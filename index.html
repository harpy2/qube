<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QUBE â€” í’€ì–´ë¼. íƒˆì¶œí•˜ë¼.</title>
<meta name="description" content="ë°©íƒˆì¶œ ì¶”ë¦¬ í¼ì¦ ê²Œì„. ë‹¨ì„œë¥¼ ì°¾ê³ , í¼ì¦ì„ í’€ê³ , íƒˆì¶œí•˜ë¼.">
<meta property="og:title" content="QUBE â€” ë°©íƒˆì¶œ ì¶”ë¦¬ í¼ì¦ ê²Œì„">
<meta property="og:description" content="í’€ì–´ë¼. íƒˆì¶œí•˜ë¼.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://qube.salmonholic.com">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ”’</text></svg>">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#0a0a0a;--bg2:#111;--bg3:#1a1a1a;
  --text:#e0e0e0;--text2:#888;--text3:#555;
  --accent:#b44aff;--accent2:#9333ea;--accent-glow:rgba(180,74,255,.15);
  --cyan:#00e5ff;--danger:#ff4444;--success:#00ff88;
  --card:rgba(255,255,255,.03);--card-border:rgba(255,255,255,.06);
}
html{scroll-behavior:smooth}
body{background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Noto Sans KR',sans-serif;line-height:1.6;overflow-x:hidden}
.hidden{display:none!important}
.hero{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;position:relative;overflow:hidden;padding:2rem}
.hero::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at 50% 40%,rgba(180,74,255,.06) 0%,transparent 70%);pointer-events:none}
.hero h1{font-size:clamp(3rem,10vw,6rem);font-weight:900;letter-spacing:0.1em;margin-bottom:1rem;background:linear-gradient(135deg,#fff 0%,#b44aff 50%,#00e5ff 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hero p{font-size:clamp(1rem,3vw,1.3rem);color:var(--text2);max-width:450px;margin-bottom:2.5rem}
.hero-cta{padding:16px 48px;background:linear-gradient(135deg,var(--accent),var(--cyan));color:#000;font-size:1.1rem;font-weight:700;border:none;border-radius:50px;cursor:pointer;transition:all .3s;letter-spacing:.05em}
.hero-cta:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(180,74,255,.4)}
.scroll-hint{position:absolute;bottom:2rem;animation:bounce 2s infinite;color:var(--text3);font-size:1.5rem}
@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(10px)}}
.particles{position:absolute;inset:0;pointer-events:none;overflow:hidden}
.particle{position:absolute;width:3px;height:3px;border-radius:50%;opacity:.4;animation:float linear infinite}
@keyframes float{0%{transform:translateY(100vh) scale(0);opacity:0}10%{opacity:.4}90%{opacity:.4}100%{transform:translateY(-10vh) scale(1);opacity:0}}
.stats-bar{display:flex;justify-content:center;gap:40px;padding:24px 0;margin-bottom:1rem}
.stat{text-align:center}
.stat-val{font-size:2rem;font-weight:900;background:linear-gradient(135deg,var(--accent),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.stat-label{font-size:.8rem;color:var(--text2);margin-top:4px}
.series-section{max-width:700px;margin:0 auto;padding:0 1.5rem 4rem}
.series-section h2{font-size:1.5rem;margin-bottom:.5rem;display:flex;align-items:center;gap:8px}
.series-progress-text{color:var(--text2);font-size:.85rem;margin-bottom:1.5rem}
.series-card{background:var(--card);border:1px solid var(--card-border);border-radius:20px;padding:1.8rem;margin-bottom:1.2rem;backdrop-filter:blur(10px);transition:all .3s;cursor:pointer;position:relative;overflow:hidden}
.series-card:hover:not(.locked){border-color:rgba(180,74,255,.3);background:rgba(255,255,255,.05);transform:translateY(-3px);box-shadow:0 8px 30px rgba(180,74,255,.1)}
.series-card.locked{opacity:.45;filter:saturate(.3);cursor:not-allowed}
.series-card.cleared{border-color:rgba(0,255,136,.2)}
.series-lock-overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.4);backdrop-filter:blur(2px);border-radius:20px;z-index:2}
.series-lock-overlay span{font-size:1rem;color:var(--text2);background:rgba(0,0,0,.6);padding:8px 20px;border-radius:50px}
.series-header{display:flex;align-items:center;gap:16px;margin-bottom:12px}
.series-icon{font-size:2.8rem}
.series-info{flex:1}
.series-title{font-size:1.2rem;font-weight:700}
.series-diff{font-size:.85rem;color:var(--text2);margin-top:2px}
.series-diff .star{color:var(--accent)}
.series-diff .star.empty{color:var(--text3)}
.series-desc{font-size:.9rem;color:var(--text2);line-height:1.6;margin-bottom:12px}
.series-footer{display:flex;align-items:center;justify-content:space-between}
.series-chapter-progress{font-size:.85rem;color:var(--text2)}
.series-chapter-progress .done{color:var(--success)}
.series-badge{padding:4px 14px;border-radius:20px;font-size:.75rem;font-weight:700}
.badge-clear{background:var(--success);color:#000}
.badge-progress{background:var(--accent);color:#fff}
.badge-new{background:rgba(180,74,255,.2);color:var(--accent);border:1px solid rgba(180,74,255,.3)}
#chapters{max-width:700px;margin:0 auto;min-height:100vh;padding:1rem}
.chapter-header{display:flex;align-items:center;padding:1rem 0;border-bottom:1px solid var(--card-border);margin-bottom:2rem;gap:12px}
.chapter-back{background:none;border:none;color:var(--text2);font-size:1.3rem;cursor:pointer;padding:4px 8px}
.chapter-back:hover{color:var(--text)}
.chapter-series-title{font-size:1.2rem;font-weight:700;flex:1}
.chapter-series-desc{color:var(--text2);font-size:.9rem;line-height:1.7;margin-bottom:2rem;padding:0 .5rem}
.chapter-timeline{position:relative;padding-left:32px}
.chapter-timeline::before{content:'';position:absolute;left:11px;top:20px;bottom:20px;width:2px;background:linear-gradient(to bottom,var(--accent),var(--cyan));opacity:.3}
.chapter-item{position:relative;margin-bottom:1.5rem}
.chapter-dot{position:absolute;left:-32px;top:18px;width:22px;height:22px;border-radius:50%;border:2px solid var(--text3);background:var(--bg);display:flex;align-items:center;justify-content:center;font-size:.7rem;z-index:1}
.chapter-item.unlocked .chapter-dot{border-color:var(--accent);box-shadow:0 0 8px rgba(180,74,255,.4)}
.chapter-item.cleared .chapter-dot{border-color:var(--success);background:var(--success);color:#000}
.chapter-card{background:var(--card);border:1px solid var(--card-border);border-radius:16px;padding:1.3rem 1.5rem;transition:all .3s}
.chapter-item.unlocked .chapter-card{border-color:rgba(180,74,255,.2)}
.chapter-item.unlocked .chapter-card:hover{border-color:rgba(180,74,255,.4);background:rgba(255,255,255,.05);transform:translateX(4px)}
.chapter-item.locked .chapter-card{opacity:.4;filter:saturate(.3)}
.chapter-card-title{font-size:1.05rem;font-weight:700;margin-bottom:4px}
.chapter-card-desc{font-size:.85rem;color:var(--text2);margin-bottom:10px}
.chapter-card-meta{display:flex;align-items:center;gap:12px;font-size:.8rem;color:var(--text2)}
.chapter-enter{padding:8px 20px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;border:none;border-radius:50px;cursor:pointer;font-size:.85rem;font-weight:600;transition:all .3s}
.chapter-enter:hover{box-shadow:0 4px 15px rgba(180,74,255,.4)}
.chapter-replay{padding:8px 20px;background:var(--bg3);color:var(--text2);border:1px solid var(--card-border);border-radius:50px;cursor:pointer;font-size:.85rem;transition:all .3s}
.chapter-replay:hover{border-color:var(--accent);color:var(--text)}
#game{max-width:700px;margin:0 auto;min-height:100vh;padding:1rem}
.game-header{display:flex;align-items:center;padding:1rem 0;border-bottom:1px solid var(--card-border);margin-bottom:1.5rem;gap:12px}
.game-back{background:none;border:none;color:var(--text2);font-size:1.3rem;cursor:pointer;padding:4px 8px}
.game-back:hover{color:var(--text)}
.game-title{font-size:1.1rem;font-weight:700;flex:1}
.game-progress-text{color:var(--text2);font-size:.85rem}
.progress-bar{display:flex;gap:6px;margin-bottom:1.5rem}
.prog-dot{flex:1;height:4px;border-radius:2px;background:var(--bg3);transition:all .3s}
.prog-dot.active{background:var(--accent);box-shadow:0 0 8px rgba(180,74,255,.4)}
.prog-dot.done{background:var(--success)}
.story-box{background:var(--bg3);border:1px solid var(--card-border);border-radius:16px;padding:1.5rem;margin-bottom:1.5rem;animation:fadeIn .5s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(15px)}to{opacity:1;transform:translateY(0)}}
.story-box .label{color:var(--accent);font-size:.75rem;font-weight:700;margin-bottom:8px;text-transform:uppercase;letter-spacing:.15em}
.story-box p{color:var(--text2);line-height:1.8}
.puzzle-box{background:rgba(180,74,255,.05);border:1px solid rgba(180,74,255,.15);border-radius:16px;padding:1.5rem;margin-bottom:1.5rem;animation:fadeIn .5s ease}
.puzzle-label{color:var(--cyan);font-size:.8rem;font-weight:700;margin-bottom:12px;letter-spacing:.05em}
.puzzle-question{font-size:1rem;line-height:1.8;margin-bottom:1.2rem}
.cpq-mission{background:rgba(0,229,255,.05);border:1px solid rgba(0,229,255,.15);border-radius:12px;padding:1.2rem;margin:1rem 0}
.cpq-mission .mission-title{color:var(--cyan);font-size:.8rem;font-weight:700;margin-bottom:10px}
.cpq-steps{font-size:.9rem;color:var(--text2);line-height:2;padding-left:1.2rem}
.cpq-steps b{color:var(--text)}
.cpq-keyword-box{margin-top:12px;display:flex;align-items:center;gap:10px}
.cpq-keyword{display:inline-block;background:linear-gradient(135deg,var(--accent),var(--cyan));color:#000;padding:8px 20px;border-radius:50px;font-size:.9rem;font-weight:700;cursor:pointer;transition:all .2s}
.cpq-keyword:hover{transform:scale(1.03);box-shadow:0 4px 15px rgba(180,74,255,.3)}
.hint-btn{background:none;border:1px solid var(--text3);color:var(--text2);padding:8px 16px;border-radius:50px;font-size:.8rem;cursor:pointer;transition:all .2s;margin-bottom:1rem}
.hint-btn:hover{border-color:var(--accent);color:var(--accent)}
.hint-box{background:rgba(255,165,0,.08);border:1px solid rgba(255,165,0,.2);border-radius:10px;padding:12px 16px;font-size:.9rem;color:#f59e0b;margin-bottom:1rem}
.answer-area{display:flex;flex-direction:column;gap:10px}
.answer-area input{width:100%;padding:14px 18px;background:var(--bg3);border:1px solid var(--card-border);border-radius:12px;color:var(--text);font-size:1rem;font-family:inherit;outline:none;transition:border-color .3s}
.answer-area input:focus{border-color:var(--accent)}
.answer-area input::placeholder{color:var(--text3)}
.btn-submit{width:100%;padding:14px 28px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;border:none;border-radius:12px;font-weight:700;cursor:pointer;transition:all .2s;white-space:nowrap;font-family:inherit;font-size:.95rem}
.btn-submit:hover{box-shadow:0 4px 15px rgba(180,74,255,.4)}
.btn-next{width:100%;padding:14px;background:linear-gradient(135deg,var(--accent),var(--cyan));color:#000;border:none;border-radius:50px;font-weight:700;cursor:pointer;transition:all .3s;font-size:1rem;font-family:inherit;margin-top:1rem}
.btn-next:hover{box-shadow:0 4px 20px rgba(180,74,255,.4);transform:translateY(-1px)}
.feedback{padding:14px 18px;border-radius:12px;margin-top:1rem;font-size:.95rem;animation:fadeIn .3s}
.feedback.correct{background:rgba(0,255,136,.1);color:var(--success);border:1px solid rgba(0,255,136,.2)}
.feedback.wrong{background:rgba(255,68,68,.1);color:var(--danger);border:1px solid rgba(255,68,68,.2)}
.cliffhanger-box{background:linear-gradient(135deg,rgba(180,74,255,.08),rgba(0,229,255,.08));border:1px solid rgba(180,74,255,.25);border-radius:16px;padding:2rem;margin:1.5rem 0;text-align:center;animation:fadeIn .8s ease}
.cliffhanger-box .label{color:var(--cyan);font-size:.75rem;font-weight:700;margin-bottom:12px;letter-spacing:.2em}
.cliffhanger-box p{color:var(--text);line-height:2;font-size:1.05rem;font-style:italic}
.series-clear-box{text-align:center;padding:2rem 0;animation:fadeIn .5s}
.series-clear-emoji{font-size:4rem;margin-bottom:1rem}
.series-clear-title{font-size:1.8rem;font-weight:900;background:linear-gradient(135deg,#fff,var(--accent),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:.5rem}
.series-clear-sub{color:var(--text2);margin-bottom:1.5rem}
#result{max-width:600px;margin:0 auto;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:2rem}
.result-card{text-align:center;width:100%}
.result-emoji{font-size:4rem;margin-bottom:1rem}
.result-title{font-size:2rem;font-weight:900;margin-bottom:.5rem;background:linear-gradient(135deg,#fff,var(--accent),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.result-sub{color:var(--text2);margin-bottom:2rem}
.result-grade{display:inline-block;font-size:1.5rem;font-weight:900;padding:10px 30px;border-radius:50px;background:linear-gradient(135deg,var(--accent),var(--cyan));color:#000;margin-bottom:2rem}
.result-stats{display:flex;justify-content:center;gap:20px;margin-bottom:2rem;flex-wrap:wrap}
.result-stat{background:var(--card);border:1px solid var(--card-border);border-radius:16px;padding:18px 24px;min-width:100px}
.result-stat-val{font-size:1.5rem;font-weight:900;color:var(--accent)}
.result-stat-label{font-size:.75rem;color:var(--text2);margin-top:4px}
.result-btns{display:flex;flex-direction:column;gap:10px;max-width:300px;margin:0 auto}
.btn-home{padding:14px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;border:none;border-radius:50px;font-weight:700;cursor:pointer;font-size:1rem;font-family:inherit;transition:all .3s}
.btn-home:hover{box-shadow:0 4px 15px rgba(180,74,255,.4)}
.btn-share{padding:14px;background:transparent;border:1px solid var(--card-border);color:var(--text2);border-radius:50px;cursor:pointer;font-size:.9rem;font-family:inherit;transition:all .2s}
.btn-share:hover{border-color:var(--accent);color:var(--text)}
.loading-screen{display:none;position:fixed;inset:0;background:var(--bg);z-index:1000;flex-direction:column;align-items:center;justify-content:center;gap:16px}
.loading-screen.active{display:flex}
.spinner{width:40px;height:40px;border:3px solid var(--bg3);border-top-color:var(--accent);border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-text{color:var(--text2);font-size:.9rem}
.confetti-container{position:fixed;inset:0;pointer-events:none;z-index:999;overflow:hidden}
.confetti-piece{position:absolute;width:10px;height:10px;top:-20px;animation:confettiFall 3s ease-in forwards}
@keyframes confettiFall{0%{transform:translateY(0) rotate(0deg);opacity:1}100%{transform:translateY(100vh) rotate(720deg);opacity:0}}

/* â•â•â• Interactive Puzzle Styles â•â•â• */

/* Flashlight */
.flashlight-area{position:relative;width:100%;height:300px;border-radius:12px;overflow:hidden;cursor:none;touch-action:none;margin-bottom:16px;background:#111}
.flashlight-overlay{position:absolute;inset:0;background:radial-gradient(circle 60px at var(--fx,50%) var(--fy,50%),transparent 0%,rgba(0,0,0,.97) 100%);z-index:2;pointer-events:none;transition:none}
.flashlight-item{position:absolute;color:var(--cyan);font-size:1.5rem;font-weight:900;z-index:1;user-select:none;text-shadow:0 0 8px var(--cyan)}
.flashlight-hint-text{text-align:center;color:var(--text3);font-size:.85rem;margin-bottom:12px}

/* Jigsaw */
.jigsaw-area{display:grid;gap:8px;margin-bottom:16px}
.jigsaw-slots{display:grid;gap:8px;margin-bottom:16px}
.jigsaw-slot{background:rgba(180,74,255,.08);border:2px dashed rgba(180,74,255,.3);border-radius:10px;min-height:60px;display:flex;align-items:center;justify-content:center;font-size:.8rem;color:var(--text3);transition:all .3s}
.jigsaw-slot.hover{border-color:var(--cyan);background:rgba(0,229,255,.1)}
.jigsaw-slot.correct{border-color:var(--success);background:rgba(0,255,136,.1);border-style:solid}
.jigsaw-piece{background:var(--bg3);border:1px solid var(--accent);border-radius:10px;padding:12px 16px;cursor:grab;user-select:none;touch-action:none;font-size:.9rem;color:var(--text);transition:all .2s;text-align:center}
.jigsaw-piece:active{cursor:grabbing;transform:scale(1.05);box-shadow:0 4px 15px rgba(180,74,255,.3)}
.jigsaw-piece.placed{opacity:.4;pointer-events:none}
.jigsaw-tray{display:flex;flex-wrap:wrap;gap:8px;padding:12px;background:var(--bg2);border-radius:12px;margin-bottom:16px;justify-content:center}
.jigsaw-reveal{text-align:center;font-size:1.3rem;font-weight:700;color:var(--success);padding:16px;animation:fadeIn .5s}

/* Dial */
.dial-container{display:flex;flex-direction:column;align-items:center;gap:20px;margin-bottom:16px}
.dial-row{display:flex;gap:16px;align-items:center}
.dial-digit{display:flex;flex-direction:column;align-items:center;gap:6px}
.dial-digit .label{font-size:.75rem;color:var(--text3)}
.dial-ring{width:70px;height:70px;border-radius:50%;border:3px solid var(--accent);display:flex;align-items:center;justify-content:center;font-size:1.8rem;font-weight:900;color:var(--text);cursor:pointer;user-select:none;transition:all .2s;background:var(--bg3)}
.dial-ring:hover{border-color:var(--cyan);box-shadow:0 0 15px rgba(0,229,255,.3)}
.dial-ring:active{transform:scale(.95)}
.dial-arrows{display:flex;flex-direction:column;gap:2px}
.dial-arrow{width:70px;padding:4px;background:var(--bg3);border:1px solid var(--card-border);border-radius:6px;cursor:pointer;text-align:center;font-size:1rem;color:var(--text2);transition:all .2s}
.dial-arrow:hover{border-color:var(--accent);color:var(--text)}
.dial-lock-btn{padding:12px 32px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;border:none;border-radius:50px;cursor:pointer;font-weight:700;font-size:.95rem;transition:all .2s}
.dial-lock-btn:hover{box-shadow:0 4px 15px rgba(180,74,255,.4)}
.dial-result{font-size:.9rem;margin-top:8px;min-height:24px}

/* Piano */
.piano-area{margin-bottom:16px}
.piano-keys{display:flex;gap:4px;justify-content:center;margin-bottom:12px;flex-wrap:wrap}
.piano-key{width:48px;height:120px;border-radius:0 0 8px 8px;cursor:pointer;display:flex;flex-direction:column;align-items:center;justify-content:flex-end;padding-bottom:10px;font-size:.75rem;font-weight:700;transition:all .1s;user-select:none;border:1px solid rgba(255,255,255,.1)}
.piano-key.white{background:linear-gradient(180deg,#e8e8e8,#fff);color:#333}
.piano-key.black{background:linear-gradient(180deg,#222,#444);color:#aaa;height:80px;width:36px;margin:0 -10px;z-index:2;border-color:rgba(0,0,0,.3)}
.piano-key:active,.piano-key.pressed{transform:scaleY(.97);filter:brightness(.8)}
.piano-key.correct-flash{background:var(--success)!important;color:#000!important}
.piano-sequence{display:flex;gap:6px;justify-content:center;flex-wrap:wrap;margin-bottom:12px}
.piano-seq-dot{width:28px;height:28px;border-radius:50%;border:2px solid var(--text3);display:flex;align-items:center;justify-content:center;font-size:.7rem;color:var(--text3)}
.piano-seq-dot.hit{border-color:var(--success);color:var(--success);background:rgba(0,255,136,.1)}
.piano-seq-dot.miss{border-color:var(--danger);color:var(--danger);background:rgba(255,68,68,.1)}
.piano-display{text-align:center;color:var(--text2);font-size:.85rem;margin-bottom:12px}

/* Hidden Text */
.hidden-text-area{padding:20px;background:var(--bg2);border-radius:12px;margin-bottom:16px;line-height:2.2;font-size:1rem;user-select:text;cursor:text}
.hidden-text-area .secret{color:transparent;background:transparent;transition:color .3s,background .3s;border-radius:4px;padding:2px 4px}
.hidden-text-area .secret::selection{color:var(--cyan);background:rgba(0,229,255,.2)}
.hidden-text-area .secret::-moz-selection{color:var(--cyan);background:rgba(0,229,255,.2)}
.hidden-text-area .secret.revealed{color:var(--cyan);background:rgba(0,229,255,.1)}
.hidden-text-hint{text-align:center;color:var(--text3);font-size:.8rem;margin-bottom:12px;font-style:italic}

/* Timing */
.timing-area{margin-bottom:16px}
.timing-track{position:relative;width:100%;height:50px;background:var(--bg2);border-radius:25px;overflow:hidden;margin-bottom:12px;border:1px solid var(--card-border)}
.timing-zone{position:absolute;height:100%;background:rgba(0,255,136,.15);border-left:2px solid var(--success);border-right:2px solid var(--success)}
.timing-cursor{position:absolute;top:5px;bottom:5px;width:8px;background:var(--accent);border-radius:4px;box-shadow:0 0 10px var(--accent);transition:none}
.timing-btn{display:block;width:100%;padding:16px;background:linear-gradient(135deg,var(--accent),var(--cyan));color:#000;border:none;border-radius:12px;font-size:1.1rem;font-weight:700;cursor:pointer;transition:all .1s;font-family:inherit}
.timing-btn:active{transform:scale(.97)}
.timing-btn:disabled{opacity:.5;cursor:not-allowed}
.timing-progress{display:flex;gap:8px;justify-content:center;margin-bottom:12px}
.timing-pip{width:32px;height:32px;border-radius:50%;border:2px solid var(--text3);display:flex;align-items:center;justify-content:center;font-size:.9rem}
.timing-pip.hit{border-color:var(--success);color:var(--success);background:rgba(0,255,136,.1)}
.timing-pip.miss{border-color:var(--danger);color:var(--danger);background:rgba(255,68,68,.1)}

/* Connect Dots */
.dots-area{position:relative;width:100%;height:300px;background:var(--bg2);border-radius:12px;margin-bottom:16px;overflow:hidden;touch-action:none}
.dots-area svg{position:absolute;inset:0;width:100%;height:100%}
.dot-point{cursor:pointer;transition:all .2s}
.dot-point:hover circle{r:14;fill:rgba(180,74,255,.3)}
.dot-label{font-size:12px;fill:var(--text);font-weight:700;pointer-events:none;text-anchor:middle;dominant-baseline:central}
.dot-line{stroke:var(--cyan);stroke-width:2;stroke-linecap:round;fill:none;opacity:.7}
.dots-reveal{text-align:center;font-size:1.2rem;font-weight:700;color:var(--success);padding:12px;animation:fadeIn .5s}

/* Color Code */
.color-grid{display:flex;gap:16px;justify-content:center;flex-wrap:wrap;margin-bottom:16px}
.color-item{display:flex;flex-direction:column;align-items:center;gap:6px}
.color-circle{width:56px;height:56px;border-radius:50%;border:3px solid rgba(255,255,255,.1);box-shadow:0 4px 12px rgba(0,0,0,.3)}
.color-name{font-size:.75rem;color:var(--text2)}
.color-hint{text-align:center;color:var(--text2);font-size:.9rem;margin-bottom:16px;line-height:1.8}

/* Mirror */
.mirror-area{padding:24px;background:var(--bg2);border-radius:12px;margin-bottom:16px;text-align:center;overflow:hidden}
.mirror-text{font-size:1.8rem;font-weight:900;color:var(--text);letter-spacing:.15em;display:inline-block;line-height:1.6}
.mirror-text.flip-h{transform:scaleX(-1)}
.mirror-text.flip-v{transform:scaleY(-1)}
.mirror-text.flip-both{transform:scale(-1)}
.mirror-label{color:var(--text3);font-size:.8rem;margin-top:10px}

/* Shake */
.shake-area{text-align:center;margin-bottom:16px}
.shake-icon{font-size:4rem;display:inline-block;animation:none}
.shake-icon.shaking{animation:shakeAnim .1s infinite}
@keyframes shakeAnim{0%{transform:rotate(-5deg)}50%{transform:rotate(5deg)}100%{transform:rotate(-5deg)}}
.shake-progress{margin:16px auto;width:80%;max-width:300px}
.shake-bar{height:12px;background:var(--bg3);border-radius:6px;overflow:hidden;border:1px solid var(--card-border)}
.shake-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--cyan));border-radius:6px;transition:width .15s;width:0%}
.shake-count{font-size:.85rem;color:var(--text2);margin-top:8px}
.shake-instruction{font-size:.9rem;color:var(--text2);margin-bottom:12px}
.shake-reveal{font-size:1.1rem;color:var(--cyan);font-weight:700;margin-top:16px;animation:fadeIn .5s}
.shake-spacebar{padding:14px 32px;background:var(--bg3);border:2px solid var(--accent);color:var(--text);border-radius:12px;font-size:1rem;font-weight:700;cursor:pointer;transition:all .1s;font-family:inherit;margin-top:8px}
.shake-spacebar:active{background:var(--accent);color:#000;transform:scale(.97)}

@media(max-width:600px){
  .hero h1{letter-spacing:.05em}
  .stats-bar{gap:24px}
  .result-stats{gap:12px}
  .series-card{padding:1.3rem}
  .chapter-timeline{padding-left:28px}
  .piano-key{width:38px;height:100px}
  .piano-key.black{width:28px;height:65px;margin:0 -8px}
  .dial-ring{width:56px;height:56px;font-size:1.4rem}
  .flashlight-area{height:250px}
  .dots-area{height:250px}
}
</style>
</head>
<body>

<div id="home">
  <div class="hero">
    <div class="particles" id="particles"></div>
    <h1>QUBE</h1>
    <p>í’€ì–´ë¼. íƒˆì¶œí•˜ë¼.</p>
    <button class="hero-cta" onclick="scrollToSeries()">ì‹œë¦¬ì¦ˆ ì„ íƒí•˜ê¸°</button>
    <div class="scroll-hint">â†“</div>
  </div>
  <div class="stats-bar">
    <div class="stat"><div class="stat-val" id="statCleared">0</div><div class="stat-label">í´ë¦¬ì–´</div></div>
    <div class="stat"><div class="stat-val" id="statGrade">ğŸ”°</div><div class="stat-label">ë“±ê¸‰</div></div>
    <div class="stat"><div class="stat-val" id="statStreak">0</div><div class="stat-label">ì‹œë¦¬ì¦ˆ</div></div>
  </div>
  <div class="series-section" id="series-section">
    <h2>ğŸ“– ë¯¸ìŠ¤í„°ë¦¬ ì‹œë¦¬ì¦ˆ</h2>
    <div class="series-progress-text" id="seriesProgressText"></div>
    <div id="seriesGrid"></div>
  </div>
</div>

<div id="chapters" class="hidden"></div>

<div class="loading-screen" id="loadingScreen">
  <div class="spinner"></div>
  <div class="loading-text">ì§„ì… ì¤‘...</div>
</div>

<div id="game" class="hidden">
  <div class="game-header">
    <button class="game-back" onclick="confirmExit()">â†</button>
    <div class="game-title" id="gameTitle"></div>
    <div class="game-progress-text" id="gameProgressText"></div>
  </div>
  <div class="progress-bar" id="progressBar"></div>
  <div id="gameContent"></div>
</div>

<div id="result" class="hidden">
  <div class="result-card" id="resultContent"></div>
</div>

<script>
var API = 'https://qube-api.harpy922.workers.dev';

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Interactive Puzzle Renderers
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

var _activeTimingAnim = null;
var _activePianoCtx = null;

function cleanupInteractive() {
  if (_activeTimingAnim) { cancelAnimationFrame(_activeTimingAnim); _activeTimingAnim = null; }
}

// â”€â”€ Flashlight â”€â”€
function initFlashlight(cfg) {
  var area = document.getElementById('interactiveArea');
  var itemsHtml = '';
  cfg.items.forEach(function(it) {
    itemsHtml += '<div class="flashlight-item" style="left:'+it.x+'%;top:'+it.y+'%">'+it.text+'</div>';
  });
  area.innerHTML = '<div class="flashlight-hint-text">ğŸ”¦ ì–´ë‘  ì†ì„ ë¹„ì¶° ìˆ¨ê²¨ì§„ ë‹¨ì„œë¥¼ ì°¾ìœ¼ì„¸ìš” (ë§ˆìš°ìŠ¤/í„°ì¹˜ ì´ë™)</div>' +
    '<div class="flashlight-area" id="flArea">' + itemsHtml +
    '<div class="flashlight-overlay" id="flOverlay"></div></div>';
  var el = document.getElementById('flArea');
  var ov = document.getElementById('flOverlay');
  function updatePos(x, y) {
    var r = el.getBoundingClientRect();
    var px = ((x - r.left) / r.width * 100);
    var py = ((y - r.top) / r.height * 100);
    ov.style.setProperty('--fx', px + '%');
    ov.style.setProperty('--fy', py + '%');
  }
  el.addEventListener('mousemove', function(e) { updatePos(e.clientX, e.clientY); });
  el.addEventListener('touchmove', function(e) {
    e.preventDefault();
    var t = e.touches[0];
    updatePos(t.clientX, t.clientY);
  }, {passive:false});
}

// â”€â”€ Jigsaw â”€â”€
function initJigsaw(cfg) {
  var area = document.getElementById('interactiveArea');
  var slotsHtml = '<div class="jigsaw-slots" style="grid-template-columns:repeat('+cfg.cols+',1fr)">';
  for (var i = 0; i < cfg.pieces.length; i++) {
    slotsHtml += '<div class="jigsaw-slot" data-slot="'+i+'" id="jslot'+i+'"><span>ìŠ¬ë¡¯ '+(i+1)+'</span></div>';
  }
  slotsHtml += '</div>';
  // Shuffle pieces
  var indices = cfg.pieces.map(function(_,i){return i;});
  for(var j=indices.length-1;j>0;j--){var k=Math.floor(Math.random()*(j+1));var tmp=indices[j];indices[j]=indices[k];indices[k]=tmp;}
  var trayHtml = '<div class="jigsaw-tray" id="jigsawTray">';
  indices.forEach(function(pi) {
    trayHtml += '<div class="jigsaw-piece" draggable="true" data-piece="'+pi+'" id="jpiece'+pi+'">'+cfg.pieces[pi]+'</div>';
  });
  trayHtml += '</div>';
  area.innerHTML = trayHtml + slotsHtml + '<div id="jigsawReveal"></div>';

  // State
  var placed = {};
  var pieces = document.querySelectorAll('.jigsaw-piece');
  var slots = document.querySelectorAll('.jigsaw-slot');

  // Drag events
  pieces.forEach(function(p) {
    p.addEventListener('dragstart', function(e) { e.dataTransfer.setData('text/plain', p.dataset.piece); });
    // Touch drag
    var startX, startY, clone;
    p.addEventListener('touchstart', function(e) {
      var t = e.touches[0];
      startX = t.clientX; startY = t.clientY;
      clone = p.cloneNode(true);
      clone.style.position='fixed'; clone.style.zIndex='999'; clone.style.opacity='.8';
      clone.style.pointerEvents='none'; clone.style.width=p.offsetWidth+'px';
      document.body.appendChild(clone);
      clone.style.left=(t.clientX-30)+'px'; clone.style.top=(t.clientY-20)+'px';
    }, {passive:true});
    p.addEventListener('touchmove', function(e) {
      e.preventDefault();
      if(clone){var t=e.touches[0]; clone.style.left=(t.clientX-30)+'px'; clone.style.top=(t.clientY-20)+'px';}
    }, {passive:false});
    p.addEventListener('touchend', function(e) {
      if(clone){clone.remove();clone=null;}
      var t = e.changedTouches[0];
      var el = document.elementFromPoint(t.clientX, t.clientY);
      if(el && el.classList.contains('jigsaw-slot')) {
        handleDrop(el, p.dataset.piece);
      }
    });
  });

  slots.forEach(function(s) {
    s.addEventListener('dragover', function(e){e.preventDefault();s.classList.add('hover');});
    s.addEventListener('dragleave', function(){s.classList.remove('hover');});
    s.addEventListener('drop', function(e){
      e.preventDefault(); s.classList.remove('hover');
      handleDrop(s, e.dataTransfer.getData('text/plain'));
    });
  });

  function handleDrop(slot, pieceId) {
    var si = parseInt(slot.dataset.slot);
    var pi = parseInt(pieceId);
    if(cfg.correctOrder[pi] === si) {
      placed[pi] = true;
      slot.classList.add('correct');
      slot.innerHTML = '<span style="color:var(--success)">'+cfg.pieces[pi]+'</span>';
      var pc = document.getElementById('jpiece'+pi);
      if(pc) pc.classList.add('placed');
      if(Object.keys(placed).length === cfg.pieces.length) {
        document.getElementById('jigsawReveal').innerHTML = '<div class="jigsaw-reveal">ğŸ§© '+cfg.revealText+'</div>';
      }
    } else {
      slot.classList.add('hover');
      setTimeout(function(){slot.classList.remove('hover');},300);
    }
  }
}

// â”€â”€ Dial â”€â”€
function initDial(cfg) {
  var area = document.getElementById('interactiveArea');
  var html = '<div class="dial-container">';
  html += '<div class="dial-row">';
  cfg.combination.forEach(function(_, i) {
    html += '<div class="dial-digit">';
    html += '<div class="dial-arrows"><button class="dial-arrow" onclick="dialChange('+i+',1)">â–²</button></div>';
    html += '<div class="dial-ring" id="dialRing'+i+'" onclick="dialChange('+i+',1)">0</div>';
    html += '<div class="dial-arrows"><button class="dial-arrow" onclick="dialChange('+i+',-1)">â–¼</button></div>';
    if(cfg.labels && cfg.labels[i]) html += '<div class="label">'+cfg.labels[i]+'</div>';
    html += '</div>';
  });
  html += '</div>';
  html += '<button class="dial-lock-btn" onclick="dialCheck()">ğŸ”“ ìë¬¼ì‡  ì—´ê¸°</button>';
  html += '<div class="dial-result" id="dialResult"></div>';
  html += '</div>';
  area.innerHTML = html;
  window._dialValues = cfg.combination.map(function(){return 0;});
  window._dialTarget = cfg.combination;
}
function dialChange(i, dir) {
  window._dialValues[i] = (window._dialValues[i] + dir + 10) % 10;
  document.getElementById('dialRing'+i).textContent = window._dialValues[i];
}
function dialCheck() {
  var ok = true;
  for(var i=0;i<window._dialTarget.length;i++){
    if(window._dialValues[i] !== window._dialTarget[i]) ok=false;
  }
  var res = document.getElementById('dialResult');
  if(ok) {
    res.innerHTML = '<span style="color:var(--success)">ğŸ”“ ìë¬¼ì‡ ê°€ ì—´ë ¸ë‹¤!</span>';
    var inp = document.getElementById('answerInput');
    if(inp) inp.value = window._dialTarget.join('');
  } else {
    res.innerHTML = '<span style="color:var(--danger)">ë”¸ê¹... ì—´ë¦¬ì§€ ì•ŠëŠ”ë‹¤.</span>';
    setTimeout(function(){res.innerHTML='';},1500);
  }
}

// â”€â”€ Piano â”€â”€
function initPiano(cfg) {
  var area = document.getElementById('interactiveArea');
  var notes = cfg.keys || ['C','D','E','F','G','A','B'];
  var noteNames = {'C':'ë„','D':'ë ˆ','E':'ë¯¸','F':'íŒŒ','G':'ì†”','A':'ë¼','B':'ì‹œ'};
  var freqs = {'C':261.63,'D':293.66,'E':329.63,'F':349.23,'G':392,'A':440,'B':493.88};
  var isBlack = {'C':false,'D':false,'E':false,'F':false,'G':false,'A':false,'B':false,'C#':true,'D#':true,'F#':true,'G#':true,'A#':true};

  var keysHtml = '<div class="piano-keys">';
  notes.forEach(function(n) {
    var cls = isBlack[n] ? 'black' : 'white';
    keysHtml += '<div class="piano-key '+cls+'" data-note="'+n+'" onclick="pianoPress(\''+n+'\')">'+(noteNames[n]||n)+'</div>';
  });
  keysHtml += '</div>';

  var seqHtml = '<div class="piano-display">ì—°ì£¼í•  ìˆœì„œ: <b>'+cfg.display+'</b></div>';
  seqHtml += '<div class="piano-sequence" id="pianoSeq">';
  cfg.sequence.forEach(function(_, i) {
    seqHtml += '<div class="piano-seq-dot" id="pseq'+i+'">'+(i+1)+'</div>';
  });
  seqHtml += '</div>';

  area.innerHTML = seqHtml + keysHtml;
  window._pianoSeq = cfg.sequence;
  window._pianoPos = 0;
  window._pianoFailed = false;

  // Setup audio
  try { if(!_activePianoCtx) _activePianoCtx = new (window.AudioContext||window.webkitAudioContext)(); }
  catch(e) { _activePianoCtx = null; }
  window._pianoFreqs = freqs;
}
function pianoPress(note) {
  // Play sound
  if(_activePianoCtx) {
    try {
      var osc = _activePianoCtx.createOscillator();
      var gain = _activePianoCtx.createGain();
      osc.connect(gain); gain.connect(_activePianoCtx.destination);
      osc.frequency.value = window._pianoFreqs[note] || 440;
      osc.type = 'sine';
      gain.gain.setValueAtTime(0.3, _activePianoCtx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, _activePianoCtx.currentTime + 0.5);
      osc.start(); osc.stop(_activePianoCtx.currentTime + 0.5);
    } catch(e){}
  }
  // Visual feedback
  var keys = document.querySelectorAll('.piano-key[data-note="'+note+'"]');
  keys.forEach(function(k){k.classList.add('pressed');setTimeout(function(){k.classList.remove('pressed');},200);});

  if(window._pianoFailed) return;
  var expected = window._pianoSeq[window._pianoPos];
  var dot = document.getElementById('pseq'+window._pianoPos);
  if(note === expected) {
    dot.classList.add('hit');
    window._pianoPos++;
    if(window._pianoPos >= window._pianoSeq.length) {
      // Auto-fill answer
      var inp = document.getElementById('answerInput');
      if(inp && window._pianoAnswer) inp.value = window._pianoAnswer;
      keys.forEach(function(k){k.classList.add('correct-flash');});
    }
  } else {
    dot.classList.add('miss');
    window._pianoFailed = true;
    setTimeout(function(){
      window._pianoPos = 0;
      window._pianoFailed = false;
      document.querySelectorAll('.piano-seq-dot').forEach(function(d){d.classList.remove('hit','miss');});
    }, 800);
  }
}

// â”€â”€ Hidden Text â”€â”€
function initHiddenText(cfg) {
  var area = document.getElementById('interactiveArea');
  var html = '<div class="hidden-text-hint">ğŸ’¡ í…ìŠ¤íŠ¸ë¥¼ ë“œë˜ê·¸(ì„ íƒ)í•˜ì—¬ ìˆ¨ê²¨ì§„ ê¸€ìë¥¼ ì°¾ìœ¼ì„¸ìš”</div>';
  html += '<div class="hidden-text-area" id="htArea">';
  cfg.segments.forEach(function(seg) {
    if(seg.hidden) {
      html += '<span class="secret" onclick="this.classList.toggle(\'revealed\')">'+seg.text+'</span>';
    } else {
      html += '<span>'+seg.text+'</span>';
    }
  });
  html += '</div>';
  area.innerHTML = html;
}

// â”€â”€ Timing â”€â”€
function initTiming(cfg) {
  var area = document.getElementById('interactiveArea');
  var zoneStart = (cfg.zoneStart || 0.35) * 100;
  var zoneEnd = (cfg.zoneEnd || 0.55) * 100;
  var required = cfg.required || 3;
  var html = '<div class="timing-area">';
  html += '<div class="timing-progress" id="timingPips">';
  for(var i=0;i<required;i++) html += '<div class="timing-pip" id="tpip'+i+'">'+(i+1)+'</div>';
  html += '</div>';
  html += '<div class="timing-track"><div class="timing-zone" style="left:'+zoneStart+'%;width:'+(zoneEnd-zoneStart)+'%"></div>';
  html += '<div class="timing-cursor" id="timingCursor"></div></div>';
  html += '<button class="timing-btn" id="timingBtn" onclick="timingHit()">âš¡ íƒ€ì´ë° ë§ì¶”ê¸°!</button>';
  html += '</div>';
  area.innerHTML = html;

  window._timingState = {hits:0, required:required, zs:cfg.zoneStart||0.35, ze:cfg.zoneEnd||0.55, pos:0, dir:1, speed:cfg.speed||0.008, running:true, revealText:cfg.revealText||''};
  var cursor = document.getElementById('timingCursor');
  function animate() {
    if(!window._timingState.running) return;
    var s = window._timingState;
    s.pos += s.dir * s.speed;
    if(s.pos >= 1) { s.pos = 1; s.dir = -1; }
    if(s.pos <= 0) { s.pos = 0; s.dir = 1; }
    cursor.style.left = (s.pos * 95) + '%';
    _activeTimingAnim = requestAnimationFrame(animate);
  }
  animate();
}
function timingHit() {
  var s = window._timingState;
  if(!s || !s.running) return;
  var inZone = s.pos >= s.zs && s.pos <= s.ze;
  var pip = document.getElementById('tpip'+s.hits);
  if(inZone) {
    if(pip) pip.classList.add('hit');
    s.hits++;
    if(s.hits >= s.required) {
      s.running = false;
      document.getElementById('timingBtn').disabled = true;
      document.getElementById('timingBtn').textContent = 'âœ… ì„±ê³µ!';
      if(s.revealText) {
        var inp = document.getElementById('answerInput');
        if(inp) inp.value = s.revealText;
      }
    } else {
      s.speed += 0.003; // gets faster
    }
  } else {
    if(pip) pip.classList.add('miss');
    setTimeout(function(){
      s.hits = 0;
      document.querySelectorAll('.timing-pip').forEach(function(p){p.classList.remove('hit','miss');});
    }, 500);
  }
}

// â”€â”€ Connect Dots â”€â”€
function initConnectDots(cfg) {
  var area = document.getElementById('interactiveArea');
  var html = '<div class="dots-area" id="dotsArea"><svg id="dotsSvg">';
  // Lines placeholder
  html += '<g id="dotsLines"></g>';
  // Dots
  cfg.dots.forEach(function(d, i) {
    html += '<g class="dot-point" data-order="'+d.order+'" onclick="dotClick('+d.order+')">';
    html += '<circle cx="'+d.x+'%" cy="'+d.y+'%" r="12" fill="rgba(180,74,255,.15)" stroke="var(--accent)" stroke-width="2"/>';
    html += '<text class="dot-label" x="'+d.x+'%" y="'+d.y+'%">'+d.order+'</text>';
    html += '</g>';
  });
  html += '</svg></div><div id="dotsReveal"></div>';
  area.innerHTML = html;
  window._dotsState = {current:1, total:cfg.dots.length, dots:cfg.dots, revealText:cfg.revealText||''};
}
function dotClick(order) {
  var s = window._dotsState;
  if(order !== s.current) return;
  // Highlight dot
  var dot = document.querySelector('.dot-point[data-order="'+order+'"] circle');
  if(dot) { dot.setAttribute('fill','rgba(0,255,136,.3)'); dot.setAttribute('stroke','var(--success)'); }
  // Draw line from previous
  if(s.current > 1) {
    var prev = s.dots.find(function(d){return d.order===s.current-1;});
    var curr = s.dots.find(function(d){return d.order===s.current;});
    if(prev && curr) {
      var svg = document.getElementById('dotsLines');
      var line = document.createElementNS('http://www.w3.org/2000/svg','line');
      line.setAttribute('x1',prev.x+'%'); line.setAttribute('y1',prev.y+'%');
      line.setAttribute('x2',curr.x+'%'); line.setAttribute('y2',curr.y+'%');
      line.setAttribute('class','dot-line');
      svg.appendChild(line);
    }
  }
  s.current++;
  if(s.current > s.total) {
    document.getElementById('dotsReveal').innerHTML = '<div class="dots-reveal">âœ¨ '+s.revealText+'</div>';
    var inp = document.getElementById('answerInput');
    if(inp && s.answerFill) inp.value = s.answerFill;
  }
}

// â”€â”€ Color Code â”€â”€
function initColorCode(cfg) {
  var area = document.getElementById('interactiveArea');
  var html = '<div class="color-grid">';
  cfg.colors.forEach(function(c) {
    html += '<div class="color-item"><div class="color-circle" style="background:'+c.color+'"></div><div class="color-name">'+c.name+'</div></div>';
  });
  html += '</div>';
  html += '<div class="color-hint">'+cfg.clueText+'</div>';
  area.innerHTML = html;
}

// â”€â”€ Mirror â”€â”€
function initMirror(cfg) {
  var area = document.getElementById('interactiveArea');
  var cls = 'mirror-text';
  if(cfg.direction === 'horizontal') cls += ' flip-h';
  else if(cfg.direction === 'vertical') cls += ' flip-v';
  else if(cfg.direction === 'both') cls += ' flip-both';
  area.innerHTML = '<div class="mirror-area"><div class="'+cls+'">'+cfg.text+'</div>' +
    '<div class="mirror-label">ğŸª ê±°ìš¸ì— ë¹„ì¹œ ê¸€ìë¥¼ í•´ë…í•˜ì„¸ìš”</div></div>';
}

// â”€â”€ Shake â”€â”€
function initShake(cfg) {
  var area = document.getElementById('interactiveArea');
  var required = cfg.required || 20;
  var html = '<div class="shake-area">';
  html += '<div class="shake-icon" id="shakeIcon">ğŸ“±</div>';
  html += '<div class="shake-instruction" id="shakeInst"></div>';
  html += '<div class="shake-progress"><div class="shake-bar"><div class="shake-fill" id="shakeFill"></div></div></div>';
  html += '<div class="shake-count" id="shakeCount">0 / '+required+'</div>';
  html += '<div id="shakeReveal"></div>';
  html += '</div>';
  area.innerHTML = html;

  window._shakeState = {count:0, required:required, done:false, revealText:cfg.revealText||''};

  // Check mobile
  var isMobile = /Android|iPhone|iPad/i.test(navigator.userAgent);
  if(isMobile && window.DeviceMotionEvent) {
    document.getElementById('shakeInst').textContent = 'ğŸ“± ê¸°ê¸°ë¥¼ í”ë“¤ì–´ ë‹¨ì„œë¥¼ ì°¾ìœ¼ì„¸ìš”!';
    // Request permission for iOS
    if(typeof DeviceMotionEvent.requestPermission === 'function') {
      DeviceMotionEvent.requestPermission().then(function(p){
        if(p==='granted') window.addEventListener('devicemotion', shakeHandler);
      }).catch(function(){
        // Fallback to button
        addShakeButton();
      });
    } else {
      window.addEventListener('devicemotion', shakeHandler);
    }
  } else {
    document.getElementById('shakeInst').textContent = 'âŒ¨ï¸ ìŠ¤í˜ì´ìŠ¤ë°”ë¥¼ ì—°íƒ€í•˜ì„¸ìš”!';
    addShakeButton();
    document.addEventListener('keydown', shakeKeyHandler);
  }
}
function addShakeButton() {
  var area = document.querySelector('.shake-area');
  if(area && !document.getElementById('shakeBtn')) {
    var btn = document.createElement('button');
    btn.className = 'shake-spacebar';
    btn.id = 'shakeBtn';
    btn.textContent = 'ğŸ‘Š ë‘ë“œë¦¬ê¸°!';
    btn.onclick = doShake;
    area.insertBefore(btn, document.getElementById('shakeReveal'));
  }
}
function shakeHandler(e) {
  var acc = e.accelerationIncludingGravity;
  if(!acc) return;
  var total = Math.abs(acc.x||0) + Math.abs(acc.y||0) + Math.abs(acc.z||0);
  if(total > 30) doShake();
}
function shakeKeyHandler(e) {
  if(e.code === 'Space' && window._shakeState && !window._shakeState.done) {
    e.preventDefault();
    doShake();
  }
}
function doShake() {
  var s = window._shakeState;
  if(!s || s.done) return;
  s.count++;
  var pct = Math.min(100, s.count / s.required * 100);
  document.getElementById('shakeFill').style.width = pct + '%';
  document.getElementById('shakeCount').textContent = Math.min(s.count, s.required) + ' / ' + s.required;
  document.getElementById('shakeIcon').classList.add('shaking');
  setTimeout(function(){document.getElementById('shakeIcon').classList.remove('shaking');},100);
  if(s.count >= s.required && !s.done) {
    s.done = true;
    document.getElementById('shakeReveal').innerHTML = '<div class="shake-reveal">ğŸ’¡ '+s.revealText+'</div>';
    window.removeEventListener('devicemotion', shakeHandler);
    document.removeEventListener('keydown', shakeKeyHandler);
    var btn = document.getElementById('shakeBtn');
    if(btn) btn.disabled = true;
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Series & Chapter Data
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var SERIES = [
  {
    id:'professor', title:'ì‚¬ë¼ì§„ êµìˆ˜', icon:'ğŸ”®', difficulty:1,
    desc:'ê³ ê³ í•™ êµìˆ˜ ê¹€ë™í˜„ì´ ë°œêµ´ í˜„ì¥ì—ì„œ ì‹¤ì¢…ëë‹¤. ë‚¨ì€ ê±´ ì•”í˜¸í™”ëœ ì—°êµ¬ë…¸íŠ¸ í•œ ê¶Œë¿.',
    chapters:[
      {
        id:'ch1_study', title:'Ch.1 â€” êµìˆ˜ì˜ ì„œì¬', desc:'ì‹¤ì¢… 3ì¼ì§¸. ì„œì¬ì— ì¹¨ì…í•´ ë‹¨ì„œë¥¼ ì°¾ëŠ”ë‹¤.', time:'12ë¶„',
        intro:'ê¹€ë™í˜„ êµìˆ˜ê°€ ì‚¬ë¼ì¡Œë‹¤.\n3ì¼ì§¸ ì—°ë½ ë‘ì ˆ. ê²½ì°°ì€ "ìë°œì  ì ì "ì´ë¼ í–ˆì§€ë§Œ, ë‹¹ì‹ ì€ ë¯¿ì§€ ì•Šì•˜ë‹¤.\në§ˆìŠ¤í„°í‚¤ë¡œ ì„œì¬ì— ë“¤ì–´ì„  ìˆœê°„, ë“± ë’¤ì—ì„œ ë¬¸ì´ ì ê²¼ë‹¤.\ní¬ë¯¸í•œ ìŠ¤íƒ ë“œ ë¶ˆë¹› ì•„ë˜, ê¸‰í•˜ê²Œ ì°¢ê¸´ ì„œë¥˜ì™€ ì“°ëŸ¬ì§„ ì»¤í”¼ì”.\nêµìˆ˜ëŠ” ë­”ê°€ë¥¼ ìˆ¨ê¸°ë‹¤ ì«“ê¸´ ê²ƒì´ë‹¤.',
        puzzles:[
          { type:'interactive', interactionType:'hidden-text', title:'ğŸ“‹ í¼ì¦ 1: ì±…ìƒ ìœ„ì˜ ì•”í˜¸ ë©”ëª¨',
            story:'ì±…ìƒ ìœ„, í”¼ ë¬»ì€ í¬ìŠ¤íŠ¸ì‡ í•˜ë‚˜. êµìˆ˜ì˜ ë–¨ë¦¬ëŠ” í•„ì²´. ì¢Œí‘œ ì•”í˜¸ë‹¤.',
            config:{ segments:[
              {text:'ê²©ìì—ì„œ ì¢Œí‘œ (1,1)=', hidden:false},
              {text:'ì„œ', hidden:true},
              {text:', (1,2)=', hidden:false},
              {text:'ë', hidden:true},
              {text:', (2,1)=', hidden:false},
              {text:'ì—´', hidden:true},
              {text:', (2,2)=', hidden:false},
              {text:'ì–´', hidden:true},
              {text:', (2,3)=', hidden:false},
              {text:'ê³ ', hidden:true},
              {text:' â€” ì´ ë‹¤ì„¯ ê¸€ìê°€ ë©”ì‹œì§€ë‹¤. í¬ìŠ¤íŠ¸ì‡ì˜ ë‚˜ë¨¸ì§€ ë¶€ë¶„ì€ í•ìêµ­ìœ¼ë¡œ ë²ˆì ¸ ìˆë‹¤.', hidden:false}
            ]},
            hint:'ìˆ¨ê²¨ì§„ ê¸€ìë¥¼ ë“œë˜ê·¸í•˜ì—¬ ì°¾ìœ¼ì„¸ìš”. ë‹¤ì„¯ ê¸€ìë¥¼ ì´ì–´ì„œ ì…ë ¥.',
            validate:function(i){return i.replace(/\s/g,'') === 'ì„œëì—´ì–´ê³ '} },
          { type:'interactive', interactionType:'color-code', title:'ğŸ“¦ í¼ì¦ 2: ì„œë ì† íƒë°° ì˜ìˆ˜ì¦',
            story:'ì„œëì´ ì—´ë ¸ë‹¤. ì•ˆì—ëŠ” íƒë°° ì˜ìˆ˜ì¦ í•œ ì¥. ì‹¤ì¢… ì´í‹€ ì „, ë‚¯ì„  ì£¼ì†Œë¡œ ë³´ë‚¸ í™”ë¬¼.\nêµìˆ˜ê°€ ë¹¨ê°„ íœìœ¼ë¡œ ë°‘ì¤„ ê·¸ì€ ë¶€ë¶„: "ìƒ‰ìƒ ì½”ë“œê°€ ë°°ì†¡ë£Œë‹¤."',
            config:{ colors:[
              {color:'#ff4444', name:'ë¹¨ê°• (ê¸°ë³¸ë£Œ)', value:'3'},
              {color:'#4488ff', name:'íŒŒë‘ (ê±°ë¦¬í• ì¦)', value:'2'},
              {color:'#44ff88', name:'ì´ˆë¡ (ë¬´ê²Œí• ì¦)', value:'1.5'},
              {color:'#ffaa00', name:'ë…¸ë‘ (í• ì¸)', value:'-0.5'}
            ], clueText:'ê° ìƒ‰ìƒì˜ ê°’(ì²œ ì› ë‹¨ìœ„): ë¹¨ê°•=3, íŒŒë‘=2, ì´ˆë¡=1.5, ë…¸ë‘=-0.5<br>ëª¨ë‘ ë”í•œ ê°’ Ã— 1000 = ìµœì¢… ë°°ì†¡ë£Œ'},
            hint:'3 + 2 + 1.5 - 0.5 = 6 â†’ 6000ì›',
            validate:function(i){return i.replace(/[^\d]/g,'') === '6000'} },
          { type:'interactive', interactionType:'mirror', title:'ğŸ”¢ í¼ì¦ 3: ë²½ ì†ì˜ ê¸ˆê³ ',
            story:'ì˜ìˆ˜ì¦ ë’·ë©´: "ë²½ì„ í™•ì¸í•˜ë¼." ì±…ì¥ ì„¸ ë²ˆì§¸ ì¹¸ ë’¤ì— ìˆ¨ê²¨ì§„ ê¸ˆê³ .\nê¸ˆê³  ìœ„ì— ê±°ìš¸ì´ ë†“ì—¬ìˆê³ , ê·¸ ì•ˆì— ìˆ«ìê°€ ë¹„ì¹œë‹¤.',
            config:{ text:'3 2 1 5 7', direction:'horizontal' },
            hint:'ê±°ìš¸ì— ë¹„ì¹œ ìˆ«ìë¥¼ ë’¤ì§‘ìœ¼ë©´ 75123',
            validate:function(i){return i.replace(/\s/g,'') === '75123'} },
          { type:'interactive', interactionType:'flashlight', title:'ğŸ““ í¼ì¦ 4: ê¸ˆê³  ì† ìˆ˜ì²©',
            story:'ê¸ˆê³ ê°€ ì—´ë ¸ë‹¤. "PRIVATE" ê°ì¸ëœ ê°€ì£½ ìˆ˜ì²©.\nê°‘ìê¸° ì •ì „. ì†ì „ë“±ì„ êº¼ë‚´ ë¹„ì¶°ì•¼ í•œë‹¤.',
            config:{ items:[
              {x:15, y:25, text:'D=4'},
              {x:65, y:40, text:'O=15'},
              {x:35, y:70, text:'O=15'},
              {x:80, y:75, text:'R=18'},
              {x:50, y:15, text:'DOOR=?'}
            ]},
            hint:'D(4)+O(15)+O(15)+R(18)=52. ì–´ë‘  ì†ì„ ë¹„ì¶° ë‹¨ì„œë¥¼ ì°¾ìœ¼ì„¸ìš”.',
            validate:function(i){return i.trim() === '52'} },
          { type:'cpq', cpqIndex:0,
            story:'ìˆ˜ì²© ë§ˆì§€ë§‰ ì¥ì— ë¹¨ê°„ ë™ê·¸ë¼ë¯¸ ì¹œ ì£¼ì†Œ.\n"ì—¬ê¸°ê°€ í•µì‹¬ì´ë‹¤." êµìˆ˜ê°€ ì‚¬ë¼ì§€ê¸° ì§ì „, ë§ˆì§€ë§‰ìœ¼ë¡œ í–¥í•˜ë ¤ë˜ ì¥ì†Œ.',
            storyAfter:'ì½”ë“œê°€ ë§ì•˜ë‹¤. ìˆ˜ì²© ë’·í‘œì§€ ì•ˆìª½, êµìˆ˜ì˜ ë§ˆì§€ë§‰ ë©”ëª¨ê°€ ë“œëŸ¬ë‚¬ë‹¤.' }
        ],
        cliffhanger:'ìˆ˜ì²© ë’·í‘œì§€ë¥¼ ë²—ê¸°ì ì ‘íŒ ì¢…ì´ê°€ ë–¨ì–´ì¡Œë‹¤.\në–¨ë¦¬ëŠ” ì†ìœ¼ë¡œ í¼ì³¤ë‹¤. êµìˆ˜ì˜ í•„ì²´.\n\n"ê·¸ë“¤ì´ ë‚˜ë¥¼ ì°¾ê³  ìˆë‹¤. ì—°êµ¬ ìƒ˜í”Œì€ í™”ë¬¼ì„ ì— ì‹¤ì—ˆë‹¤."\n"ì•„ë¦¬ì•„í˜¸... ì¸ì²œí•­ 2ë²ˆ ì„ ì°©ì¥..."\n\nêµìˆ˜ëŠ” ì—¬ê¸°ì„œ ë°°ë¥¼ íƒ”ë‹¤.\nê·¸ë¦¬ê³  ì‚¬ë¼ì¡Œë‹¤.'
      },
      {
        id:'ch2_ship', title:'Ch.2 â€” í™”ë¬¼ì„  ì•„ë¦¬ì•„í˜¸', desc:'êµìˆ˜ê°€ ë§ˆì§€ë§‰ìœ¼ë¡œ íƒ‘ìŠ¹í•œ ìœ ë ¹ í™”ë¬¼ì„ ì— ì ì…í•œë‹¤.', time:'14ë¶„',
        intro:'ì¸ì²œí•­ 2ë²ˆ ì„ ì°©ì¥.\në…¹ìŠ¨ í™”ë¬¼ì„  "ì•„ë¦¬ì•„í˜¸"ê°€ ì•ˆê°œ ì†ì— ì •ë°•í•´ ìˆë‹¤.\nì„ ì› 12ëª…ì´ íƒ€ê³  ìˆì—ˆë‹¤. ì§€ê¸ˆì€ ì•„ë¬´ë„ ì—†ë‹¤. êµ¬ëª…ë³´íŠ¸ë„, ì†Œì§€í’ˆë„ ê·¸ëŒ€ë¡œì¸ ì±„.\në‹¹ì‹ ì´ ê°‘íŒì— ì˜¬ë¼ì„  ìˆœê°„, í•´ì¹˜ê°€ ë‹«í˜”ë‹¤.\në¹„ìƒë“±ë§Œ ê¹œë¹¡ì´ê³ , ì–´ë”˜ê°€ì—ì„œ ê¸ˆì†ì´ ì‚ê±±ê±°ë¦°ë‹¤.',
        puzzles:[
          { type:'interactive', interactionType:'flashlight', title:'ğŸ§­ í¼ì¦ 1: í•­í•´ ì¼ì§€ì˜ ë§ˆì§€ë§‰ ê¸°ë¡',
            story:'ì„ ì¥ì‹¤. ë¹„ìƒë“±ì´ ê¹œë¹¡ì¸ë‹¤. ì–´ë‘  ì†ì—ì„œ ê¸ˆê³  ë¹„ë°€ë²ˆí˜¸ë¥¼ ì°¾ì•„ì•¼ í•œë‹¤.\në²½ë©´ì— ì„¸ ê¶Œì˜ ì±…ì´ ê½‚í˜€ìˆë‹¤.',
            config:{ items:[
              {x:12, y:30, text:'"ëŒ€í•œë¯¼êµ­"=4ê¸€ì'},
              {x:55, y:55, text:'"ë‚˜ì¹¨ë°˜"=3ê¸€ì'},
              {x:80, y:20, text:'"ìš©ê³¨"=2ê¸€ì'},
              {x:40, y:80, text:'ë¹„ë°€ë²ˆí˜¸: ê¸€ììˆ˜'}
            ]},
            hint:'ëŒ€í•œë¯¼êµ­=4, ë‚˜ì¹¨ë°˜=3, ìš©ê³¨=2 â†’ 432',
            validate:function(i){return i.replace(/\s/g,'') === '432'} },
          { type:'interactive', interactionType:'hidden-text', title:'ğŸ“¦ í¼ì¦ 2: í™”ë¬¼ ì í•˜ ëª©ë¡',
            story:'ê¸ˆê³  ì•ˆì— "HELP" í•œ ë‹¨ì–´ì™€ ì í•˜ ëª©ë¡.\në¹¨ê°„ ì¤„ ê·¸ì€ í•­ëª©: "íŠ¹ìˆ˜ í™”ë¬¼ #7 â€” ë°œì†¡ì§€ í™•ì¸ ìš”ë§."',
            config:{ segments:[
              {text:'í™”ë¬¼ #7 ì œì›: ê¸¸ì´ 120cm Ã— í­ 80cm Ã— ë†’ì´ 50cm. ë¶€í”¼ = ', hidden:false},
              {text:'480000', hidden:true},
              {text:' cmÂ³. ì´ í™”ë¬¼ì€ ì¼ë°˜ í™”ë¬¼ì´ ì•„ë‹ˆë‹¤. ì¸ì²´ í¬ê¸°ì— ë§ì¶° ì œì‘ë˜ì—ˆë‹¤.', hidden:false}
            ]},
            hint:'120Ã—80Ã—50=480000. ìˆ¨ê²¨ì§„ ìˆ«ìë¥¼ ë“œë˜ê·¸í•˜ì—¬ ì°¾ìœ¼ì„¸ìš”.',
            validate:function(i){return i.replace(/[^\d]/g,'') === '480000'} },
          { type:'interactive', interactionType:'mirror', title:'âš“ í¼ì¦ 3: ê¸°ê´€ì‹¤ì˜ ì´ì§„ë²•',
            story:'ê¸°ê´€ì‹¤. ì—”ì§„ì´ ë©ˆì¶°ìˆë‹¤. ë°°ì „ë°˜ ìœ„ ê±°ìš¸ì— ì´ì§„ìˆ˜ê°€ ë¹„ì¹œë‹¤.',
            config:{ text:'3 4 9', direction:'horizontal' },
            hint:'ê±°ìš¸ì— ë¹„ì¹œ ìˆ«ì 349ë¥¼ ë°˜ì „ â†’ 943',
            validate:function(i){return i.replace(/\s/g,'') === '943'} },
          { type:'interactive', interactionType:'color-code', title:'ğŸ“» í¼ì¦ 4: ë¬´ì „ê¸° SOS ì‹ í˜¸',
            story:'ê¸°ê´€ì¥ ë°•ì² ìˆ˜ì˜ ë…¸íŠ¸.\n"ì„ ì¥ì´ í™”ë¬¼ #7ì„ ì—´ì—ˆë‹¤. ê·¸ ì•ˆì— ìˆë˜ ê±´... ì—°êµ¬ ìƒ˜í”Œì´ ì•„ë‹ˆì—ˆë‹¤."\në¬´ì „ê¸° ì˜†ì— ìƒ‰ìƒ ì½”ë“œí‘œ.',
            config:{ colors:[
              {color:'#ff4444', name:'ë¹¨ê°• (S=ì 3ê°œ)', value:'3'},
              {color:'#ffaa00', name:'ë…¸ë‘ (O=ì„ 3ê°œ)', value:'3'},
              {color:'#4488ff', name:'íŒŒë‘ (S=ì 3ê°œ)', value:'3'}
            ], clueText:'SOS = S(3) + O(3) + S(3)<br>ì´ ì‹ í˜¸ ê°œìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”'},
            hint:'3 + 3 + 3 = 9',
            validate:function(i){return i.trim() === '9'} },
          { type:'cpq', cpqIndex:0,
            story:'ê¸°ê´€ì¥ì˜ ë…¸íŠ¸ ë§ˆì§€ë§‰ í˜ì´ì§€.\n"í™”ë¬¼ #7ì˜ ì§„ì§œ ë°œì†¡ì§€ë¥¼ ì°¾ì•˜ë‹¤. ì´ ì£¼ì†Œë‹¤."',
            storyAfter:'ë§ì•˜ë‹¤. ê¸°ê´€ì¥ì˜ ë§ˆì§€ë§‰ ê¸°ë¡ì´ í•´ë…ëë‹¤.' }
        ],
        cliffhanger:'ê¸°ê´€ì¥ì˜ ë§ˆì§€ë§‰ ê¸°ë¡.\n\n"í™”ë¬¼ #7 ì•ˆì— ë“  ê±´ êµìˆ˜ì˜ ì—°êµ¬ ìƒ˜í”Œì´ ì•„ë‹ˆì—ˆë‹¤.\nì¸ì²´ ì¡°ì§ì´ì—ˆë‹¤."\n\nì í•˜ ëª©ë¡ ë’·ë©´, ë°°ì†¡ì§€ ì£¼ì†Œê°€ ì í˜€ ìˆë‹¤.\n\n"ê·¸ëœë“œ íŒŒí¬ í˜¸í…” 1408í˜¸ â€” VIP ì „ìš© ë°°ì†¡"\n\nêµìˆ˜ëŠ” ì´ê±¸ ì•Œê³  ìˆì—ˆë‹¤. ê·¸ë˜ì„œ ì«“ê¸´ ê²ƒì´ë‹¤.'
      },
      {
        id:'ch3_hotel', title:'Ch.3 â€” í˜¸í…” ìŠ¤ìœ„íŠ¸ë£¸', desc:'5ì„±ê¸‰ í˜¸í…” 1408í˜¸. êµìˆ˜ê°€ ë§ˆì§€ë§‰ìœ¼ë¡œ ëª©ê²©ëœ ê³³.', time:'15ë¶„',
        intro:'ê·¸ëœë“œ íŒŒí¬ í˜¸í…”. ë¡œë¹„ì˜ ìƒ¹ë“¤ë¦¬ì—ê°€ ì°¨ê°‘ê²Œ ë¹›ë‚œë‹¤.\n1408í˜¸. VIP ì „ìš© ìŠ¤ìœ„íŠ¸ë£¸. êµìˆ˜ê°€ ë§ˆì§€ë§‰ìœ¼ë¡œ ëª©ê²©ëœ ê³³.\nì¹´ë“œí‚¤ë¥¼ ëŒ€ì ë¬¸ì´ ì—´ë ¸ë‹¤. ì•ˆì— ë“¤ì–´ì„œëŠ” ìˆœê°„, ìë™ ì ê¸ˆ.\nì¹¨ëŒ€ëŠ” ì •ëˆë˜ì–´ ìˆì§€ë§Œ, ìš•ì‹¤ì—ì„œ í¬ë¯¸í•œ ë¬¼ì†Œë¦¬ê°€ ë“¤ë¦°ë‹¤.\nëˆ„êµ°ê°€ ì—¬ê¸° ìˆì—ˆë‹¤. ì•„ì£¼ ìµœê·¼ê¹Œì§€.',
        puzzles:[
          { type:'interactive', interactionType:'color-code', title:'ğŸ”‘ í¼ì¦ 1: ë…¸íŠ¸ë¶ì˜ ì´ëª¨ì§€ ì•”í˜¸',
            story:'ì±…ìƒ ìœ„ ë…¸íŠ¸ë¶ì´ ì—´ë ¤ìˆë‹¤. ì ê¸ˆ í™”ë©´ì— ì´ëª¨ì§€ ìˆ˜ì‹ì´ ê¹œë¹¡ì¸ë‹¤.',
            config:{ colors:[
              {color:'#ffd700', name:'ğŸ¨ í˜¸í…”', value:'14'},
              {color:'#c0c0c0', name:'ğŸ”‘ ì—´ì‡ ', value:'4'}
            ], clueText:'ğŸ¨+ğŸ¨=28 â†’ ğŸ¨=14<br>ğŸ”‘Ã—ğŸ”‘=16 â†’ ğŸ”‘=4<br>ğŸ¨-ğŸ”‘=?'},
            hint:'14 - 4 = 10',
            validate:function(i){return i.trim() === '10'} },
          { type:'interactive', interactionType:'mirror', title:'ğŸ’» í¼ì¦ 2: ê²€ìƒ‰ ê¸°ë¡ ë¶„ì„',
            story:'ë…¸íŠ¸ë¶ì´ ì—´ë ¸ë‹¤. í™”ë©´ì— ê±°ìš¸ì²˜ëŸ¼ ë°˜ì „ëœ ìˆ«ìê°€ í‘œì‹œëœë‹¤.\n"í˜¸í…” 1408í˜¸ ë¹„ë°€" ê²€ìƒ‰ê³¼ "ìˆ«ì 7ì˜ ì˜ë¯¸" ê²€ìƒ‰ ê²°ê³¼.',
            config:{ text:'5 1 4 1', direction:'horizontal' },
            hint:'ë°˜ì „ëœ 1415 â†’ 1415',
            validate:function(i){return i.trim() === '1415'} },
          { type:'interactive', interactionType:'flashlight', title:'ğŸª í¼ì¦ 3: ìš•ì‹¤ ê±°ìš¸ì˜ ë©”ì‹œì§€',
            story:'"ê±°ìš¸ ë’¤ì— ì§„ì‹¤ì´ ìˆë‹¤."\nìš•ì‹¤ì´ ê¹œê¹œí•˜ë‹¤. ì†ì „ë“±ìœ¼ë¡œ ê¹€ ì„œë¦° ê±°ìš¸ì„ ë¹„ì¶°ì•¼ í•œë‹¤.',
            config:{ items:[
              {x:20, y:35, text:'5'},
              {x:45, y:55, text:'6'},
              {x:65, y:25, text:'7'},
              {x:85, y:70, text:'5'},
              {x:50, y:85, text:'ìˆœì„œëŒ€ë¡œ ì½ì–´ë¼'}
            ]},
            hint:'ìˆœì„œëŒ€ë¡œ 5675',
            validate:function(i){return i.trim() === '5675'} },
          { type:'interactive', interactionType:'hidden-text', title:'ğŸ“… í¼ì¦ 4: ë¹„ë°€ ê¸ˆê³ ì˜ ì¼ì •í‘œ',
            story:'ìš•ì‹¤ íƒ€ì¼ ë°‘ì— ê¸ˆê³ . í˜¸í…” ë¹„í’ˆì´ ì•„ë‹ˆë‹¤. ì•ˆì— êµìˆ˜ì˜ ë¹„ë°€ ì¼ì •í‘œ.',
            config:{ segments:[
              {text:'09:00 Aì‚¬ ë¯¸íŒ…: 3ëª… / 14:00 Bì‚¬ ê²€í† : 2ëª… / 16:30 Cì‚¬ í˜‘ì˜: 4ëª… / 19:00 ì €ë…: 1ëª…. ì´ ì°¸ì„ì = ', hidden:false},
              {text:'10', hidden:true},
              {text:'ëª…. ë§ˆì§€ë§‰ ë¯¸íŒ… ì¥ì†Œë§Œì´ ì§„ì§œ ë‹¨ì„œë‹¤.', hidden:false}
            ]},
            hint:'3+2+4+1=10. ìˆ¨ê²¨ì§„ ìˆ«ìë¥¼ ì°¾ìœ¼ì„¸ìš”.',
            validate:function(i){return i.trim() === '10'} },
          { type:'cpq', cpqIndex:0,
            story:'ê¸ˆê³  ì•ˆ ë´‰íˆ¬. êµìˆ˜ì˜ í¸ì§€.\n"ì´ í˜¸í…”ì€ ê±°ì ì´ë‹¤. ì§„ì§œ ëª©ì ì§€ì˜ ìœ„ì¹˜ë¥¼ ë‚¨ê¸´ë‹¤."',
            storyAfter:'í¸ì§€ì˜ ë§ˆì§€ë§‰ ì¤„ì´ ë“œëŸ¬ë‚¬ë‹¤.' }
        ],
        cliffhanger:'í¸ì§€ì˜ ë§ˆì§€ë§‰ ì¤„.\n\n"ë‚˜ëŠ” ë„ë§ì¹œ ê²Œ ì•„ë‹ˆë‹¤. ê°ê¸ˆë‹¹í–ˆë‹¤."\n"ì¹¨ëŒ€ í—¤ë“œë³´ë“œ ë’¤ì— ë¹„ë°€ í†µë¡œê°€ ìˆë‹¤. í•˜ì§€ë§Œ ì—´ì§€ ë§ˆë¼."\n"ê·¸ë“¤ì´ ê¸°ë‹¤ë¦¬ê³  ìˆë‹¤."\n\ní—¤ë“œë³´ë“œë¥¼ ë°€ì ì°¨ê°€ìš´ ë°”ëŒì´ ë¶ˆì–´ì™”ë‹¤.\ní†µë¡œ ë²½ì— ì‚¬ì§„ í•œ ì¥ì´ ë¶™ì–´ìˆë‹¤.\nêµìˆ˜ì™€ í•¨ê»˜ ì°íŒ ë‚¨ì â€” ë§ˆìˆ ì‚¬ ìµœí˜„ìš°.\n\nì‚¬ì§„ ë’·ë©´: "ê·¸ë„ ì‚¬ë¼ì¡Œë‹¤. ìš°ë¦¬ëŠ” ê°™ì€ ê²ƒì„ ë°œê²¬í–ˆë‹¤."'
      }
    ]
  },
  {
    id:'magician', title:'ë§ˆìˆ ì‚¬ì˜ ìœ ì‚°', icon:'ğŸ­', difficulty:2,
    desc:'ì „ì„¤ì˜ ë§ˆìˆ ì‚¬ ìµœí˜„ìš°ê°€ ê³µì—° ì¤‘ ì‚¬ë¼ì¡Œë‹¤. ìœ ì–¸ì¥ì—ëŠ” "ë§ˆì§€ë§‰ íŠ¸ë¦­ì„ í’€ì–´ë¼"ê³ ë§Œ ì í˜€ìˆë‹¤.',
    chapters:[
      {
        id:'ch1_magic', title:'Ch.1 â€” ë§ˆìˆ ì‚¬ì˜ ë¹„ë°€ ë°©', desc:'ìµœí˜„ìš°ì˜ ê°œì¸ ì—°ìŠµì‹¤. ë¬´ëŒ€ì¥ì¹˜ì™€ ê±°ìš¸ë¡œ ê°€ë“í•œ ë°©.', time:'12ë¶„',
        intro:'ë§ˆìˆ ì‚¬ ìµœí˜„ìš°. "ëŒ€íƒˆì¶œ" ê³µì—° ì¤‘ ì‚¬ë¼ì¡Œë‹¤.\nì¼ì£¼ì¼ì§¸ í–‰ë°©ë¶ˆëª…. ê²½ì°°ì€ "ìì‘ê·¹"ì´ë¼ ê²°ë¡  ë‚´ë ¸ë‹¤.\ní•˜ì§€ë§Œ êµìˆ˜ì˜ ì‚¬ì§„ì´ ëª¨ë“  ê±¸ ë°”ê¿¨ë‹¤.\nê·¹ì¥ ë’¤í¸ ë¹„ë°€ ë°©ì— ì ì…í–ˆì§€ë§Œ, ë§ˆìˆ  ì¥ì¹˜ê°€ ì‘ë™í•˜ë©° ë¬¸ì´ ë´‰ì‡„ëë‹¤.\nì˜¤ë¥´ê³¨ì´ ìš¸ë¦°ë‹¤. ìµœí˜„ìš°ì˜ ëª©ì†Œë¦¬: "ì§„ì§œ íƒì •ì´ë¼ë©´ ì´ê²ƒì„ í’€ì–´ë¼."',
        puzzles:[
          { type:'interactive', interactionType:'dial', title:'ğŸƒ í¼ì¦ 1: ë§ˆìˆ ì‚¬ì˜ ì¹´ë“œ íŠ¸ë¦­',
            story:'ë²¨ë²³ í…Œì´ë¸” ìœ„, ë‹¤ì´ì–¼ ìë¬¼ì‡ ê°€ ë‹¬ë¦° ìƒì.\në©”ëª¨: "ì¹´ë“œ íŒ¨í„´ì˜ ë§ˆì§€ë§‰ ìˆ˜ê°€ ì—´ì‡ ë‹¤."\nâ™¥: +2ì”©(2,4,6,8,?) â™¦: +2ì”©(1,3,5,7,?) â™£: +3ì”©(3,6,9,12,?)',
            config:{ combination:[1,0,9,1,5], labels:['â™¥?','â™¦?','â™£?','',''] },
            hint:'â™¥10, â™¦9, â™£15 â†’ ë‹¤ì´ì–¼ì„ 10915ë¡œ ë§ì¶”ì„¸ìš”',
            validate:function(i){return i.replace(/\s/g,'') === '10915'} },
          { type:'interactive', interactionType:'piano', title:'ğŸ“” í¼ì¦ 2: ë‹¤ì´ì–´ë¦¬ì˜ ìŒì•… ì•”í˜¸',
            story:'ê¸ˆê³  ì•ˆ ë‹¤ì´ì–´ë¦¬. ì•…ë³´ê°€ ê·¸ë ¤ì ¸ ìˆë‹¤.\n"ì˜¬ë°”ë¥¸ ìˆœì„œë¡œ ì—°ì£¼í•˜ë©´ ìˆ«ìê°€ ë‚˜íƒ€ë‚œë‹¤."',
            config:{ keys:['C','D','E','F','G','A','B'], sequence:['G','A','G','E','D'], display:'ì†” ë¼ ì†” ë¯¸ ë ˆ' },
            hint:'ì†”(G) ë¼(A) ì†”(G) ë¯¸(E) ë ˆ(D) ìˆœì„œë¡œ ê±´ë°˜ì„ ëˆ„ë¥´ì„¸ìš”. ì •ë‹µ: 50',
            validate:function(i){return i.trim() === '50'} },
          { type:'interactive', interactionType:'jigsaw', title:'ğŸª í¼ì¦ 3: ë§ˆë²•ì˜ ê±°ìš¸ LED',
            story:'"ë§ˆì§€ë§‰ ë‹¨ì„œëŠ” ê±°ìš¸ ì†ì—."\nLED íŒ¨í„´ ì¡°ê°ì´ í©ì–´ì ¸ ìˆë‹¤. ì˜¬ë°”ë¥¸ ìˆœì„œë¡œ ë§ì¶”ë©´ ìˆ«ìê°€ ë³´ì¸ë‹¤.',
            config:{ pieces:['â—â—‹â—â—‹â—','â—‹â—â—‹â—â—‹','â—â—‹â—‹â—‹â—','â—‹â—â—‹â—â—‹','â—â—‹â—â—‹â—‹'], cols:1, correctOrder:[0,1,2,3,4],
              revealText:'â— ì´ ê°œìˆ˜: 3+2+2+2+2 = 11' },
            hint:'ê° ì¤„ì˜ â—ë¥¼ ì„¸ë©´ 3,2,2,2,2 â†’ í•©: 11',
            validate:function(i){return i.trim() === '11'} },
          { type:'interactive', interactionType:'timing', title:'ğŸ© í¼ì¦ 4: ë§ˆìˆ  ë„êµ¬ ëª©ë¡',
            story:'ê±°ìš¸ì´ íšŒì „í•œë‹¤. íƒ€ì´ë°ì— ë§ì¶° ë²„íŠ¼ì„ ëˆŒëŸ¬ì•¼ ë¹„ë°€ ì„œëì´ ì—´ë¦°ë‹¤.\në§ˆìˆ  ë„êµ¬: ì‹¤í¬7 + ì¹´ë“œ12 + ì§€íŒ¡ì´3 + ê±°ìš¸5 + ë™ì „20',
            config:{ zoneStart:0.35, zoneEnd:0.55, required:3, speed:0.008, revealText:'47' },
            hint:'7+12+3+5+20=47. ì´ˆë¡ êµ¬ê°„ì— ë§ì¶° 3ë²ˆ ì—°ì† ì„±ê³µí•˜ì„¸ìš”.',
            validate:function(i){return i.trim() === '47'} },
          { type:'cpq', cpqIndex:0,
            story:'"ëŒ€íƒˆì¶œì€ ê³µì—°ì´ ì•„ë‹ˆì—ˆë‹¤."\nìµœí˜„ìš°ê°€ ë§ˆì§€ë§‰ìœ¼ë¡œ í–¥í•˜ë ¤ë˜ ì¥ì†Œì˜ ë‹¨ì„œ.',
            storyAfter:'ë„êµ¬í•¨ ì´ì¤‘ë°”ë‹¥ ì•„ë˜, ë´‰íˆ¬ í•˜ë‚˜ê°€ ë‚˜ì™”ë‹¤.' }
        ],
        cliffhanger:'ë´‰íˆ¬ ì•ˆì—ëŠ” ë¹›ë°”ëœ ì¡¸ì—…ì•¨ë²” í•œ í˜ì´ì§€.\nì„¸ì¢…ê³ ë“±í•™êµ 3í•™ë…„ 2ë°˜, 1994ë…„.\n\nì„¸ ëª…ì—ê²Œ ë™ê·¸ë¼ë¯¸ê°€ ì³ì ¸ ìˆë‹¤.\nê¹€ë™í˜„. ìµœí˜„ìš°. ê·¸ë¦¬ê³  ì„¸ ë²ˆì§¸ ì‚¬ëŒ â€” ì´ë¦„ì´ ê¹Œë§£ê²Œ ì§€ì›Œì ¸ ìˆë‹¤.\n\nì•¨ë²” ì—¬ë°±ì— ìµœí˜„ìš°ì˜ ê¸€ì”¨:\n"ìš°ë¦¬ ì…‹ì€ ê°™ì€ ê±¸ ë´¤ë‹¤. ê·¸ë‚  ë°¤, í•™êµì—ì„œ."\n\n1994ë…„ ì„¸ì¢…ê³ . í™”ì¬ë¡œ íêµëœ ë°”ë¡œ ê·¸ í•™êµë‹¤.'
      },
      {
        id:'ch2_school', title:'Ch.2 â€” ì•¼ê°„ í•™êµ', desc:'30ë…„ ì „ í™”ì¬ë¡œ íêµëœ ì„¸ì¢…ê³ . ê·¸ë‚  ë°¤ì˜ ì§„ì‹¤ì„ íŒŒí—¤ì¹œë‹¤.', time:'14ë¶„',
        intro:'ì„¸ì¢…ê³ ë“±í•™êµ. 30ë…„ê°„ ë°©ì¹˜ëœ íêµ.\nì² ì¡°ë§ì„ ë„˜ì–´ ì •ë¬¸ì— ë“¤ì–´ì„°ë‹¤. ìœ ë¦¬ì°½ì€ ê¹¨ì ¸ ìˆê³ , ë³µë„ì— ë‚™ì„œê°€ ê°€ë“í•˜ë‹¤.\n3í•™ë…„ 2ë°˜ êµì‹¤. ì¹ íŒì— ëˆ„êµ°ê°€ ìµœê·¼ì— ì ì–´ë†“ì€ ê¸€ì”¨.\n"ì—¬ê¸°ì„œ ì‹œì‘ëë‹¤."\në¬¸ì´ ì•ˆì—ì„œ ì ê²¼ë‹¤. ë¹„ìƒë“±ë§Œ ê¹œë¹¡ì´ëŠ” êµì‹¤. 30ë…„ ì „ì˜ ë©”ì•„ë¦¬ê°€ ë“¤ë¦°ë‹¤.',
        puzzles:[
          { type:'interactive', interactionType:'jigsaw', title:'ğŸ“š í¼ì¦ 1: ì‚¬ë¬¼í•¨ì˜ ì¡°í•©',
            story:'ê¹€ë™í˜„ì˜ ì‚¬ë¬¼í•¨. ì¡°í•©ì„ ì•Œë ¤ì£¼ëŠ” ì¡°ê° ë©”ëª¨ê°€ ì°¢ì–´ì ¸ ë°”ë‹¥ì— í©ì–´ì ¸ ìˆë‹¤.',
            config:{ pieces:['ë°˜ë²ˆí˜¸(2)Ã—2=4','ìƒì¼: 12ì›”8ì¼â†’20','ì°½ê°€ì¤„ìˆ˜=5','í•©ì¹˜ë©´â†’4205'], cols:2,
              correctOrder:[0,1,2,3], revealText:'ë¹„ë°€ë²ˆí˜¸: 4205' },
            hint:'ë©”ëª¨ ì¡°ê°ì„ ì˜¬ë°”ë¥¸ ìœ„ì¹˜ì— ë§ì¶”ì„¸ìš”. 4, 20, 5 â†’ 4205',
            validate:function(i){return i.replace(/\s/g,'') === '4205'} },
          { type:'interactive', interactionType:'timing', title:'ğŸ“ í¼ì¦ 2: í•™ìŠµ ê³„íší‘œ',
            story:'"ì˜¤ëŠ˜ ë°¤ ì§€í•˜ì‹¤ì—ì„œ ë§Œë‚˜." ì„œëì—ì„œ ë°œê²¬í•œ ìª½ì§€.\nììŠµ ì‹œê°„í‘œ ì•ì— íƒ€ì´ë¨¸ ìë¬¼ì‡ ê°€ ê±¸ë ¤ìˆë‹¤.',
            config:{ zoneStart:0.3, zoneEnd:0.5, required:3, speed:0.01, revealText:'20' },
            hint:'ì›”3+í™”5+ìˆ˜2+ëª©4+ê¸ˆ6=20. íƒ€ì´ë°ì— ë§ì¶° 3ë²ˆ ì„±ê³µí•˜ì„¸ìš”.',
            validate:function(i){return i.trim() === '20'} },
          { type:'interactive', interactionType:'dial', title:'ğŸ“ í¼ì¦ 3: ì¹ íŒì˜ ìˆ˜í•™ ë¬¸ì œ',
            story:'"ì§„ì§œ ë¹„ë°€ì€ ì¹ íŒ ë’¤ì— ìˆë‹¤."\nì¹ íŒì— ë‹¤ì´ì–¼ ìë¬¼ì‡ . (n-2)Ã—180Â° ê³µì‹ìœ¼ë¡œ ìœ¡ê°í˜• ë‚´ê°ì˜ í•©ì„ êµ¬í•˜ë¼.',
            config:{ combination:[7,2,0], labels:['ë°±','ì‹­','ì¼'] },
            hint:'(6-2)Ã—180=720. ë‹¤ì´ì–¼ì„ 720ìœ¼ë¡œ ë§ì¶”ì„¸ìš”.',
            validate:function(i){return i.trim() === '720'} },
          { type:'interactive', interactionType:'piano', title:'ğŸ“° í¼ì¦ 4: ë¹„ë°€ ìë£Œì‹¤',
            story:'ì¹ íŒì´ ì›€ì§ì¸ë‹¤. ë’¤í¸ ìë£Œì‹¤ì˜ ì ê¸ˆì¥ì¹˜. ìŒê³„ ìˆœì„œë¥¼ ë§ì¶°ì•¼ ì—´ë¦°ë‹¤.\nì„¸ì¢…ê³  ì‚¬ê±´ ê¸°ë¡: 95ë…„1ê±´+03ë…„2ê±´+10ë…„1ê±´+18ë…„3ê±´+23ë…„3ê±´',
            config:{ keys:['C','D','E','F','G','A','B'], sequence:['C','D','C','E','E'], display:'ë„ ë ˆ ë„ ë¯¸ ë¯¸ (1,2,1,3,3)' },
            hint:'ì‚¬ê±´ ìˆ˜ íŒ¨í„´ 1,2,1,3,3ì„ ìŒê³„ë¡œ. í•©ê³„=10',
            validate:function(i){return i.trim() === '10'} },
          { type:'cpq', cpqIndex:0,
            story:'ìë£Œì‹¤ ë²½ì— ë¶™ì€ ì§€ë„. í™”ì¬ ì›ì¸ ì¡°ì‚¬ ë³´ê³ ì„œ.\n"í™”ì¬ëŠ” ì‚¬ê³ ê°€ ì•„ë‹ˆì—ˆë‹¤." ê²°ì •ì  ì¥ì†Œê°€ í‘œì‹œë˜ì–´ ìˆë‹¤.',
            storyAfter:'ë³´ê³ ì„œì˜ ë§ˆì§€ë§‰ í˜ì´ì§€ê°€ í¼ì³ì¡Œë‹¤.' }
        ],
        cliffhanger:'í™”ì¬ ì¡°ì‚¬ ë³´ê³ ì„œ. ê¸°ë°€ ìŠ¤íƒ¬í”„ê°€ ì°í˜€ìˆë‹¤.\n\n"1994ë…„ 12ì›” 24ì¼. ì„¸ì¢…ê³  ì§€í•˜ ë³´ì¼ëŸ¬ì‹¤ì—ì„œ ë°œí™”."\n"í™”ì¬ëŠ” ì‚¬ê³ ê°€ ì•„ë‹ˆë¼ ì˜ë„ì  ë°©í™”."\n"ëª©ì : ì§€í•˜ì‹¤ì˜ ì¦ê±° ì¸ë©¸."\n\nì¦ê±°ê°€ ë­ì˜€ì„ê¹Œ?\n\në³´ê³ ì„œì— ì²¨ë¶€ëœ ìƒì¡´ì ëª…ë‹¨. ì„¸ ë²ˆì§¸ ì´ë¦„.\nì§ì—…ë€: "ê·¸ë€ë° ì˜¤í˜ë¼ í•˜ìš°ìŠ¤ ë‹¨ì›"\n\nì¡¸ì—…ì•¨ë²”ì—ì„œ ì§€ì›Œì¡Œë˜ ì„¸ ë²ˆì§¸ ì‚¬ëŒ.\nê·¸ê°€ ì˜¤í˜ë¼ ê·¹ì¥ì— ìˆë‹¤.'
      },
      {
        id:'ch3_opera', title:'Ch.3 â€” ì˜¤í˜ë¼ ê·¹ì¥', desc:'100ë…„ ëœ ê·¹ì¥. ë¬´ëŒ€ ì•„ë˜ì— ìˆ¨ê²¨ì§„ ë¹„ë°€.', time:'15ë¶„',
        intro:'ê·¸ë€ë° ì˜¤í˜ë¼ í•˜ìš°ìŠ¤. 100ë…„ ì—­ì‚¬ì˜ ê·¹ì¥.\nê³µì—°ì€ ëë‚¬ì§€ë§Œ ì¡°ëª…ì´ ì¼œì ¸ ìˆë‹¤. ë¬´ëŒ€ ìœ„ì— í•œ ì‚¬ëŒì´ ì„œ ìˆë‹¤.\në‹¹ì‹ ì„ ê¸°ë‹¤ë¦¬ê³  ìˆì—ˆë‹¤ëŠ” ë“¯ì´.\n"ì˜ ì™”ì–´. êµìˆ˜ë„, í˜„ìš°ë„ ì—¬ê¸°ê¹Œì§€ ì™”ì—ˆì§€."\nê·¸ê°€ ë’¤ëŒì•„ì„œëŠ” ìˆœê°„, ë¬´ëŒ€ê°€ êº¼ì§€ê³  ê¸°ê³„ì¥ì¹˜ê°€ ì‘ë™í•œë‹¤.',
        puzzles:[
          { type:'interactive', interactionType:'piano', title:'ğŸ¼ í¼ì¦ 1: ì•…ë³´ì˜ ì•ŒíŒŒë²³ ì•”í˜¸',
            story:'ë¶„ì¥ì‹¤. í™”ì¥ëŒ€ ìœ„ ì•…ë³´ì— ë¹¨ê°„ íœìœ¼ë¡œ ìŒí‘œì— ë™ê·¸ë¼ë¯¸. ìˆœì„œëŒ€ë¡œ ì—°ì£¼í•˜ë¼.',
            config:{ keys:['C','D','E','F','G','A','B'], sequence:['C','D','E','C','G'], display:'ë„(C) ë ˆ(D) ë¯¸(E) ë„(C) ì†”(G) â†’ ìˆ«ì: 3,4,5,3,7' },
            hint:'C=3,D=4,E=5,C=3,G=7 â†’ 34537',
            validate:function(i){return i.replace(/\s/g,'') === '34537'} },
          { type:'interactive', interactionType:'dial', title:'ğŸ“” í¼ì¦ 2: ìœ„í˜‘ í¸ì§€ì˜ ë¡œë§ˆ ìˆ«ì',
            story:'ë¶„ì¥ëŒ€ ì„œë. ìœ„í˜‘ í¸ì§€ ë„¤ í†µ.\ní¸ì§€ì˜ ì›” ìˆ«ìë¥¼ ë‹¤ì´ì–¼ì— ë§ì¶° ê¸ˆê³ ë¥¼ ì—´ì–´ë¼.',
            config:{ combination:[3,1], labels:['ì‹­','ì¼'] },
            hint:'IIIì›”(3)+VIIì›”(7)+IXì›”(9)+XIIì›”(12)=31',
            validate:function(i){return i.trim() === '31'} },
          { type:'interactive', interactionType:'timing', title:'ğŸ» í¼ì¦ 3: ì˜¤ì¼€ìŠ¤íŠ¸ë¼ ë°°ì¹˜ íŒ¨í„´',
            story:'ì§€í•˜ ì•…ê¸° ë³´ê´€ì†Œ. ë¬´ëŒ€ ì¥ì¹˜ì˜ íƒ€ì´ë°ì— ë§ì¶° ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë‹µì´ ë“œëŸ¬ë‚œë‹¤.\níŒ¨í„´: 8â†’6â†’4â†’2â†’?',
            config:{ zoneStart:0.4, zoneEnd:0.6, required:3, speed:0.012, revealText:'0' },
            hint:'-2ì”© ê°ì†Œ: 8,6,4,2,0. íƒ€ì´ë° 3ë²ˆ ì„±ê³µì‹œ ë‹µì´ ë‚˜íƒ€ë‚¨.',
            validate:function(i){return i.trim() === '0'} },
          { type:'interactive', interactionType:'jigsaw', title:'ğŸšª í¼ì¦ 4: ë¬´ëŒ€ ê¸°ê³„ì‹¤',
            story:'ê¸°ê³„ì‹¤. 100ë…„ ëœ ì¥ì¹˜ë“¤ ì‚¬ì´ì— í¼ì¦ ì¡°ê°ì´ í©ì–´ì ¸ ìˆë‹¤.',
            config:{ pieces:['ê±´ë¦½: 1924ë…„','í˜„ì¬: 2024ë…„','ì°¨ì´ = ?ë…„','ì •ë‹µ: 100'], cols:2,
              correctOrder:[0,1,2,3], revealText:'ê·¹ì¥ ì—°ìˆ˜: 100ë…„' },
            hint:'2024-1924=100',
            validate:function(i){return i.trim() === '100'} },
          { type:'cpq', cpqIndex:0,
            story:'ë¬´ëŒ€ ì•„ë˜ ë¹„ë°€ ê¸°ë¡ë³´ê´€ì†Œ.\n"ìœ ë ¹ì˜ ì •ì²´ë¥¼ ì•Œì•„ëƒˆë‹¤. ì¦ê±°ê°€ ì´ ì¥ì†Œì— ìˆë‹¤."',
            storyAfter:'ê¸°ë¡ë³´ê´€ì†Œì˜ ë§ˆì§€ë§‰ ì„œë¥˜ê°€ ë“œëŸ¬ë‚¬ë‹¤.' }
        ],
        cliffhanger:'ê¸°ë¡ë³´ê´€ì†Œì—ì„œ ë‚˜ì˜¨ ì„œë¥˜ë­‰ì¹˜.\n\nì„¸ ë²ˆì§¸ ë‚¨ìì˜ ê³ ë°±.\n"ìš°ë¦¬ ì…‹ì€ 1994ë…„ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ì´ë¸Œ, í•™êµ ì§€í•˜ì‹¤ì—ì„œ ê·¸ê²ƒì„ ë´¤ë‹¤."\n"ì¸ì²´ ì‹¤í—˜ ê¸°ë¡. ì•„ì´ë“¤ì„ ëŒ€ìƒìœ¼ë¡œ í•œ."\n"í™”ì¬ëŠ” ì¦ê±°ë¥¼ íƒœìš°ê¸° ìœ„í•œ ê²ƒì´ì—ˆë‹¤."\n\në§ˆì§€ë§‰ í˜ì´ì§€.\n"ìµœí˜„ìš°ëŠ” ì´ê±¸ ì„¸ìƒì— ì•Œë¦¬ë ¤ë‹¤ ì‚¬ë¼ì¡Œë‹¤."\n"ê¹€ë™í˜„ êµìˆ˜ëŠ” ì¦ê±°ë¥¼ ëª¨ìœ¼ë‹¤ ê°ê¸ˆë‹¹í–ˆë‹¤."\n"ë‚˜ëŠ”... ë§ˆì§€ë§‰ íŠ¸ë¦­ì„ ì¤€ë¹„í–ˆë‹¤."\n\nì„œë¥˜ ë’·ë©´ì— ë„ì¥.\n"ì„±ëª¨ì˜ë£Œì¬ë‹¨"\n\níì‡„ëœ ì„±ëª¨ë³‘ì›. 304í˜¸.\nëª¨ë“  ê²ƒì€ ê±°ê¸°ì„œ ì‹œì‘ëë‹¤.'
      }
    ]
  },
  {
    id:'hospital', title:'304í˜¸ì˜ ê¸°ì–µ', icon:'ğŸ¥', difficulty:3,
    desc:'10ë…„ ì „ íì‡„ëœ ë³‘ì›. 304í˜¸ í™˜ìë“¤ì´ ì „ì› ë™ì‹œì— ì‚¬ë¼ì§„ ì‚¬ê±´. ì§„ì‹¤ì„ íŒŒí—¤ì³ë¼.',
    chapters:[
      {
        id:'ch1_hospital', title:'Ch.1 â€” íë³‘ì› 304í˜¸', desc:'ë°¤ë§ˆë‹¤ ë¶ˆì´ ì¼œì§€ëŠ” íë³‘ì›. 10ë…„ ì „ ê·¸ë‚  ë°¤ì˜ ì§„ì‹¤.', time:'14ë¶„',
        intro:'ì„±ëª¨ë³‘ì›. 10ë…„ ì „ ì˜ë£Œì‚¬ê³ ë¡œ íì‡„ëë‹¤.\ní•˜ì§€ë§Œ "ì˜ë£Œì‚¬ê³ "ëŠ” ê³µì‹ ë°œí‘œì¼ ë¿ì´ë‹¤.\n304í˜¸ì—ì„œ ë°¤ë§ˆë‹¤ ë¶ˆë¹›ì´ ì¼œì§„ë‹¤ëŠ” ì œë³´.\në‹¹ì‹ ì´ ë“¤ì–´ì„  ìˆœê°„, ë³µë„ ëì—ì„œ ë°œìêµ­ ì†Œë¦¬.\n10ë…„ê°„ ì•„ë¬´ë„ ë“¤ì–´ì˜¤ì§€ ì•Šì•˜ì„ ì´ ë³‘ì›ì—ì„œ.',
        puzzles:[
          { type:'interactive', interactionType:'connect-dots', title:'ğŸ’Š í¼ì¦ 1: í™˜ì ì°¨íŠ¸ì˜ ë³µìš©ëŸ‰',
            story:'304í˜¸ ì¹¨ëŒ€ ì˜†, ë‚¡ì€ í™˜ì ì°¨íŠ¸. ì ë“¤ì„ ìˆœì„œëŒ€ë¡œ ì—°ê²°í•˜ë©´ ë³µìš©ëŸ‰ì´ ë‚˜íƒ€ë‚œë‹¤.',
            config:{ dots:[
              {x:15, y:20, order:1}, {x:40, y:15, order:2},
              {x:65, y:25, order:3}, {x:85, y:50, order:4},
              {x:60, y:75, order:5}, {x:30, y:80, order:6}
            ], revealText:'ì•„ì¹¨2+ì ì‹¬1+ì €ë…3 = 6' },
            hint:'ì ì„ 1â†’2â†’3â†’4â†’5â†’6 ìˆœì„œë¡œ í´ë¦­. ë‹µ: 6',
            validate:function(i){return i.trim() === '6'} },
          { type:'interactive', interactionType:'shake', title:'ğŸ“‹ í¼ì¦ 2: ì˜ì‚¬ì˜ ì§„ë£Œ ê¸°ë¡',
            story:'ì¹¨ëŒ€ ì•„ë˜ ê¸ˆê³ . ë¨¼ì§€ê°€ ë‘ê»ê²Œ ìŒ“ì—¬ìˆë‹¤. í”ë“¤ì–´ì„œ ë¨¼ì§€ë¥¼ í„¸ì–´ë‚´ì•¼ í•œë‹¤.',
            config:{ required:15, revealText:'ì£¼ê°„ ì§„ë£Œ: 12+8+15+6+9 = 50' },
            hint:'ê¸°ê¸°ë¥¼ í”ë“¤ê±°ë‚˜ ìŠ¤í˜ì´ìŠ¤ë°”ë¥¼ ì—°íƒ€! ë‹µ: 50',
            validate:function(i){return i.trim() === '50'} },
          { type:'interactive', interactionType:'flashlight', title:'ğŸ”¬ í¼ì¦ 3: ì°½ê°€ì˜ í™”í•™ ê³µì‹',
            story:'ì •ì „ëœ ì‹¤í—˜ì‹¤. ì†ì „ë“±ìœ¼ë¡œ ë²½ë©´ì˜ í™”í•™ ê³µì‹ì„ ì°¾ì•„ì•¼ í•œë‹¤.',
            config:{ items:[
              {x:10, y:20, text:'Hâ‚‚O'},
              {x:50, y:40, text:'NaCl'},
              {x:30, y:65, text:'Câ‚†Hâ‚â‚‚Oâ‚†'},
              {x:75, y:30, text:'ì›ì†Œ ì²«ê¸€ì:'},
              {x:70, y:55, text:'H,O,Na,Cl,C'},
              {x:45, y:85, text:'â†’ HONCC'}
            ]},
            hint:'ì›ì†Œ ì²« ê¸€ì: H,O,N,C,C â†’ HONCC',
            validate:function(i){return i.toUpperCase().replace(/\s/g,'') === 'HONCC'} },
          { type:'interactive', interactionType:'dial', title:'ğŸ—‚ï¸ í¼ì¦ 4: ë³‘ì› ì´ ì¸ì›',
            story:'ë¹„ë°€ ì„œëì˜ ë‹¤ì´ì–¼ ì ê¸ˆ. ë³‘ì› ì „ì²´ ì¸ì›ìˆ˜ë¡œ ì—´ë¦°ë‹¤.\nì…ì›45+ì™¸ë˜128+ì˜ë£Œì§„23+ê´€ë¦¬14',
            config:{ combination:[2,1,0], labels:['ë°±','ì‹­','ì¼'] },
            hint:'45+128+23+14=210. ë‹¤ì´ì–¼ì„ 210ìœ¼ë¡œ.',
            validate:function(i){return i.trim() === '210'} },
          { type:'cpq', cpqIndex:0,
            story:'"304í˜¸ì˜ ì§„ì§œ ë¹„ë°€. ë” í° ìŒëª¨ê°€ ìˆë‹¤."\nê¹€ ì˜ì‚¬ê°€ ëª©ìˆ¨ ê±¸ê³  ì¶”ì í•œ ì¥ì†Œ.',
            storyAfter:'ë³´ê³ ì„œì˜ ë§ˆì§€ë§‰ ì¥ì´ í•´ë…ëë‹¤.' }
        ],
        cliffhanger:'ê¹€ì˜í˜¸ ì˜ì‚¬ì˜ ìµœì¢… ë³´ê³ ì„œ.\n\n"304í˜¸ í™˜ì 5ëª…. ì „ì› ê°™ì€ ê³ ì•„ì› ì¶œì‹ ."\n"êµ¬ì„¸ì£¼ ê³ ì•„ì›. 30ë…„ ì „ í™”ì¬ë¡œ íì‡„ëœ ë°”ë¡œ ê·¸ê³³."\n"í™˜ìë“¤ì€ ì–´ë¦° ì‹œì ˆ ì‹¤í—˜ ëŒ€ìƒì´ì—ˆë‹¤."\n"ê·¸ë¦¬ê³  ëˆ„êµ°ê°€ ê·¸ë“¤ì„ ë‹¤ì‹œ ëª¨ì•˜ë‹¤."\n\në³´ê³ ì„œì— ì²¨ë¶€ëœ ì‚¬ì§„.\nê³ ì•„ì› ì •ë¬¸. ìµœê·¼ì— ì°íŒ ê²ƒì´ë‹¤.\nì² ì¡°ë§ì´ ìƒˆê²ƒìœ¼ë¡œ êµì²´ë˜ì–´ ìˆë‹¤.\n\nëˆ„êµ°ê°€ ê·¸ê³³ì„ ë‹¤ì‹œ ì‚¬ìš©í•˜ê³  ìˆë‹¤.'
      },
      {
        id:'ch2_orphanage', title:'Ch.2 â€” ë²„ë ¤ì§„ ê³ ì•„ì›', desc:'30ë…„ ì „ ë¶ˆíƒ„ ê³ ì•„ì›. ë°¤ë§ˆë‹¤ ì•„ì´ë“¤ì˜ ìš¸ìŒì†Œë¦¬ê°€ ë“¤ë¦°ë‹¤.', time:'16ë¶„',
        intro:'êµ¬ì„¸ì£¼ ê³ ì•„ì›. ì™¸ë²½ì€ ê·¸ì„ìŒìœ¼ë¡œ ê¹Œë§£ë‹¤.\nìƒˆ ì² ì¡°ë§. ìƒˆ ìë¬¼ì‡ . ëˆ„êµ°ê°€ ê´€ë¦¬í•˜ê³  ìˆë‹¤.\nì•ˆìœ¼ë¡œ ë“¤ì–´ì„œì ì†Œë…ì•½ ëƒ„ìƒˆ. 30ë…„ ì „ ê±´ë¬¼ì—ì„œ?\n2ì¸µì—ì„œ í¬ë¯¸í•œ ë¶ˆë¹›. ë°œìêµ­ ì†Œë¦¬.\nì´ê³³ì€ ë²„ë ¤ì§€ì§€ ì•Šì•˜ë‹¤.',
        puzzles:[
          { type:'interactive', interactionType:'flashlight', title:'ğŸ‘¶ í¼ì¦ 1: ì¬ì›ìƒ ëª…ë‹¨ ë¶„ì„',
            story:'ì‚¬ë¬´ì‹¤ì´ ê¹œê¹œí•˜ë‹¤. ì†ì „ë“±ìœ¼ë¡œ 30ë…„ ì „ ì¬ì›ìƒ ëª…ë‹¨ì„ ì°¾ì•„ì•¼ í•œë‹¤.',
            config:{ items:[
              {x:15, y:20, text:'ê°•í˜œì§„'},
              {x:40, y:35, text:'ê¹€ë¯¼ìˆ˜'},
              {x:65, y:50, text:'ë°•ì˜í¬'},
              {x:25, y:65, text:'ì˜¤íƒœì‹'},
              {x:80, y:25, text:'ìœ¤ì„œì—°'},
              {x:50, y:80, text:'5ë²ˆì§¸=ìœ¤'}
            ]},
            hint:'ê°€ë‚˜ë‹¤ìˆœ: ê°•,ê¹€,ë°•,ì˜¤,ìœ¤... ë‹¤ì„¯ ë²ˆì§¸ ê¸€ìëŠ” ìœ¤',
            validate:function(i){return i.trim() === 'ìœ¤'} },
          { type:'interactive', interactionType:'connect-dots', title:'ğŸ“– í¼ì¦ 2: ì›ì¥ ìˆ˜ë…€ì˜ ì¼ê¸°',
            story:'ì›ì¥ ìˆ˜ë…€ì˜ ì¼ê¸°ì—ì„œ ì™¸ì¶œ ê¸°ë¡ íŒ¨í„´ì„ ì ìœ¼ë¡œ ì—°ê²°í•´ì•¼ í•œë‹¤.',
            config:{ dots:[
              {x:10, y:50, order:1}, {x:30, y:30, order:2},
              {x:50, y:50, order:3}, {x:70, y:30, order:4},
              {x:90, y:50, order:5}
            ], revealText:'ê°„ê²©: 4ì¼. 1,5,9,13,17 â†’ ë‹µ: 17' },
            hint:'4ì¼ ê°„ê²©: 1â†’5â†’9â†’13â†’17',
            validate:function(i){return i.trim() === '17'} },
          { type:'interactive', interactionType:'shake', title:'ğŸ§¸ í¼ì¦ 3: ë†€ì´ë°©ì˜ ì´ì§„ë²•',
            story:'2ì¸µ ë†€ì´ë°©. ì¹ íŒì´ ë¨¼ì§€ë¡œ ë®ì—¬ìˆë‹¤. í”ë“¤ì–´ì„œ ë¨¼ì§€ë¥¼ í„¸ì–´ë‚´ì•¼ í•œë‹¤.',
            config:{ required:20, revealText:'10101001(ì´ì§„ë²•) = 128+32+8+1 = 169' },
            hint:'ê¸°ê¸°ë¥¼ í”ë“¤ê±°ë‚˜ ë²„íŠ¼ ì—°íƒ€! ë‹µ: 169',
            validate:function(i){return i.trim() === '169'} },
          { type:'interactive', interactionType:'timing', title:'ğŸšª í¼ì¦ 4: ì§€í•˜ì‹¤ì˜ ì—°ìˆ˜ ê³„ì‚°',
            story:'ì§€í•˜ì‹¤ ë¬¸ì˜ íƒ€ì´ë¨¸ ì ê¸ˆì¥ì¹˜. ì •í™•í•œ íƒ€ì´ë°ì— ë§ì¶°ì•¼ ì—´ë¦°ë‹¤.\ní™”ì¬: 1994ë…„, í˜„ì¬: 2024ë…„',
            config:{ zoneStart:0.35, zoneEnd:0.5, required:3, speed:0.012, revealText:'30' },
            hint:'2024-1994=30. íƒ€ì´ë° 3ë²ˆ ì„±ê³µí•˜ì„¸ìš”.',
            validate:function(i){return i.trim() === '30'} },
          { type:'cpq', cpqIndex:0,
            story:'ì§€í•˜ì‹¤ ë²½ ë’¤ ìˆ¨ê²¨ì§„ ë°©.\n"ì•„ì´ë“¤ì€ ì—¬ê¸°ì„œ ì‹¤í—˜ë‹¹í–ˆë‹¤." ì¦ê±°ê°€ ìˆ¨ê²¨ì§„ ë§ˆì§€ë§‰ ì¥ì†Œ.',
            storyAfter:'ë²½ ë’¤ ë°©ì—ì„œ ìƒìê°€ ë‚˜ì™”ë‹¤.' }
        ],
        cliffhanger:'ìƒì ì•ˆ. ì…ì–‘ ì„œë¥˜ ìˆ˜ì‹­ í†µ.\n\nì „ë¶€ ê°€ì§œë‹¤. ì…ì–‘ëœ ì•„ì´ë“¤ì€ ê°€ì •ì— ê°„ ê²Œ ì•„ë‹ˆì—ˆë‹¤.\nì„œë¥˜ì˜ ì‹¤ì œ ëª©ì ì§€:\n"ì§€í•˜ì²  7í˜¸ì„  â€” êµ°ì‚¬ íì—­ B-7"\n\nì•„ì´ë“¤ì€ ê·¸ê³³ìœ¼ë¡œ ë³´ë‚´ì¡Œë‹¤.\nì„œë¥˜ ë’·ë©´, ìµœê·¼ ë‚ ì§œì˜ ë©”ëª¨:\n"ì‹¤í—˜ì€ ê³„ì†ë˜ê³  ìˆë‹¤. ìƒˆë¡œìš´ í”¼í—˜ìê°€ í•„ìš”í•˜ë‹¤."\n\n304í˜¸ í™˜ìë“¤ì´ ì‚¬ë¼ì§„ ì´ìœ .\nê·¸ë“¤ì€ ë‹¤ì‹œ ëŒì•„ê°„ ê²ƒì´ë‹¤.'
      },
      {
        id:'ch3_subway', title:'Ch.3 â€” ì§€í•˜ì²  íì—­', desc:'ë´‰ì¸ëœ êµ°ì‚¬ íì—­. ì•„ì´ë“¤ì´ ë³´ë‚´ì§„ ê³³.', time:'16ë¶„',
        intro:'7í˜¸ì„  ë§ˆì§€ë§‰ ì—´ì°¨ê°€ ë– ë‚œ ë’¤.\nìœ ì§€ë³´ìˆ˜ í†µë¡œë¥¼ í†µí•´ ë´‰ì¸ëœ B-7 íì—­ìœ¼ë¡œ ì§„ì…í–ˆë‹¤.\ní”Œë«í¼ì€ ê¹¨ë—í•˜ë‹¤. ë„ˆë¬´ ê¹¨ë—í•˜ë‹¤. ê´€ë¦¬ë˜ê³  ìˆë‹¤.\ní˜•ê´‘ë“±ì´ ê¹œë¹¡ì´ê³ , ì–´ë”˜ê°€ì—ì„œ ê¸°ê³„ìŒì´ ë“¤ë¦°ë‹¤.\nì´ê³³ì€ ì—­ì´ ì•„ë‹ˆë‹¤. ìœ„ì¥ëœ ì‹œì„¤ì´ë‹¤.',
        puzzles:[
          { type:'interactive', interactionType:'timing', title:'ğŸ—ºï¸ í¼ì¦ 1: ë…¸ì„ ë„ì˜ í™˜ìŠ¹ì—­',
            story:'ë²½ë©´ ë…¸ì„ ë„ ì•ì— íƒ€ì´ë° ì ê¸ˆì¥ì¹˜. í™˜ìŠ¹ì—­ ê°œìˆ˜ê°€ ë‹µì´ë‹¤.\ní™ëŒ€ì…êµ¬(í™˜ìŠ¹), ì‹ ì´Œ(X), ì´ëŒ€(X), ì¶©ì •ë¡œ(í™˜ìŠ¹)',
            config:{ zoneStart:0.3, zoneEnd:0.5, required:3, speed:0.015, revealText:'2' },
            hint:'í™˜ìŠ¹ì—­: í™ëŒ€ì…êµ¬, ì¶©ì •ë¡œ = 2ê°œ. íƒ€ì´ë° 3ë²ˆ!',
            validate:function(i){return i.trim() === '2'} },
          { type:'interactive', interactionType:'shake', title:'ğŸ“‹ í¼ì¦ 2: ì‹¤ì¢…ì ê¸°ë¡',
            story:'ê´€ì œì‹¤ ì„œëì´ ì ê²¨ìˆë‹¤. í˜ìœ¼ë¡œ í”ë“¤ì–´ ì—´ì–´ì•¼ í•œë‹¤.',
            config:{ required:18, revealText:'ì‹¤ì¢…ì: 2+3+5+2 = 12ëª…' },
            hint:'Aë™2+Bë™3+Cë™5+Dë™2=12. í”ë“¤ì–´ì„œ ì„œëì„ ì—´ì–´ë¼!',
            validate:function(i){return i.trim() === '12'} },
          { type:'interactive', interactionType:'piano', title:'â° í¼ì¦ 3: ìš´í–‰ ì‹œê°„ ê³„ì‚°',
            story:'ìš´ì „ì„ ì½˜ì†”ì˜ ìŒì„± ì¸ì¦. ì˜¬ë°”ë¥¸ ìŒê³„ë¥¼ ì…ë ¥í•´ì•¼ ì‹œê°„í‘œê°€ ë‚˜ì˜¨ë‹¤.\n23:45â†’01:15 = 15+75 = 90ë¶„',
            config:{ keys:['C','D','E','F','G','A','B'], sequence:['G','A','B','A','G'], display:'ì†” ë¼ ì‹œ ë¼ ì†” (ì‹œìŠ¤í…œ ì¸ì¦ ì½”ë“œ)' },
            hint:'ìŒê³„ë¥¼ ë§ì¶”ë©´ ë‹µì´ ë‚˜íƒ€ë‚¨. 23:45â†’01:15 = 90ë¶„',
            validate:function(i){return i.trim() === '90'} },
          { type:'interactive', interactionType:'connect-dots', title:'ğŸšª í¼ì¦ 4: ì¦ì–¸ ë¶„ì„',
            story:'ë…¹ìŒê¸°ì˜ ì¦ì–¸ ê´€ê³„ë„. ì ì„ ì—°ê²°í•˜ë©´ ì§„ì‹¤ì´ ë³´ì¸ë‹¤.',
            config:{ dots:[
              {x:20, y:30, order:1}, {x:50, y:15, order:2},
              {x:80, y:30, order:3}, {x:50, y:60, order:4},
              {x:50, y:85, order:5}
            ], revealText:'A(ì°¸),C(ì°¸),D(ì°¸) = ì§„ì‹¤ 3ëª…' },
            hint:'Bê°€ ê±°ì§“ì´ë©´ A,C,Dê°€ ì§„ì‹¤ = 3ëª…',
            validate:function(i){return i.trim() === '3'} },
          { type:'cpq', cpqIndex:0,
            story:'ì‹œì„¤ ìµœì‹¬ë¶€. ì‹¤í—˜ì‹¤ ë¬¸ ì•.\në§ˆì§€ë§‰ ì¸ì¦ì´ í•„ìš”í•˜ë‹¤. ê²°ì •ì  ì¥ì†Œì˜ ê±°ë¦¬ë¥¼ í™•ì¸í•˜ë¼.',
            storyAfter:'ì‹¤í—˜ì‹¤ ë¬¸ì´ ì—´ë ¸ë‹¤.' }
        ],
        cliffhanger:'ì‹¤í—˜ì‹¤.\n\në²½ë©´ ê°€ë“ ì‚¬ì§„ê³¼ ì„œë¥˜. 30ë…„ê°„ì˜ ê¸°ë¡.\nì•„ì´ë“¤ì˜ ì„±ì¥ ì‚¬ì§„. ê°™ì€ ì•„ì´ë“¤ì´ ì–´ë¥¸ì´ ë˜ì–´ê°€ëŠ” ê³¼ì •.\n304í˜¸ í™˜ìë“¤ì´ë‹¤.\n\nê·¸ë¦¬ê³  ì„œë¥˜ ë§¨ ìœ„, ì¬ë‹¨ ë¡œê³ .\n"êµ­ë¦½ ê³ ê³ í•™ ë°•ë¬¼ê´€ ì‚°í•˜ íŠ¹ìˆ˜ì—°êµ¬ì¬ë‹¨"\n\në°•ë¬¼ê´€.\nê¹€ë™í˜„ êµìˆ˜ê°€ ì†Œì†ëœ ë°”ë¡œ ê·¸ ë°•ë¬¼ê´€.\n\nêµìˆ˜ëŠ” ì´ ì‚¬ì‹¤ì„ ì•Œê³  ìˆì—ˆë‹¤.\nì•„ë‹ˆ, êµìˆ˜ëŠ” ì´ ì¬ë‹¨ì˜ ì¼ì›ì´ì—ˆë‹¤.\n\në²½ì— ë¶™ì€ ì¡°ì§ë„. ìµœìƒìœ„ì— ì íŒ ì´ë¦„.\n"ì¬ë‹¨ ì´ì‚¬ì¥: â–¡â–¡â–¡"\nì´ë¦„ì´ ê²€ê²Œ ì¹ í•´ì ¸ ìˆë‹¤.\n\ní•˜ì§€ë§Œ ì•„ë˜ ë©”ëª¨ê°€ ìˆë‹¤.\n"ì§€í•˜ ì „ì‹œì‹¤ Bê´€. ëª¨ë“  ë‹µì´ ê±°ê¸° ìˆë‹¤."'
      },
      {
        id:'ch4_museum', title:'Ch.4 â€” ë°•ë¬¼ê´€ì˜ ì§€í•˜', desc:'êµ­ë¦½ ë°•ë¬¼ê´€ ì „ì‹œê´€ ì•„ë˜ ìˆ¨ê²¨ì§„ ì—°êµ¬ì†Œ. 10ë…„ ì „ ì‚¬ê±´ì˜ ì „ëª¨.', time:'15ë¶„',
        intro:'êµ­ë¦½ ê³ ê³ í•™ ë°•ë¬¼ê´€. íê´€ í›„ ì•¼ê°„.\nì§€í•˜ Bê´€ ì…êµ¬. ì¼ë°˜ì¸ ì¶œì… ê¸ˆì§€ êµ¬ì—­.\nì¹´ë“œí‚¤ê°€ ì‘ë™í•œë‹¤. êµìˆ˜ì˜ ê²ƒì´ë‹ˆê¹Œ.\nì—˜ë¦¬ë² ì´í„°ê°€ ì§€í•˜ 3ì¸µê¹Œì§€ ë‚´ë ¤ê°„ë‹¤.\në¬¸ì´ ì—´ë¦¬ì ì„œëŠ˜í•œ ê³µê¸°ì™€ í•¨ê»˜ ê¸°ê³„ìŒ.\nì—¬ê¸°ëŠ” ë°•ë¬¼ê´€ì´ ì•„ë‹ˆë‹¤.',
        puzzles:[
          { type:'interactive', interactionType:'connect-dots', title:'ğŸº í¼ì¦ 1: ìœ ë¬¼ ì—°ë„ ì•”í˜¸',
            story:'ì „ì‹œ êµ¬ì—­ì„ ìœ„ì¥í•œ í†µë¡œ. ìœ ë¬¼ 4ì ì˜ ì—°ë„ë¥¼ ìˆœì„œëŒ€ë¡œ ì—°ê²°í•˜ë¼.',
            config:{ dots:[
              {x:15, y:30, order:1}, {x:40, y:60, order:2},
              {x:65, y:25, order:3}, {x:88, y:55, order:4}
            ], revealText:'ë§ˆì§€ë§‰ ìë¦¬: 3,0,6,9 â†’ 3069' },
            hint:'BC1323â†’3, BC1550â†’0, BC196â†’6, BC69â†’9',
            validate:function(i){return i.replace(/\s/g,'') === '3069'} },
          { type:'interactive', interactionType:'dial', title:'ğŸ““ í¼ì¦ 2: ìˆœì°° ê¸°ë¡ íŒ¨í„´',
            story:'ê²½ë¹„ì› ìˆœì°° ì¼ì§€ì˜ ë‹¤ì´ì–¼ ì ê¸ˆ.\nì´ë™ê°ì§€: 3,5,7,9,? (+2ì”©)',
            config:{ combination:[1,1], labels:['ì‹­','ì¼'] },
            hint:'3â†’5â†’7â†’9â†’11. ë‹¤ì´ì–¼ì„ 11ë¡œ.',
            validate:function(i){return i.trim() === '11'} },
          { type:'interactive', interactionType:'flashlight', title:'ğŸ›ï¸ í¼ì¦ 3: ìŒì•… ì•”í˜¸',
            story:'ê·¸ë¦¬ìŠ¤ê´€ì´ ì •ì „ëë‹¤. ì•„í´ë¡œ ì¡°ê°ìƒ ëŒ€ì¢Œì˜ ìŒí‘œë¥¼ ì°¾ì•„ë¼.',
            config:{ items:[
              {x:20, y:30, text:'ì†”=5'},
              {x:55, y:50, text:'ë„=1'},
              {x:35, y:75, text:'ë ˆ=2'},
              {x:80, y:35, text:'ë¯¸=3'},
              {x:60, y:80, text:'â†’5123'}
            ]},
            hint:'ì†”ë„ë ˆë¯¸ = 5123',
            validate:function(i){return i.replace(/\s/g,'') === '5123'} },
          { type:'interactive', interactionType:'shake', title:'ğŸšª í¼ì¦ 4: í™©ì œì˜ ì¬ìœ„ ê¸°ê°„',
            story:'ë¡œë§ˆê´€ í•´ì‹œê³„ê°€ ë¨¼ì§€ë¡œ ë®ì—¬ìˆë‹¤. í”ë“¤ì–´ì„œ ë‹¦ì•„ë‚´ì•¼ í•œë‹¤.\nì•„ìš°êµ¬ìŠ¤íˆ¬ìŠ¤45, íŠ¸ë¼ì•¼ëˆ„ìŠ¤19, í•˜ë“œë¦¬ì•„ëˆ„ìŠ¤21, ë§ˆë¥´ì¿ ìŠ¤19',
            config:{ required:15, revealText:'ìµœëŒ€ ì¬ìœ„: ì•„ìš°êµ¬ìŠ¤íˆ¬ìŠ¤ 45ë…„' },
            hint:'45,19,21,19 ì¤‘ ìµœëŒ€ê°’ì€ 45',
            validate:function(i){return i.trim() === '45'} },
          { type:'cpq', cpqIndex:0,
            story:'ìµœì‹¬ë¶€ ë¹„ë°€ ìˆ˜ì¥ê³ .\n"ëª¨ë“  ì¦ê±°ê°€ ì—¬ê¸° ìˆë‹¤." ë§ˆì§€ë§‰ ì¥ì†Œì˜ ê±°ë¦¬ë¥¼ í™•ì¸í•˜ë¼.',
            storyAfter:'ìˆ˜ì¥ê³ ì˜ ìµœì¢… ë¬¸ì„œê°€ ë“œëŸ¬ë‚¬ë‹¤.' }
        ],
        cliffhanger:'ìˆ˜ì¥ê³  ì¤‘ì•™. ëŒ€í˜• ìŠ¤í¬ë¦°.\n\nì¬ìƒ ë²„íŠ¼ì„ ëˆ„ë¥´ì ì˜ìƒì´ í˜ëŸ¬ë‚˜ì˜¨ë‹¤.\nì¬ë‹¨ ì´ì‚¬ì¥ì˜ ì–¼êµ´.\n\n"304í˜¸ í™˜ìë“¤ì€ ì‚¬ë¼ì§„ ê²Œ ì•„ë‹™ë‹ˆë‹¤."\n"ê·¸ë“¤ì€ ì„±ê³µí•œ ê²ë‹ˆë‹¤."\n"30ë…„ê°„ì˜ ì‹¤í—˜ì´ ë“œë””ì–´ ê²°ì‹¤ì„ ë§ºì—ˆìŠµë‹ˆë‹¤."\n"ì´ì œ 2ë‹¨ê³„ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤."\n\nì˜ìƒì´ ëŠê¸´ë‹¤.\n\nìŠ¤í¬ë¦° ì•„ë˜ ì„œë¥˜. 2ë‹¨ê³„ ê³„íšì„œ.\nëª©í‘œ: "ì‹¬í•´ ì—°êµ¬ì†Œ ê°€ë™"\nìœ„ì¹˜: "ë¶íƒœí‰ì–‘ í•´ì € 1000m"\n\nêµìˆ˜ëŠ” ì´ê±¸ ë§‰ìœ¼ë ¤ë‹¤ ê°ê¸ˆë‹¹í•œ ê²ƒì´ë‹¤.\nìµœí˜„ìš°ëŠ” ì´ê±¸ ì•Œë¦¬ë ¤ë‹¤ ì‚¬ë¼ì§„ ê²ƒì´ë‹¤.\n\nì„œë¥˜ ë§ˆì§€ë§‰ ì¤„.\n"ì¹´ìš´íŠ¸ë‹¤ìš´ ì‹œì‘. ì‹œê³„íƒ‘ì—ì„œ ì‹ í˜¸ë¥¼ ë³´ë‚´ë¼."\n\në„ì‹œ ì¤‘ì‹¬ì˜ ì‹œê³„íƒ‘.\n3ì‹œ 33ë¶„ì— ë©ˆì¶˜ ì‹œê³„.\n\nì¹´ìš´íŠ¸ë‹¤ìš´ì€ ì´ë¯¸ ì‹œì‘ëë‹¤.'
      }
    ]
  },
  {
    id:'deep', title:'ì‹¬í•´ì˜ ë¹„ë°€', icon:'ğŸ”±', difficulty:3,
    desc:'ëª¨ë“  ì‚¬ê±´ì˜ ë°°í›„. ì‹œê³„íƒ‘ì—ì„œ ì‹œì‘ëœ ì¹´ìš´íŠ¸ë‹¤ìš´. ëë‚´ì§€ ì•Šìœ¼ë©´ ëë‚˜ì§€ ì•ŠëŠ”ë‹¤.',
    chapters:[
      {
        id:'ch1_clock', title:'Ch.1 â€” ì‹œê³„íƒ‘', desc:'ë„ì‹œ ì¤‘ì‹¬ì˜ ì‹œê³„íƒ‘. ê°‘ìê¸° ë©ˆì¶˜ ì‹œê³„ì™€ í•¨ê»˜ ì‹œì‘ë˜ëŠ” ì¹´ìš´íŠ¸ë‹¤ìš´.', time:'14ë¶„',
        intro:'ê³ ë”• ì‹œê³„íƒ‘. 50ë…„ê°„ í•œ ë²ˆë„ ë©ˆì¶”ì§€ ì•Šì•˜ë‹¤.\nì§€ê¸ˆì€ 3ì‹œ 33ë¶„ì— ë©ˆì¶° ìˆë‹¤.\nì¢…ì§€ê¸° ë°•ì‹œê³„ê°€ ì‚¬ë¼ì¡Œë‹¤.\níƒ‘ ê¼­ëŒ€ê¸°ì— ì˜¬ë¼ì„œì ê³„ë‹¨ì´ ë¬´ë„ˆì¡Œë‹¤.\nê¸°ì–´ ëŒì•„ê°€ëŠ” ì†Œë¦¬ ì‚¬ì´ë¡œ ë¹¨ê°„ LED ìˆ«ìê°€ ê¹œë¹¡ì¸ë‹¤.\nì¹´ìš´íŠ¸ë‹¤ìš´. 72:00:00.',
        puzzles:[
          { type:'interactive', interactionType:'timing', title:'â° í¼ì¦ 1: ì‹œê³„ë°”ëŠ˜ ê°ë„',
            story:'ê±°ëŒ€í•œ ì‹œê³„ ê¸°ê³„ì¥ì¹˜. 3ì‹œ 33ë¶„ì— ë©ˆì¶°ìˆë‹¤.\níƒ€ì´ë°ì— ë§ì¶° ê¸°ì–´ë¥¼ ë§ì¶”ë©´ ê°ë„ê°€ ê³„ì‚°ëœë‹¤.\në¶„ì¹¨198Â°-ì‹œì¹¨106.5Â°=91.5Â°',
            config:{ zoneStart:0.38, zoneEnd:0.52, required:3, speed:0.014, revealText:'91.5' },
            hint:'|198-106.5|=91.5. íƒ€ì´ë° 3ë²ˆ ì„±ê³µ!',
            validate:function(i){return i.trim()==='91.5'||i.trim()==='91'} },
          { type:'interactive', interactionType:'mirror', title:'ğŸ“’ í¼ì¦ 2: ì‹œê³„ ì˜¤ì°¨ íŒ¨í„´',
            story:'ì‘ì—… ì¼ì§€ê°€ ê±°ìš¸ì— ë°˜ì‚¬ë˜ì–´ ë³´ì¸ë‹¤.\nì˜¤ì°¨: 2â†’4â†’8â†’16â†’?',
            config:{ text:'2 3', direction:'horizontal' },
            hint:'ë§¤ì¼ 2ë°°: 16Ã—2=32. ê±°ìš¸ ë°˜ì „ëœ 32ë¥¼ ì½ìœ¼ë©´ 32',
            validate:function(i){return i.trim() === '32'} },
          { type:'interactive', interactionType:'piano', title:'ğŸ”” í¼ì¦ 3: ì¢…ì˜ ì§„ë™ ì£¼íŒŒìˆ˜',
            story:'ì¢…ë£¨ì˜ ìŒì„± ì ê¸ˆ. ì˜¬ë°”ë¥¸ ìŒê³„ë¡œ ì¢…ì„ ìš¸ë ¤ì•¼ í•œë‹¤.\nf = 1500 Ã· 4 = 375',
            config:{ keys:['C','D','E','F','G','A','B'], sequence:['E','G','A','G','E'], display:'ë¯¸ ì†” ë¼ ì†” ë¯¸ (ê³µëª… ì£¼íŒŒìˆ˜ ì½”ë“œ)' },
            hint:'1500Ã·4=375. ìŒê³„ë¥¼ ë§ì¶”ë©´ ë‹µì´ ë‚˜íƒ€ë‚¨.',
            validate:function(i){return i.trim() === '375'} },
          { type:'interactive', interactionType:'connect-dots', title:'ğŸšª í¼ì¦ 4: ì‹œê³„íƒ‘ ì—°ìˆ˜',
            story:'ê¸°ê³„ ë‚´ë¶€ì— ìˆ¨ê²¨ì§„ ì ë“¤. ì—°ê²°í•˜ë©´ ê±´ì„¤ ì—°ë„ê°€ ë“œëŸ¬ë‚œë‹¤.',
            config:{ dots:[
              {x:15, y:25, order:1}, {x:35, y:55, order:2},
              {x:55, y:25, order:3}, {x:75, y:55, order:4},
              {x:90, y:25, order:5}
            ], revealText:'2024-1974 = 50ë…„' },
            hint:'ê±´ì„¤1974, í˜„ì¬2024. ë‹µ: 50',
            validate:function(i){return i.trim() === '50'} },
          { type:'cpq', cpqIndex:0,
            story:'ì‹œê³„ ë‚´ë¶€ ìˆ¨ê²¨ì§„ ë°©. ì¢Œí‘œê°€ ìƒˆê²¨ì§„ ê¸ˆì†íŒ.\n"ì´ ì¢Œí‘œê°€ ê°€ë¦¬í‚¤ëŠ” ê³³." ë§ˆì§€ë§‰ ì¥ì†Œì˜ ê±°ë¦¬ë¥¼ í™•ì¸í•˜ë¼.',
            storyAfter:'ê¸ˆì†íŒ ë’·ë©´ì˜ ë©”ì‹œì§€ê°€ í•´ë…ëë‹¤.' }
        ],
        cliffhanger:'ê¸ˆì†íŒ ë’·ë©´.\ní•´ì € ì¢Œí‘œ: N 35Â°12\'48" E 129Â°45\'36"\n\nê·¸ë¦¬ê³  í•œ ì¤„ì˜ ë©”ì‹œì§€.\n"ëª¨ë“  ë‹µì€ ë°”ë‹¤ ì•„ë˜ì— ìˆë‹¤."\n\nì¹´ìš´íŠ¸ë‹¤ìš´ì´ ë©ˆì·„ë‹¤.\nì‹œê³„ê°€ ë‹¤ì‹œ ì›€ì§ì´ê¸° ì‹œì‘í•œë‹¤.\n\ní•˜ì§€ë§Œ ë°©í–¥ì´ ë°˜ëŒ€ë‹¤.\nì‹œê³„ê°€ ê±°ê¾¸ë¡œ ê°€ê³  ìˆë‹¤.\n\nì¢…ì§€ê¸°ì˜ ë§ˆì§€ë§‰ ë©”ëª¨.\n"ì´ ì‚¬ê±´ì„ 20ë…„ê°„ ì¶”ì í•´ì˜¨ ì‚¬ëŒì´ ìˆë‹¤."\n"íƒì • ì¥í˜œë¦°. ê·¸ë…€ì˜ ì‚¬ë¬´ì†Œì— ëª¨ë“  ì—°ê²°ê³ ë¦¬ê°€ ìˆë‹¤."'
      },
      {
        id:'ch2_detective', title:'Ch.2 â€” íƒì • ì‚¬ë¬´ì†Œ', desc:'20ë…„ê°„ ì´ ì‚¬ê±´ì„ ì¶”ì í•´ì˜¨ íƒì •. ëª¨ë“  ì—°ê²°ê³ ë¦¬ë¥¼ ì •ë¦¬í•œë‹¤.', time:'13ë¶„',
        intro:'ì‚¬ë¦½íƒì • ì¥í˜œë¦°. 20ë…„ ê²½ë ¥.\n"ê²°ì •ì  ë‹¨ì„œë¥¼ ì°¾ì•˜ë‹¤"ëŠ” ì „í™”ë¥¼ ë§ˆì§€ë§‰ìœ¼ë¡œ 3ì¼ì§¸ ì—°ë½ ë‘ì ˆ.\nì‚¬ë¬´ì†Œì— ë“¤ì–´ì„œì ìŒì„±ì´ í˜ëŸ¬ë‚˜ì˜¨ë‹¤.\n"ì—¬ê¸°ê¹Œì§€ ì™”ë‹¤ë©´, ë‹¹ì‹ ë„ ì§„ì‹¤ì— ê°€ê¹Œì›Œì§„ ê±°ì•¼."\n"ë‚´ê°€ ì •ë¦¬í•œ ê±¸ ë´. ëª¨ë“  ê±´ ì—°ê²°ë˜ì–´ ìˆì–´."',
        puzzles:[
          { type:'interactive', interactionType:'jigsaw', title:'ğŸ” í¼ì¦ 1: ì•Œë¦¬ë°”ì´ ë¶„ì„',
            story:'ì‚¬ê±´ ìˆ˜ì²©ì˜ ì•Œë¦¬ë°”ì´ ì¡°ê°ì´ ì°¢ì–´ì ¸ ìˆë‹¤. ë§ì¶”ë©´ ë²”ì¸ì´ ë“œëŸ¬ë‚œë‹¤.',
            config:{ pieces:['ê¹€ëŒ€í‘œ: ì§‘','ë°•ì°¨ì¥: ì˜í™”','ìµœë¶€ì¥: ì´ë™ì¤‘','ì´ë¹„ì„œ: ì‚¬ìš°ë‚˜'], cols:2,
              correctOrder:[0,1,2,3], revealText:'ì´ë™ ì¤‘ì¸ ìµœë¶€ì¥ë§Œ ììœ ì‹œê°„ â†’ ë‹µ: ìµœ' },
            hint:'9ì‹œ~9ì‹œ30ë¶„ ììœ ì‹œê°„ ìˆëŠ” ì‚¬ëŒ = ìµœ',
            validate:function(i){return i.trim() === 'ìµœ'} },
          { type:'interactive', interactionType:'color-code', title:'ğŸ•µï¸ í¼ì¦ 2: ì´ë™ ì‹œê°„ ê³„ì‚°',
            story:'ì¶”ì  ê¸°ë¡ì˜ ìƒ‰ìƒ ì½”ë“œ ì§€ë„.',
            config:{ colors:[
              {color:'#ff4444', name:'ë¹¨ê°• (íšŒì‚¬â†’ì¹´í˜)', value:'15'},
              {color:'#4488ff', name:'íŒŒë‘ (ì¹´í˜â†’ì€í–‰)', value:'25'},
              {color:'#44ff88', name:'ì´ˆë¡ (ì€í–‰â†’ì§‘)', value:'20'}
            ], clueText:'ê° ìƒ‰ìƒ = ì´ë™ ì‹œê°„(ë¶„)<br>ë¹¨ê°•15 + íŒŒë‘25 + ì´ˆë¡20 = ?'},
            hint:'15+25+20=60',
            validate:function(i){return i.trim() === '60'} },
          { type:'interactive', interactionType:'shake', title:'ğŸ’° í¼ì¦ 3: ì¬ë‹¨ ìê¸ˆ ì¶”ì ',
            story:'ì¥í˜œë¦°ì˜ ê¸ˆê³ ê°€ ë…¹ìŠ¬ì–´ ìˆë‹¤. í˜ìœ¼ë¡œ í”ë“¤ì–´ ì—´ì–´ì•¼ í•œë‹¤.\nì•„ë“¤1/2+ë”¸1/3+ì†ì1/6=1. ìì„ ë‹¨ì²´=0',
            config:{ required:20, revealText:'3/6+2/6+1/6=6/6 â†’ ìì„ ë‹¨ì²´: 0' },
            hint:'ì „ë¶€ ë¶„ë°°ë¨. ìì„ ë‹¨ì²´ ëª« = 0',
            validate:function(i){return i.trim()==='0'||i.trim()==='0/6'} },
          { type:'interactive', interactionType:'dial', title:'ğŸ“‹ í¼ì¦ 4: ì ‘ì´‰ íšŸìˆ˜ í•©ì‚°',
            story:'ìˆ˜ì‚¬ ë…¸íŠ¸ì˜ ë‹¤ì´ì–¼ ì ê¸ˆ. ì´ ì ‘ì´‰ íšŸìˆ˜ë¡œ ì—´ë¦°ë‹¤.\nê¹€7+ë°•12+ìµœ5+ì´9+ë³€í˜¸ì‚¬6',
            config:{ combination:[3,9], labels:['ì‹­','ì¼'] },
            hint:'7+12+5+9+6=39',
            validate:function(i){return i.trim() === '39'} },
          { type:'cpq', cpqIndex:0,
            story:'"ì§„ë²”ì„ ì°¾ì•˜ë‹¤. ê°ì‹œë‹¹í•˜ê³  ìˆë‹¤."\nì¥í˜œë¦°ì´ ë§ˆì§€ë§‰ìœ¼ë¡œ í–¥í•˜ë ¤ë˜ ì¥ì†Œ.',
            storyAfter:'ì¥í˜œë¦°ì˜ ë§ˆì§€ë§‰ ë…¹ìŒì´ ì¬ìƒëë‹¤.' }
        ],
        cliffhanger:'ì¥í˜œë¦°ì˜ ë§ˆì§€ë§‰ ë…¹ìŒ.\n\n"20ë…„ê°„ ì¶”ì í•œ ëì— ëª¨ë“  ê±¸ ì—°ê²°í–ˆì–´."\n"êµìˆ˜ ê¹€ë™í˜„, ë§ˆìˆ ì‚¬ ìµœí˜„ìš°, ì„¸ ë²ˆì§¸ ë‚¨ì."\n"304í˜¸ í™˜ìë“¤, êµ¬ì„¸ì£¼ ê³ ì•„ì›, ì„¸ì¢…ê³  í™”ì¬."\n"ì „ë¶€ í•˜ë‚˜ì˜ í”„ë¡œì íŠ¸ì•¼."\n"ì½”ë“œëª…: QUBE."\n\n"í•´ì € ì—°êµ¬ì†Œ. ë¶íƒœí‰ì–‘ ìˆ˜ì‹¬ 1000m."\n"ê±°ê¸°ì„œ ëª¨ë“  ê²Œ ì‹œì‘ëê³ , ê±°ê¸°ì„œ ëë‚´ì•¼ í•´."\n"ë‚˜ëŠ” ì§€ê¸ˆ ê·¸ê³³ìœ¼ë¡œ ê°„ë‹¤."\n\në…¹ìŒì´ ëŠê¸´ë‹¤.\n\nì±…ìƒ ì„œëì— ì ìˆ˜ì • íƒ‘ìŠ¹ê¶Œ ë‘ ì¥.\ní•œ ì¥ì€ ì¥í˜œë¦° ê²ƒ. í•œ ì¥ì€... ë¹„ì–´ ìˆë‹¤.\n\në‹¹ì‹ ì˜ ì´ë¦„ì„ ì ìœ¼ë¼ëŠ” ëœ»ì´ë‹¤.'
      },
      {
        id:'ch3_abyss', title:'Ch.3 â€” í•´ì € ì—°êµ¬ì†Œ', desc:'ìˆ˜ì‹¬ 1000m. ëª¨ë“  ë–¡ë°¥ì´ íšŒìˆ˜ë˜ëŠ” ìµœì¢… ìŠ¤í…Œì´ì§€.', time:'20ë¶„',
        intro:'ì ìˆ˜ì •ì´ í•˜ê°•í•œë‹¤. ìˆ˜ì‹¬ 100m... 500m... 1000m.\ní•´ì € ì—°êµ¬ì†Œ "ë”¥ ë¸”ë£¨". ì°½ë°–ìœ¼ë¡œ í‘¸ë¥¸ ë¹›ì´ íë¥¸ë‹¤.\në„í‚¹ ì™„ë£Œ. ì—ì–´ë¡ì´ ì—´ë¦°ë‹¤.\nì¥í˜œë¦°ì´ ìˆë‹¤. ì‚´ì•„ ìˆë‹¤.\n"ë“œë””ì–´ ì™”êµ¬ë‚˜. ì´ì œ ëë‚¼ ë•Œì•¼."\nì‚°ì†Œ ì”ëŸ‰: 3ì‹œê°„. ì‹œê°„ì´ ì—†ë‹¤.',
        puzzles:[
          { type:'interactive', interactionType:'flashlight', title:'ğŸ§¬ í¼ì¦ 1: í•´ì € ê¸°ì•• ê³„ì‚°',
            story:'ì¤‘ì•™ ì œì–´ì‹¤ì´ ì¹¨ìˆ˜ ì§ì „ì´ë‹¤. ë¹„ìƒë“±ë§Œ ê¹œë¹¡ì´ëŠ” ì–´ë‘  ì†ì—ì„œ ê¸°ì•• ë°ì´í„°ë¥¼ ì°¾ì•„ë¼.',
            config:{ items:[
              {x:15, y:25, text:'ìˆ˜ë©´=1ê¸°ì••'},
              {x:50, y:40, text:'10më‹¹ +1ê¸°ì••'},
              {x:30, y:65, text:'ìˆ˜ì‹¬=1000m'},
              {x:75, y:55, text:'1+100='},
              {x:80, y:80, text:'101ê¸°ì••'}
            ]},
            hint:'1+(1000Ã·10)=101',
            validate:function(i){return i.trim() === '101'} },
          { type:'interactive', interactionType:'connect-dots', title:'ğŸ“Š í¼ì¦ 2: ìƒëª…ì²´ ì¶œí˜„ íŒ¨í„´',
            story:'ê´€ì¸¡ ê¸°ë¡ì˜ ë°ì´í„° í¬ì¸íŠ¸ë¥¼ ì—°ê²°í•˜ë©´ í”¼ë³´ë‚˜ì¹˜ íŒ¨í„´ì´ ë³´ì¸ë‹¤.',
            config:{ dots:[
              {x:10, y:80, order:1}, {x:25, y:80, order:2},
              {x:40, y:65, order:3}, {x:55, y:50, order:4},
              {x:70, y:30, order:5}, {x:85, y:15, order:6}
            ], revealText:'í”¼ë³´ë‚˜ì¹˜: 1,1,2,3,5,8 â†’ 6ì£¼ì°¨: 8' },
            hint:'3+5=8. ì ì„ ìˆœì„œëŒ€ë¡œ ì—°ê²°!',
            validate:function(i){return i.trim() === '8'} },
          { type:'interactive', interactionType:'dial', title:'ğŸ”¬ í¼ì¦ 3: DNA ì„œì—´ ë³€í™˜',
            story:'ì‹¤í—˜ì‹¤ì˜ ë‹¤ì´ì–¼ ì ê¸ˆ. DNA ì„œì—´ì„ ìˆ«ìë¡œ ë³€í™˜í•´ì•¼ í•œë‹¤.\nA=1,T=2,C=3,G=4. ATCG TACG GCTA ATGC',
            config:{ combination:[1,2,3,4,2,1,3,4,4,3,2,1,1,2,4,3], labels:[] },
            hint:'ATCG=1234 TACG=2134 GCTA=4321 ATGC=1243',
            validate:function(i){return i.replace(/[\s-]/g,'') === '1234213443211243'} },
          { type:'interactive', interactionType:'piano', title:'ğŸšª í¼ì¦ 4: ë¹„ìƒ íƒˆì¶œ ì½”ë“œ',
            story:'ë¹„ìƒ íƒˆì¶œ ì‹œìŠ¤í…œì˜ ìŒì„± ì¸ì¦. ì˜¬ë°”ë¥¸ ìˆœì„œë¡œ í‚¤ë¥¼ ëˆŒëŸ¬ì•¼ í•œë‹¤.\n2019+2015=4034',
            config:{ keys:['C','D','E','F','G','A','B'], sequence:['F','A','E','G','F'], display:'íŒŒ ë¼ ë¯¸ ì†” íŒŒ (íƒˆì¶œ ì¸ì¦ ì½”ë“œ)' },
            hint:'ì—°ë„ í•©: 2019+2015=4034. ìŒê³„ë¥¼ ë§ì¶”ë©´ ë‹µì´ ë‚˜íƒ€ë‚¨.',
            validate:function(i){return i.trim() === '4034'} },
          { type:'cpq', cpqIndex:0,
            story:'"ì´ ìƒëª…ì²´ë“¤ì€ ì§€êµ¬ ìƒëª…ì²´ê°€ ì•„ë‹ˆë‹¤."\nìµœì¢… ì¢Œí‘œ. ë§ˆì§€ë§‰ ì¥ì†Œì˜ ê±°ë¦¬ë¥¼ ì¸¡ì •í•˜ë¼.',
            storyAfter:'ë¹„ìƒ íƒˆì¶œ ì‹œìŠ¤í…œì´ ê°€ë™ëë‹¤.' }
        ],
        cliffhanger:'íƒˆì¶œ ì§ì „, ì¥í˜œë¦°ì´ ì¤‘ì•™ ì»´í“¨í„°ì˜ ë§ˆì§€ë§‰ íŒŒì¼ì„ ì—´ì—ˆë‹¤.\n\nQUBE í”„ë¡œì íŠ¸ ìµœì¢… ë³´ê³ ì„œ.\n\n"1994ë…„, ì„¸ì¢…ê³  ì§€í•˜ì‹¤ì—ì„œ ë°œê²¬ëœ ë¯¸ì§€ì˜ ë¬¼ì§ˆ."\n"ì„¸ ëª…ì˜ í•™ìƒì´ ëª©ê²©. ê¹€ë™í˜„, ìµœí˜„ìš°, ê·¸ë¦¬ê³  â–ˆâ–ˆâ–ˆâ–ˆ."\n"ë¬¼ì§ˆì€ í•´ì €ì—ì„œ ì˜¨ ê²ƒì´ì—ˆë‹¤."\n"30ë…„ê°„ì˜ ì—°êµ¬ ê²°ê³¼: ì´ê²ƒì€ ì‹ í˜¸ì˜€ë‹¤."\n"ëˆ„êµ°ê°€ ìš°ë¦¬ì—ê²Œ ë³´ë‚¸ ë©”ì‹œì§€."\n\nì¥í˜œë¦°ì´ ë§í–ˆë‹¤.\n"êµìˆ˜ë„, ë§ˆìˆ ì‚¬ë„, í™˜ìë“¤ë„... ì „ë¶€ ì´ ë¹„ë°€ì„ ì§€í‚¤ê¸° ìœ„í•´ í¬ìƒëœ ê±°ì•¼."\n"í•˜ì§€ë§Œ ì´ì œ ì„¸ìƒì´ ì•Œì•„ì•¼ í•´."\n\në¹„ìƒ íƒˆì¶œ í¬ë“œê°€ ìƒìŠ¹í•œë‹¤.\nìˆ˜ë©´ ìœ„ë¡œ ë– ì˜¤ë¥´ëŠ” ìˆœê°„, ë¼ë””ì˜¤ì—ì„œ ë‰´ìŠ¤ê°€ í˜ëŸ¬ë‚˜ì˜¨ë‹¤.\n\n"ì†ë³´ì…ë‹ˆë‹¤. êµ­ë¦½ ê³ ê³ í•™ ë°•ë¬¼ê´€ íŠ¹ìˆ˜ì—°êµ¬ì¬ë‹¨ì˜ ë¹„ë°€ ì‹¤í—˜ì´ í­ë¡œë˜ì—ˆìŠµë‹ˆë‹¤."\n"ì‹¤ì¢…ëœ êµìˆ˜ ê¹€ë™í˜„ì´ ë¬´ì‚¬íˆ êµ¬ì¶œë˜ì—ˆìœ¼ë©°..."\n\nìµœí˜„ìš°ì˜ ë§ˆì§€ë§‰ íŠ¸ë¦­.\nê·¸ëŠ” ì‚¬ë¼ì§„ ê²Œ ì•„ë‹ˆë¼, ì¦ê±°ë¥¼ ì„¸ìƒì— ë³´ë‚´ê³  ìˆì—ˆë‹¤.\n\në‹¹ì‹ ì€ í•´ëƒˆë‹¤.\n\nğŸ† QUBE â€” ALL CLEAR'
      }
    ]
  }
];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Game State & Logic
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var state = { currentSeries:null, currentChapter:null, currentPuzzle:0, cpqCampaigns:[], startTime:null, attempts:0 };

function getProgress() { try{return JSON.parse(localStorage.getItem('qube_progress')||'{}');}catch(e){return {};} }
function saveProgressData(p) { localStorage.setItem('qube_progress', JSON.stringify(p)); }
function isChapterCleared(sid,cid) { var p=getProgress(); return !!(p[sid]&&p[sid][cid]); }
function isChapterUnlocked(si,ci) {
  if(ci===0) return true;
  var s=SERIES[si];
  return isChapterCleared(s.id,s.chapters[ci-1].id);
}
function isSeriesUnlocked(si){return true;}
function isSeriesCleared(si){var s=SERIES[si];for(var i=0;i<s.chapters.length;i++)if(!isChapterCleared(s.id,s.chapters[i].id))return false;return true;}
function getTotalCleared(){var c=0;SERIES.forEach(function(s,si){s.chapters.forEach(function(ch){if(isChapterCleared(s.id,ch.id))c++;});});return c;}
function getSeriesCleared(){var c=0;SERIES.forEach(function(_,si){if(isSeriesCleared(si))c++;});return c;}
function getGrade(c){return c>=10?'ğŸ•µï¸ ì…œë¡':c>=7?'ğŸ” ëª…íƒì •':c>=4?'ğŸ§ íƒì •':c>=2?'ğŸ“‹ ìˆ˜ìŠµíƒì •':'ğŸ”° ì´ˆë³´íƒì •';}
function formatTime(s){return Math.floor(s/60)+':'+String(s%60).padStart(2,'0');}

function createParticles(){var c=document.getElementById('particles');for(var i=0;i<50;i++){var p=document.createElement('div');p.className='particle';p.style.left=Math.random()*100+'%';p.style.animationDuration=(8+Math.random()*12)+'s';p.style.animationDelay=Math.random()*10+'s';var sz=(2+Math.random()*3)+'px';p.style.width=p.style.height=sz;p.style.background=Math.random()>.5?'#b44aff':'#00e5ff';p.style.boxShadow='0 0 6px '+p.style.background;c.appendChild(p);}}
function scrollToSeries(){document.getElementById('series-section').scrollIntoView({behavior:'smooth'});}

function showScreen(id){['home','chapters','game','result'].forEach(function(s){document.getElementById(s).classList.toggle('hidden',s!==id);});document.getElementById('loadingScreen').classList.remove('active');if(id!=='home')window.scrollTo(0,0);}
function goHome(){cleanupInteractive();state.currentSeries=null;state.currentChapter=null;showScreen('home');renderHome();}
function confirmExit(){if(confirm('ì •ë§ ë‚˜ê°€ì‹œê² ìŠµë‹ˆê¹Œ? ì§„í–‰ ìƒí™©ì´ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.'))goHome();}

function renderHome(){
  var cleared=getTotalCleared(),totalChapters=0;
  SERIES.forEach(function(s){totalChapters+=s.chapters.length;});
  document.getElementById('statCleared').textContent=cleared;
  document.getElementById('statGrade').textContent=getGrade(cleared).split(' ')[0];
  document.getElementById('statStreak').textContent=getSeriesCleared();
  document.getElementById('seriesProgressText').textContent='âœ… '+cleared+'/'+totalChapters+' ì±•í„° í´ë¦¬ì–´';
  var html='';
  for(var si=0;si<SERIES.length;si++){
    var s=SERIES[si],unlocked=isSeriesUnlocked(si),serCleared=isSeriesCleared(si),chapCleared=0;
    for(var ci=0;ci<s.chapters.length;ci++)if(isChapterCleared(s.id,s.chapters[ci].id))chapCleared++;
    var stars='';for(var d=0;d<3;d++)stars+='<span class="star '+(d<s.difficulty?'':'empty')+'">'+(d<s.difficulty?'â˜…':'â˜†')+'</span>';
    var badge='';
    if(serCleared)badge='<span class="series-badge badge-clear">âœ… í´ë¦¬ì–´</span>';
    else if(chapCleared>0)badge='<span class="series-badge badge-progress">'+chapCleared+'/'+s.chapters.length+'</span>';
    else if(unlocked)badge='<span class="series-badge badge-new">NEW</span>';
    var lockOverlay='';
    if(!unlocked){var prevTitle=si>0?SERIES[si-1].title:'';lockOverlay='<div class="series-lock-overlay"><span>ğŸ”’ "'+prevTitle+'" í´ë¦¬ì–´ ì‹œ í•´ê¸ˆ</span></div>';}
    html+='<div class="series-card '+(unlocked?'':'locked')+' '+(serCleared?'cleared':'')+'" onclick="'+(unlocked?'openSeries('+si+')':'')+'">';
    html+=lockOverlay+'<div class="series-header"><div class="series-icon">'+s.icon+'</div><div class="series-info"><div class="series-title">'+s.title+'</div><div class="series-diff">'+stars+'</div></div>'+badge+'</div>';
    html+='<div class="series-desc">'+s.desc+'</div><div class="series-footer"><div class="series-chapter-progress">';
    for(var ci2=0;ci2<s.chapters.length;ci2++){if(isChapterCleared(s.id,s.chapters[ci2].id))html+='<span class="done">âœ…</span> ';else if(isChapterUnlocked(si,ci2))html+='ğŸ”“ ';else html+='ğŸ”’ ';}
    html+='</div></div></div>';
  }
  document.getElementById('seriesGrid').innerHTML=html;
}

function openSeries(si){
  var s=SERIES[si];showScreen('chapters');
  var html='<div class="chapter-header"><button class="chapter-back" onclick="goHome()">â†</button><div class="chapter-series-title">'+s.icon+' '+s.title+'</div></div>';
  html+='<div class="chapter-series-desc">'+s.desc+'</div><div class="chapter-timeline">';
  for(var ci=0;ci<s.chapters.length;ci++){
    var ch=s.chapters[ci],cleared=isChapterCleared(s.id,ch.id),unlocked=isChapterUnlocked(si,ci);
    var cls=cleared?'cleared':(unlocked?'unlocked':'locked'),dotContent=cleared?'âœ“':(unlocked?(ci+1):'ğŸ”’');
    html+='<div class="chapter-item '+cls+'"><div class="chapter-dot">'+dotContent+'</div><div class="chapter-card"><div class="chapter-card-title">'+ch.title+'</div><div class="chapter-card-desc">'+ch.desc+'</div><div class="chapter-card-meta"><span>â± '+ch.time+'</span>';
    if(cleared)html+='<button class="chapter-replay" onclick="startChapter('+si+','+ci+')">ë‹¤ì‹œ ë„ì „ ğŸ”„</button>';
    else if(unlocked)html+='<button class="chapter-enter" onclick="startChapter('+si+','+ci+')">ì…ì¥í•˜ê¸° ğŸ”‘</button>';
    else html+='<span>ğŸ”’ ì´ì „ ì±•í„° í´ë¦¬ì–´ í•„ìš”</span>';
    html+='</div></div></div>';
  }
  html+='</div>';
  document.getElementById('chapters').innerHTML=html;
}

async function startChapter(si,ci){
  var s=SERIES[si],ch=s.chapters[ci];
  state.currentSeries=s;state.currentChapter=ch;state.currentSeriesIdx=si;state.currentChapIdx=ci;state.currentPuzzle=0;state.startTime=Date.now();state.attempts=0;
  document.getElementById('loadingScreen').classList.add('active');
  try{var cpqCount=ch.puzzles.filter(function(p){return p.type==='cpq';}).length;var res=await fetch(API+'/api/random?count='+cpqCount);var data=await res.json();state.cpqCampaigns=data.campaigns||[];}catch(e){state.cpqCampaigns=[];}
  showScreen('game');document.getElementById('gameTitle').textContent=ch.title;renderIntro();
}

function renderIntro(){
  renderProgressBar();
  document.getElementById('gameContent').innerHTML='<div class="story-box"><div class="label">ğŸ“– í”„ë¡¤ë¡œê·¸</div><p>'+state.currentChapter.intro.replace(/\n/g,'<br>')+'</p></div><button class="btn-next" onclick="renderPuzzle(0)">ì¡°ì‚¬ ì‹œì‘ â†’</button>';
}

function renderProgressBar(){
  var total=state.currentChapter.puzzles.length;
  document.getElementById('gameProgressText').textContent=(state.currentPuzzle+1)+' / '+total;
  var dots='';for(var i=0;i<total;i++){var cls=i<state.currentPuzzle?'done':(i===state.currentPuzzle?'active':'');dots+='<div class="prog-dot '+cls+'"></div>';}
  document.getElementById('progressBar').innerHTML=dots;
}

function renderPuzzle(idx){
  cleanupInteractive();
  state.currentPuzzle=idx;renderProgressBar();
  var puzzle=state.currentChapter.puzzles[idx];
  if(puzzle.type==='cpq') renderCpqPuzzle(idx,puzzle);
  else if(puzzle.type==='interactive') renderInteractivePuzzle(idx,puzzle);
  else renderGeneralPuzzle(idx,puzzle);
}

function renderInteractivePuzzle(idx,puzzle){
  var html='<div class="story-box"><div class="label">ğŸ“– ìƒí™©</div><p>'+puzzle.story.replace(/\n/g,'<br>')+'</p></div>';
  html+='<div class="puzzle-box"><div class="puzzle-label">'+puzzle.title+'</div>';
  html+='<div id="interactiveArea"></div>';
  html+='<div class="hint-box hidden" id="hintBox">ğŸ’¡ '+puzzle.hint+'</div>';
  html+='<button class="hint-btn" onclick="document.getElementById(\'hintBox\').classList.remove(\'hidden\');this.remove()">ğŸ’¡ íŒíŠ¸ ë³´ê¸°</button>';
  html+='<div class="answer-area"><input type="text" id="answerInput" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”" onkeydown="handleEnter(event,'+idx+')"><button class="btn-submit" onclick="checkGeneral('+idx+')">í™•ì¸</button></div>';
  html+='<div id="feedback"></div></div>';
  document.getElementById('gameContent').innerHTML=html;

  // Set piano answer for auto-fill
  if(puzzle.interactionType==='piano') window._pianoAnswer = '';

  switch(puzzle.interactionType){
    case 'flashlight': initFlashlight(puzzle.config); break;
    case 'jigsaw': initJigsaw(puzzle.config); break;
    case 'dial': initDial(puzzle.config); break;
    case 'piano': initPiano(puzzle.config); break;
    case 'hidden-text': initHiddenText(puzzle.config); break;
    case 'timing': initTiming(puzzle.config); break;
    case 'connect-dots': initConnectDots(puzzle.config); break;
    case 'color-code': initColorCode(puzzle.config); break;
    case 'mirror': initMirror(puzzle.config); break;
    case 'shake': initShake(puzzle.config); break;
  }
  setTimeout(function(){document.getElementById('gameContent').scrollIntoView({behavior:'smooth'});},100);
}

function renderGeneralPuzzle(idx,puzzle){
  document.getElementById('gameContent').innerHTML=
    '<div class="story-box"><div class="label">ğŸ“– ìƒí™©</div><p>'+puzzle.story.replace(/\n/g,'<br>')+'</p></div>'+
    '<div class="puzzle-box"><div class="puzzle-label">'+puzzle.title+'</div>'+
    '<div class="puzzle-question">'+puzzle.question.replace(/\n/g,'<br>')+'</div>'+
    '<div class="hint-box hidden" id="hintBox">ğŸ’¡ '+puzzle.hint+'</div>'+
    '<button class="hint-btn" onclick="document.getElementById(\'hintBox\').classList.remove(\'hidden\');this.remove()">ğŸ’¡ íŒíŠ¸ ë³´ê¸°</button>'+
    '<div class="answer-area"><input type="text" id="answerInput" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”" onkeydown="handleEnter(event,'+idx+')">'+
    '<button class="btn-submit" onclick="checkGeneral('+idx+')">í™•ì¸</button></div>'+
    '<div id="feedback"></div></div>';
  setTimeout(function(){document.getElementById('gameContent').scrollIntoView({behavior:'smooth'});},100);
}

function renderCpqPuzzle(idx,puzzle){
  var camp=state.cpqCampaigns[puzzle.cpqIndex];
  if(!camp){nextPuzzle(idx);return;}
  var desc=camp.join_desc||'',keyword=camp.search_keyword||'';
  var placeMatch=desc.match(/\[([^\]]*X[^\]]*)\]/),placeHint=placeMatch?placeMatch[1]:'í•´ë‹¹ ì¥ì†Œ';
  var startMatch=desc.match(/ì¶œë°œì§€ë¥¼\s*\[([^\]]+)\]/),startPlace=startMatch?startMatch[1]:'ì§€ì •ëœ ì¶œë°œì§€';
  document.getElementById('gameContent').innerHTML=
    '<div class="story-box"><div class="label">ğŸ“– ë‹¨ì„œ ë°œê²¬</div><p>'+puzzle.story.replace(/\n/g,'<br>')+'</p></div>'+
    '<div class="puzzle-box"><div class="puzzle-label">ğŸ” í¼ì¦ '+(idx+1)+': ì¥ì†Œ ì¶”ì  ë¯¸ì…˜</div>'+
    '<div class="puzzle-question">ë‹¨ì„œì— ì íŒ ì¥ì†Œë¥¼ ì°¾ì•„ì•¼ í•œë‹¤. ë„¤ì´ë²„ì—ì„œ ê²€ìƒ‰í•˜ì—¬ ê±¸ìŒ ìˆ˜ë¥¼ í™•ì¸í•˜ë¼.</div>'+
    '<div class="cpq-mission"><div class="mission-title">ğŸ“‹ ë¯¸ì…˜ ìˆœì„œ</div>'+
    '<ol class="cpq-steps"><li>ì•„ë˜ í‚¤ì›Œë“œë¥¼ ë³µì‚¬í•˜ì—¬ <b>ë„¤ì´ë²„</b>ì—ì„œ ê²€ìƒ‰</li>'+
    '<li>ê²€ìƒ‰ ê²°ê³¼ì—ì„œ <b>'+placeHint+'</b> í´ë¦­</li>'+
    '<li>í”Œë ˆì´ìŠ¤ì—ì„œ <b>ì§€ë„</b> íƒ­ â†’ <b>ì§€ë„ì•±ìœ¼ë¡œ ë³´ê¸°</b></li>'+
    '<li><b>ë„ì°©</b> ë²„íŠ¼ í´ë¦­</li>'+
    '<li>ì¶œë°œì§€ë¥¼ <b>'+startPlace+'</b>(ìœ¼)ë¡œ ì„¤ì •</li>'+
    '<li><b>ë„ë³´</b> â†’ <b>ê°€ì¥ ë¹ ë¥¸</b> ê²½ë¡œì˜ ê±¸ìŒ ìˆ˜ í™•ì¸</li></ol>'+
    '<div class="cpq-keyword-box"><span class="cpq-keyword" onclick="copyKeyword(this)" title="í´ë¦­í•˜ì—¬ ë³µì‚¬">ğŸ” '+keyword+'</span></div></div>'+
    '<div class="answer-area" style="margin-top:16px"><input type="number" id="answerInput" placeholder="ê±¸ìŒ ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”" onkeydown="handleEnter(event,'+idx+',\'cpq\')">'+
    '<button class="btn-submit" onclick="checkCpq('+idx+')">í™•ì¸</button></div>'+
    '<div id="feedback"></div></div>';
  setTimeout(function(){document.getElementById('gameContent').scrollIntoView({behavior:'smooth'});},100);
}

var isComposing=false;
document.addEventListener('compositionstart',function(){isComposing=true;});
document.addEventListener('compositionend',function(){isComposing=false;});
function handleEnter(e,idx,type){if(e.key==='Enter'&&!isComposing){e.preventDefault();type==='cpq'?checkCpq(idx):checkGeneral(idx);}}

function checkGeneral(idx){var input=document.getElementById('answerInput').value.trim();if(!input)return;state.attempts++;showFeedback(state.currentChapter.puzzles[idx].validate(input),idx);}
async function checkCpq(idx){var input=document.getElementById('answerInput').value.trim();if(!input)return;state.attempts++;var camp=state.cpqCampaigns[state.currentChapter.puzzles[idx].cpqIndex];try{var res=await fetch(API+'/api/verify',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({campaign_id:camp.id,user_answer:input})});var data=await res.json();showFeedback(data.correct,idx);}catch(e){showFeedback(false,idx);}}

function showFeedback(correct,idx){
  var fb=document.getElementById('feedback'),puzzle=state.currentChapter.puzzles[idx],isLast=idx>=state.currentChapter.puzzles.length-1;
  if(correct){
    var after=puzzle.storyAfter||'';
    fb.innerHTML='<div class="feedback correct">âœ… ì •ë‹µ!'+(after?' '+after:'')+'</div><button class="btn-next" onclick="nextPuzzle('+idx+')">'+(isLast?'ğŸšª ì±•í„° ì™„ë£Œ!':'ë‹¤ìŒ í¼ì¦ â†’')+'</button>';
  }else{
    fb.innerHTML='<div class="feedback wrong">âŒ ì˜¤ë‹µ. ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.</div>';
    document.getElementById('answerInput').value='';fb.scrollIntoView({behavior:'smooth',block:'center'});
  }
}
function nextPuzzle(cur){cleanupInteractive();if(cur+1>=state.currentChapter.puzzles.length)showCliffhanger();else renderPuzzle(cur+1);}

function showCliffhanger(){
  cleanupInteractive();
  var ch=state.currentChapter,s=state.currentSeries,si=state.currentSeriesIdx,ci=state.currentChapIdx;
  var elapsed=Math.floor((Date.now()-state.startTime)/1000);
  var p=getProgress();if(!p[s.id])p[s.id]={};p[s.id][ch.id]={cleared:true,bestTime:elapsed,lastPlayed:Date.now()};saveProgressData(p);
  var isLastChapter=ci>=s.chapters.length-1,isLastSeries=si>=SERIES.length-1,isFinalClear=isLastChapter&&isLastSeries;
  var gameGrade='S';if(elapsed>600)gameGrade='C';else if(elapsed>300)gameGrade='B';else if(elapsed>180)gameGrade='A';
  showScreen('result');var html='';
  if(isFinalClear){spawnConfetti();html+='<div class="result-emoji">ğŸ†</div><div class="result-title">QUBE â€” ALL CLEAR</div><div class="result-sub">ëª¨ë“  ë¯¸ìŠ¤í„°ë¦¬ë¥¼ í•´ê²°í–ˆìŠµë‹ˆë‹¤</div>';}
  else if(isLastChapter){spawnConfetti();html+='<div class="result-emoji">ğŸŠ</div><div class="result-title">ì‹œë¦¬ì¦ˆ í´ë¦¬ì–´!</div><div class="result-sub">"'+s.title+'" ì™„ë£Œ!</div>';}
  else{html+='<div class="result-emoji">ğŸ‰</div><div class="result-title">ì±•í„° í´ë¦¬ì–´!</div><div class="result-sub">'+ch.title+' ì™„ë£Œ</div>';}
  html+='<div class="result-grade">'+gameGrade+' RANK</div><div class="result-stats">';
  html+='<div class="result-stat"><div class="result-stat-val">'+formatTime(elapsed)+'</div><div class="result-stat-label">ì†Œìš”ì‹œê°„</div></div>';
  html+='<div class="result-stat"><div class="result-stat-val">'+state.attempts+'</div><div class="result-stat-label">ì‹œë„íšŸìˆ˜</div></div>';
  var totalCleared=getTotalCleared(),grade=getGrade(totalCleared);
  html+='<div class="result-stat"><div class="result-stat-val">'+grade.split(' ')[0]+'</div><div class="result-stat-label">'+(grade.split(' ')[1]||'')+'</div></div></div>';
  if(ch.cliffhanger)html+='<div class="cliffhanger-box"><div class="label">ğŸ“– TO BE CONTINUED...</div><p>'+ch.cliffhanger.replace(/\n/g,'<br>')+'</p></div>';
  html+='<div class="result-btns">';
  if(!isLastChapter)html+='<button class="btn-home" onclick="startChapter('+si+','+(ci+1)+')">ë‹¤ìŒ ì±•í„°ë¡œ â†’</button>';
  else if(!isLastSeries)html+='<button class="btn-home" onclick="openSeries('+(si+1)+')">ë‹¤ìŒ ì‹œë¦¬ì¦ˆ â†’</button>';
  html+='<button class="btn-home" style="background:var(--bg3);color:var(--text2)" onclick="goHome()">ğŸšª ë¡œë¹„ë¡œ ëŒì•„ê°€ê¸°</button>';
  html+='<button class="btn-share" onclick="shareResult()">ğŸ“¤ ê²°ê³¼ ê³µìœ í•˜ê¸°</button></div>';
  document.getElementById('resultContent').innerHTML=html;
}

function shareResult(){
  var ch=state.currentChapter,s=state.currentSeries,elapsed=Math.floor((Date.now()-state.startTime)/1000);
  var text='ğŸ” QUBE - '+s.title+' / '+ch.title+'\nâ± '+formatTime(elapsed)+'ì— í´ë¦¬ì–´!\n\në‚˜ëŠ” íƒˆì¶œí–ˆë‹¤. ë‹¹ì‹ ì€?\nğŸ‘‰ https://qube.salmonholic.com';
  if(navigator.share)navigator.share({text:text});else{navigator.clipboard&&navigator.clipboard.writeText(text);alert('í´ë¦½ë³´ë“œì— ë³µì‚¬ëìŠµë‹ˆë‹¤!');}
}
function copyKeyword(el){var text=el.textContent.replace('ğŸ” ','').trim();navigator.clipboard&&navigator.clipboard.writeText(text);var orig=el.textContent;el.textContent='âœ“ ë³µì‚¬ë¨!';setTimeout(function(){el.textContent=orig;},1500);}

function spawnConfetti(){
  var container=document.createElement('div');container.className='confetti-container';document.body.appendChild(container);
  var colors=['#b44aff','#00e5ff','#00ff88','#ff4444','#f59e0b','#fff'];
  for(var i=0;i<60;i++){var piece=document.createElement('div');piece.className='confetti-piece';piece.style.left=Math.random()*100+'%';piece.style.background=colors[Math.floor(Math.random()*colors.length)];piece.style.animationDelay=Math.random()*2+'s';piece.style.animationDuration=(2+Math.random()*2)+'s';var size=(6+Math.random()*8)+'px';piece.style.width=size;piece.style.height=size;piece.style.borderRadius=Math.random()>.5?'50%':'2px';container.appendChild(piece);}
  setTimeout(function(){container.remove();},5000);
}

createParticles();renderHome();
</script>
</body>
</html>