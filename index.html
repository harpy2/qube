<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QUBE â€” í’€ì–´ë¼. íƒˆì¶œí•˜ë¼.</title>
<meta name="description" content="ë°©íƒˆì¶œ ì¶”ë¦¬ í¼ì¦ ê²Œì„. ë‹¨ì„œë¥¼ ì°¾ê³ , í¼ì¦ì„ í’€ê³ , íƒˆì¶œí•˜ë¼.">
<meta property="og:title" content="QUBE â€” ë°©íƒˆì¶œ ì¶”ë¦¬ í¼ì¦ ê²Œì„">
<meta property="og:description" content="í’€ì–´ë¼. íƒˆì¶œí•˜ë¼.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://qube.salmonholic.com">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ”’</text></svg>">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#0a0a0a;--bg2:#111;--bg3:#1a1a1a;
  --text:#e0e0e0;--text2:#888;--text3:#555;
  --accent:#b44aff;--accent2:#9333ea;--accent-glow:rgba(180,74,255,.15);
  --cyan:#00e5ff;--danger:#ff4444;--success:#00ff88;
  --card:rgba(255,255,255,.03);--card-border:rgba(255,255,255,.06);
}
html{scroll-behavior:smooth}
body{background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Noto Sans KR',sans-serif;line-height:1.6;overflow-x:hidden}
.hidden{display:none!important}

/* Hero */
.hero{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;position:relative;overflow:hidden;padding:2rem}
.hero::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at 50% 40%,rgba(180,74,255,.06) 0%,transparent 70%);pointer-events:none}
.hero h1{font-size:clamp(3rem,10vw,6rem);font-weight:900;letter-spacing:0.1em;margin-bottom:1rem;background:linear-gradient(135deg,#fff 0%,#b44aff 50%,#00e5ff 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hero p{font-size:clamp(1rem,3vw,1.3rem);color:var(--text2);max-width:450px;margin-bottom:2.5rem}
.hero-cta{padding:16px 48px;background:linear-gradient(135deg,var(--accent),var(--cyan));color:#000;font-size:1.1rem;font-weight:700;border:none;border-radius:50px;cursor:pointer;transition:all .3s;letter-spacing:.05em}
.hero-cta:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(180,74,255,.4)}
.scroll-hint{position:absolute;bottom:2rem;animation:bounce 2s infinite;color:var(--text3);font-size:1.5rem}
@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(10px)}}

/* Particles */
.particles{position:absolute;inset:0;pointer-events:none;overflow:hidden}
.particle{position:absolute;width:3px;height:3px;border-radius:50%;opacity:.4;animation:float linear infinite}
@keyframes float{0%{transform:translateY(100vh) scale(0);opacity:0}10%{opacity:.4}90%{opacity:.4}100%{transform:translateY(-10vh) scale(1);opacity:0}}

/* Stats Bar */
.stats-bar{display:flex;justify-content:center;gap:40px;padding:24px 0;margin-bottom:1rem}
.stat{text-align:center}
.stat-val{font-size:2rem;font-weight:900;background:linear-gradient(135deg,var(--accent),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.stat-label{font-size:.8rem;color:var(--text2);margin-top:4px}

/* Rooms Section */
.rooms-section{max-width:900px;margin:0 auto;padding:0 1.5rem 4rem}
.rooms-section h2{font-size:1.5rem;margin-bottom:.5rem;display:flex;align-items:center;gap:8px}
.rooms-progress{color:var(--text2);font-size:.85rem;margin-bottom:1.5rem}
.room-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:1.2rem}

/* Room Card */
.room-card{background:var(--card);border:1px solid var(--card-border);border-radius:16px;padding:1.5rem;backdrop-filter:blur(10px);transition:all .3s;cursor:pointer;position:relative;overflow:hidden}
.room-card:hover{border-color:rgba(180,74,255,.3);background:rgba(255,255,255,.05);transform:translateY(-3px);box-shadow:0 8px 30px rgba(180,74,255,.1)}
.room-card.cleared{border-color:rgba(0,255,136,.2)}
.room-card.cleared .room-start{background:var(--bg3);color:var(--text2)}
.room-badge{position:absolute;top:12px;right:12px;padding:4px 12px;border-radius:20px;font-size:.7rem;font-weight:700}
.badge-new{background:var(--accent);color:#fff}
.badge-cleared{background:var(--success);color:#000}
.room-emoji{font-size:2.5rem;margin-bottom:.8rem}
.room-title{font-size:1.15rem;font-weight:700;margin-bottom:.4rem}
.room-desc{font-size:.85rem;color:var(--text2);margin-bottom:.8rem;line-height:1.5}
.room-meta{display:flex;gap:12px;color:var(--text2);font-size:.85rem;margin-bottom:1rem}
.room-diff .star{color:var(--accent)}
.room-diff .star.empty{color:var(--text3)}
.room-start{width:100%;padding:10px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;border:none;border-radius:50px;cursor:pointer;font-size:.9rem;font-weight:600;transition:all .3s}
.room-start:hover{box-shadow:0 4px 15px rgba(180,74,255,.4)}

/* Game Screen */
#game{max-width:700px;margin:0 auto;min-height:100vh;padding:1rem}
.game-header{display:flex;align-items:center;padding:1rem 0;border-bottom:1px solid var(--card-border);margin-bottom:1.5rem;gap:12px}
.game-back{background:none;border:none;color:var(--text2);font-size:1.3rem;cursor:pointer;padding:4px 8px}
.game-back:hover{color:var(--text)}
.game-title{font-size:1.1rem;font-weight:700;flex:1}
.game-progress-text{color:var(--text2);font-size:.85rem}

.progress-bar{display:flex;gap:6px;margin-bottom:1.5rem}
.prog-dot{flex:1;height:4px;border-radius:2px;background:var(--bg3);transition:all .3s}
.prog-dot.active{background:var(--accent);box-shadow:0 0 8px rgba(180,74,255,.4)}
.prog-dot.done{background:var(--success)}

.story-box{background:var(--bg3);border:1px solid var(--card-border);border-radius:16px;padding:1.5rem;margin-bottom:1.5rem;animation:fadeIn .5s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(15px)}to{opacity:1;transform:translateY(0)}}
.story-box .label{color:var(--accent);font-size:.75rem;font-weight:700;margin-bottom:8px;text-transform:uppercase;letter-spacing:.15em}
.story-box p{color:var(--text2);line-height:1.8}

.puzzle-box{background:rgba(180,74,255,.05);border:1px solid rgba(180,74,255,.15);border-radius:16px;padding:1.5rem;margin-bottom:1.5rem;animation:fadeIn .5s ease}
.puzzle-label{color:var(--cyan);font-size:.8rem;font-weight:700;margin-bottom:12px;letter-spacing:.05em}
.puzzle-question{font-size:1rem;line-height:1.8;margin-bottom:1.2rem}

.cpq-mission{background:rgba(0,229,255,.05);border:1px solid rgba(0,229,255,.15);border-radius:12px;padding:1.2rem;margin:1rem 0}
.cpq-mission .mission-title{color:var(--cyan);font-size:.8rem;font-weight:700;margin-bottom:10px}
.cpq-steps{font-size:.9rem;color:var(--text2);line-height:2;padding-left:1.2rem}
.cpq-steps b{color:var(--text)}
.cpq-keyword-box{margin-top:12px;display:flex;align-items:center;gap:10px}
.cpq-keyword{display:inline-block;background:linear-gradient(135deg,var(--accent),var(--cyan));color:#000;padding:8px 20px;border-radius:50px;font-size:.9rem;font-weight:700;cursor:pointer;transition:all .2s}
.cpq-keyword:hover{transform:scale(1.03);box-shadow:0 4px 15px rgba(180,74,255,.3)}

.hint-btn{background:none;border:1px solid var(--text3);color:var(--text2);padding:8px 16px;border-radius:50px;font-size:.8rem;cursor:pointer;transition:all .2s;margin-bottom:1rem}
.hint-btn:hover{border-color:var(--accent);color:var(--accent)}
.hint-box{background:rgba(255,165,0,.08);border:1px solid rgba(255,165,0,.2);border-radius:10px;padding:12px 16px;font-size:.9rem;color:#f59e0b;margin-bottom:1rem}

.answer-area{display:flex;gap:8px}
.answer-area input{flex:1;padding:14px 18px;background:var(--bg3);border:1px solid var(--card-border);border-radius:50px;color:var(--text);font-size:1rem;font-family:inherit;outline:none;transition:border-color .3s}
.answer-area input:focus{border-color:var(--accent)}
.answer-area input::placeholder{color:var(--text3)}
.btn-submit{padding:14px 28px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;border:none;border-radius:50px;font-weight:700;cursor:pointer;transition:all .2s;white-space:nowrap;font-family:inherit;font-size:.95rem}
.btn-submit:hover{box-shadow:0 4px 15px rgba(180,74,255,.4)}
.btn-next{width:100%;padding:14px;background:linear-gradient(135deg,var(--accent),var(--cyan));color:#000;border:none;border-radius:50px;font-weight:700;cursor:pointer;transition:all .3s;font-size:1rem;font-family:inherit;margin-top:1rem}
.btn-next:hover{box-shadow:0 4px 20px rgba(180,74,255,.4);transform:translateY(-1px)}

.feedback{padding:14px 18px;border-radius:12px;margin-top:1rem;font-size:.95rem;animation:fadeIn .3s}
.feedback.correct{background:rgba(0,255,136,.1);color:var(--success);border:1px solid rgba(0,255,136,.2)}
.feedback.wrong{background:rgba(255,68,68,.1);color:var(--danger);border:1px solid rgba(255,68,68,.2)}

/* Result */
#result{max-width:600px;margin:0 auto;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:2rem}
.result-card{text-align:center;width:100%}
.result-emoji{font-size:4rem;margin-bottom:1rem}
.result-title{font-size:2rem;font-weight:900;margin-bottom:.5rem;background:linear-gradient(135deg,#fff,var(--accent),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.result-sub{color:var(--text2);margin-bottom:2rem}
.result-grade{display:inline-block;font-size:1.5rem;font-weight:900;padding:10px 30px;border-radius:50px;background:linear-gradient(135deg,var(--accent),var(--cyan));color:#000;margin-bottom:2rem}
.result-stats{display:flex;justify-content:center;gap:20px;margin-bottom:2rem;flex-wrap:wrap}
.result-stat{background:var(--card);border:1px solid var(--card-border);border-radius:16px;padding:18px 24px;min-width:100px}
.result-stat-val{font-size:1.5rem;font-weight:900;color:var(--accent)}
.result-stat-label{font-size:.75rem;color:var(--text2);margin-top:4px}
.result-btns{display:flex;flex-direction:column;gap:10px;max-width:300px;margin:0 auto}
.btn-home{padding:14px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;border:none;border-radius:50px;font-weight:700;cursor:pointer;font-size:1rem;font-family:inherit;transition:all .3s}
.btn-home:hover{box-shadow:0 4px 15px rgba(180,74,255,.4)}
.btn-share{padding:14px;background:transparent;border:1px solid var(--card-border);color:var(--text2);border-radius:50px;cursor:pointer;font-size:.9rem;font-family:inherit;transition:all .2s}
.btn-share:hover{border-color:var(--accent);color:var(--text)}

/* Loading */
.loading-screen{display:none;position:fixed;inset:0;background:var(--bg);z-index:1000;flex-direction:column;align-items:center;justify-content:center;gap:16px}
.loading-screen.active{display:flex}
.spinner{width:40px;height:40px;border:3px solid var(--bg3);border-top-color:var(--accent);border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-text{color:var(--text2);font-size:.9rem}

@media(max-width:600px){
  .hero h1{letter-spacing:.05em}
  .room-grid{grid-template-columns:1fr}
  .stats-bar{gap:24px}
  .result-stats{gap:12px}
}
</style>
</head>
<body>

<!-- â”€â”€â”€ í™ˆ â”€â”€â”€ -->
<div id="home">
  <div class="hero">
    <div class="particles" id="particles"></div>
    <h1>QUBE</h1>
    <p>í’€ì–´ë¼. íƒˆì¶œí•˜ë¼.</p>
    <button class="hero-cta" onclick="scrollToRooms()">ë°© ì„ íƒí•˜ê¸°</button>
    <div class="scroll-hint">â†“</div>
  </div>
  <div class="stats-bar">
    <div class="stat"><div class="stat-val" id="statCleared">0</div><div class="stat-label">í´ë¦¬ì–´</div></div>
    <div class="stat"><div class="stat-val" id="statGrade">ğŸ”°</div><div class="stat-label">ë“±ê¸‰</div></div>
    <div class="stat"><div class="stat-val" id="statStreak">0</div><div class="stat-label">ì—°ì†</div></div>
  </div>
  <div class="rooms-section" id="rooms-section">
    <h2>ğŸšª ë¯¸ìŠ¤í„°ë¦¬ ëª©ë¡</h2>
    <div class="rooms-progress" id="rooms-progress"></div>
    <div class="room-grid" id="roomGrid"></div>
  </div>
</div>

<!-- â”€â”€â”€ ë¡œë”© â”€â”€â”€ -->
<div class="loading-screen" id="loadingScreen">
  <div class="spinner"></div>
  <div class="loading-text">ë°©ì— ì§„ì…í•˜ëŠ” ì¤‘...</div>
</div>

<!-- â”€â”€â”€ ê²Œì„ â”€â”€â”€ -->
<div id="game" class="hidden">
  <div class="game-header">
    <button class="game-back" onclick="confirmExit()">â†</button>
    <div class="game-title" id="gameTitle"></div>
    <div class="game-progress-text" id="gameProgressText"></div>
  </div>
  <div class="progress-bar" id="progressBar"></div>
  <div id="gameContent"></div>
</div>

<!-- â”€â”€â”€ ê²°ê³¼ â”€â”€â”€ -->
<div id="result" class="hidden">
  <div class="result-card" id="resultContent"></div>
</div>

<script>
const API = 'https://qube-api.harpy922.workers.dev';

// â”€â”€â”€ ë°© í…œí”Œë¦¿ â”€â”€â”€
const ROOMS = [
  {
    id: 'professor', emoji: 'ğŸšï¸', name: 'ì‚¬ë¼ì§„ êµìˆ˜ì˜ ì„œì¬',
    desc: 'ëŒ€í•™ êµìˆ˜ê°€ ê°‘ìê¸° ì‹¤ì¢…ëë‹¤. ê·¸ì˜ ì„œì¬ì— ë“¤ì–´ì™”ì§€ë§Œ ë¬¸ì´ ì ê²¼ë‹¤. ë‚¨ì€ ë‹¨ì„œë¥¼ ëª¨ì•„ íƒˆì¶œí•˜ë¼.',
    difficulty: 1, time: '10ë¶„',
    intro: 'ìœ ëª… ê³ ê³ í•™ êµìˆ˜ ê¹€ë™í˜„ì´ 3ì¼ì§¸ ì—°ë½ì´ ì—†ë‹¤. ì¡°êµì¸ ë‹¹ì‹ ì€ ê·¸ì˜ ì„œì¬ì— ë“¤ì–´ì™”ë‹¤. ë¬¸ì´ ì² ì»¹ ì†Œë¦¬ì™€ í•¨ê»˜ ì ê²¼ë‹¤. ì±…ì¥ ì‚¬ì´, ì„œë ì†, ë²½ì— ê±¸ë¦° ê·¸ë¦¼ ë’¤ì— ë¬´ì–¸ê°€ ìˆì„ ê²ƒì´ë‹¤.',
    puzzles: [
      { type:'general', title:'ğŸ“‹ í¼ì¦ 1: ì±…ìƒ ìœ„ì˜ ë©”ëª¨', story:'ì±…ìƒ ìœ„ì— êµìˆ˜ì˜ ë©”ëª¨ê°€ ìˆë‹¤. ì•Œ ìˆ˜ ì—†ëŠ” ë¬¸ìê°€ ì í˜€ìˆë‹¤.', question:'ë‹¤ìŒ ì•”í˜¸ë¥¼ í•´ë…í•˜ë¼:\n\n<b>ã…ã„±ã…‡ ã……ã…ˆ ã…‚ã… = ?</b>\n\níŒíŠ¸: ê° ê¸€ìì˜ ì´ˆì„±ì´ë‹¤. "í•œêµ­ì˜ ìˆ˜ë„ ì„œìš¸"ì²˜ëŸ¼ ì½ì–´ë³´ë¼.', hint:'ì´ˆì„±ë§Œ ë³´ë©´... ã…ã„±ã…‡ = í•œê¸€ì˜, ã……ã…ˆ = ì‹œì‘, ã…‚ã… = ?', validate: i => i.replace(/\s/g,'').includes('ë°”í') },
      { type:'cpq', cpqIndex:0, story:'ì„œëì„ ì—´ì íƒë°° ì˜ìˆ˜ì¦ì´ ë‚˜ì™”ë‹¤. êµìˆ˜ê°€ ì‹¤ì¢… ì „ ë§ˆì§€ë§‰ìœ¼ë¡œ ê²€ìƒ‰í•œ ê²ƒ ê°™ë‹¤. ì´ ì¥ì†Œì˜ ë¹„ë°€ì„ í’€ì–´ì•¼ í•œë‹¤.', storyAfter:'ì˜ìˆ˜ì¦ ë’·ë©´ì— ì íŒ ìˆ«ì... ì´ê²ƒì€ ì–´ë”˜ê°€ì˜ ê±¸ìŒ ìˆ˜ë‹¤. êµìˆ˜ëŠ” ì´ ì¥ì†Œë¥¼ ê°€ë ¤ í–ˆë˜ ê²ƒì´ë‹¤.' },
      { type:'general', title:'ğŸ”¢ í¼ì¦ 3: ê¸ˆê³  ë²ˆí˜¸', story:'ë²½ ê·¸ë¦¼ ë’¤ì— ê¸ˆê³ ê°€ ìˆë‹¤. ë²ˆí˜¸ 4ìë¦¬ë¥¼ ì…ë ¥í•´ì•¼ í•œë‹¤.', question:'êµìˆ˜ì˜ ì¼ê¸°ì— ì íŒ ìˆ˜ì—´:\n\n<b>2, 3, 5, 8, 13, ?</b>\n\në¹ˆì¹¸ì— ë“¤ì–´ê°ˆ ìˆ«ì ë‘ ê°œë¥¼ ì´ì–´ ì“°ì‹œì˜¤.\n(ì˜ˆ: ë‹¤ìŒ ë‘ ìˆ˜ê°€ 20, 33ì´ë©´ "2033")', hint:'í”¼ë³´ë‚˜ì¹˜ì™€ ë¹„ìŠ·í•˜ë‹¤. ê° ìˆ˜ëŠ” ì•ì˜ ë‘ ìˆ˜ì˜ í•©ì´ë‹¤.', validate: i => i.replace(/\s/g,'') === '2134' },
      { type:'cpq', cpqIndex:1, story:'ê¸ˆê³  ì•ˆì— êµìˆ˜ì˜ ë¹„ë°€ ìˆ˜ì²©ì´ ìˆë‹¤. ë§ˆì§€ë§‰ í˜ì´ì§€ì— ë˜ ë‹¤ë¥¸ ì¥ì†Œê°€ ì í˜€ìˆë‹¤. êµìˆ˜ì˜ í–‰ë°©ì„ ì¶”ì í•˜ë ¤ë©´ ì´ê³³ë„ í™•ì¸í•´ì•¼ í•œë‹¤.', storyAfter:'ìˆ˜ì²©ì˜ ë§ˆì§€ë§‰ ì¥ì— ì íŒ ìˆ«ìë¥¼ í™•ì¸í–ˆë‹¤. êµìˆ˜ì˜ ë™ì„ ì´ ì ì  ë“œëŸ¬ë‚œë‹¤.' },
      { type:'general', title:'ğŸšª í¼ì¦ 5: ìµœì¢… íƒˆì¶œ', story:'ëª¨ë“  ë‹¨ì„œë¥¼ ëª¨ì•˜ë‹¤. ë¬¸ ì˜† íŒ¨ë„ì— ìµœì¢… ì½”ë“œë¥¼ ì…ë ¥í•´ì•¼ í•œë‹¤.', question:'ì„œì¬ ê³³ê³³ì—ì„œ ë°œê²¬í•œ ì•ŒíŒŒë²³:\n\nì±…ìƒ: <b>E</b>, ì„œë: <b>S</b>, ê¸ˆê³ : <b>C</b>, ìˆ˜ì²©: <b>A</b>, ê·¸ë¦¼: <b>P</b>, ë¬¸: <b>E</b>\n\nì´ ê¸€ìë¥¼ ì˜¬ë°”ë¥¸ ìˆœì„œë¡œ ë°°ì—´í•˜ë©´?\n(íŒíŠ¸: ë‹¹ì‹ ì´ í•´ì•¼ í•  ê²ƒ)', hint:'íƒˆì¶œ... ì˜ì–´ë¡œ?', validate: i => i.toUpperCase().replace(/\s/g,'') === 'ESCAPE' }
    ]
  },
  {
    id: 'ship', emoji: 'ğŸš¢', name: 'í‘œë¥˜ëœ í™”ë¬¼ì„ ',
    desc: 'í•´ì•ˆê°€ì— ë– ë°€ë ¤ ì˜¨ ë¬´ì¸ í™”ë¬¼ì„ . ì„ ì›ë“¤ì€ ì–´ë””ë¡œ ì‚¬ë¼ì¡ŒëŠ”ê°€? ë°°ì—ì„œ íƒˆì¶œí•˜ë¼.',
    difficulty: 2, time: '12ë¶„',
    intro: 'í•´ì•ˆê°€ì— ì •ì²´ë¶ˆëª…ì˜ í™”ë¬¼ì„ ì´ í‘œë¥˜í•´ì™”ë‹¤. í•´ì–‘ê²½ì°° ì†Œì†ì¸ ë‹¹ì‹ ì´ ì¡°ì‚¬ë¥¼ ì‹œì‘í–ˆì§€ë§Œ, ê°‘íŒ í•´ì¹˜ê°€ ë‹«íˆë©° ê°‡í˜”ë‹¤. ì„ ì› ê¸°ë¡ê³¼ í™”ë¬¼ ëª©ë¡ì—ì„œ ë‹¨ì„œë¥¼ ì°¾ì•„ë¼.',
    puzzles: [
      { type:'general', title:'ğŸ§­ í¼ì¦ 1: í•­í•´ ì¼ì§€', story:'ì„ ì¥ì‹¤ í•­í•´ ì¼ì§€ì˜ ë§ˆì§€ë§‰ í˜ì´ì§€. ì¢Œí‘œê°€ ì•”í˜¸ë¡œ ì í˜€ìˆë‹¤.', question:'í•­í•´ ì¼ì§€ì— ì íŒ ì•”í˜¸:\n\n<b>A=1, B=2, C=3 ... ê·œì¹™ìœ¼ë¡œ</b>\n<b>8-5-12-16</b>\n\nì´ ìˆ«ìë“¤ì„ ì•ŒíŒŒë²³ìœ¼ë¡œ ë³€í™˜í•˜ë©´?', hint:'8ë²ˆì§¸ ì•ŒíŒŒë²³ = H, 5ë²ˆì§¸ = E ...', validate: i => i.toUpperCase().replace(/\s/g,'') === 'HELP' },
      { type:'cpq', cpqIndex:0, story:'í™”ë¬¼ì¹¸ì— ìˆ˜ìƒí•œ ë°°ì†¡ ê¸°ë¡ì´ ìˆë‹¤. ëˆ„êµ°ê°€ ì´ ì¥ì†Œë¥¼ ì¡°ì‚¬í•˜ê³  ìˆì—ˆë‹¤.', storyAfter:'ë°°ì†¡ ê¸°ë¡ì˜ ê±¸ìŒ ìˆ˜ë¥¼ í™•ì¸í–ˆë‹¤. ì´ ì¥ì†Œì™€ ì‹¤ì¢…ëœ ì„ ì›ë“¤ ì‚¬ì´ì— ë¬´ìŠ¨ ì—°ê´€ì´ ìˆëŠ” ê±¸ê¹Œ.' },
      { type:'general', title:'âš“ í¼ì¦ 3: ëª¨ìŠ¤ ë¶€í˜¸', story:'ë¬´ì „ê¸°ì—ì„œ ë°˜ë³µë˜ëŠ” ì‹ í˜¸ê°€ ë“¤ë¦°ë‹¤.', question:'ëª¨ìŠ¤ ë¶€í˜¸ë¥¼ í•´ë…í•˜ë¼:\n\n<b>Â·Â·Â·  â”€â”€â”€ Â·Â·Â·</b>\n\nì´ê²ƒì€ êµ­ì œ ì¡°ë‚œ ì‹ í˜¸ë‹¤. ì„¸ ê¸€ìë¡œ ë‹µí•˜ë¼.', hint:'Â·Â·Â· = S, â”€â”€â”€ = O', validate: i => i.toUpperCase().replace(/\s/g,'') === 'SOS' },
      { type:'cpq', cpqIndex:1, story:'ê¸°ê´€ì‹¤ì—ì„œ ì„ ì›ì˜ ê°œì¸ ë¬¼í’ˆì„ ë°œê²¬í–ˆë‹¤. ê·¸ê°€ ë§ˆì§€ë§‰ìœ¼ë¡œ í™•ì¸í•œ ì¥ì†Œ ê¸°ë¡ì´ ë‚¨ì•„ìˆë‹¤.', storyAfter:'ì„ ì›ì˜ ê¸°ë¡ê³¼ ì¼ì¹˜í•œë‹¤. ê·¸ë“¤ì´ ì™œ ì´ ì¥ì†Œë“¤ì„ ì¡°ì‚¬í–ˆëŠ”ì§€ ìœ¤ê³½ì´ ì¡íˆê¸° ì‹œì‘í•œë‹¤.' },
      { type:'general', title:'ğŸšª í¼ì¦ 5: í•´ì¹˜ í•´ì œ', story:'ëª¨ë“  ë‹¨ì„œë¥¼ ì¡°í•©í•´ í•´ì¹˜ ì ê¸ˆì¥ì¹˜ë¥¼ í•´ì œí•´ì•¼ í•œë‹¤.', question:'ì ê¸ˆì¥ì¹˜ì— ì íŒ ìˆ˜ìˆ˜ê»˜ë¼:\n\n"<b>ë‚˜ëŠ” ì•ìœ¼ë¡œ ê°€ë„ ë’¤ë¡œ ê°€ë„ ê°™ë‹¤.<br>ë°”ë‹¤ ìœ„ì—ì„œ íƒœì–´ë‚˜ ë°”ë‹¤ì—ì„œ ì£½ëŠ”ë‹¤.<br>ë‚˜ëŠ” ë‘ ê¸€ìë‹¤.</b>"\n\nì •ë‹µì€?', hint:'ì•ë’¤ê°€ ê°™ì€ ê²ƒ... ë°”ë‹¤ì™€ ê´€ë ¨ëœ ê²ƒ...', validate: i => i.replace(/\s/g,'') === 'íŒŒë„' }
    ]
  },
  {
    id: 'hotel', emoji: 'ğŸ¨', name: 'í˜¸í…” ë¯¸ìŠ¤í„°ë¦¬',
    desc: 'ê³ ê¸‰ í˜¸í…” íˆ¬ìˆ™ê°ì´ ì‹¤ì¢…ëë‹¤. ê·¸ì˜ ë°©ì— ë‚¨ì€ í”ì ì„ ì«“ì•„ ì§„ì‹¤ì„ ë°í˜€ë¼.',
    difficulty: 3, time: '15ë¶„',
    intro: '5ì„±ê¸‰ í˜¸í…”ì˜ VIP íˆ¬ìˆ™ê° ë°•ì¤€í˜¸ ì”¨ê°€ ì²´í¬ì¸ í›„ ì‚¬ë¼ì¡Œë‹¤. ë³´ì•ˆíŒ€ì¸ ë‹¹ì‹ ì€ ê·¸ì˜ ë°© 1408í˜¸ì— ë“¤ì–´ì™”ë‹¤. ì¹´ë“œí‚¤ê°€ ì—ëŸ¬ë¥¼ ë‚´ë©° ë¬¸ì´ ì ê²¼ë‹¤. ë°© ì•ˆì˜ í”ì ì„ ëª¨ì•„ ìƒí™©ì„ íŒŒì•…í•˜ë¼.',
    puzzles: [
      { type:'general', title:'ğŸ”‘ í¼ì¦ 1: ì¹´ë“œí‚¤ í•´í‚¹', story:'ì˜† í…Œì´ë¸”ì— íˆ¬ìˆ™ê°ì˜ ë…¸íŠ¸ë¶ì´ ì—´ë ¤ìˆë‹¤. ë¹„ë°€ë²ˆí˜¸ íŒíŠ¸ê°€ ì í˜€ìˆë‹¤.', question:'ë…¸íŠ¸ë¶ í™”ë©´ì˜ ë¹„ë°€ë²ˆí˜¸ íŒíŠ¸:\n\n<b>"ë‚´ ë°© ë²ˆí˜¸ì—ì„œ ê°€ì¥ í° ìˆ˜ì™€ ê°€ì¥ ì‘ì€ ìˆ˜ì˜ ì°¨ì´"</b>\n\në°© ë²ˆí˜¸ëŠ” <b>1408</b>ì´ë‹¤. ì •ë‹µì€?', hint:'1408ì—ì„œ ê°€ì¥ í° ìˆ«ì = 8, ê°€ì¥ ì‘ì€ ìˆ«ì = 0. ì°¨ì´ëŠ”?', validate: i => i.trim()==='7'||i.trim()==='8' },
      { type:'cpq', cpqIndex:0, story:'ë…¸íŠ¸ë¶ì— íˆ¬ìˆ™ê°ì˜ ìµœê·¼ ê²€ìƒ‰ ê¸°ë¡ì´ ë‚¨ì•„ìˆë‹¤. ì‹¤ì¢… ì§ì „ ì´ ì¥ì†Œë¥¼ í™•ì¸í•œ ê²ƒ ê°™ë‹¤.', storyAfter:'ê²€ìƒ‰ ê¸°ë¡ì˜ ì¥ì†Œì™€ ê±¸ìŒ ìˆ˜... íˆ¬ìˆ™ê°ì€ ì´ê³³ì„ ë°©ë¬¸í•˜ë ¤ í–ˆë˜ ê²ƒì´ë‹¤.' },
      { type:'general', title:'ğŸª í¼ì¦ 3: ê±°ìš¸ ì† ë©”ì‹œì§€', story:'ìš•ì‹¤ ê±°ìš¸ì— ê¹€ì´ ì„œë ¤ ê¸€ìê°€ ë“œëŸ¬ë‚œë‹¤.', question:'ê±°ìš¸ì— ë¹„ì¹œ ë©”ì‹œì§€ë¥¼ í•´ë…í•˜ë¼:\n\nê±°ìš¸ì— "<b>ë„ì›€ì„ ì²­í•˜ë¼</b>"ê°€ ë¹„ì³ìˆë‹¤.\nì´ê²ƒì„ ê±°ê¾¸ë¡œ ì½ìœ¼ë©´?', hint:'í•œêµ­ì–´ë¥¼ ê±°ê¾¸ë¡œ ì½ì–´ë³´ì', validate: i => i.replace(/\s/g,'') === 'ë¼í•˜ì²­ì„ì›€ë„' },
      { type:'cpq', cpqIndex:1, story:'ê¸ˆê³  ì•ˆì— íˆ¬ìˆ™ê°ì˜ ì¼ì •í‘œê°€ ìˆë‹¤. ë°©ë¬¸ ì˜ˆì •ì´ì—ˆë˜ ë˜ ë‹¤ë¥¸ ì¥ì†Œê°€ ê¸°ë¡ë¼ ìˆë‹¤.', storyAfter:'ë‘ ì¥ì†Œì˜ ì—°ê²°ê³ ë¦¬ë¥¼ ì°¾ì•˜ë‹¤. íˆ¬ìˆ™ê°ì˜ ëª©ì ì´ ì ì  ì„ ëª…í•´ì§„ë‹¤.' },
      { type:'general', title:'ğŸšª í¼ì¦ 5: ë¹„ë°€ í†µë¡œ', story:'ëª¨ë“  ë‹¨ì„œê°€ í•˜ë‚˜ë¡œ ëª¨ì˜€ë‹¤. ë²½ ì† ë¹„ë°€ í†µë¡œì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ë¼.', question:'íˆ¬ìˆ™ê°ì´ ë‚¨ê¸´ ë§ˆì§€ë§‰ ë©”ëª¨:\n\n<b>"ì²´í¬ì¸: 14ì‹œ, ì²´í¬ì•„ì›ƒ: 08ì‹œ<br>ë°©: 1408í˜¸, ì¸µ: 14ì¸µ<br>ë¹„ë°€ë²ˆí˜¸ = ëª¨ë“  ìˆ«ìì˜ í•©"</b>\n\n14 + 8 + 1408 + 14 = ?', hint:'14 + 8 + 1408 + 14 ë¥¼ ê³„ì‚°í•´ë³´ì', validate: i => i.trim()==='1444' }
    ]
  }
];

// â”€â”€â”€ ê²Œì„ ìƒíƒœ â”€â”€â”€
let state = { currentRoom:null, currentPuzzle:0, cpqCampaigns:[], startTime:null, attempts:0 };

function loadProgress() { try{return JSON.parse(localStorage.getItem('qube_progress')||'{}')}catch{return{}} }
function saveProgress(p) { localStorage.setItem('qube_progress',JSON.stringify(p)) }
function getGrade(c) { return c>=10?'ğŸ•µï¸ ì…œë¡':c>=7?'ğŸ” ëª…íƒì •':c>=4?'ğŸ§ íƒì •':c>=2?'ğŸ“‹ ìˆ˜ìŠµíƒì •':'ğŸ”° ì´ˆë³´íƒì •' }
function formatTime(s) { return Math.floor(s/60)+':'+String(s%60).padStart(2,'0') }

// â”€â”€â”€ íŒŒí‹°í´ â”€â”€â”€
function createParticles() {
  const c = document.getElementById('particles');
  for(let i=0;i<50;i++){
    const p = document.createElement('div');
    p.className='particle';
    p.style.left=Math.random()*100+'%';
    p.style.animationDuration=(8+Math.random()*12)+'s';
    p.style.animationDelay=Math.random()*10+'s';
    const sz=(2+Math.random()*3)+'px';
    p.style.width=p.style.height=sz;
    p.style.background=Math.random()>.5?'#b44aff':'#00e5ff';
    p.style.boxShadow=`0 0 6px ${p.style.background}`;
    c.appendChild(p);
  }
}

function scrollToRooms() { document.getElementById('rooms-section').scrollIntoView({behavior:'smooth'}) }

// â”€â”€â”€ í™”ë©´ ì „í™˜ â”€â”€â”€
function showScreen(id) {
  document.getElementById('home').classList.toggle('hidden', id!=='home');
  document.getElementById('game').classList.toggle('hidden', id!=='game');
  document.getElementById('result').classList.toggle('hidden', id!=='result');
  document.getElementById('loadingScreen').classList.remove('active');
  if(id!=='home') window.scrollTo(0,0);
}

function goHome() {
  state.currentRoom=null;
  showScreen('home');
  renderHome();
}

function confirmExit() { if(confirm('ì •ë§ ë‚˜ê°€ì‹œê² ìŠµë‹ˆê¹Œ? ì§„í–‰ ìƒí™©ì´ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.')) goHome() }

// â”€â”€â”€ í™ˆ ë Œë”ë§ â”€â”€â”€
function renderHome() {
  const progress = loadProgress();
  const cleared = Object.keys(progress).filter(k=>progress[k]?.cleared).length;

  document.getElementById('statCleared').textContent = cleared;
  document.getElementById('statGrade').textContent = getGrade(cleared).split(' ')[0];
  document.getElementById('rooms-progress').textContent = `ğŸ”“ ${ROOMS.length}/${ROOMS.length} í•´ê¸ˆ Â· âœ… ${cleared} íƒˆì¶œ`;

  const grid = document.getElementById('roomGrid');
  grid.innerHTML = ROOMS.map(room => {
    const p = progress[room.id];
    const isClear = p?.cleared;
    const stars = Array.from({length:3},(_,i)=>`<span class="star ${i<room.difficulty?'':'empty'}">${i<room.difficulty?'â˜…':'â˜†'}</span>`).join('');
    const badge = isClear ? '<span class="room-badge badge-cleared">âœ“ í´ë¦¬ì–´</span>' : '<span class="room-badge badge-new">NEW</span>';

    return `<div class="room-card ${isClear?'cleared':''}" onclick="startRoom('${room.id}')">
      ${badge}
      <div class="room-emoji">${room.emoji}</div>
      <div class="room-title">${room.name}</div>
      <div class="room-desc">${room.desc}</div>
      <div class="room-meta">
        <span class="room-diff">${stars}</span>
        <span>â± ${room.time}</span>
        ${isClear?`<span>ğŸ† ${formatTime(p.bestTime)}</span>`:''}
      </div>
      <button class="room-start">${isClear?'ë‹¤ì‹œ ë„ì „ ğŸ”„':'ì…ì¥í•˜ê¸° ğŸ”‘'}</button>
    </div>`;
  }).join('');
}

// â”€â”€â”€ ê²Œì„ ì‹œì‘ â”€â”€â”€
async function startRoom(roomId) {
  const room = ROOMS.find(r=>r.id===roomId);
  if(!room) return;

  state.currentRoom=room; state.currentPuzzle=0; state.startTime=Date.now(); state.attempts=0;

  document.getElementById('loadingScreen').classList.add('active');

  try {
    const cpqCount = room.puzzles.filter(p=>p.type==='cpq').length;
    const res = await fetch(`${API}/api/random?count=${cpqCount}`);
    const data = await res.json();
    state.cpqCampaigns = data.campaigns || [];
  } catch(e) { state.cpqCampaigns = []; }

  showScreen('game');
  document.getElementById('gameTitle').textContent = room.emoji + ' ' + room.name;
  renderIntro();
}

function renderIntro() {
  renderProgress();
  document.getElementById('gameContent').innerHTML = `
    <div class="story-box">
      <div class="label">ğŸ“– í”„ë¡¤ë¡œê·¸</div>
      <p>${state.currentRoom.intro}</p>
    </div>
    <button class="btn-next" onclick="renderPuzzle(0)">ì¡°ì‚¬ ì‹œì‘ â†’</button>`;
}

function renderProgress() {
  const room = state.currentRoom;
  const total = room.puzzles.length;
  document.getElementById('gameProgressText').textContent = `${state.currentPuzzle+1} / ${total}`;
  document.getElementById('progressBar').innerHTML =
    Array.from({length:total},(_,i)=>{
      const cls = i<state.currentPuzzle?'done':i===state.currentPuzzle?'active':'';
      return `<div class="prog-dot ${cls}"></div>`;
    }).join('');
}

// â”€â”€â”€ í¼ì¦ ë Œë”ë§ â”€â”€â”€
function renderPuzzle(idx) {
  state.currentPuzzle = idx;
  renderProgress();
  const puzzle = state.currentRoom.puzzles[idx];
  puzzle.type==='cpq' ? renderCpqPuzzle(idx,puzzle) : renderGeneralPuzzle(idx,puzzle);
}

function renderGeneralPuzzle(idx, puzzle) {
  document.getElementById('gameContent').innerHTML = `
    <div class="story-box">
      <div class="label">ğŸ“– ìƒí™©</div>
      <p>${puzzle.story}</p>
    </div>
    <div class="puzzle-box">
      <div class="puzzle-label">${puzzle.title}</div>
      <div class="puzzle-question">${puzzle.question.replace(/\n/g,'<br>')}</div>
      <div class="hint-box hidden" id="hintBox">ğŸ’¡ ${puzzle.hint}</div>
      <button class="hint-btn" onclick="document.getElementById('hintBox').classList.remove('hidden');this.remove()">ğŸ’¡ íŒíŠ¸ ë³´ê¸°</button>
      <div class="answer-area">
        <input type="text" id="answerInput" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”" onkeydown="handleEnter(event,${idx})">
        <button class="btn-submit" onclick="checkGeneral(${idx})">í™•ì¸</button>
      </div>
      <div id="feedback"></div>
    </div>`;
  document.getElementById('answerInput').focus();
}

function renderCpqPuzzle(idx, puzzle) {
  const camp = state.cpqCampaigns[puzzle.cpqIndex];
  if(!camp) { nextPuzzle(idx); return; }

  const desc = camp.join_desc || '';
  const keyword = camp.search_keyword || '';
  const placeMatch = desc.match(/\[([^\]]*X[^\]]*)\]/);
  const placeHint = placeMatch ? placeMatch[1] : 'í•´ë‹¹ ì¥ì†Œ';
  const startMatch = desc.match(/ì¶œë°œì§€ë¥¼\s*\[([^\]]+)\]/);
  const startPlace = startMatch ? startMatch[1] : 'ì§€ì •ëœ ì¶œë°œì§€';

  document.getElementById('gameContent').innerHTML = `
    <div class="story-box">
      <div class="label">ğŸ“– ë‹¨ì„œ ë°œê²¬</div>
      <p>${puzzle.story}</p>
    </div>
    <div class="puzzle-box">
      <div class="puzzle-label">ğŸ” í¼ì¦ ${idx+1}: ì¥ì†Œ ì¶”ì  ë¯¸ì…˜</div>
      <div class="puzzle-question">ë‹¨ì„œì— ì íŒ ì¥ì†Œë¥¼ ì°¾ì•„ì•¼ í•œë‹¤. ë„¤ì´ë²„ì—ì„œ ê²€ìƒ‰í•˜ì—¬ ê±¸ìŒ ìˆ˜ë¥¼ í™•ì¸í•˜ë¼.</div>
      <div class="cpq-mission">
        <div class="mission-title">ğŸ“‹ ë¯¸ì…˜ ìˆœì„œ</div>
        <ol class="cpq-steps">
          <li>ì•„ë˜ í‚¤ì›Œë“œë¥¼ ë³µì‚¬í•˜ì—¬ <b>ë„¤ì´ë²„</b>ì—ì„œ ê²€ìƒ‰</li>
          <li>ê²€ìƒ‰ ê²°ê³¼ì—ì„œ <b>${placeHint}</b> í´ë¦­</li>
          <li>í”Œë ˆì´ìŠ¤ì—ì„œ <b>ì§€ë„</b> íƒ­ â†’ <b>ì§€ë„ì•±ìœ¼ë¡œ ë³´ê¸°</b></li>
          <li><b>ë„ì°©</b> ë²„íŠ¼ í´ë¦­</li>
          <li>ì¶œë°œì§€ë¥¼ <b>${startPlace}</b>(ìœ¼)ë¡œ ì„¤ì •</li>
          <li><b>ë„ë³´</b> â†’ <b>ê°€ì¥ ë¹ ë¥¸</b> ê²½ë¡œì˜ ê±¸ìŒ ìˆ˜ í™•ì¸</li>
        </ol>
        <div class="cpq-keyword-box">
          <span class="cpq-keyword" onclick="copyKeyword(this)" title="í´ë¦­í•˜ì—¬ ë³µì‚¬">ğŸ” ${keyword}</span>
        </div>
      </div>
      <div class="answer-area" style="margin-top:16px">
        <input type="number" id="answerInput" placeholder="ê±¸ìŒ ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”" onkeydown="handleEnter(event,${idx},'cpq')">
        <button class="btn-submit" onclick="checkCpq(${idx})">í™•ì¸</button>
      </div>
      <div id="feedback"></div>
    </div>`;
  document.getElementById('answerInput').focus();
}

// â”€â”€â”€ ì…ë ¥ í•¸ë“¤ëŸ¬ â”€â”€â”€
let isComposing = false;
document.addEventListener('compositionstart', ()=>{isComposing=true});
document.addEventListener('compositionend', ()=>{isComposing=false});

function handleEnter(e, idx, type) {
  if(e.key==='Enter' && !isComposing) {
    e.preventDefault();
    type==='cpq' ? checkCpq(idx) : checkGeneral(idx);
  }
}

// â”€â”€â”€ ê²€ì¦ â”€â”€â”€
function checkGeneral(idx) {
  const input = document.getElementById('answerInput').value.trim();
  if(!input) return;
  state.attempts++;
  showFeedback(state.currentRoom.puzzles[idx].validate(input), idx);
}

async function checkCpq(idx) {
  const input = document.getElementById('answerInput').value.trim();
  if(!input) return;
  state.attempts++;
  const camp = state.cpqCampaigns[state.currentRoom.puzzles[idx].cpqIndex];
  try {
    const res = await fetch(`${API}/api/verify`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({campaign_id:camp.id,user_answer:input})});
    const data = await res.json();
    showFeedback(data.correct, idx);
  } catch { showFeedback(false, idx); }
}

function showFeedback(correct, idx) {
  const fb = document.getElementById('feedback');
  const puzzle = state.currentRoom.puzzles[idx];
  if(correct) {
    const after = puzzle.storyAfter||'';
    fb.innerHTML = `<div class="feedback correct">âœ… ì •ë‹µ!${after?' '+after:''}</div>
      <button class="btn-next" onclick="nextPuzzle(${idx})">${idx<state.currentRoom.puzzles.length-1?'ë‹¤ìŒ í¼ì¦ â†’':'ğŸšª íƒˆì¶œ!'}</button>`;
  } else {
    fb.innerHTML = '<div class="feedback wrong">âŒ ì˜¤ë‹µ. ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.</div>';
    document.getElementById('answerInput').value='';
    document.getElementById('answerInput').focus();
  }
}

function nextPuzzle(cur) { cur+1>=state.currentRoom.puzzles.length ? showResult() : renderPuzzle(cur+1) }

// â”€â”€â”€ ê²°ê³¼ â”€â”€â”€
function showResult() {
  const elapsed = Math.floor((Date.now()-state.startTime)/1000);
  const room = state.currentRoom;
  const progress = loadProgress();
  const prev = progress[room.id];
  const bestTime = prev?.bestTime ? Math.min(prev.bestTime,elapsed) : elapsed;
  progress[room.id] = {cleared:true, bestTime, lastPlayed:Date.now()};
  saveProgress(progress);

  const cleared = Object.keys(progress).filter(k=>progress[k]?.cleared).length;
  const grade = getGrade(cleared);
  let gameGrade = 'S';
  if(elapsed>600) gameGrade='C'; else if(elapsed>300) gameGrade='B'; else if(elapsed>180) gameGrade='A';

  showScreen('result');
  document.getElementById('resultContent').innerHTML = `
    <div class="result-emoji">ğŸ‰</div>
    <div class="result-title">íƒˆì¶œ ì„±ê³µ!</div>
    <div class="result-sub">${room.name}ì—ì„œ ë¬´ì‚¬íˆ íƒˆì¶œí–ˆìŠµë‹ˆë‹¤</div>
    <div class="result-grade">${gameGrade} RANK</div>
    <div class="result-stats">
      <div class="result-stat"><div class="result-stat-val">${formatTime(elapsed)}</div><div class="result-stat-label">ì†Œìš”ì‹œê°„</div></div>
      <div class="result-stat"><div class="result-stat-val">${state.attempts}</div><div class="result-stat-label">ì‹œë„íšŸìˆ˜</div></div>
      <div class="result-stat"><div class="result-stat-val">${grade.split(' ')[0]}</div><div class="result-stat-label">${grade.split(' ')[1]||''}</div></div>
    </div>
    <div class="result-btns">
      <button class="btn-home" onclick="goHome()">ğŸšª ë¡œë¹„ë¡œ ëŒì•„ê°€ê¸°</button>
      <button class="btn-share" onclick="shareResult()">ğŸ“¤ ê²°ê³¼ ê³µìœ í•˜ê¸°</button>
    </div>`;
}

function shareResult() {
  const room = state.currentRoom;
  const elapsed = Math.floor((Date.now()-state.startTime)/1000);
  const text = `ğŸ” QUBE - ${room.name}\n${room.emoji} íƒˆì¶œ ì„±ê³µ! | â± ${formatTime(elapsed)}\n\në‚˜ëŠ” íƒˆì¶œí–ˆë‹¤. ë‹¹ì‹ ì€?\nğŸ‘‰ https://qube.salmonholic.com`;
  navigator.share ? navigator.share({text}) : (navigator.clipboard?.writeText(text), alert('í´ë¦½ë³´ë“œì— ë³µì‚¬ëìŠµë‹ˆë‹¤!'));
}

function copyKeyword(el) {
  const text = el.textContent.replace('ğŸ” ','').trim();
  navigator.clipboard?.writeText(text);
  const orig = el.textContent;
  el.textContent = 'âœ“ ë³µì‚¬ë¨!';
  setTimeout(()=>el.textContent=orig, 1500);
}

// â”€â”€â”€ ì´ˆê¸°í™” â”€â”€â”€
createParticles();
renderHome();
</script>
</body>
</html>
