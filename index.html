<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QUBE ‚Äî ÌíÄÏñ¥Îùº. ÌÉàÏ∂úÌïòÎùº.</title>
<meta name="description" content="Î∞©ÌÉàÏ∂ú Ï∂îÎ¶¨ ÌçºÏ¶ê Í≤åÏûÑ. Îã®ÏÑúÎ•º Ï∞æÍ≥†, ÌçºÏ¶êÏùÑ ÌíÄÍ≥†, ÌÉàÏ∂úÌïòÎùº.">
<meta property="og:title" content="QUBE ‚Äî Î∞©ÌÉàÏ∂ú Ï∂îÎ¶¨ ÌçºÏ¶ê Í≤åÏûÑ">
<meta property="og:description" content="ÌíÄÏñ¥Îùº. ÌÉàÏ∂úÌïòÎùº.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://qube.salmonholic.com">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üîí</text></svg>">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#0a0a0a;--bg2:#111;--bg3:#1a1a1a;
  --text:#e0e0e0;--text2:#888;--text3:#555;
  --accent:#b44aff;--accent2:#9333ea;--accent-glow:rgba(180,74,255,.15);
  --cyan:#00e5ff;--danger:#ff4444;--success:#00ff88;
  --card:rgba(255,255,255,.03);--card-border:rgba(255,255,255,.06);
}
html{scroll-behavior:smooth}
body{background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Noto Sans KR',sans-serif;line-height:1.6;overflow-x:hidden}
.hidden{display:none!important}
.hero{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;position:relative;overflow:hidden;padding:2rem}
.hero::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at 50% 40%,rgba(180,74,255,.06) 0%,transparent 70%);pointer-events:none}
.hero h1{font-size:clamp(3rem,10vw,6rem);font-weight:900;letter-spacing:0.1em;margin-bottom:1rem;background:linear-gradient(135deg,#fff 0%,#b44aff 50%,#00e5ff 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hero p{font-size:clamp(1rem,3vw,1.3rem);color:var(--text2);max-width:450px;margin-bottom:2.5rem}
.hero-cta{padding:16px 48px;background:linear-gradient(135deg,var(--accent),var(--cyan));color:#000;font-size:1.1rem;font-weight:700;border:none;border-radius:50px;cursor:pointer;transition:all .3s;letter-spacing:.05em}
.hero-cta:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(180,74,255,.4)}
.scroll-hint{position:absolute;bottom:2rem;animation:bounce 2s infinite;color:var(--text3);font-size:1.5rem}
@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(10px)}}
.particles{position:absolute;inset:0;pointer-events:none;overflow:hidden}
.particle{position:absolute;width:3px;height:3px;border-radius:50%;opacity:.4;animation:float linear infinite}
@keyframes float{0%{transform:translateY(100vh) scale(0);opacity:0}10%{opacity:.4}90%{opacity:.4}100%{transform:translateY(-10vh) scale(1);opacity:0}}
.stats-bar{display:flex;justify-content:center;gap:40px;padding:24px 0;margin-bottom:1rem}
.stat{text-align:center}
.stat-val{font-size:2rem;font-weight:900;background:linear-gradient(135deg,var(--accent),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.stat-label{font-size:.8rem;color:var(--text2);margin-top:4px}
.series-section{max-width:700px;margin:0 auto;padding:0 1.5rem 4rem}
.series-section h2{font-size:1.5rem;margin-bottom:.5rem;display:flex;align-items:center;gap:8px}
.series-progress-text{color:var(--text2);font-size:.85rem;margin-bottom:1.5rem}
.series-card{background:var(--card);border:1px solid var(--card-border);border-radius:20px;padding:1.8rem;margin-bottom:1.2rem;backdrop-filter:blur(10px);transition:all .3s;cursor:pointer;position:relative;overflow:hidden}
.series-card:hover:not(.locked){border-color:rgba(180,74,255,.3);background:rgba(255,255,255,.05);transform:translateY(-3px);box-shadow:0 8px 30px rgba(180,74,255,.1)}
.series-card.locked{opacity:.45;filter:saturate(.3);cursor:not-allowed}
.series-card.cleared{border-color:rgba(0,255,136,.2)}
.series-lock-overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.4);backdrop-filter:blur(2px);border-radius:20px;z-index:2}
.series-lock-overlay span{font-size:1rem;color:var(--text2);background:rgba(0,0,0,.6);padding:8px 20px;border-radius:50px}
.series-header{display:flex;align-items:center;gap:16px;margin-bottom:12px}
.series-icon{font-size:2.8rem}
.series-info{flex:1}
.series-title{font-size:1.2rem;font-weight:700}
.series-diff{font-size:.85rem;color:var(--text2);margin-top:2px}
.series-diff .star{color:var(--accent)}
.series-diff .star.empty{color:var(--text3)}
.series-desc{font-size:.9rem;color:var(--text2);line-height:1.6;margin-bottom:12px}
.series-footer{display:flex;align-items:center;justify-content:space-between}
.series-chapter-progress{font-size:.85rem;color:var(--text2)}
.series-chapter-progress .done{color:var(--success)}
.series-badge{padding:4px 14px;border-radius:20px;font-size:.75rem;font-weight:700}
.badge-clear{background:var(--success);color:#000}
.badge-progress{background:var(--accent);color:#fff}
.badge-new{background:rgba(180,74,255,.2);color:var(--accent);border:1px solid rgba(180,74,255,.3)}
#chapters{max-width:700px;margin:0 auto;min-height:100vh;padding:1rem}
.chapter-header{display:flex;align-items:center;padding:1rem 0;border-bottom:1px solid var(--card-border);margin-bottom:2rem;gap:12px}
.chapter-back{background:none;border:none;color:var(--text2);font-size:1.3rem;cursor:pointer;padding:4px 8px}
.chapter-back:hover{color:var(--text)}
.chapter-series-title{font-size:1.2rem;font-weight:700;flex:1}
.chapter-series-desc{color:var(--text2);font-size:.9rem;line-height:1.7;margin-bottom:2rem;padding:0 .5rem}
.chapter-timeline{position:relative;padding-left:32px}
.chapter-timeline::before{content:'';position:absolute;left:11px;top:20px;bottom:20px;width:2px;background:linear-gradient(to bottom,var(--accent),var(--cyan));opacity:.3}
.chapter-item{position:relative;margin-bottom:1.5rem}
.chapter-dot{position:absolute;left:-32px;top:18px;width:22px;height:22px;border-radius:50%;border:2px solid var(--text3);background:var(--bg);display:flex;align-items:center;justify-content:center;font-size:.7rem;z-index:1}
.chapter-item.unlocked .chapter-dot{border-color:var(--accent);box-shadow:0 0 8px rgba(180,74,255,.4)}
.chapter-item.cleared .chapter-dot{border-color:var(--success);background:var(--success);color:#000}
.chapter-card{background:var(--card);border:1px solid var(--card-border);border-radius:16px;padding:1.3rem 1.5rem;transition:all .3s}
.chapter-item.unlocked .chapter-card{border-color:rgba(180,74,255,.2)}
.chapter-item.unlocked .chapter-card:hover{border-color:rgba(180,74,255,.4);background:rgba(255,255,255,.05);transform:translateX(4px)}
.chapter-item.locked .chapter-card{opacity:.4;filter:saturate(.3)}
.chapter-card-title{font-size:1.05rem;font-weight:700;margin-bottom:4px}
.chapter-card-desc{font-size:.85rem;color:var(--text2);margin-bottom:10px}
.chapter-card-meta{display:flex;align-items:center;gap:12px;font-size:.8rem;color:var(--text2)}
.chapter-enter{padding:8px 20px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;border:none;border-radius:50px;cursor:pointer;font-size:.85rem;font-weight:600;transition:all .3s}
.chapter-enter:hover{box-shadow:0 4px 15px rgba(180,74,255,.4)}
.chapter-replay{padding:8px 20px;background:var(--bg3);color:var(--text2);border:1px solid var(--card-border);border-radius:50px;cursor:pointer;font-size:.85rem;transition:all .3s}
.chapter-replay:hover{border-color:var(--accent);color:var(--text)}
#game{max-width:700px;margin:0 auto;min-height:100vh;padding:1rem}
.game-header{display:flex;align-items:center;padding:1rem 0;border-bottom:1px solid var(--card-border);margin-bottom:1.5rem;gap:12px}
.game-back{background:none;border:none;color:var(--text2);font-size:1.3rem;cursor:pointer;padding:4px 8px}
.game-back:hover{color:var(--text)}
.game-title{font-size:1.1rem;font-weight:700;flex:1}
.game-progress-text{color:var(--text2);font-size:.85rem}
.progress-bar{display:flex;gap:6px;margin-bottom:1.5rem}
.prog-dot{flex:1;height:4px;border-radius:2px;background:var(--bg3);transition:all .3s}
.prog-dot.active{background:var(--accent);box-shadow:0 0 8px rgba(180,74,255,.4)}
.prog-dot.done{background:var(--success)}
.story-box{background:var(--bg3);border:1px solid var(--card-border);border-radius:16px;padding:1.5rem;margin-bottom:1.5rem;animation:fadeIn .5s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(15px)}to{opacity:1;transform:translateY(0)}}
.story-box .label{color:var(--accent);font-size:.75rem;font-weight:700;margin-bottom:8px;text-transform:uppercase;letter-spacing:.15em}
.story-box p{color:var(--text2);line-height:1.8}
.puzzle-box{background:rgba(180,74,255,.05);border:1px solid rgba(180,74,255,.15);border-radius:16px;padding:1.5rem;margin-bottom:1.5rem;animation:fadeIn .5s ease}
.puzzle-label{color:var(--cyan);font-size:.8rem;font-weight:700;margin-bottom:12px;letter-spacing:.05em}
.puzzle-question{font-size:1rem;line-height:1.8;margin-bottom:1.2rem}
.cpq-mission{background:rgba(0,229,255,.05);border:1px solid rgba(0,229,255,.15);border-radius:12px;padding:1.2rem;margin:1rem 0}
.cpq-mission .mission-title{color:var(--cyan);font-size:.8rem;font-weight:700;margin-bottom:10px}
.cpq-steps{font-size:.9rem;color:var(--text2);line-height:2;padding-left:1.2rem}
.cpq-steps b{color:var(--text)}
.cpq-keyword-box{margin-top:12px;display:flex;align-items:center;gap:10px}
.cpq-keyword{display:inline-block;background:linear-gradient(135deg,var(--accent),var(--cyan));color:#000;padding:8px 20px;border-radius:50px;font-size:.9rem;font-weight:700;cursor:pointer;transition:all .2s}
.cpq-keyword:hover{transform:scale(1.03);box-shadow:0 4px 15px rgba(180,74,255,.3)}
.hint-btn{background:none;border:1px solid var(--text3);color:var(--text2);padding:8px 16px;border-radius:50px;font-size:.8rem;cursor:pointer;transition:all .2s;margin-bottom:1rem}
.hint-btn:hover{border-color:var(--accent);color:var(--accent)}
.hint-box{background:rgba(255,165,0,.08);border:1px solid rgba(255,165,0,.2);border-radius:10px;padding:12px 16px;font-size:.9rem;color:#f59e0b;margin-bottom:1rem}
.answer-area{display:flex;flex-direction:column;gap:10px}
.answer-area input{width:100%;padding:14px 18px;background:var(--bg3);border:1px solid var(--card-border);border-radius:12px;color:var(--text);font-size:1rem;font-family:inherit;outline:none;transition:border-color .3s}
.answer-area input:focus{border-color:var(--accent)}
.answer-area input::placeholder{color:var(--text3)}
.btn-submit{width:100%;padding:14px 28px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;border:none;border-radius:12px;font-weight:700;cursor:pointer;transition:all .2s;white-space:nowrap;font-family:inherit;font-size:.95rem}
.btn-submit:hover{box-shadow:0 4px 15px rgba(180,74,255,.4)}
.btn-next{width:100%;padding:14px;background:linear-gradient(135deg,var(--accent),var(--cyan));color:#000;border:none;border-radius:50px;font-weight:700;cursor:pointer;transition:all .3s;font-size:1rem;font-family:inherit;margin-top:1rem}
.btn-next:hover{box-shadow:0 4px 20px rgba(180,74,255,.4);transform:translateY(-1px)}
.feedback{padding:14px 18px;border-radius:12px;margin-top:1rem;font-size:.95rem;animation:fadeIn .3s}
.feedback.correct{background:rgba(0,255,136,.1);color:var(--success);border:1px solid rgba(0,255,136,.2)}
.feedback.wrong{background:rgba(255,68,68,.1);color:var(--danger);border:1px solid rgba(255,68,68,.2)}
.cliffhanger-box{background:linear-gradient(135deg,rgba(180,74,255,.08),rgba(0,229,255,.08));border:1px solid rgba(180,74,255,.25);border-radius:16px;padding:2rem;margin:1.5rem 0;text-align:center;animation:fadeIn .8s ease}
.cliffhanger-box .label{color:var(--cyan);font-size:.75rem;font-weight:700;margin-bottom:12px;letter-spacing:.2em}
.cliffhanger-box p{color:var(--text);line-height:2;font-size:1.05rem;font-style:italic}
.series-clear-box{text-align:center;padding:2rem 0;animation:fadeIn .5s}
.series-clear-emoji{font-size:4rem;margin-bottom:1rem}
.series-clear-title{font-size:1.8rem;font-weight:900;background:linear-gradient(135deg,#fff,var(--accent),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:.5rem}
.series-clear-sub{color:var(--text2);margin-bottom:1.5rem}
#result{max-width:600px;margin:0 auto;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:2rem}
.result-card{text-align:center;width:100%}
.result-emoji{font-size:4rem;margin-bottom:1rem}
.result-title{font-size:2rem;font-weight:900;margin-bottom:.5rem;background:linear-gradient(135deg,#fff,var(--accent),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.result-sub{color:var(--text2);margin-bottom:2rem}
.result-grade{display:inline-block;font-size:1.5rem;font-weight:900;padding:10px 30px;border-radius:50px;background:linear-gradient(135deg,var(--accent),var(--cyan));color:#000;margin-bottom:2rem}
.result-stats{display:flex;justify-content:center;gap:20px;margin-bottom:2rem;flex-wrap:wrap}
.result-stat{background:var(--card);border:1px solid var(--card-border);border-radius:16px;padding:18px 24px;min-width:100px}
.result-stat-val{font-size:1.5rem;font-weight:900;color:var(--accent)}
.result-stat-label{font-size:.75rem;color:var(--text2);margin-top:4px}
.result-btns{display:flex;flex-direction:column;gap:10px;max-width:300px;margin:0 auto}
.btn-home{padding:14px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;border:none;border-radius:50px;font-weight:700;cursor:pointer;font-size:1rem;font-family:inherit;transition:all .3s}
.btn-home:hover{box-shadow:0 4px 15px rgba(180,74,255,.4)}
.btn-share{padding:14px;background:transparent;border:1px solid var(--card-border);color:var(--text2);border-radius:50px;cursor:pointer;font-size:.9rem;font-family:inherit;transition:all .2s}
.btn-share:hover{border-color:var(--accent);color:var(--text)}
.loading-screen{display:none;position:fixed;inset:0;background:var(--bg);z-index:1000;flex-direction:column;align-items:center;justify-content:center;gap:16px}
.loading-screen.active{display:flex}
.spinner{width:40px;height:40px;border:3px solid var(--bg3);border-top-color:var(--accent);border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-text{color:var(--text2);font-size:.9rem}
.confetti-container{position:fixed;inset:0;pointer-events:none;z-index:999;overflow:hidden}
.confetti-piece{position:absolute;width:10px;height:10px;top:-20px;animation:confettiFall 3s ease-in forwards}
@keyframes confettiFall{0%{transform:translateY(0) rotate(0deg);opacity:1}100%{transform:translateY(100vh) rotate(720deg);opacity:0}}
.hint-penalty-notice{position:fixed;top:20%;left:50%;transform:translateX(-50%);background:rgba(255,68,68,.95);color:#fff;padding:14px 28px;border-radius:12px;font-size:1.1rem;font-weight:700;z-index:1000;animation:penaltyFade 2s ease forwards;pointer-events:none;text-align:center}
@keyframes penaltyFade{0%{opacity:1;transform:translateX(-50%) translateY(0)}70%{opacity:1}100%{opacity:0;transform:translateX(-50%) translateY(-30px)}}

/* ‚ïê‚ïê‚ïê Interactive Puzzle Styles ‚ïê‚ïê‚ïê */

/* Flashlight */
.flashlight-area{position:relative;width:100%;height:300px;border-radius:12px;overflow:hidden;cursor:none;touch-action:none;margin-bottom:16px;background:#111}
.flashlight-overlay{position:absolute;inset:0;background:radial-gradient(circle 60px at var(--fx,50%) var(--fy,50%),transparent 0%,rgba(0,0,0,.97) 100%);z-index:2;pointer-events:none;transition:none}
.flashlight-item{position:absolute;color:var(--cyan);font-size:1.5rem;font-weight:900;z-index:1;user-select:none;text-shadow:0 0 8px var(--cyan)}
.flashlight-hint-text{text-align:center;color:var(--text3);font-size:.85rem;margin-bottom:12px}

/* Jigsaw */
.jigsaw-slots{display:grid;gap:8px;margin-bottom:16px}
.jigsaw-slot{background:rgba(180,74,255,.08);border:2px dashed rgba(180,74,255,.3);border-radius:10px;min-height:60px;display:flex;align-items:center;justify-content:center;font-size:.8rem;color:var(--text3);transition:all .3s}
.jigsaw-slot.hover{border-color:var(--cyan);background:rgba(0,229,255,.1)}
.jigsaw-slot.correct{border-color:var(--success);background:rgba(0,255,136,.1);border-style:solid}
.jigsaw-piece{background:var(--bg3);border:1px solid var(--accent);border-radius:10px;padding:12px 16px;cursor:grab;user-select:none;touch-action:none;font-size:.9rem;color:var(--text);transition:all .2s;text-align:center}
.jigsaw-piece:active{cursor:grabbing;transform:scale(1.05);box-shadow:0 4px 15px rgba(180,74,255,.3)}
.jigsaw-piece.placed{opacity:.4;pointer-events:none}
.jigsaw-tray{display:flex;flex-wrap:wrap;gap:8px;padding:12px;background:var(--bg2);border-radius:12px;margin-bottom:16px;justify-content:center}
.jigsaw-reveal{text-align:center;font-size:1.3rem;font-weight:700;color:var(--success);padding:16px;animation:fadeIn .5s}

/* Dial */
.dial-container{display:flex;flex-direction:column;align-items:center;gap:20px;margin-bottom:16px}
.dial-row{display:flex;gap:16px;align-items:center}
.dial-digit{display:flex;flex-direction:column;align-items:center;gap:6px}
.dial-digit .label{font-size:.75rem;color:var(--text3)}
.dial-ring{width:70px;height:70px;border-radius:50%;border:3px solid var(--accent);display:flex;align-items:center;justify-content:center;font-size:1.8rem;font-weight:900;color:var(--text);cursor:pointer;user-select:none;transition:all .2s;background:var(--bg3)}
.dial-ring:hover{border-color:var(--cyan);box-shadow:0 0 15px rgba(0,229,255,.3)}
.dial-ring:active{transform:scale(.95)}
.dial-arrows{display:flex;flex-direction:column;gap:2px}
.dial-arrow{width:70px;padding:4px;background:var(--bg3);border:1px solid var(--card-border);border-radius:6px;cursor:pointer;text-align:center;font-size:1rem;color:var(--text2);transition:all .2s}
.dial-arrow:hover{border-color:var(--accent);color:var(--text)}
.dial-lock-btn{padding:12px 32px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;border:none;border-radius:50px;cursor:pointer;font-weight:700;font-size:.95rem;transition:all .2s}
.dial-lock-btn:hover{box-shadow:0 4px 15px rgba(180,74,255,.4)}
.dial-result{font-size:.9rem;margin-top:8px;min-height:24px}

/* Timing */
.timing-area{margin-bottom:16px}
.timing-track{position:relative;width:100%;height:50px;background:var(--bg2);border-radius:25px;overflow:hidden;margin-bottom:12px;border:1px solid var(--card-border)}
.timing-zone{position:absolute;height:100%;background:rgba(0,255,136,.15);border-left:2px solid var(--success);border-right:2px solid var(--success)}
.timing-cursor{position:absolute;top:5px;bottom:5px;width:8px;background:var(--accent);border-radius:4px;box-shadow:0 0 10px var(--accent);transition:none}
.timing-btn{display:block;width:100%;padding:16px;background:linear-gradient(135deg,var(--accent),var(--cyan));color:#000;border:none;border-radius:12px;font-size:1.1rem;font-weight:700;cursor:pointer;transition:all .1s;font-family:inherit}
.timing-btn:active{transform:scale(.97)}
.timing-btn:disabled{opacity:.5;cursor:not-allowed}
.timing-progress{display:flex;gap:8px;justify-content:center;margin-bottom:12px}
.timing-pip{width:32px;height:32px;border-radius:50%;border:2px solid var(--text3);display:flex;align-items:center;justify-content:center;font-size:.9rem}
.timing-pip.hit{border-color:var(--success);color:var(--success);background:rgba(0,255,136,.1)}
.timing-pip.miss{border-color:var(--danger);color:var(--danger);background:rgba(255,68,68,.1)}

/* Trivia */
.trivia-area{margin-bottom:16px}
.trivia-question{font-size:1.1rem;color:var(--text);line-height:1.8;margin-bottom:16px;font-weight:700}
.trivia-options{display:flex;flex-direction:column;gap:10px}
.trivia-option{padding:14px 18px;background:var(--bg3);border:1px solid var(--card-border);border-radius:12px;cursor:pointer;font-size:.95rem;color:var(--text);transition:all .2s;text-align:left}
.trivia-option:hover{border-color:var(--accent);background:rgba(180,74,255,.08)}
.trivia-option.selected{border-color:var(--accent);background:rgba(180,74,255,.15)}

/* Logic */
.logic-area{margin-bottom:16px}
.logic-scenario{padding:20px;background:var(--bg2);border-radius:12px;line-height:2;font-size:.95rem;color:var(--text2);margin-bottom:16px}
.logic-scenario b{color:var(--text)}
.logic-choices{display:flex;flex-direction:column;gap:10px}
.logic-choice{padding:14px 18px;background:var(--bg3);border:1px solid var(--card-border);border-radius:12px;cursor:pointer;font-size:.95rem;color:var(--text);transition:all .2s}
.logic-choice:hover{border-color:var(--accent);background:rgba(180,74,255,.08)}
.logic-choice.selected{border-color:var(--cyan);background:rgba(0,229,255,.1)}

/* Skill Check */
.skillcheck-area{text-align:center;margin-bottom:16px}
.skillcheck-gauge{position:relative;width:200px;height:200px;margin:0 auto 16px}
.skillcheck-gauge svg{width:100%;height:100%}
.skillcheck-info{display:flex;justify-content:center;gap:16px;margin-bottom:12px;font-size:.9rem;color:var(--text2)}
.skillcheck-info b{color:var(--text)}
.skillcheck-btn{display:block;width:80%;margin:0 auto;padding:16px;background:linear-gradient(135deg,var(--accent),var(--cyan));color:#000;border:none;border-radius:12px;font-size:1.1rem;font-weight:700;cursor:pointer;font-family:inherit;transition:all .1s}
.skillcheck-btn:active{transform:scale(.97)}
.skillcheck-btn:disabled{opacity:.5;cursor:not-allowed}

/* Mini Sudoku */
.sudoku-area{margin-bottom:16px}
.sudoku-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:4px;max-width:280px;margin:0 auto 16px;background:var(--accent);padding:2px;border-radius:8px}
.sudoku-cell{width:100%;aspect-ratio:1;display:flex;align-items:center;justify-content:center;font-size:1.4rem;font-weight:900;background:var(--bg2);border-radius:4px}
.sudoku-cell.fixed{color:var(--text)}
.sudoku-cell input{width:100%;height:100%;background:transparent;border:2px solid var(--card-border);border-radius:4px;color:var(--cyan);font-size:1.4rem;font-weight:900;text-align:center;outline:none;font-family:inherit}
.sudoku-cell input:focus{border-color:var(--accent)}
.sudoku-cell input.correct{border-color:var(--success);color:var(--success)}
.sudoku-cell input.wrong{border-color:var(--danger);color:var(--danger)}
.sudoku-cell:nth-child(2n+1):nth-child(-n+8){border-right:none}
.sudoku-status{text-align:center;font-size:.9rem;color:var(--text2);min-height:24px;margin-top:8px}

/* Pipe Connect */
.pipe-area{margin-bottom:16px}
.pipe-grid{display:grid;gap:2px;max-width:320px;margin:0 auto 16px;background:var(--bg3);padding:4px;border-radius:8px}
.pipe-cell{aspect-ratio:1;background:var(--bg2);border-radius:4px;position:relative;cursor:pointer;transition:all .2s;overflow:hidden}
.pipe-cell:hover{background:rgba(180,74,255,.08)}
.pipe-cell.empty{cursor:default;background:var(--bg)}
.pipe-cell.start{box-shadow:inset 0 0 0 2px var(--success)}
.pipe-cell.end{box-shadow:inset 0 0 0 2px var(--danger)}
.pipe-seg{position:absolute;background:var(--cyan);border-radius:2px}
.pipe-seg-top{left:calc(50% - 3px);top:0;width:6px;height:calc(50% + 3px)}
.pipe-seg-right{top:calc(50% - 3px);right:0;width:calc(50% + 3px);height:6px}
.pipe-seg-bottom{left:calc(50% - 3px);bottom:0;width:6px;height:calc(50% + 3px)}
.pipe-seg-left{top:calc(50% - 3px);left:0;width:calc(50% + 3px);height:6px}
.pipe-center{position:absolute;left:calc(50% - 5px);top:calc(50% - 5px);width:10px;height:10px;border-radius:50%;background:var(--cyan)}
.pipe-status{text-align:center;font-size:.9rem;color:var(--text2);min-height:24px}

/* Wire Cutting */
.wire-area{margin-bottom:16px}
.wire-container{position:relative;padding:20px;background:var(--bg2);border-radius:12px;margin-bottom:12px}
.wire-line{display:flex;align-items:center;gap:12px;padding:12px 0;cursor:pointer;transition:all .2s;position:relative}
.wire-line:hover:not(.cut){filter:brightness(1.3)}
.wire-line .wire-visual{flex:1;height:8px;border-radius:4px;position:relative;overflow:hidden}
.wire-line .wire-visual::after{content:'';position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);animation:wireShine 2s infinite}
@keyframes wireShine{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}
.wire-line.cut .wire-visual{clip-path:polygon(0 0,45% 0,43% 100%,0 100%,0 0,57% 0,55% 100%,100% 100%,100% 0);opacity:.5}
.wire-line.cut{cursor:default;opacity:.6}
.wire-label{font-size:.85rem;font-weight:700;width:50px;text-align:center}
.wire-status{text-align:center;font-size:.9rem;min-height:24px}
.wire-status.error{color:var(--danger)}
.wire-status.success{color:var(--success)}
.wire-hint-text{text-align:center;color:var(--text2);font-size:.85rem;margin-bottom:12px;line-height:1.8}

/* Mastermind */
.mastermind-area{margin-bottom:16px}
.mastermind-history{max-height:280px;overflow-y:auto;margin-bottom:12px}
.mastermind-row{display:flex;align-items:center;gap:8px;padding:8px;background:var(--bg2);border-radius:8px;margin-bottom:4px}
.mastermind-guess{display:flex;gap:4px}
.mastermind-digit{width:36px;height:36px;border-radius:8px;background:var(--bg3);display:flex;align-items:center;justify-content:center;font-size:1.1rem;font-weight:700;color:var(--text)}
.mastermind-feedback{display:flex;gap:4px;margin-left:auto}
.mastermind-input{display:flex;gap:4px;justify-content:center;margin-bottom:12px}
.mastermind-input input{width:44px;height:44px;background:var(--bg3);border:2px solid var(--card-border);border-radius:10px;color:var(--cyan);font-size:1.3rem;font-weight:700;text-align:center;outline:none;font-family:inherit}
.mastermind-input input:focus{border-color:var(--accent)}
.mastermind-submit{display:block;width:60%;margin:0 auto;padding:12px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;border:none;border-radius:50px;font-weight:700;cursor:pointer;font-size:.95rem;font-family:inherit;transition:all .2s}
.mastermind-submit:hover{box-shadow:0 4px 15px rgba(180,74,255,.4)}
.mastermind-submit:disabled{opacity:.5;cursor:not-allowed}
.mastermind-info{text-align:center;font-size:.85rem;color:var(--text2);margin-bottom:12px}
.mastermind-status{text-align:center;font-size:.9rem;min-height:24px;margin-top:8px}

/* Memory Card */
.memory-area{margin-bottom:16px}
.memory-grid{display:grid;gap:8px;max-width:360px;margin:0 auto 16px}
.memory-card{aspect-ratio:1;background:var(--bg3);border:2px solid var(--card-border);border-radius:12px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:2rem;transition:all .3s;user-select:none}
.memory-card.hidden-card{background:linear-gradient(135deg,var(--accent2),var(--accent));border-color:var(--accent)}
.memory-card.hidden-card::after{content:'?';font-size:1.5rem;color:rgba(255,255,255,.5)}
.memory-card.revealed{border-color:var(--cyan);background:var(--bg2)}
.memory-card.matched{border-color:var(--success);background:rgba(0,255,136,.08);cursor:default}
.memory-info{text-align:center;font-size:.85rem;color:var(--text2);margin-bottom:12px}
.memory-status{text-align:center;font-size:.9rem;min-height:24px}

/* Simon */
.simon-area{text-align:center;margin-bottom:16px}
.simon-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;max-width:260px;margin:0 auto 16px}
.simon-btn{aspect-ratio:1;border-radius:16px;border:3px solid transparent;cursor:pointer;transition:all .15s;opacity:.6}
.simon-btn:active{transform:scale(.95)}
.simon-btn.active{opacity:1;transform:scale(1.05);box-shadow:0 0 20px currentColor}
.simon-btn.red{background:#c0392b;border-color:#e74c3c;color:#e74c3c}
.simon-btn.blue{background:#2980b9;border-color:#3498db;color:#3498db}
.simon-btn.green{background:#27ae60;border-color:#2ecc71;color:#2ecc71}
.simon-btn.yellow{background:#f39c12;border-color:#f1c40f;color:#f1c40f}
.simon-btn.disabled{pointer-events:none;opacity:.3}
.simon-info{font-size:.9rem;color:var(--text2);margin-bottom:12px}
.simon-status{font-size:.9rem;min-height:24px;margin-top:8px}

@media(max-width:600px){
  .hero h1{letter-spacing:.05em}
  .stats-bar{gap:24px}
  .result-stats{gap:12px}
  .series-card{padding:1.3rem}
  .chapter-timeline{padding-left:28px}
  .dial-ring{width:56px;height:56px;font-size:1.4rem}
  .flashlight-area{height:250px}
  .sudoku-grid{max-width:240px}
  .pipe-grid{max-width:260px}
  .simon-grid{max-width:220px}
  .memory-grid{max-width:300px}
  .mastermind-input input{width:38px;height:38px}
}
</style>
</head>
<body>

<div id="home">
  <div class="hero">
    <div class="particles" id="particles"></div>
    <h1>QUBE</h1>
    <p>ÌíÄÏñ¥Îùº. ÌÉàÏ∂úÌïòÎùº.</p>
    <button class="hero-cta" onclick="scrollToSeries()">ÏãúÎ¶¨Ï¶à ÏÑ†ÌÉùÌïòÍ∏∞</button>
    <div class="scroll-hint">‚Üì</div>
  </div>
  <div class="stats-bar">
    <div class="stat"><div class="stat-val" id="statCleared">0</div><div class="stat-label">ÌÅ¥Î¶¨Ïñ¥</div></div>
    <div class="stat"><div class="stat-val" id="statGrade">üî∞</div><div class="stat-label">Îì±Í∏â</div></div>
    <div class="stat"><div class="stat-val" id="statStreak">0</div><div class="stat-label">ÏãúÎ¶¨Ï¶à</div></div>
  </div>
  <div class="series-section" id="series-section">
    <h2>üìñ ÎØ∏Ïä§ÌÑ∞Î¶¨ ÏãúÎ¶¨Ï¶à</h2>
    <div class="series-progress-text" id="seriesProgressText"></div>
    <div id="seriesGrid"></div>
  </div>
</div>

<div id="chapters" class="hidden"></div>

<div class="loading-screen" id="loadingScreen">
  <div class="spinner"></div>
  <div class="loading-text">ÏßÑÏûÖ Ï§ë...</div>
</div>

<div id="game" class="hidden">
  <div class="game-header">
    <button class="game-back" onclick="confirmExit()">‚Üê</button>
    <div class="game-title" id="gameTitle"></div>
    <div class="game-progress-text" id="gameProgressText"></div>
  </div>
  <div class="progress-bar" id="progressBar"></div>
  <div id="gameContent"></div>
</div>

<div id="result" class="hidden">
  <div class="result-card" id="resultContent"></div>
</div>

<script>
var API = 'https://qube-api.harpy922.workers.dev';
var _activeTimingAnim = null;
var _activeSkillAnim = null;
var _activeSimonTimeout = null;
var _audioCtx = null;
function getAudioCtx(){if(!_audioCtx)try{_audioCtx=new(window.AudioContext||window.webkitAudioContext)()}catch(e){}return _audioCtx;}
function cleanupInteractive(){if(_activeTimingAnim){cancelAnimationFrame(_activeTimingAnim);_activeTimingAnim=null;}if(_activeSkillAnim){cancelAnimationFrame(_activeSkillAnim);_activeSkillAnim=null;}if(_activeSimonTimeout){clearTimeout(_activeSimonTimeout);_activeSimonTimeout=null;}}

/* ‚ïê‚ïê‚ïê Flashlight ‚ïê‚ïê‚ïê */
function initFlashlight(cfg){
  var area=document.getElementById('interactiveArea');
  var h='<div class="flashlight-hint-text">üî¶ Ïñ¥Îë† ÏÜçÏùÑ ÎπÑÏ∂∞ Ïà®Í≤®ÏßÑ Îã®ÏÑúÎ•º Ï∞æÏúºÏÑ∏Ïöî</div><div class="flashlight-area" id="flArea">';
  cfg.items.forEach(function(it){h+='<div class="flashlight-item" style="left:'+it.x+'%;top:'+it.y+'%">'+it.text+'</div>';});
  h+='<div class="flashlight-overlay" id="flOverlay"></div></div>';
  area.innerHTML=h;
  var el=document.getElementById('flArea'),ov=document.getElementById('flOverlay');
  function up(x,y){var r=el.getBoundingClientRect();ov.style.setProperty('--fx',(x-r.left)/r.width*100+'%');ov.style.setProperty('--fy',(y-r.top)/r.height*100+'%');}
  el.addEventListener('mousemove',function(e){up(e.clientX,e.clientY);});
  el.addEventListener('touchmove',function(e){e.preventDefault();up(e.touches[0].clientX,e.touches[0].clientY);},{passive:false});
}

/* ‚ïê‚ïê‚ïê Jigsaw ‚ïê‚ïê‚ïê */
function initJigsaw(cfg){
  var area=document.getElementById('interactiveArea');
  var sh='<div class="jigsaw-slots" style="grid-template-columns:repeat('+cfg.cols+',1fr)">';
  for(var i=0;i<cfg.pieces.length;i++)sh+='<div class="jigsaw-slot" data-slot="'+i+'" id="jslot'+i+'"><span>Ïä¨Î°Ø '+(i+1)+'</span></div>';
  sh+='</div>';
  var idx=cfg.pieces.map(function(_,i){return i;});
  for(var j=idx.length-1;j>0;j--){var k=Math.floor(Math.random()*(j+1)),t=idx[j];idx[j]=idx[k];idx[k]=t;}
  var th='<div class="jigsaw-tray" id="jigsawTray">';
  idx.forEach(function(pi){th+='<div class="jigsaw-piece" draggable="true" data-piece="'+pi+'" id="jpiece'+pi+'">'+cfg.pieces[pi]+'</div>';});
  th+='</div>';
  area.innerHTML=th+sh+'<div id="jigsawReveal"></div>';
  var placed={};
  document.querySelectorAll('.jigsaw-piece').forEach(function(p){
    p.addEventListener('dragstart',function(e){e.dataTransfer.setData('text/plain',p.dataset.piece);});
    var clone;
    p.addEventListener('touchstart',function(e){var tc=e.touches[0];clone=p.cloneNode(true);clone.style.cssText='position:fixed;z-index:999;opacity:.8;pointer-events:none;width:'+p.offsetWidth+'px;left:'+(tc.clientX-30)+'px;top:'+(tc.clientY-20)+'px';document.body.appendChild(clone);},{passive:true});
    p.addEventListener('touchmove',function(e){e.preventDefault();if(clone){clone.style.left=(e.touches[0].clientX-30)+'px';clone.style.top=(e.touches[0].clientY-20)+'px';}},{passive:false});
    p.addEventListener('touchend',function(e){if(clone){clone.remove();clone=null;}var el2=document.elementFromPoint(e.changedTouches[0].clientX,e.changedTouches[0].clientY);if(el2&&el2.classList.contains('jigsaw-slot'))handleDrop(el2,p.dataset.piece);});
  });
  document.querySelectorAll('.jigsaw-slot').forEach(function(s){
    s.addEventListener('dragover',function(e){e.preventDefault();s.classList.add('hover');});
    s.addEventListener('dragleave',function(){s.classList.remove('hover');});
    s.addEventListener('drop',function(e){e.preventDefault();s.classList.remove('hover');handleDrop(s,e.dataTransfer.getData('text/plain'));});
  });
  function handleDrop(slot,pid){
    var si=parseInt(slot.dataset.slot),pi=parseInt(pid);
    if(cfg.correctOrder[pi]===si){placed[pi]=true;slot.classList.add('correct');slot.innerHTML='<span style="color:var(--success)">'+cfg.pieces[pi]+'</span>';var pc=document.getElementById('jpiece'+pi);if(pc)pc.classList.add('placed');
      if(Object.keys(placed).length===cfg.pieces.length)document.getElementById('jigsawReveal').innerHTML='<div class="jigsaw-reveal">üß© '+cfg.revealText+'</div>';
    }else{slot.classList.add('hover');setTimeout(function(){slot.classList.remove('hover');},300);}
  }
}

/* ‚ïê‚ïê‚ïê Dial ‚ïê‚ïê‚ïê */
function initDial(cfg){
  var area=document.getElementById('interactiveArea');
  var h='<div class="dial-container"><div class="dial-row">';
  cfg.combination.forEach(function(_,i){
    h+='<div class="dial-digit"><div class="dial-arrows"><button class="dial-arrow" onclick="dialChange('+i+',1)">‚ñ≤</button></div>';
    h+='<div class="dial-ring" id="dialRing'+i+'" onclick="dialChange('+i+',1)">0</div>';
    h+='<div class="dial-arrows"><button class="dial-arrow" onclick="dialChange('+i+',-1)">‚ñº</button></div>';
    if(cfg.labels&&cfg.labels[i])h+='<div class="label">'+cfg.labels[i]+'</div>';
    h+='</div>';
  });
  h+='</div><button class="dial-lock-btn" onclick="dialCheck()">üîì ÏûêÎ¨ºÏá† Ïó¥Í∏∞</button><div class="dial-result" id="dialResult"></div></div>';
  area.innerHTML=h;
  window._dialValues=cfg.combination.map(function(){return 0;});
  window._dialTarget=cfg.combination;
}
function dialChange(i,dir){window._dialValues[i]=(window._dialValues[i]+dir+10)%10;document.getElementById('dialRing'+i).textContent=window._dialValues[i];}
function dialCheck(){
  var ok=true;for(var i=0;i<window._dialTarget.length;i++)if(window._dialValues[i]!==window._dialTarget[i])ok=false;
  var res=document.getElementById('dialResult');
  if(ok){res.innerHTML='<span style="color:var(--success)">üîì ÏûêÎ¨ºÏá†Í∞Ä Ïó¥Î†∏Îã§!</span>';setTimeout(function(){showFeedback(true,state.currentPuzzle);},800);}
  else{res.innerHTML='<span style="color:var(--danger)">Îî∏Íπç... Ïó¥Î¶¨ÏßÄ ÏïäÎäîÎã§.</span>';setTimeout(function(){res.innerHTML='';},1500);}
}

/* ‚ïê‚ïê‚ïê Timing ‚ïê‚ïê‚ïê */
function initTiming(cfg){
  var area=document.getElementById('interactiveArea');
  var zs=(cfg.zoneStart||0.35)*100,ze=(cfg.zoneEnd||0.55)*100,req=cfg.required||3;
  var h='<div class="timing-area"><div class="timing-progress" id="timingPips">';
  for(var i=0;i<req;i++)h+='<div class="timing-pip" id="tpip'+i+'">'+(i+1)+'</div>';
  h+='</div><div class="timing-track"><div class="timing-zone" style="left:'+zs+'%;width:'+(ze-zs)+'%"></div><div class="timing-cursor" id="timingCursor"></div></div>';
  h+='<button class="timing-btn" id="timingBtn" onclick="timingHit()">‚ö° ÌÉÄÏù¥Î∞ç ÎßûÏ∂îÍ∏∞!</button></div>';
  area.innerHTML=h;
  window._timingState={hits:0,required:req,zs:cfg.zoneStart||0.35,ze:cfg.zoneEnd||0.55,pos:0,dir:1,speed:cfg.speed||0.008,running:true,revealText:cfg.revealText||''};
  var cursor=document.getElementById('timingCursor');
  function anim(){if(!window._timingState.running)return;var s=window._timingState;s.pos+=s.dir*s.speed;if(s.pos>=1){s.pos=1;s.dir=-1;}if(s.pos<=0){s.pos=0;s.dir=1;}cursor.style.left=(s.pos*95)+'%';_activeTimingAnim=requestAnimationFrame(anim);}
  anim();
}
function timingHit(){
  var s=window._timingState;if(!s||!s.running)return;
  var inZ=s.pos>=s.zs&&s.pos<=s.ze,pip=document.getElementById('tpip'+s.hits);
  if(inZ){if(pip)pip.classList.add('hit');s.hits++;if(s.hits>=s.required){s.running=false;document.getElementById('timingBtn').disabled=true;document.getElementById('timingBtn').textContent='‚úÖ ÏÑ±Í≥µ!';setTimeout(function(){showFeedback(true,state.currentPuzzle);},800);}else s.speed+=0.003;}
  else{if(pip)pip.classList.add('miss');setTimeout(function(){s.hits=0;document.querySelectorAll('.timing-pip').forEach(function(p){p.classList.remove('hit','miss');});},500);}
}

/* ‚ïê‚ïê‚ïê Trivia ‚ïê‚ïê‚ïê */
function initTrivia(cfg){
  var area=document.getElementById('interactiveArea');
  var h='<div class="trivia-area"><div class="trivia-question">'+cfg.question+'</div><div class="trivia-options">';
  cfg.options.forEach(function(opt){h+='<div class="trivia-option" onclick="triviaSelect(this)">'+opt+'</div>';});
  h+='</div></div>';area.innerHTML=h;
}
function triviaSelect(el){document.querySelectorAll('.trivia-option').forEach(function(o){o.classList.remove('selected');});el.classList.add('selected');var inp=document.getElementById('answerInput');if(inp)inp.value=el.textContent.trim();}

/* ‚ïê‚ïê‚ïê Logic ‚ïê‚ïê‚ïê */
function initLogic(cfg){
  var area=document.getElementById('interactiveArea');
  var h='<div class="logic-area"><div class="logic-scenario">'+cfg.scenario+'</div><div class="logic-choices">';
  cfg.choices.forEach(function(ch){h+='<div class="logic-choice" onclick="logicSelect(this)">'+ch+'</div>';});
  h+='</div></div>';area.innerHTML=h;
}
function logicSelect(el){document.querySelectorAll('.logic-choice').forEach(function(o){o.classList.remove('selected');});el.classList.add('selected');var inp=document.getElementById('answerInput');if(inp)inp.value=el.textContent.trim();}

/* ‚ïê‚ïê‚ïê Skill Check ‚ïê‚ïê‚ïê */
function initSkillCheck(cfg){
  var area=document.getElementById('interactiveArea');
  var total=cfg.total||10,req=cfg.required||7,speed=cfg.speed||3,tgtSize=cfg.targetSize||15;
  var tgtStart=Math.floor(Math.random()*360);
  var h='<div class="skillcheck-area">';
  h+='<div class="skillcheck-gauge" id="scGauge"><svg viewBox="0 0 200 200">';
  h+='<circle cx="100" cy="100" r="85" fill="none" stroke="'+getComputedStyle(document.documentElement).getPropertyValue('--bg3').trim()+'" stroke-width="14"/>';
  var arcDeg=tgtSize/100*360;
  h+='<path d="'+describeArc(100,100,85,tgtStart,tgtStart+arcDeg)+'" fill="none" stroke="rgba(0,255,136,.4)" stroke-width="14" stroke-linecap="round"/>';
  h+='<line id="scNeedle" x1="100" y1="100" x2="100" y2="22" stroke="#b44aff" stroke-width="3" stroke-linecap="round"/>';
  h+='<circle cx="100" cy="100" r="6" fill="#b44aff"/>';
  h+='</svg></div>';
  h+='<div class="skillcheck-info"><span>ÏÑ±Í≥µ: <b id="scHits">0</b>/'+req+'</span><span>ÏãúÎèÑ: <b id="scTries">0</b>/'+total+'</span></div>';
  h+='<button class="skillcheck-btn" id="scBtn" onclick="skillCheckHit()">‚ö° ÌÅ¥Î¶≠!</button>';
  h+='<div class="skillcheck-info" id="scStatus"></div></div>';
  area.innerHTML=h;
  window._scState={total:total,required:req,speed:speed,tgtStart:tgtStart,tgtEnd:tgtStart+arcDeg,angle:0,hits:0,tries:0,running:true,answer:cfg.answer||''};
  var needle=document.getElementById('scNeedle');
  function anim(){if(!window._scState.running)return;var s=window._scState;s.angle=(s.angle+s.speed)%360;needle.setAttribute('transform','rotate('+s.angle+',100,100)');_activeSkillAnim=requestAnimationFrame(anim);}
  anim();
}
function describeArc(cx,cy,r,startAngle,endAngle){
  var s=startAngle-90,e=endAngle-90;
  var sr=s*Math.PI/180,er=e*Math.PI/180;
  var x1=cx+r*Math.cos(sr),y1=cy+r*Math.sin(sr),x2=cx+r*Math.cos(er),y2=cy+r*Math.sin(er);
  var large=(endAngle-startAngle)>180?1:0;
  return 'M '+x1+' '+y1+' A '+r+' '+r+' 0 '+large+' 1 '+x2+' '+y2;
}
function skillCheckHit(){
  var s=window._scState;if(!s||!s.running)return;
  s.tries++;
  var a=s.angle,ts=s.tgtStart%360,te=s.tgtEnd%360;
  var inZone=te>ts?(a>=ts&&a<=te):(a>=ts||a<=te);
  if(inZone)s.hits++;
  document.getElementById('scHits').textContent=s.hits;
  document.getElementById('scTries').textContent=s.tries;
  if(s.hits>=s.required){s.running=false;document.getElementById('scBtn').disabled=true;document.getElementById('scStatus').innerHTML='<span style="color:var(--success)">‚úÖ ÏÑ±Í≥µ!</span>';setTimeout(function(){showFeedback(true,state.currentPuzzle);},800);}
  else if(s.tries>=s.total){s.running=false;document.getElementById('scBtn').disabled=true;document.getElementById('scStatus').innerHTML='<span style="color:var(--danger)">‚ùå Ïã§Ìå®... Îã§Ïãú ÏãúÎèÑÌïòÏÑ∏Ïöî</span>';setTimeout(function(){var cfg=window._scState;initSkillCheck({total:cfg.total,required:cfg.required,speed:cfg.speed,targetSize:Math.round((cfg.tgtEnd-cfg.tgtStart)/360*100),answer:cfg.answer});},1500);}
}

/* ‚ïê‚ïê‚ïê Mini Sudoku ‚ïê‚ïê‚ïê */
function initSudoku(cfg){
  var area=document.getElementById('interactiveArea');
  var h='<div class="sudoku-area"><div class="sudoku-grid">';
  for(var r=0;r<4;r++)for(var c=0;c<4;c++){
    if(cfg.grid[r][c]!==0)h+='<div class="sudoku-cell fixed">'+cfg.grid[r][c]+'</div>';
    else h+='<div class="sudoku-cell"><input type="number" min="1" max="4" data-r="'+r+'" data-c="'+c+'" oninput="sudokuCheck()"></div>';
  }
  h+='</div><div class="sudoku-status" id="sudokuStatus">Îπà Ïπ∏Ïóê 1~4Î•º Ï±ÑÏö∞ÏÑ∏Ïöî (Ìñâ/Ïó¥/2√ó2 Î∏îÎ°ùÏóê Ï§ëÎ≥µ ÏóÜÏù¥)</div></div>';
  area.innerHTML=h;
  window._sudokuSolution=cfg.solution;
  window._sudokuAnswer=cfg.answer||'';
  window._sudokuSolved=false;
}
function sudokuCheck(){
  if(window._sudokuSolved) return;
  var sol=window._sudokuSolution,allCorrect=true,allFilled=true;
  document.querySelectorAll('.sudoku-cell input').forEach(function(inp){
    var v=parseInt(inp.value),r=parseInt(inp.dataset.r),c=parseInt(inp.dataset.c);
    if(!v||isNaN(v)){allFilled=false;inp.className='';return;}
    if(v===sol[r][c]){inp.className='correct';}else{inp.className='wrong';allCorrect=false;}
  });
  if(allFilled&&allCorrect){
    window._sudokuSolved=true;
    document.getElementById('sudokuStatus').innerHTML='<span style="color:var(--success)">‚úÖ Ïä§ÎèÑÏø† ÏôÑÏÑ±!</span>';
    document.querySelectorAll('.sudoku-cell input').forEach(function(inp){inp.disabled=true;});
    setTimeout(function(){showFeedback(true,state.currentPuzzle);},800);
  }
}

/* ‚ïê‚ïê‚ïê Pipe Connect ‚ïê‚ïê‚ïê */
function initPipe(cfg){
  var area=document.getElementById('interactiveArea');
  var sz=cfg.size;
  var h='<div class="pipe-area"><div class="pipe-grid" style="grid-template-columns:repeat('+sz+',1fr)">';
  for(var r=0;r<sz;r++)for(var c=0;c<sz;c++){
    var p=null;cfg.pipes.forEach(function(pp){if(pp.r===r&&pp.c===c)p=pp;});
    if(p){
      var cls='pipe-cell';
      if(cfg.start&&cfg.start.r===r&&cfg.start.c===c)cls+=' start';
      if(cfg.end&&cfg.end.r===r&&cfg.end.c===c)cls+=' end';
      h+='<div class="'+cls+'" data-r="'+r+'" data-c="'+c+'" onclick="pipeRotate(this)">';
      h+=getPipeHtml(p.type,p.initial);
      h+='</div>';
    }else{
      h+='<div class="pipe-cell empty"></div>';
    }
  }
  h+='</div><div class="pipe-status" id="pipeStatus">ÌååÏù¥ÌîÑÎ•º ÌÅ¥Î¶≠ÌïòÏó¨ ÌöåÏ†ÑÏãúÌÇ§ÏÑ∏Ïöî. ÏûÖÍµ¨‚ÜíÏ∂úÍµ¨Î•º Ïó∞Í≤∞!</div></div>';
  area.innerHTML=h;
  window._pipeState={pipes:cfg.pipes.map(function(p){return{r:p.r,c:p.c,type:p.type,rotation:p.initial,correct:p.correct};}),answer:cfg.answer||''};
}
function getPipeOpenings(type,rot){
  var r=rot%4;
  if(type==='straight')return r%2===0?{left:1,right:1}:{top:1,bottom:1};
  if(type==='corner'){var m=[{top:1,right:1},{right:1,bottom:1},{bottom:1,left:1},{left:1,top:1}];return m[r];}
  if(type==='tee'){var m2=[{left:1,top:1,right:1},{top:1,right:1,bottom:1},{right:1,bottom:1,left:1},{bottom:1,left:1,top:1}];return m2[r];}
  if(type==='cross')return{top:1,right:1,bottom:1,left:1};
  return{};
}
function getPipeHtml(type,rot){
  var o=getPipeOpenings(type,rot),h='<div class="pipe-center"></div>';
  if(o.top)h+='<div class="pipe-seg pipe-seg-top"></div>';
  if(o.right)h+='<div class="pipe-seg pipe-seg-right"></div>';
  if(o.bottom)h+='<div class="pipe-seg pipe-seg-bottom"></div>';
  if(o.left)h+='<div class="pipe-seg pipe-seg-left"></div>';
  return h;
}
function pipeRotate(el){
  var r=parseInt(el.dataset.r),c=parseInt(el.dataset.c),ps=window._pipeState;
  ps.pipes.forEach(function(p){if(p.r===r&&p.c===c){p.rotation=(p.rotation+1)%4;el.innerHTML=getPipeHtml(p.type,p.rotation);}});
  var allOk=true;
  ps.pipes.forEach(function(p){if(p.rotation!==p.correct)allOk=false;});
  if(allOk){
    document.getElementById('pipeStatus').innerHTML='<span style="color:var(--success)">‚úÖ ÌååÏù¥ÌîÑ Ïó∞Í≤∞ ÏôÑÎ£å!</span>';
    document.querySelectorAll('.pipe-cell:not(.empty)').forEach(function(c2){c2.style.pointerEvents='none';});
    setTimeout(function(){ showFeedback(true, state.currentPuzzle); }, 800);
  }
}

/* ‚ïê‚ïê‚ïê Wire Cutting ‚ïê‚ïê‚ïê */
function initWire(cfg){
  var area=document.getElementById('interactiveArea');
  var h='<div class="wire-area">';
  if(cfg.hintText)h+='<div class="wire-hint-text">'+cfg.hintText+'</div>';
  h+='<div class="wire-container" id="wireContainer">';
  cfg.wires.forEach(function(w,i){
    h+='<div class="wire-line" id="wire'+i+'" data-idx="'+i+'" onclick="wireCut('+i+')">';
    h+='<div class="wire-label" style="color:'+w.color+'">'+w.label+'</div>';
    h+='<div class="wire-visual" style="background:'+w.color+'"></div>';
    h+='</div>';
  });
  h+='</div><div class="wire-status" id="wireStatus">Ïò¨Î∞îÎ•∏ ÏàúÏÑúÎ°ú Ï†ÑÏÑ†ÏùÑ Ï†àÎã®ÌïòÏÑ∏Ïöî</div></div>';
  area.innerHTML=h;
  window._wireState={correctOrder:cfg.correctOrder,cutIdx:0,answer:cfg.answer||''};
}
function wireCut(idx){
  var s=window._wireState;if(!s)return;
  var el=document.getElementById('wire'+idx);
  if(el.classList.contains('cut'))return;
  if(idx===s.correctOrder[s.cutIdx]){
    el.classList.add('cut');s.cutIdx++;
    if(s.cutIdx>=s.correctOrder.length){
      document.getElementById('wireStatus').innerHTML='<span class="success" style="color:var(--success)">‚úÖ Î™®Îì† Ï†ÑÏÑ† Ìï¥Ï†ú ÏôÑÎ£å!</span>';
      setTimeout(function(){showFeedback(true,state.currentPuzzle);},800);
    }
  }else{
    document.getElementById('wireStatus').innerHTML='<span class="error" style="color:var(--danger)">üí• ÏûòÎ™ªÎêú ÏàúÏÑú! Îã§Ïãú ÏãúÎèÑ...</span>';
    setTimeout(function(){
      document.querySelectorAll('.wire-line').forEach(function(w){w.classList.remove('cut');});
      s.cutIdx=0;
      document.getElementById('wireStatus').textContent='Ïò¨Î∞îÎ•∏ ÏàúÏÑúÎ°ú Ï†ÑÏÑ†ÏùÑ Ï†àÎã®ÌïòÏÑ∏Ïöî';
    },1000);
  }
}

/* ‚ïê‚ïê‚ïê Mastermind ‚ïê‚ïê‚ïê */
function initMastermind(cfg){
  var area=document.getElementById('interactiveArea');
  var digits=cfg.digits||4,maxA=cfg.maxAttempts||8,maxN=cfg.maxNum||6;
  var h='<div class="mastermind-area">';
  h+='<div class="mastermind-info">'+digits+'ÏûêÎ¶¨ Ïà´ÏûêÎ•º ÎßûÏ∂îÏÑ∏Ïöî (1~'+maxN+'). ÏµúÎåÄ '+maxA+'Ìöå ÏãúÎèÑ.</div>';
  h+='<div class="mastermind-info">üü¢ Ïä§Ìä∏ÎùºÏù¥ÌÅ¨: ÏúÑÏπò+Ïà´Ïûê ÎßûÏùå | üü° Î≥º: Ïà´ÏûêÎßå ÎßûÏùå</div>';
  h+='<div class="mastermind-history" id="mmHistory"></div>';
  h+='<div class="mastermind-input" id="mmInput">';
  for(var i=0;i<digits;i++)h+='<input type="number" min="1" max="'+maxN+'" id="mmD'+i+'" onkeydown="mmKeyNav(event,'+i+','+digits+')">';
  h+='</div>';
  h+='<button class="mastermind-submit" id="mmBtn" onclick="mmSubmit()">Ï†úÏ∂ú</button>';
  h+='<div class="mastermind-status" id="mmStatus"></div></div>';
  area.innerHTML=h;
  window._mmState={answer:cfg.answer,digits:digits,maxAttempts:maxA,maxNum:maxN,attempts:0,answerStr:cfg.answerStr||''};
  document.getElementById('mmD0').focus();
}
function mmKeyNav(e,i,total){if(e.key>='1'&&e.key<='9'&&i<total-1)setTimeout(function(){document.getElementById('mmD'+(i+1)).focus();},50);}
function mmSubmit(){
  var s=window._mmState;if(!s)return;
  var guess=[];
  for(var i=0;i<s.digits;i++){var v=parseInt(document.getElementById('mmD'+i).value);if(!v||v<1||v>s.maxNum){document.getElementById('mmStatus').innerHTML='<span style="color:var(--danger)">1~'+s.maxNum+' Î≤îÏúÑÏùò Ïà´ÏûêÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî</span>';return;}guess.push(v);}
  s.attempts++;
  var strike=0,ball=0,ansUsed=[],guessUsed=[];
  for(var i2=0;i2<s.digits;i2++){if(guess[i2]===s.answer[i2]){strike++;ansUsed[i2]=true;guessUsed[i2]=true;}}
  for(var i3=0;i3<s.digits;i3++){if(guessUsed[i3])continue;for(var j=0;j<s.digits;j++){if(ansUsed[j])continue;if(guess[i3]===s.answer[j]){ball++;ansUsed[j]=true;break;}}}
  var h2='<div class="mastermind-row"><div class="mastermind-guess">';
  guess.forEach(function(g){h2+='<div class="mastermind-digit">'+g+'</div>';});
  h2+='</div><div class="mastermind-feedback">';
  for(var x=0;x<strike;x++)h2+='üü¢';for(var y=0;y<ball;y++)h2+='üü°';
  if(strike===0&&ball===0)h2+='‚úñ';
  h2+='</div></div>';
  document.getElementById('mmHistory').innerHTML+=h2;
  for(var i4=0;i4<s.digits;i4++)document.getElementById('mmD'+i4).value='';
  document.getElementById('mmD0').focus();
  if(strike===s.digits){
    document.getElementById('mmBtn').disabled=true;
    document.getElementById('mmStatus').innerHTML='<span style="color:var(--success)">‚úÖ Ï†ïÎãµ! '+s.attempts+'Ìöå ÎßåÏóê ÏÑ±Í≥µ!</span>';
    setTimeout(function(){showFeedback(true,state.currentPuzzle);},800);
  }else if(s.attempts>=s.maxAttempts){
    document.getElementById('mmBtn').disabled=true;
    document.getElementById('mmStatus').innerHTML='<span style="color:var(--danger)">‚ùå Ïã§Ìå®... Ï†ïÎãµ: '+s.answer.join('')+'</span>';
    setTimeout(function(){initMastermind({answer:s.answer,digits:s.digits,maxAttempts:s.maxAttempts,maxNum:s.maxNum,answerStr:s.answerStr});},2500);
  }else{
    document.getElementById('mmStatus').textContent='ÎÇ®ÏùÄ ÏãúÎèÑ: '+(s.maxAttempts-s.attempts)+'Ìöå';
  }
}

/* ‚ïê‚ïê‚ïê Memory Card ‚ïê‚ïê‚ïê */
function initMemory(cfg){
  var area=document.getElementById('interactiveArea');
  var cards=[],pairs=cfg.pairs;
  pairs.forEach(function(p,i){cards.push({id:i*2,pairId:i,emoji:p});cards.push({id:i*2+1,pairId:i,emoji:p});});
  for(var j=cards.length-1;j>0;j--){var k=Math.floor(Math.random()*(j+1)),t=cards[j];cards[j]=cards[k];cards[k]=t;}
  var cols=cards.length<=8?4:(cards.length<=12?4:5);
  var h='<div class="memory-area"><div class="memory-info">Ïπ¥ÎìúÎ•º Îí§ÏßëÏñ¥ Í∞ôÏùÄ ÏßùÏùÑ Ï∞æÏúºÏÑ∏Ïöî</div>';
  h+='<div class="memory-grid" style="grid-template-columns:repeat('+cols+',1fr)">';
  cards.forEach(function(c){h+='<div class="memory-card hidden-card" data-id="'+c.id+'" data-pair="'+c.pairId+'" data-emoji="'+c.emoji+'" onclick="memFlip(this)"></div>';});
  h+='</div><div class="memory-status" id="memStatus"></div></div>';
  area.innerHTML=h;
  window._memState={flipped:[],matched:0,total:pairs.length,locked:false,answer:cfg.answer||''};
}
function memFlip(el){
  var s=window._memState;if(!s||s.locked)return;
  if(el.classList.contains('revealed')||el.classList.contains('matched'))return;
  el.classList.remove('hidden-card');el.classList.add('revealed');el.textContent=el.dataset.emoji;
  s.flipped.push(el);
  if(s.flipped.length===2){
    s.locked=true;
    var a=s.flipped[0],b=s.flipped[1];
    if(a.dataset.pair===b.dataset.pair){
      a.classList.add('matched');b.classList.add('matched');
      s.matched++;s.flipped=[];s.locked=false;
      if(s.matched>=s.total){
        document.getElementById('memStatus').innerHTML='<span style="color:var(--success)">‚úÖ Î™®Îì† ÏßùÏùÑ Ï∞æÏïòÏäµÎãàÎã§!</span>';
        setTimeout(function(){showFeedback(true,state.currentPuzzle);},800);
      }
    }else{
      setTimeout(function(){
        a.classList.remove('revealed');a.classList.add('hidden-card');a.textContent='';
        b.classList.remove('revealed');b.classList.add('hidden-card');b.textContent='';
        s.flipped=[];s.locked=false;
      },800);
    }
  }
}

/* ‚ïê‚ïê‚ïê Simon ‚ïê‚ïê‚ïê */
function initSimon(cfg){
  var area=document.getElementById('interactiveArea');
  var rounds=cfg.rounds||5;
  var colors=['red','blue','green','yellow'];
  var labels=['Îπ®Í∞ï','ÌååÎûë','Ï¥àÎ°ù','ÎÖ∏Îûë'];
  var h='<div class="simon-area"><div class="simon-info" id="simonInfo">Ìå®ÌÑ¥ÏùÑ Í∏∞ÏñµÌïòÍ≥† Îî∞ÎùºÌïòÏÑ∏Ïöî! ('+rounds+'ÎùºÏö¥Îìú)</div>';
  h+='<div class="simon-grid">';
  colors.forEach(function(c,i){h+='<div class="simon-btn '+c+' disabled" id="simonBtn'+i+'" onclick="simonPress('+i+')"><br>'+labels[i]+'</div>';});
  h+='</div><div class="simon-status" id="simonStatus">Ï§ÄÎπÑ Ï§ë...</div></div>';
  area.innerHTML=h;
  var seq=[];
  for(var i=0;i<rounds;i++)seq.push(Math.floor(Math.random()*4));
  window._simonState={sequence:seq,round:1,playerPos:0,playing:false,answer:cfg.answer||''};
  setTimeout(function(){simonPlayRound();},800);
}
function simonPlayTone(idx){
  var ctx=getAudioCtx();if(!ctx)return;
  var freqs=[261.63,329.63,392,523.25];
  try{var osc=ctx.createOscillator(),gain=ctx.createGain();osc.connect(gain);gain.connect(ctx.destination);osc.frequency.value=freqs[idx];osc.type='sine';gain.gain.setValueAtTime(0.3,ctx.currentTime);gain.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+0.4);osc.start();osc.stop(ctx.currentTime+0.4);}catch(e){}
}
function simonFlash(idx,dur){
  var btn=document.getElementById('simonBtn'+idx);btn.classList.add('active');simonPlayTone(idx);
  setTimeout(function(){btn.classList.remove('active');},dur||400);
}
function simonPlayRound(){
  var s=window._simonState;if(!s)return;
  s.playing=true;s.playerPos=0;
  document.querySelectorAll('.simon-btn').forEach(function(b){b.classList.add('disabled');});
  document.getElementById('simonInfo').textContent='ÎùºÏö¥Îìú '+s.round+'/'+s.sequence.length+' ‚Äî Ìå®ÌÑ¥ÏùÑ Î≥¥ÏÑ∏Ïöî!';
  document.getElementById('simonStatus').textContent='';
  var i=0;
  function playNext(){
    if(i>=s.round){s.playing=false;document.querySelectorAll('.simon-btn').forEach(function(b){b.classList.remove('disabled');});document.getElementById('simonInfo').textContent='ÎùºÏö¥Îìú '+s.round+'/'+s.sequence.length+' ‚Äî Îî∞ÎùºÌïòÏÑ∏Ïöî!';return;}
    simonFlash(s.sequence[i],350);i++;
    _activeSimonTimeout=setTimeout(playNext,550);
  }
  _activeSimonTimeout=setTimeout(playNext,500);
}
function simonPress(idx){
  var s=window._simonState;if(!s||s.playing)return;
  simonFlash(idx,250);
  if(idx===s.sequence[s.playerPos]){
    s.playerPos++;
    if(s.playerPos>=s.round){
      if(s.round>=s.sequence.length){
        document.querySelectorAll('.simon-btn').forEach(function(b){b.classList.add('disabled');});
        document.getElementById('simonStatus').innerHTML='<span style="color:var(--success)">‚úÖ Î™®Îì† ÎùºÏö¥Îìú ÌÅ¥Î¶¨Ïñ¥!</span>';
        setTimeout(function(){showFeedback(true,state.currentPuzzle);},800);
      }else{
        s.round++;
        document.getElementById('simonStatus').innerHTML='<span style="color:var(--success)">‚úì ÏÑ±Í≥µ!</span>';
        setTimeout(function(){simonPlayRound();},800);
      }
    }
  }else{
    document.getElementById('simonStatus').innerHTML='<span style="color:var(--danger)">‚ùå ÌãÄÎ†∏ÏäµÎãàÎã§! Îã§Ïãú...</span>';
    document.querySelectorAll('.simon-btn').forEach(function(b){b.classList.add('disabled');});
    setTimeout(function(){s.round=1;simonPlayRound();},1200);
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   Series & Chapter Data
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
var SERIES = [
  {
    id:'professor', title:'ÏÇ¨ÎùºÏßÑ ÍµêÏàò', icon:'üîÆ', difficulty:1,
    desc:'Í≥†Í≥†Ìïô ÍµêÏàò ÍπÄÎèôÌòÑÏù¥ Î∞úÍµ¥ ÌòÑÏû•ÏóêÏÑú Ïã§Ï¢ÖÎêêÎã§. ÎÇ®ÏùÄ Í±¥ ÏïîÌò∏ÌôîÎêú Ïó∞Íµ¨ÎÖ∏Ìä∏ Ìïú Í∂åÎøê.',
    chapters:[
      {
        id:'ch1_study', title:'Ch.1 ‚Äî ÍµêÏàòÏùò ÏÑúÏû¨', desc:'Ïã§Ï¢Ö 3ÏùºÏß∏. ÏÑúÏû¨Ïóê Ïπ®ÏûÖÌï¥ Îã®ÏÑúÎ•º Ï∞æÎäîÎã§.', time:'12Î∂Ñ',
        intro:'ÍπÄÎèôÌòÑ ÍµêÏàòÍ∞Ä ÏÇ¨ÎùºÏ°åÎã§.\n3ÏùºÏß∏ Ïó∞ÎùΩ ÎëêÏ†à. Í≤ΩÏ∞∞ÏùÄ "ÏûêÎ∞úÏ†Å Ïû†Ï†Å"Ïù¥Îùº ÌñàÏßÄÎßå, ÎãπÏã†ÏùÄ ÎØøÏßÄ ÏïäÏïòÎã§.\nÎßàÏä§ÌÑ∞ÌÇ§Î°ú ÏÑúÏû¨Ïóê Îì§Ïñ¥ÏÑ† ÏàúÍ∞Ñ, Îì± Îí§ÏóêÏÑú Î¨∏Ïù¥ Ïû†Í≤ºÎã§.\nÌù¨ÎØ∏Ìïú Ïä§ÌÉ†Îìú Î∂àÎπõ ÏïÑÎûò, Í∏âÌïòÍ≤å Ï∞¢Í∏¥ ÏÑúÎ•òÏôÄ Ïì∞Îü¨ÏßÑ Ïª§ÌîºÏûî.\nÍµêÏàòÎäî Î≠îÍ∞ÄÎ•º Ïà®Í∏∞Îã§ Ï´ìÍ∏¥ Í≤ÉÏù¥Îã§.',
        puzzles:[
          { type:'interactive', interactionType:'trivia', title:'üìã ÌçºÏ¶ê 1: ÏÑúÎûçÏùò Ïû†Í∏àÏû•Ïπò',
            story:'Ï±ÖÏÉÅ ÏÑúÎûçÏóê Î≥¥Ïïà ÏßàÎ¨∏Ïù¥ Ï†ÅÌòÄ ÏûàÎã§.\n"Í≥†Í≥†ÌïôÏûêÎßåÏù¥ Ïó¥ Ïàò ÏûàÎã§."',
            config:{ question:'Í≥†Í≥†ÌïôÏóêÏÑú ÎÇòÏù¥ÌÖåÎ•º Ïù¥Ïö©ÌïòÏó¨ Ïú†Î¨ºÏùò Ïó∞ÎåÄÎ•º Ï∏°Ï†ïÌïòÎäî ÌïôÎ¨∏ÏùÄ?', options:['Ïó∞Î•úÏó∞ÎåÄÌïô','Ï∏µÏÑúÌïô','Ïú†ÌòïÌïô','Î∞©ÏÇ¨ÏÑ±ÌÉÑÏÜåÏ∏°Ï†ïÎ≤ï'] },
            hint:'ÎÇòÏù¥ÌÖå(Âπ¥Ëº™) = Ïó∞Î•ú. ÎÇòÏù¥ÌÖåÎ°ú Ïó∞ÎåÄÎ•º Ï∏°Ï†ïÌïòÎäî ÌïôÎ¨∏ = Ïó∞Î•úÏó∞ÎåÄÌïô.',
            validate:function(i){return i.trim()==='Ïó∞Î•úÏó∞ÎåÄÌïô'} },
          { type:'interactive', interactionType:'flashlight', title:'üî¶ ÌçºÏ¶ê 2: Ï†ïÏ†ÑÎêú ÏÑúÏû¨',
            story:'Í∞ëÏûêÍ∏∞ Ï†ïÏ†Ñ. ÏÜêÏ†ÑÎì±ÏùÑ Í∫ºÎÇ¥ Ïñ¥Îë† ÏÜçÏóêÏÑú Ìù©Ïñ¥ÏßÑ Í∏ÄÏûêÎ•º Ï∞æÏïÑÏïº ÌïúÎã§.',
            config:{ items:[
              {x:15, y:25, text:'Íµê'},{x:65, y:40, text:'Ïàò'},{x:35, y:70, text:'ÏßÄ'},{x:80, y:75, text:'ÎèÑ'},
              {x:50, y:15, text:'‚Üí ÎÑ§ Í∏ÄÏûêÎ•º Ï°∞Ìï©ÌïòÎùº'}
            ]},
            hint:'Íµê, Ïàò, ÏßÄ, ÎèÑ ‚Üí "ÍµêÏàòÏßÄÎèÑ" (ÍµêÏàòÏùò ÏßÄÎèÑ)',
            validate:function(i){return i.replace(/\s/g,'')==='ÍµêÏàòÏßÄÎèÑ'} },
          { type:'interactive', interactionType:'skill-check', title:'üîê ÌçºÏ¶ê 3: Î≤Ω ÏÜç Í∏àÍ≥†',
            story:'ÏÑúÏû¨ Î≤ΩÎ©¥Ïóê Ïà®Í≤®ÏßÑ Í∏àÍ≥†. Îã§Ïù¥ÏñºÏùÑ Ï†ïÎ∞ÄÌïòÍ≤å ÎßûÏ∂∞Ïïº ÌïúÎã§.\nÍ≤åÏù¥ÏßÄÏùò Ï¥àÎ°ù Íµ¨Í∞ÑÏóê ÎßûÏ∂∞ ÌÅ¥Î¶≠ÌïòÎùº.',
            config:{ total:10, required:5, speed:2, targetSize:20, answer:'Í∏àÍ≥†Ïó¥Î¶º' },
            hint:'Ï¥àÎ°ù Íµ¨Í∞ÑÏóê Î∞îÎäòÏù¥ ÏûàÏùÑ Îïå ÌÅ¥Î¶≠! 10Î≤à Ï§ë 5Î≤à ÏÑ±Í≥µÌïòÎ©¥ Îê©ÎãàÎã§.',
            validate:function(i){return i.trim()==='Í∏àÍ≥†Ïó¥Î¶º'} },
          { type:'interactive', interactionType:'jigsaw', title:'üìÑ ÌçºÏ¶ê 4: Ï∞¢Ïñ¥ÏßÑ Î©îÎ™®',
            story:'Í∏àÍ≥† ÏïàÏóêÏÑú Ï∞¢Ïñ¥ÏßÑ Î©îÎ™® Ï°∞Í∞ÅÏù¥ ÎÇòÏôîÎã§. Ïò¨Î∞îÎ•∏ ÏàúÏÑúÎ°ú ÎßûÏ∂îÎ©¥ Îã®ÏÑúÍ∞Ä ÎìúÎü¨ÎÇúÎã§.',
            config:{ pieces:['ÌôîÎ¨ºÏÑ†Ïóê','Ïó∞Íµ¨ ÏÉòÌîåÏùÑ','Ïã§ÏóàÎã§','ÏïÑÎ¶¨ÏïÑÌò∏'], cols:2,
              correctOrder:[1,0,2,3], revealText:'ÌÇ§ÏõåÎìú: "ÏïÑÎ¶¨ÏïÑÌò∏"' },
            hint:'Ï°∞Í∞ÅÏùÑ ÎßûÏ∂îÏÑ∏Ïöî: "Ïó∞Íµ¨ ÏÉòÌîåÏùÑ ÌôîÎ¨ºÏÑ†Ïóê Ïã§ÏóàÎã§ ÏïÑÎ¶¨ÏïÑÌò∏"',
            validate:function(i){return i.replace(/\s/g,'')==='ÏïÑÎ¶¨ÏïÑÌò∏'} },
          { type:'cpq', cpqIndex:0,
            story:'ÏàòÏ≤© ÎßàÏßÄÎßâ Ïû•Ïóê Îπ®Í∞Ñ ÎèôÍ∑∏ÎùºÎØ∏ Ïπú Ï£ºÏÜå.\n"Ïó¨Í∏∞Í∞Ä ÌïµÏã¨Ïù¥Îã§." ÍµêÏàòÍ∞Ä ÏÇ¨ÎùºÏßÄÍ∏∞ ÏßÅÏ†Ñ, ÎßàÏßÄÎßâÏúºÎ°ú Ìñ•ÌïòÎ†§Îçò Ïû•ÏÜå.',
            storyAfter:'ÏΩîÎìúÍ∞Ä ÎßûÏïòÎã§. ÏàòÏ≤© Îí∑ÌëúÏßÄ ÏïàÏ™Ω, ÍµêÏàòÏùò ÎßàÏßÄÎßâ Î©îÎ™®Í∞Ä ÎìúÎü¨ÎÇ¨Îã§.' }
        ],
        cliffhanger:'ÏàòÏ≤© Îí∑ÌëúÏßÄÎ•º Î≤óÍ∏∞Ïûê Ï†ëÌûå Ï¢ÖÏù¥Í∞Ä Îñ®Ïñ¥Ï°åÎã§.\nÎñ®Î¶¨Îäî ÏÜêÏúºÎ°ú ÌéºÏ≥§Îã§. ÍµêÏàòÏùò ÌïÑÏ≤¥.\n\n"Í∑∏Îì§Ïù¥ ÎÇòÎ•º Ï∞æÍ≥† ÏûàÎã§. Ïó∞Íµ¨ ÏÉòÌîåÏùÄ ÌôîÎ¨ºÏÑ†Ïóê Ïã§ÏóàÎã§."\n"ÏïÑÎ¶¨ÏïÑÌò∏... Ïù∏Ï≤úÌï≠ 2Î≤à ÏÑ†Ï∞©Ïû•..."\n\nÍµêÏàòÎäî Ïó¨Í∏∞ÏÑú Î∞∞Î•º ÌÉîÎã§.\nÍ∑∏Î¶¨Í≥† ÏÇ¨ÎùºÏ°åÎã§.'
      },
      {
        id:'ch2_ship', title:'Ch.2 ‚Äî ÌôîÎ¨ºÏÑ† ÏïÑÎ¶¨ÏïÑÌò∏', desc:'ÍµêÏàòÍ∞Ä ÎßàÏßÄÎßâÏúºÎ°ú ÌÉëÏäπÌïú Ïú†Î†π ÌôîÎ¨ºÏÑ†Ïóê Ïû†ÏûÖÌïúÎã§.', time:'14Î∂Ñ',
        intro:'Ïù∏Ï≤úÌï≠ 2Î≤à ÏÑ†Ï∞©Ïû•.\nÎÖπÏä® ÌôîÎ¨ºÏÑ† "ÏïÑÎ¶¨ÏïÑÌò∏"Í∞Ä ÏïàÍ∞ú ÏÜçÏóê Ï†ïÎ∞ïÌï¥ ÏûàÎã§.\nÏÑ†Ïõê 12Î™ÖÏù¥ ÌÉÄÍ≥† ÏûàÏóàÎã§. ÏßÄÍ∏àÏùÄ ÏïÑÎ¨¥ÎèÑ ÏóÜÎã§. Íµ¨Î™ÖÎ≥¥Ìä∏ÎèÑ, ÏÜåÏßÄÌíàÎèÑ Í∑∏ÎåÄÎ°úÏù∏ Ï±Ñ.\nÎãπÏã†Ïù¥ Í∞ëÌåêÏóê Ïò¨ÎùºÏÑ† ÏàúÍ∞Ñ, Ìï¥ÏπòÍ∞Ä Îã´ÌòîÎã§.\nÎπÑÏÉÅÎì±Îßå ÍπúÎπ°Ïù¥Í≥†, Ïñ¥ÎîòÍ∞ÄÏóêÏÑú Í∏àÏÜçÏù¥ ÏÇêÍ±±Í±∞Î¶∞Îã§.',
        puzzles:[
          { type:'interactive', interactionType:'dial', title:'üß≠ ÌçºÏ¶ê 1: ÏÑ†Ïû•Ïã§ Í∏àÍ≥†',
            story:'ÏÑ†Ïû•Ïã§. Í∏àÍ≥†Ïùò Îã§Ïù¥Ïñº Ïû†Í∏àÏû•Ïπò.\nÏÑ†Ïû• Ï±ÖÏÉÅ ÏúÑ Î©îÎ™®: "ÏÑ†Î∞ï Î≤àÌò∏Í∞Ä Ïó¥Ïá†Îã§. A-7-2-9"',
            config:{ combination:[7,2,9], labels:['Ï≤´Ïß∏','ÎëòÏß∏','ÏÖãÏß∏'] },
            hint:'Î©îÎ™®Ïóê Ï†ÅÌûå Ïà´Ïûê: 7, 2, 9Î•º Îã§Ïù¥ÏñºÏóê ÎßûÏ∂îÏÑ∏Ïöî.',
            validate:function(i){return i.trim()==='729'} },
          { type:'interactive', interactionType:'trivia', title:'üìª ÌçºÏ¶ê 2: ÏÑ†Ïû•Ïùò ÎπÑÏÉÅ Îß§Îâ¥Ïñº',
            story:'Í∏àÍ≥† Ïïà ÎπÑÏÉÅ Îß§Îâ¥ÏñºÏùò Ïû†Í∏àÏû•ÏπòÏóê ÏßàÎ¨∏Ïù¥ Ï†ÅÌòÄ ÏûàÎã§.\n"Î∞îÎã§Î•º ÏïÑÎäî ÏûêÎßå Ïó¥ Ïàò ÏûàÎã§."',
            config:{ question:'Íµ≠Ï†ú Ìï¥ÏÉÅÏóêÏÑú ÏùåÏÑ±ÏúºÎ°ú Ï°∞ÎÇú Ïã†Ìò∏Î•º Î≥¥ÎÇº Îïå ÏÇ¨Ïö©ÌïòÎäî Îã®Ïñ¥Îäî?', options:['Î©îÏù¥Îç∞Ïù¥','Î°úÏ†Ä','Ïò§Î≤Ñ','Î∏åÎùºÎ≥¥'] },
            hint:'Mayday! ÌîÑÎûëÏä§Ïñ¥ m\'aidez(ÎèÑÏôÄÏ£ºÏÑ∏Ïöî)ÏóêÏÑú Ïú†ÎûòÌïú Íµ≠Ï†ú Ï°∞ÎÇú Ïã†Ìò∏.',
            validate:function(i){var v=i.toUpperCase().trim();return v==='Î©îÏù¥Îç∞Ïù¥'||v==='MAYDAY'} },
          { type:'interactive', interactionType:'timing', title:'‚öì ÌçºÏ¶ê 3: Í∏∞Í¥ÄÏã§ Î∞∏Î∏å',
            story:'Í∏∞Í¥ÄÏã§. Í≥ºÏó¥ Í≤ΩÍ≥†Îì±Ïù¥ ÍπúÎπ°Ïù∏Îã§.\nÏ†ïÌôïÌïú ÌÉÄÏù¥Î∞çÏóê Î∞∏Î∏åÎ•º Ïû†Í∞ÄÏïº Ìè≠Î∞úÏùÑ ÎßâÏùÑ Ïàò ÏûàÎã§.',
            config:{ zoneStart:0.4, zoneEnd:0.6, required:3, speed:0.01, revealText:'ÌôîÎ¨ºÏ∞ΩÍ≥†' },
            hint:'Ï¥àÎ°ù Íµ¨Í∞ÑÏóê Ïª§ÏÑúÍ∞Ä ÏûàÏùÑ Îïå Î≤ÑÌäºÏùÑ ÎàÑÎ•¥ÏÑ∏Ïöî. 3Î≤à Ïó∞ÏÜç ÏÑ±Í≥µ!',
            validate:function(i){return i.replace(/\s/g,'')==='ÌôîÎ¨ºÏ∞ΩÍ≥†'} },
          { type:'interactive', interactionType:'flashlight', title:'üî¶ ÌçºÏ¶ê 4: ÌôîÎ¨º Ï∞ΩÍ≥†',
            story:'ÌôîÎ¨º Ï∞ΩÍ≥†Í∞Ä ÍπúÍπúÌïòÎã§. ÏÜêÏ†ÑÎì±ÏúºÎ°ú Î≤ΩÏóê Ìù©Ïñ¥ÏßÑ Í∏ÄÏûêÎ•º Ï∞æÏïÑÎùº.',
            config:{ items:[
              {x:15, y:20, text:'Ïù∏'},{x:55, y:55, text:'Ï≤¥'},{x:80, y:30, text:'Ï°∞'},{x:35, y:75, text:'ÏßÅ'},
              {x:50, y:15, text:'‚Üí ÎÑ§ Í∏ÄÏûêÎ•º Ï°∞Ìï©'}
            ]},
            hint:'Ïù∏, Ï≤¥, Ï°∞, ÏßÅ ‚Üí "Ïù∏Ï≤¥Ï°∞ÏßÅ"',
            validate:function(i){return i.replace(/\s/g,'')==='Ïù∏Ï≤¥Ï°∞ÏßÅ'} },
          { type:'cpq', cpqIndex:0,
            story:'Í∏∞Í¥ÄÏû•Ïùò ÎÖ∏Ìä∏ ÎßàÏßÄÎßâ ÌéòÏù¥ÏßÄ.\n"ÌôîÎ¨º #7Ïùò ÏßÑÏßú Î∞úÏÜ°ÏßÄÎ•º Ï∞æÏïòÎã§. Ïù¥ Ï£ºÏÜåÎã§."',
            storyAfter:'ÎßûÏïòÎã§. Í∏∞Í¥ÄÏû•Ïùò ÎßàÏßÄÎßâ Í∏∞Î°ùÏù¥ Ìï¥ÎèÖÎêêÎã§.' }
        ],
        cliffhanger:'Í∏∞Í¥ÄÏû•Ïùò ÎßàÏßÄÎßâ Í∏∞Î°ù.\n\n"ÌôîÎ¨º #7 ÏïàÏóê Îì† Í±¥ ÍµêÏàòÏùò Ïó∞Íµ¨ ÏÉòÌîåÏù¥ ÏïÑÎãàÏóàÎã§.\nÏù∏Ï≤¥ Ï°∞ÏßÅÏù¥ÏóàÎã§."\n\nÏ†ÅÌïò Î™©Î°ù Îí∑Î©¥, Î∞∞ÏÜ°ÏßÄ Ï£ºÏÜåÍ∞Ä Ï†ÅÌòÄ ÏûàÎã§.\n\n"Í∑∏ÎûúÎìú ÌååÌÅ¨ Ìò∏ÌÖî 1408Ìò∏ ‚Äî VIP Ï†ÑÏö© Î∞∞ÏÜ°"\n\nÍµêÏàòÎäî Ïù¥Í±∏ ÏïåÍ≥† ÏûàÏóàÎã§. Í∑∏ÎûòÏÑú Ï´ìÍ∏¥ Í≤ÉÏù¥Îã§.'
      },
      {
        id:'ch3_hotel', title:'Ch.3 ‚Äî Ìò∏ÌÖî Ïä§ÏúÑÌä∏Î£∏', desc:'5ÏÑ±Í∏â Ìò∏ÌÖî 1408Ìò∏. ÍµêÏàòÍ∞Ä ÎßàÏßÄÎßâÏúºÎ°ú Î™©Í≤©Îêú Í≥≥.', time:'15Î∂Ñ',
        intro:'Í∑∏ÎûúÎìú ÌååÌÅ¨ Ìò∏ÌÖî. Î°úÎπÑÏùò ÏÉπÎì§Î¶¨ÏóêÍ∞Ä Ï∞®Í∞ëÍ≤å ÎπõÎÇúÎã§.\n1408Ìò∏. VIP Ï†ÑÏö© Ïä§ÏúÑÌä∏Î£∏. ÍµêÏàòÍ∞Ä ÎßàÏßÄÎßâÏúºÎ°ú Î™©Í≤©Îêú Í≥≥.\nÏπ¥ÎìúÌÇ§Î•º ÎåÄÏûê Î¨∏Ïù¥ Ïó¥Î†∏Îã§. ÏïàÏóê Îì§Ïñ¥ÏÑúÎäî ÏàúÍ∞Ñ, ÏûêÎèô Ïû†Í∏à.\nÏπ®ÎåÄÎäî Ï†ïÎèàÎêòÏñ¥ ÏûàÏßÄÎßå, ÏöïÏã§ÏóêÏÑú Ìù¨ÎØ∏Ìïú Î¨ºÏÜåÎ¶¨Í∞Ä Îì§Î¶∞Îã§.\nÎàÑÍµ∞Í∞Ä Ïó¨Í∏∞ ÏûàÏóàÎã§. ÏïÑÏ£º ÏµúÍ∑ºÍπåÏßÄ.',
        puzzles:[
          { type:'interactive', interactionType:'trivia', title:'üîë ÌçºÏ¶ê 1: ÎÖ∏Ìä∏Î∂ÅÏùò Î≥¥Ïïà ÏßàÎ¨∏',
            story:'Ï±ÖÏÉÅ ÏúÑ ÎÖ∏Ìä∏Î∂Å. Ïû†Í∏à ÌôîÎ©¥Ïóê Î≥¥Ïïà ÏßàÎ¨∏Ïù¥ Îñ† ÏûàÎã§.\n"Ïù¥ Ìò∏ÌÖîÏóê 13Ï∏µÏù¥ ÏóÜÎäî Ïù¥Ïú†. Í∑∏ Í≥µÌè¨Ï¶ùÏùò Ïù¥Î¶ÑÏùÄ?"',
            config:{ question:'Ïà´Ïûê 13Ïóê ÎåÄÌïú Í≥µÌè¨Ï¶ùÏùÑ Î¨¥ÏóáÏù¥Îùº ÌïòÎäîÍ∞Ä?', options:['Ìä∏Î¶¨Ïä§Ïπ¥Ïù¥Îç∞Ïπ¥Ìè¨ÎπÑÏïÑ','ÌÅ¥ÎùºÏö∞Ïä§Ìä∏Î°úÌè¨ÎπÑÏïÑ','ÏïÑÌÅ¨Î°úÌè¨ÎπÑÏïÑ','ÏïÑÍ≥†ÎùºÌè¨ÎπÑÏïÑ'] },
            hint:'Triskaidekaphobia. Í∑∏Î¶¨Ïä§Ïñ¥ÏóêÏÑú Ïú†ÎûòÌïú 13 Í≥µÌè¨Ï¶ù.',
            validate:function(i){return i.replace(/\s/g,'').indexOf('Ìä∏Î¶¨Ïä§Ïπ¥Ïù¥Îç∞Ïπ¥Ìè¨ÎπÑÏïÑ')!==-1} },
          { type:'interactive', interactionType:'logic', title:'üíª ÌçºÏ¶ê 2: CCTV Ï¶ùÏñ∏ Î∂ÑÏÑù',
            story:'ÎÖ∏Ìä∏Î∂ÅÏù¥ Ïó¥Î†∏Îã§. CCTV Ï¶ùÏñ∏Ïù¥ ÏóáÍ∞àÎ¶∞Îã§.',
            config:{ scenario:'<b>ÌîÑÎ°†Ìä∏ ÏßÅÏõê A</b>: "1408Ìò∏ Ìà¨ÏàôÍ∞ùÏùÄ ÌòºÏûê Îì§Ïñ¥Í∞îÏäµÎãàÎã§."<br><b>Ï≤≠ÏÜåÎ∂Ä B</b>: "AÍ∞Ä Í±∞ÏßìÎßêÏùÑ Ìï©ÎãàÎã§."<br><b>Í≤ΩÎπÑÏõê C</b>: "BÏùò ÎßêÏù¥ ÎßûÏäµÎãàÎã§."<br><br>A, B, C Ï§ë Ìïú Î™ÖÎßå Í±∞ÏßìÎßêÏüÅÏù¥Îã§. Í±∞ÏßìÎßêÏüÅÏù¥Îäî?',
              choices:['A','B','C'] },
            hint:'BÏôÄ CÎäî ÏÑúÎ°úÏùò ÎßêÏùÑ ÏßÄÏßÄÌïúÎã§. AÎßå Îã§Î•∏ Ï£ºÏû•. AÍ∞Ä Í±∞ÏßìÎßêÏüÅÏù¥.',
            validate:function(i){return i.toUpperCase().trim()==='A'} },
          { type:'interactive', interactionType:'flashlight', title:'ü™û ÌçºÏ¶ê 3: ÏöïÏã§Ïùò Î©îÏãúÏßÄ',
            story:'ÏöïÏã§Ïù¥ ÍπúÍπúÌïòÎã§. ÏÜêÏ†ÑÎì±ÏúºÎ°ú ÍπÄ ÏÑúÎ¶∞ Í±∞Ïö∏ÏùÑ ÎπÑÏ∂∞Ïïº ÌïúÎã§.',
            config:{ items:[
              {x:20, y:35, text:'ÎπÑ'},{x:45, y:55, text:'Î∞Ä'},{x:65, y:25, text:'ÌÜµ'},{x:85, y:70, text:'Î°ú'},
              {x:50, y:85, text:'‚Üí ÎÑ§ Í∏ÄÏûêÎ•º Ï°∞Ìï©'}
            ]},
            hint:'ÎπÑ, Î∞Ä, ÌÜµ, Î°ú ‚Üí "ÎπÑÎ∞ÄÌÜµÎ°ú"',
            validate:function(i){return i.replace(/\s/g,'')==='ÎπÑÎ∞ÄÌÜµÎ°ú'} },
          { type:'interactive', interactionType:'dial', title:'üîí ÌçºÏ¶ê 4: ÏöïÏã§ ÌÉÄÏùº Î∞ë Í∏àÍ≥†',
            story:'ÏöïÏã§ ÌÉÄÏùº Î∞ëÏóê Í∏àÍ≥†. Îã§Ïù¥Ïñº Ïû†Í∏à.\nÌé∏ÏßÄÏóê Î©îÎ™®: "Î∞© Î≤àÌò∏Î•º Í±∞Íæ∏Î°ú. 1-4-0-8Ïùò Ïó≠Ïàú."',
            config:{ combination:[8,0,4,1], labels:['1Î≤à','2Î≤à','3Î≤à','4Î≤à'] },
            hint:'1408Ïùò Ïó≠Ïàú = 8, 0, 4, 1',
            validate:function(i){return i.trim()==='8041'} },
          { type:'cpq', cpqIndex:0,
            story:'Í∏àÍ≥† Ïïà Î¥âÌà¨. ÍµêÏàòÏùò Ìé∏ÏßÄ.\n"Ïù¥ Ìò∏ÌÖîÏùÄ Í±∞Ï†êÏù¥Îã§. ÏßÑÏßú Î™©Ï†ÅÏßÄÏùò ÏúÑÏπòÎ•º ÎÇ®Í∏¥Îã§."',
            storyAfter:'Ìé∏ÏßÄÏùò ÎßàÏßÄÎßâ Ï§ÑÏù¥ ÎìúÎü¨ÎÇ¨Îã§.' }
        ],
        cliffhanger:'Ìé∏ÏßÄÏùò ÎßàÏßÄÎßâ Ï§Ñ.\n\n"ÎÇòÎäî ÎèÑÎßùÏπú Í≤å ÏïÑÎãàÎã§. Í∞êÍ∏àÎãπÌñàÎã§."\n"Ïπ®ÎåÄ Ìó§ÎìúÎ≥¥Îìú Îí§Ïóê ÎπÑÎ∞Ä ÌÜµÎ°úÍ∞Ä ÏûàÎã§. ÌïòÏßÄÎßå Ïó¥ÏßÄ ÎßàÎùº."\n"Í∑∏Îì§Ïù¥ Í∏∞Îã§Î¶¨Í≥† ÏûàÎã§."\n\nÌó§ÎìúÎ≥¥ÎìúÎ•º Î∞ÄÏûê Ï∞®Í∞ÄÏö¥ Î∞îÎûåÏù¥ Î∂àÏñ¥ÏôîÎã§.\nÌÜµÎ°ú Î≤ΩÏóê ÏÇ¨ÏßÑ Ìïú Ïû•Ïù¥ Î∂ôÏñ¥ÏûàÎã§.\nÍµêÏàòÏôÄ Ìï®Íªò Ï∞çÌûå ÎÇ®Ïûê ‚Äî ÎßàÏà†ÏÇ¨ ÏµúÌòÑÏö∞.\n\nÏÇ¨ÏßÑ Îí∑Î©¥: "Í∑∏ÎèÑ ÏÇ¨ÎùºÏ°åÎã§. Ïö∞Î¶¨Îäî Í∞ôÏùÄ Í≤ÉÏùÑ Î∞úÍ≤¨ÌñàÎã§."'
      }
    ]
  },
  {
    id:'magician', title:'ÎßàÏà†ÏÇ¨Ïùò Ïú†ÏÇ∞', icon:'üé≠', difficulty:2,
    desc:'Ï†ÑÏÑ§Ïùò ÎßàÏà†ÏÇ¨ ÏµúÌòÑÏö∞Í∞Ä Í≥µÏó∞ Ï§ë ÏÇ¨ÎùºÏ°åÎã§. Ïú†Ïñ∏Ïû•ÏóêÎäî "ÎßàÏßÄÎßâ Ìä∏Î¶≠ÏùÑ ÌíÄÏñ¥Îùº"Í≥†Îßå Ï†ÅÌòÄÏûàÎã§.',
    chapters:[
      {
        id:'ch1_magic', title:'Ch.1 ‚Äî ÎßàÏà†ÏÇ¨Ïùò ÎπÑÎ∞Ä Î∞©', desc:'ÏµúÌòÑÏö∞Ïùò Í∞úÏù∏ Ïó∞ÏäµÏã§. Î¨¥ÎåÄÏû•ÏπòÏôÄ Í±∞Ïö∏Î°ú Í∞ÄÎìùÌïú Î∞©.', time:'12Î∂Ñ',
        intro:'ÎßàÏà†ÏÇ¨ ÏµúÌòÑÏö∞. "ÎåÄÌÉàÏ∂ú" Í≥µÏó∞ Ï§ë ÏÇ¨ÎùºÏ°åÎã§.\nÏùºÏ£ºÏùºÏß∏ ÌñâÎ∞©Î∂àÎ™Ö. Í≤ΩÏ∞∞ÏùÄ "ÏûêÏûëÍ∑π"Ïù¥Îùº Í≤∞Î°† ÎÇ¥Î†∏Îã§.\nÌïòÏßÄÎßå ÍµêÏàòÏùò ÏÇ¨ÏßÑÏù¥ Î™®Îì† Í±∏ Î∞îÍø®Îã§.\nÍ∑πÏû• Îí§Ìé∏ ÎπÑÎ∞Ä Î∞©Ïóê Ïû†ÏûÖÌñàÏßÄÎßå, ÎßàÏà† Ïû•ÏπòÍ∞Ä ÏûëÎèôÌïòÎ©∞ Î¨∏Ïù¥ Î¥âÏáÑÎêêÎã§.\nÏò§Î•¥Í≥®Ïù¥ Ïö∏Î¶∞Îã§. ÏµúÌòÑÏö∞Ïùò Î™©ÏÜåÎ¶¨: "ÏßÑÏßú ÌÉêÏ†ïÏù¥ÎùºÎ©¥ Ïù¥Í≤ÉÏùÑ ÌíÄÏñ¥Îùº."',
        puzzles:[
          { type:'interactive', interactionType:'logic', title:'üé© ÌçºÏ¶ê 1: ÏÑ∏ Í∞úÏùò ÏÉÅÏûê',
            story:'ÏÑ∏ Í∞úÏùò ÏÉÅÏûêÍ∞Ä ÎÇòÌÉÄÎÇ¨Îã§. ÏµúÌòÑÏö∞Ïùò Î™©ÏÜåÎ¶¨: "ÌïòÎÇòÏóêÎßå Ïó¥Ïá†Í∞Ä ÏûàÎã§."',
            config:{ scenario:'<b>Í∏àÏÉâ ÏÉÅÏûê</b>Ïóê Ï†ÅÌûå Í∏Ä: "Ïó¥Ïá†Îäî Ïù¥ ÏïàÏóê ÏóÜÎã§."<br><b>ÏùÄÏÉâ ÏÉÅÏûê</b>Ïóê Ï†ÅÌûå Í∏Ä: "Ïó¥Ïá†Îäî Í∏àÏÉâ ÏÉÅÏûêÏóê ÏûàÎã§."<br><b>ÎèôÏÉâ ÏÉÅÏûê</b>Ïóê Ï†ÅÌûå Í∏Ä: "Ïó¥Ïá†Îäî Ïù¥ ÏïàÏóê ÏóÜÎã§."<br><br>ÏÑ∏ Î¨∏Ïû• Ï§ë Ï†ïÌôïÌûà ÌïòÎÇòÎßå Ï∞∏Ïù¥Îã§. Ïó¥Ïá†Îäî Ïñ¥ÎîîÏóê?',
              choices:['Í∏àÏÉâ','ÏùÄÏÉâ','ÎèôÏÉâ'] },
            hint:'Í∏àÏÉâÏù¥ Ï∞∏Ïù¥Î©¥("ÏóÜÎã§") ‚Üí Ïó¥Ïá†‚â†Í∏àÏÉâ ‚Üí ÏùÄÏÉâ Í±∞Ïßì ‚Üí Ïó¥Ïá†‚â†Í∏àÏÉâ OK. ÎèôÏÉâ Í±∞Ïßì ‚Üí Ïó¥Ïá†=ÎèôÏÉâ. Ï∞∏ 1Í∞ú. Ï†ïÎãµ: ÎèôÏÉâ.',
            validate:function(i){return i.trim()==='ÎèôÏÉâ'} },
          { type:'interactive', interactionType:'pipe-connect', title:'‚ö° ÌçºÏ¶ê 2: Î¨¥ÎåÄ Ï†ÑÍ∏∞ Î∞∞ÏÑ†',
            story:'Î¨¥ÎåÄ Ï°∞Î™ÖÏù¥ Ï£ΩÏóàÎã§. Ï†ÑÍ∏∞ Î∞∞ÏÑ† ÌååÏù¥ÌîÑÎ•º Ïó∞Í≤∞Ìï¥Ïïº ÌïúÎã§.\nÌååÏù¥ÌîÑÎ•º ÌÅ¥Î¶≠ÌïòÏó¨ ÌöåÏ†ÑÏãúÏºú ÏûÖÍµ¨ÏóêÏÑú Ï∂úÍµ¨ÍπåÏßÄ Ïó∞Í≤∞ÌïòÎùº.',
            config:{ size:4, answer:'Î∞∞ÏÑ†ÏôÑÎ£å',
              start:{r:0,c:0}, end:{r:3,c:3},
              pipes:[
                {r:0,c:0,type:'straight',initial:1,correct:0},
                {r:0,c:1,type:'corner',initial:0,correct:2},
                {r:1,c:1,type:'straight',initial:0,correct:1},
                {r:2,c:1,type:'corner',initial:2,correct:0},
                {r:2,c:2,type:'straight',initial:1,correct:0},
                {r:2,c:3,type:'corner',initial:0,correct:2},
                {r:3,c:3,type:'corner',initial:2,correct:0}
              ] },
            hint:'ÏûÖÍµ¨(Ï¢åÏÉÅ)‚ÜíÏ∂úÍµ¨(Ïö∞Ìïò). ÌååÏù¥ÌîÑÎ•º ÌÅ¥Î¶≠ÌïòÏó¨ Ïò¨Î∞îÎ•∏ Î∞©Ìñ•ÏúºÎ°ú ÌöåÏ†Ñ!',
            validate:function(i){return i.trim()==='Î∞∞ÏÑ†ÏôÑÎ£å'} },
          { type:'interactive', interactionType:'memory-card', title:'üÉè ÌçºÏ¶ê 3: ÎßàÏà† Ïπ¥Îìú Îß§Ïπ≠',
            story:'ÌÖåÏù¥Î∏î ÏúÑÏóê Îí§ÏßëÌûå Ïπ¥ÎìúÎì§. Í∞ôÏùÄ ÏßùÏùÑ ÎßûÏ∂îÎ©¥ Ïà®Í≤®ÏßÑ Îã®ÏÑúÍ∞Ä ÎìúÎü¨ÎÇúÎã§.',
            config:{ pairs:['üé©','ü™Ñ','üê∞','üé≠','üîÆ'], answer:'ÎåÄÌÉàÏ∂ú' },
            hint:'Ïπ¥ÎìúÎ•º Îí§ÏßëÏñ¥ Í∞ôÏùÄ Ïù¥Î™®ÏßÄ ÏßùÏùÑ Ï∞æÏúºÏÑ∏Ïöî. 5Ïåç Î™®Îëê Îß§Ïπ≠!',
            validate:function(i){return i.replace(/\s/g,'')==='ÎåÄÌÉàÏ∂ú'} },
          { type:'interactive', interactionType:'timing', title:'‚è± ÌçºÏ¶ê 4: ÌÉàÏ∂ú Ïû•Ïπò ÌÉÄÏù¥Î∞ç',
            story:'Î≤ΩÏù¥ Ï≤úÏ≤úÌûà Ï¢ÅÏïÑÏßÄÍ≥† ÏûàÎã§!\nÏ†ïÌôïÌïú ÌÉÄÏù¥Î∞çÏóê Î†àÎ≤ÑÎ•º ÎãπÍ≤® ÌÉàÏ∂ú Ïû•ÏπòÎ•º ÏûëÎèôÏãúÏºúÎùº.',
            config:{ zoneStart:0.35, zoneEnd:0.55, required:3, speed:0.01, revealText:'ÎπÑÎ∞ÄÎ∞©' },
            hint:'Ï¥àÎ°ù Íµ¨Í∞ÑÏóê Ïª§ÏÑúÍ∞Ä Ïò¨ Îïå ÌÅ¥Î¶≠! 3Î≤à Ïó∞ÏÜç ÏÑ±Í≥µÌïòÏÑ∏Ïöî.',
            validate:function(i){return i.replace(/\s/g,'')==='ÎπÑÎ∞ÄÎ∞©'} },
          { type:'cpq', cpqIndex:0,
            story:'"ÎåÄÌÉàÏ∂úÏùÄ Í≥µÏó∞Ïù¥ ÏïÑÎãàÏóàÎã§."\nÏµúÌòÑÏö∞Í∞Ä ÎßàÏßÄÎßâÏúºÎ°ú Ìñ•ÌïòÎ†§Îçò Ïû•ÏÜåÏùò Îã®ÏÑú.',
            storyAfter:'ÎèÑÍµ¨Ìï® Ïù¥Ï§ëÎ∞îÎã• ÏïÑÎûò, Î¥âÌà¨ ÌïòÎÇòÍ∞Ä ÎÇòÏôîÎã§.' }
        ],
        cliffhanger:'Î¥âÌà¨ ÏïàÏóêÎäî ÎπõÎ∞îÎûú Ï°∏ÏóÖÏï®Î≤î Ìïú ÌéòÏù¥ÏßÄ.\nÏÑ∏Ï¢ÖÍ≥†Îì±ÌïôÍµê 3ÌïôÎÖÑ 2Î∞ò, 1994ÎÖÑ.\n\nÏÑ∏ Î™ÖÏóêÍ≤å ÎèôÍ∑∏ÎùºÎØ∏Í∞Ä Ï≥êÏ†∏ ÏûàÎã§.\nÍπÄÎèôÌòÑ. ÏµúÌòÑÏö∞. Í∑∏Î¶¨Í≥† ÏÑ∏ Î≤àÏß∏ ÏÇ¨Îûå ‚Äî Ïù¥Î¶ÑÏù¥ ÍπåÎß£Í≤å ÏßÄÏõåÏ†∏ ÏûàÎã§.\n\nÏï®Î≤î Ïó¨Î∞±Ïóê ÏµúÌòÑÏö∞Ïùò Í∏ÄÏî®:\n"Ïö∞Î¶¨ ÏÖãÏùÄ Í∞ôÏùÄ Í±∏ Î¥§Îã§. Í∑∏ÎÇ† Î∞§, ÌïôÍµêÏóêÏÑú."\n\n1994ÎÖÑ ÏÑ∏Ï¢ÖÍ≥†. ÌôîÏû¨Î°ú ÌèêÍµêÎêú Î∞îÎ°ú Í∑∏ ÌïôÍµêÎã§.'
      },
      {
        id:'ch2_school', title:'Ch.2 ‚Äî ÏïºÍ∞Ñ ÌïôÍµê', desc:'30ÎÖÑ Ï†Ñ ÌôîÏû¨Î°ú ÌèêÍµêÎêú ÏÑ∏Ï¢ÖÍ≥†. Í∑∏ÎÇ† Î∞§Ïùò ÏßÑÏã§ÏùÑ ÌååÌó§ÏπúÎã§.', time:'14Î∂Ñ',
        intro:'ÏÑ∏Ï¢ÖÍ≥†Îì±ÌïôÍµê. 30ÎÖÑÍ∞Ñ Î∞©ÏπòÎêú ÌèêÍµê.\nÏ≤†Ï°∞ÎßùÏùÑ ÎÑòÏñ¥ Ï†ïÎ¨∏Ïóê Îì§Ïñ¥ÏÑ∞Îã§. Ïú†Î¶¨Ï∞ΩÏùÄ Íπ®Ï†∏ ÏûàÍ≥†, Î≥µÎèÑÏóê ÎÇôÏÑúÍ∞Ä Í∞ÄÎìùÌïòÎã§.\n3ÌïôÎÖÑ 2Î∞ò ÍµêÏã§. Ïπ†ÌåêÏóê ÎàÑÍµ∞Í∞Ä ÏµúÍ∑ºÏóê Ï†ÅÏñ¥ÎÜìÏùÄ Í∏ÄÏî®.\n"Ïó¨Í∏∞ÏÑú ÏãúÏûëÎêêÎã§."\nÎ¨∏Ïù¥ ÏïàÏóêÏÑú Ïû†Í≤ºÎã§. ÎπÑÏÉÅÎì±Îßå ÍπúÎπ°Ïù¥Îäî ÍµêÏã§.',
        puzzles:[
          { type:'interactive', interactionType:'mastermind', title:'üî¢ ÌçºÏ¶ê 1: ÏÇ¨Î¨ºÌï® Ïû†Í∏àÏû•Ïπò',
            story:'ÍπÄÎèôÌòÑÏùò ÏÇ¨Î¨ºÌï®. 3ÏûêÎ¶¨ Ïà´Ïûê Ï°∞Ìï© Ïû†Í∏àÏû•Ïπò.\nÏä§Ìä∏ÎùºÏù¥ÌÅ¨/Î≥º ÌîºÎìúÎ∞±ÏúºÎ°ú ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏïåÏïÑÎÇ¥Îùº.',
            config:{ answer:[3,1,5], digits:3, maxAttempts:8, maxNum:6, answerStr:'ÏÇ¨Î¨ºÌï®Ïó¥Î¶º' },
            hint:'3ÏûêÎ¶¨ Ïà´Ïûê(1~6). üü¢=ÏúÑÏπò+Ïà´Ïûê ÎßûÏùå, üü°=Ïà´ÏûêÎßå ÎßûÏùå. Ï∂îÎ°†ÌïòÏÑ∏Ïöî!',
            validate:function(i){return i.trim()==='ÏÇ¨Î¨ºÌï®Ïó¥Î¶º'} },
          { type:'interactive', interactionType:'logic', title:'üìù ÌçºÏ¶ê 2: ÌïôÏÉù Ï¶ùÏñ∏',
            story:'ÏÇ¨Î¨ºÌï®ÏóêÏÑú 30ÎÖÑ Ï†Ñ ÌïôÏÉù 3Î™ÖÏùò ÏßÑÏà†ÏÑúÍ∞Ä ÎÇòÏôîÎã§.',
            config:{ scenario:'<b>ÌïôÏÉù Áî≤</b>: "ÌôîÏû¨ ÎãπÏùº, ÎÇòÎäî ÎèÑÏÑúÍ¥ÄÏóê ÏûàÏóàÎã§."<br><b>ÌïôÏÉù ‰πô</b>: "Áî≤ÏùÄ Í±∞ÏßìÎßêÏù¥Îã§. Áî≤ÏùÑ ÏßÄÌïòÏã§ÏóêÏÑú Î¥§Îã§."<br><b>ÌïôÏÉù ‰∏ô</b>: "‰πôÏùò ÎßêÏù¥ ÏÇ¨Ïã§Ïù¥Îã§. ÎÇòÎèÑ Áî≤ÏùÑ ÏßÄÌïòÏã§ÏóêÏÑú Î¥§Îã§."<br><br>Áî≤, ‰πô, ‰∏ô Ï§ë Í±∞ÏßìÎßêÏüÅÏù¥Îäî ÎàÑÍµ¨Ïù∏Í∞Ä?',
              choices:['Áî≤','‰πô','‰∏ô'] },
            hint:'‰πôÍ≥º ‰∏ôÏù¥ Í∞ôÏùÄ Ï¶ùÏñ∏ÏùÑ ÌïúÎã§. Áî≤Îßå Î∂ÄÏ†ï. Áî≤Ïù¥ Í±∞ÏßìÎßêÏüÅÏù¥.',
            validate:function(i){return i.trim()==='Áî≤'} },
          { type:'interactive', interactionType:'pipe-connect', title:'üîß ÌçºÏ¶ê 3: Î≥¥ÏùºÎü¨Ïã§ Î∞∞Í¥Ä',
            story:'ÏßÄÌïò Î≥¥ÏùºÎü¨Ïã§. Í∞ÄÏä§Í¥ÄÏù¥ Ïñ¥ÏßÄÎüΩÍ≤å Íº¨Ïó¨ÏûàÎã§.\nÌååÏù¥ÌîÑÎ•º Ïò¨Î∞îÎ•¥Í≤å Ïó∞Í≤∞Ìï¥Ïïº ÏßÄÌïòÏã§ Î¨∏Ïù¥ Ïó¥Î¶∞Îã§.',
            config:{ size:4, answer:'Î∞∞Í¥ÄÏó∞Í≤∞',
              start:{r:0,c:0}, end:{r:3,c:3},
              pipes:[
                {r:0,c:0,type:'corner',initial:2,correct:1},
                {r:1,c:0,type:'straight',initial:0,correct:1},
                {r:2,c:0,type:'corner',initial:3,correct:0},
                {r:2,c:1,type:'straight',initial:1,correct:0},
                {r:2,c:2,type:'corner',initial:0,correct:1},
                {r:3,c:2,type:'straight',initial:1,correct:0},
                {r:3,c:3,type:'corner',initial:1,correct:3}
              ] },
            hint:'ÏûÖÍµ¨(Ï¢åÏÉÅ)‚ÜíÏ∂úÍµ¨(Ïö∞Ìïò). ÌååÏù¥ÌîÑÎ•º ÌÅ¥Î¶≠ÌïòÏó¨ Ïó∞Í≤∞ÌïòÏÑ∏Ïöî.',
            validate:function(i){return i.trim()==='Î∞∞Í¥ÄÏó∞Í≤∞'} },
          { type:'interactive', interactionType:'memory-card', title:'üì∏ ÌçºÏ¶ê 4: Ï°∏ÏóÖÏï®Î≤î ÏÇ¨ÏßÑ',
            story:'ÍµêÎ¨¥Ïã§ÏóêÏÑú Ï∞¢Ïñ¥ÏßÑ Ï°∏ÏóÖÏï®Î≤î ÏÇ¨ÏßÑÎì§. Í∞ôÏùÄ ÏÇ¨ÎûåÏùò ÏÇ¨ÏßÑ ÏßùÏùÑ ÎßûÏ∂∞Îùº.',
            config:{ pairs:['üë§','üìö','üè´','üî¨','üéì'], answer:'Î∞©ÌôîÎ≤îÏù∏' },
            hint:'Í∞ôÏùÄ Ïù¥Î™®ÏßÄ ÏßùÏùÑ Ï∞æÏúºÏÑ∏Ïöî. 5Ïåç Î™®Îëê Îß§Ïπ≠ÌïòÎ©¥ Îã®ÏÑúÍ∞Ä!',
            validate:function(i){return i.replace(/\s/g,'')==='Î∞©ÌôîÎ≤îÏù∏'} },
          { type:'cpq', cpqIndex:0,
            story:'ÏûêÎ£åÏã§ Î≤ΩÏóê Î∂ôÏùÄ ÏßÄÎèÑ. ÌôîÏû¨ ÏõêÏù∏ Ï°∞ÏÇ¨ Î≥¥Í≥†ÏÑú.\n"ÌôîÏû¨Îäî ÏÇ¨Í≥†Í∞Ä ÏïÑÎãàÏóàÎã§."',
            storyAfter:'Î≥¥Í≥†ÏÑúÏùò ÎßàÏßÄÎßâ ÌéòÏù¥ÏßÄÍ∞Ä ÌéºÏ≥êÏ°åÎã§.' }
        ],
        cliffhanger:'ÌôîÏû¨ Ï°∞ÏÇ¨ Î≥¥Í≥†ÏÑú. Í∏∞Î∞Ä Ïä§ÌÉ¨ÌîÑÍ∞Ä Ï∞çÌòÄÏûàÎã§.\n\n"1994ÎÖÑ 12Ïõî 24Ïùº. ÏÑ∏Ï¢ÖÍ≥† ÏßÄÌïò Î≥¥ÏùºÎü¨Ïã§ÏóêÏÑú Î∞úÌôî."\n"ÌôîÏû¨Îäî ÏÇ¨Í≥†Í∞Ä ÏïÑÎãàÎùº ÏùòÎèÑÏ†Å Î∞©Ìôî."\n"Î™©Ï†Å: ÏßÄÌïòÏã§Ïùò Ï¶ùÍ±∞ Ïù∏Î©∏."\n\nÎ≥¥Í≥†ÏÑúÏóê Ï≤®Î∂ÄÎêú ÏÉùÏ°¥Ïûê Î™ÖÎã®. ÏÑ∏ Î≤àÏß∏ Ïù¥Î¶Ñ.\nÏßÅÏóÖÎûÄ: "Í∑∏ÎûÄÎç∞ Ïò§ÌéòÎùº ÌïòÏö∞Ïä§ Îã®Ïõê"\n\nÏ°∏ÏóÖÏï®Î≤îÏóêÏÑú ÏßÄÏõåÏ°åÎçò ÏÑ∏ Î≤àÏß∏ ÏÇ¨Îûå.\nÍ∑∏Í∞Ä Ïò§ÌéòÎùº Í∑πÏû•Ïóê ÏûàÎã§.'
      },
      {
        id:'ch3_opera', title:'Ch.3 ‚Äî Ïò§ÌéòÎùº Í∑πÏû•', desc:'100ÎÖÑ Îêú Í∑πÏû•. Î¨¥ÎåÄ ÏïÑÎûòÏóê Ïà®Í≤®ÏßÑ ÎπÑÎ∞Ä.', time:'15Î∂Ñ',
        intro:'Í∑∏ÎûÄÎç∞ Ïò§ÌéòÎùº ÌïòÏö∞Ïä§. 100ÎÖÑ Ïó≠ÏÇ¨Ïùò Í∑πÏû•.\nÍ≥µÏó∞ÏùÄ ÎÅùÎÇ¨ÏßÄÎßå Ï°∞Î™ÖÏù¥ ÏºúÏ†∏ ÏûàÎã§. Î¨¥ÎåÄ ÏúÑÏóê Ìïú ÏÇ¨ÎûåÏù¥ ÏÑú ÏûàÎã§.\nÎãπÏã†ÏùÑ Í∏∞Îã§Î¶¨Í≥† ÏûàÏóàÎã§Îäî ÎìØÏù¥.\n"Ïûò ÏôîÏñ¥. ÍµêÏàòÎèÑ, ÌòÑÏö∞ÎèÑ Ïó¨Í∏∞ÍπåÏßÄ ÏôîÏóàÏßÄ."\nÍ∑∏Í∞Ä Îí§ÎèåÏïÑÏÑúÎäî ÏàúÍ∞Ñ, Î¨¥ÎåÄÍ∞Ä Í∫ºÏßÄÍ≥† Í∏∞Í≥ÑÏû•ÏπòÍ∞Ä ÏûëÎèôÌïúÎã§.',
        puzzles:[
          { type:'interactive', interactionType:'timing', title:'üé≠ ÌçºÏ¶ê 1: Î¨¥ÎåÄ Ï°∞Î™Ö ÌÉÄÏù¥Î∞ç',
            story:'Î¨¥ÎåÄ Í∏∞Í≥ÑÏû•ÏπòÍ∞Ä Ìè≠Ï£ºÌïúÎã§! Ï°∞Î™ÖÏù¥ ÍπúÎπ°Ïù¥Îäî ÏÇ¨Ïù¥Ïóê Ï†ïÌôïÌûà Ïä§ÏúÑÏπòÎ•º ÎàåÎü¨Ïïº ÌïúÎã§.',
            config:{ zoneStart:0.3, zoneEnd:0.5, required:4, speed:0.012, revealText:'Í∏∞Í≥ÑÏã§' },
            hint:'Ï¥àÎ°ù Íµ¨Í∞ÑÏóê ÌÉÄÏù¥Î∞ç ÎßûÏ∂∞ 4Î≤à Ïó∞ÏÜç ÏÑ±Í≥µÌïòÏÑ∏Ïöî. Ï†êÏ†ê Îπ®ÎùºÏßëÎãàÎã§!',
            validate:function(i){return i.replace(/\s/g,'')==='Í∏∞Í≥ÑÏã§'} },
          { type:'interactive', interactionType:'pipe-connect', title:'üîå ÌçºÏ¶ê 2: ÏùåÌñ• Î∞∞ÏÑ†',
            story:'Í∏∞Í≥ÑÏã§. ÏùåÌñ• Ïû•ÎπÑ Î∞∞ÏÑ†Ïù¥ ÏóâÏºúÏûàÎã§.\nÎ∞∞ÏÑ†ÏùÑ Ïò¨Î∞îÎ•¥Í≤å Ïó∞Í≤∞Ìï¥Ïïº Ïà®Í≤®ÏßÑ ÎÖπÏùåÏù¥ Ïû¨ÏÉùÎêúÎã§.',
            config:{ size:4, answer:'Î¨¥ÎåÄÏïÑÎûò',
              start:{r:0,c:0}, end:{r:3,c:3},
              pipes:[
                {r:0,c:0,type:'straight',initial:1,correct:0},
                {r:0,c:1,type:'corner',initial:3,correct:2},
                {r:1,c:1,type:'corner',initial:0,correct:0},
                {r:1,c:2,type:'straight',initial:0,correct:0},
                {r:1,c:3,type:'corner',initial:1,correct:2},
                {r:2,c:3,type:'straight',initial:0,correct:1},
                {r:3,c:3,type:'corner',initial:3,correct:0}
              ] },
            hint:'ÌååÏù¥ÌîÑÎ•º ÌÅ¥Î¶≠‚ÜíÌöåÏ†Ñ. ÏûÖÍµ¨‚ÜíÏ∂úÍµ¨ Ïó∞Í≤∞!',
            validate:function(i){return i.replace(/\s/g,'')==='Î¨¥ÎåÄÏïÑÎûò'} },
          { type:'interactive', interactionType:'mastermind', title:'üéª ÌçºÏ¶ê 3: ÏïÖÍ∏∞ Î≥¥Í¥ÄÏÜå Ïû†Í∏à',
            story:'ÏßÄÌïò ÏïÖÍ∏∞ Î≥¥Í¥ÄÏÜå. 3ÏûêÎ¶¨ Ïà´Ïûê Ï°∞Ìï© Ïû†Í∏àÏû•Ïπò.\nÏ∂îÎ°†ÏúºÎ°ú ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏïåÏïÑÎÇ¥Îùº.',
            config:{ answer:[2,4,6], digits:3, maxAttempts:8, maxNum:6, answerStr:'ÏßÄÌïòÏã§' },
            hint:'3ÏûêÎ¶¨ Ïà´Ïûê(1~6). Ïä§Ìä∏ÎùºÏù¥ÌÅ¨/Î≥º ÌîºÎìúÎ∞±ÏúºÎ°ú Ï∂îÎ°†!',
            validate:function(i){return i.replace(/\s/g,'')==='ÏßÄÌïòÏã§'} },
          { type:'interactive', interactionType:'logic', title:'üö™ ÌçºÏ¶ê 4: ÏÑ∏ ÏÇ¨ÎûåÏùò Ï¶ùÏñ∏',
            story:'ÏßÄÌïòÏã§ÏóêÏÑú ÎÖπÏùåÍ∏∞Í∞Ä Î∞úÍ≤¨ÎêêÎã§. ÏÑ∏ ÏÇ¨ÎûåÏùò ÎÖπÏ∑®Î°ù.',
            config:{ scenario:'<b>Î∞∞Ïö∞ X</b>: "Í∑πÏû• ÏßÄÌïòÏóêÎäî ÏïÑÎ¨¥ÎèÑ Í∞ÄÏßÄ ÏïäÎäîÎã§."<br><b>Ïó∞Ï∂úÍ∞Ä Y</b>: "XÎäî Í±∞ÏßìÎßêÏù¥Îã§. Îß§Ï£º ÎàÑÍµ∞Í∞Ä ÏßÄÌïòÏóêÏÑú ÏÜåÎ¶¨Í∞Ä Îì§Î¶∞Îã§."<br><b>Ïä§ÌÉúÌîÑ Z</b>: "YÏùò ÎßêÏù¥ ÎßûÎã§. ÎÇòÎèÑ ÏÜåÎ¶¨Î•º Îì§ÏóàÎã§."<br><br>Í±∞ÏßìÎßêÏüÅÏù¥Îäî ÎàÑÍµ¨Ïù∏Í∞Ä?',
              choices:['X','Y','Z'] },
            hint:'YÏôÄ ZÍ∞Ä Í∞ôÏùÄ Ï¶ùÏñ∏. XÎßå Î∂ÄÏ†ï ‚Üí XÍ∞Ä Í±∞ÏßìÎßêÏüÅÏù¥.',
            validate:function(i){return i.toUpperCase().trim()==='X'} },
          { type:'cpq', cpqIndex:0,
            story:'Î¨¥ÎåÄ ÏïÑÎûò ÎπÑÎ∞Ä Í∏∞Î°ùÎ≥¥Í¥ÄÏÜå.\n"Ïú†Î†πÏùò Ï†ïÏ≤¥Î•º ÏïåÏïÑÎÉàÎã§. Ï¶ùÍ±∞Í∞Ä Ïù¥ Ïû•ÏÜåÏóê ÏûàÎã§."',
            storyAfter:'Í∏∞Î°ùÎ≥¥Í¥ÄÏÜåÏùò ÎßàÏßÄÎßâ ÏÑúÎ•òÍ∞Ä ÎìúÎü¨ÎÇ¨Îã§.' }
        ],
        cliffhanger:'Í∏∞Î°ùÎ≥¥Í¥ÄÏÜåÏóêÏÑú ÎÇòÏò® ÏÑúÎ•òÎ≠âÏπò.\n\nÏÑ∏ Î≤àÏß∏ ÎÇ®ÏûêÏùò Í≥†Î∞±.\n"Ïö∞Î¶¨ ÏÖãÏùÄ 1994ÎÖÑ ÌÅ¨Î¶¨Ïä§ÎßàÏä§ Ïù¥Î∏å, ÌïôÍµê ÏßÄÌïòÏã§ÏóêÏÑú Í∑∏Í≤ÉÏùÑ Î¥§Îã§."\n"Ïù∏Ï≤¥ Ïã§Ìóò Í∏∞Î°ù. ÏïÑÏù¥Îì§ÏùÑ ÎåÄÏÉÅÏúºÎ°ú Ìïú."\n"ÌôîÏû¨Îäî Ï¶ùÍ±∞Î•º ÌÉúÏö∞Í∏∞ ÏúÑÌïú Í≤ÉÏù¥ÏóàÎã§."\n\nÎßàÏßÄÎßâ ÌéòÏù¥ÏßÄ.\n"ÏµúÌòÑÏö∞Îäî Ïù¥Í±∏ ÏÑ∏ÏÉÅÏóê ÏïåÎ¶¨Î†§Îã§ ÏÇ¨ÎùºÏ°åÎã§."\n"ÍπÄÎèôÌòÑ ÍµêÏàòÎäî Ï¶ùÍ±∞Î•º Î™®ÏúºÎã§ Í∞êÍ∏àÎãπÌñàÎã§."\n\nÏÑúÎ•ò Îí∑Î©¥Ïóê ÎèÑÏû•.\n"ÏÑ±Î™®ÏùòÎ£åÏû¨Îã®"\n\nÌèêÏáÑÎêú ÏÑ±Î™®Î≥ëÏõê. 304Ìò∏.\nÎ™®Îì† Í≤ÉÏùÄ Í±∞Í∏∞ÏÑú ÏãúÏûëÎêêÎã§.'
      }
    ]
  },
  {
    id:'hospital', title:'304Ìò∏Ïùò Í∏∞Ïñµ', icon:'üè•', difficulty:3,
    desc:'10ÎÖÑ Ï†Ñ ÌèêÏáÑÎêú Î≥ëÏõê. 304Ìò∏ ÌôòÏûêÎì§Ïù¥ Ï†ÑÏõê ÎèôÏãúÏóê ÏÇ¨ÎùºÏßÑ ÏÇ¨Í±¥. ÏßÑÏã§ÏùÑ ÌååÌó§Ï≥êÎùº.',
    chapters:[
      {
        id:'ch1_hospital', title:'Ch.1 ‚Äî ÌèêÎ≥ëÏõê 304Ìò∏', desc:'Î∞§ÎßàÎã§ Î∂àÏù¥ ÏºúÏßÄÎäî ÌèêÎ≥ëÏõê. 10ÎÖÑ Ï†Ñ Í∑∏ÎÇ† Î∞§Ïùò ÏßÑÏã§.', time:'14Î∂Ñ',
        intro:'ÏÑ±Î™®Î≥ëÏõê. 10ÎÖÑ Ï†Ñ ÏùòÎ£åÏÇ¨Í≥†Î°ú ÌèêÏáÑÎêêÎã§.\nÌïòÏßÄÎßå "ÏùòÎ£åÏÇ¨Í≥†"Îäî Í≥µÏãù Î∞úÌëúÏùº ÎøêÏù¥Îã§.\n304Ìò∏ÏóêÏÑú Î∞§ÎßàÎã§ Î∂àÎπõÏù¥ ÏºúÏßÑÎã§Îäî Ï†úÎ≥¥.\nÎãπÏã†Ïù¥ Îì§Ïñ¥ÏÑ† ÏàúÍ∞Ñ, Î≥µÎèÑ ÎÅùÏóêÏÑú Î∞úÏûêÍµ≠ ÏÜåÎ¶¨.\n10ÎÖÑÍ∞Ñ ÏïÑÎ¨¥ÎèÑ Îì§Ïñ¥Ïò§ÏßÄ ÏïäÏïòÏùÑ Ïù¥ Î≥ëÏõêÏóêÏÑú.',
        puzzles:[
          { type:'interactive', interactionType:'wire-cutting', title:'üîå ÌçºÏ¶ê 1: Î≥¥Ïïà Ïû•Ïπò Ìï¥Ï†ú',
            story:'304Ìò∏ ÏûÖÍµ¨ Î≥¥Ïïà Ïû•Ïπò. 4Í∞úÏùò ÏÉâÍπî Ï†ÑÏÑ†Ïù¥ Ïó∞Í≤∞ÎêòÏñ¥ ÏûàÎã§.\nÏò¨Î∞îÎ•∏ ÏàúÏÑúÎ°ú Ï†àÎã®Ìï¥Ïïº ÌïúÎã§.\nÎ≤ΩÏóê Ï†ÅÌûå ÌûåÌä∏Î•º Ï∞∏Í≥†ÌïòÎùº.',
            config:{ wires:[{color:'#e74c3c',label:'Îπ®Í∞ï'},{color:'#3498db',label:'ÌååÎûë'},{color:'#2ecc71',label:'Ï¥àÎ°ù'},{color:'#f1c40f',label:'ÎÖ∏Îûë'}],
              correctOrder:[2,0,3,1], hintText:'üí° "Ï¥àÎ°ùÏùÑ Î®ºÏ†Ä, Í∑∏ Îã§Ïùå Îπ®Í∞ï, ÎÖ∏Îûë, ÎßàÏßÄÎßâÏóê ÌååÎûë"', answer:'Î≥¥ÏïàÌï¥Ï†ú' },
            hint:'ÏàúÏÑú: Ï¥àÎ°ù‚ÜíÎπ®Í∞ï‚ÜíÎÖ∏Îûë‚ÜíÌååÎûë',
            validate:function(i){return i.replace(/\s/g,'')==='Î≥¥ÏïàÌï¥Ï†ú'} },
          { type:'interactive', interactionType:'mini-sudoku', title:'üß© ÌçºÏ¶ê 2: ÏïΩÌíà Î≥¥Í¥ÄÌï®',
            story:'Í∞ÑÌò∏ÏÇ¨Ïã§Ïùò ÏïΩÌíà Î≥¥Í¥ÄÌï®. 4√ó4 Ïà´Ïûê ÌçºÏ¶êÏùÑ ÏôÑÏÑ±Ìï¥Ïïº Ïû†Í∏àÏù¥ Ìï¥Ï†úÎêúÎã§.',
            config:{ grid:[[1,0,3,4],[3,4,0,2],[0,1,4,3],[4,3,2,0]], solution:[[1,2,3,4],[3,4,1,2],[2,1,4,3],[4,3,2,1]], answer:'ÏïΩÌíàÌôïÎ≥¥' },
            hint:'Í∞Å Ìñâ, Ïó¥, 2√ó2 Î∏îÎ°ùÏóê 1~4Í∞Ä Ìïú Î≤àÏî©. Îπà Ïπ∏ÏùÑ Ï±ÑÏö∞ÏÑ∏Ïöî.',
            validate:function(i){return i.replace(/\s/g,'')==='ÏïΩÌíàÌôïÎ≥¥'} },
          { type:'interactive', interactionType:'simon', title:'üè• ÌçºÏ¶ê 3: ÏùòÎ£å Ïû•ÎπÑ ÏàúÏÑú',
            story:'Ïã§ÌóòÏã§ ÏùòÎ£å Ïû•ÎπÑÏùò Í∞ÄÎèô ÏàúÏÑúÎ•º Í∏∞ÏñµÌïòÍ≥† Îî∞ÎùºÌï¥Ïïº ÌïúÎã§.\nÏû•ÎπÑ Ìå®ÎÑêÏùò ÏÉâÍπî ÏàúÏÑúÎ•º Í∏∞ÏñµÌïòÎùº.',
            config:{ rounds:6, answer:'Ïã§ÌóòÍ∏∞Î°ù' },
            hint:'ÏÉâÍπî Î≤ÑÌäºÏù¥ ÎπõÎÇòÎäî ÏàúÏÑúÎ•º Í∏∞ÏñµÌïòÍ≥† Í∞ôÏùÄ ÏàúÏÑúÎ°ú ÎàÑÎ•¥ÏÑ∏Ïöî!',
            validate:function(i){return i.replace(/\s/g,'')==='Ïã§ÌóòÍ∏∞Î°ù'} },
          { type:'interactive', interactionType:'flashlight', title:'üî¨ ÌçºÏ¶ê 4: Ïã§ÌóòÏã§',
            story:'Ï†ïÏ†ÑÎêú Ïã§ÌóòÏã§. ÏÜêÏ†ÑÎì±ÏúºÎ°ú Î≤ΩÎ©¥Ïùò Îã®ÏÑúÎ•º Ï∞æÏïÑÏïº ÌïúÎã§.',
            config:{ items:[
              {x:10, y:20, text:'Ïù∏'},{x:50, y:40, text:'Ï≤¥'},{x:30, y:65, text:'Ïã§'},{x:75, y:30, text:'Ìóò'},
              {x:70, y:70, text:'‚Üí ÎÑ§ Í∏ÄÏûêÎ•º Ï°∞Ìï©'}
            ]},
            hint:'Ïù∏, Ï≤¥, Ïã§, Ìóò ‚Üí "Ïù∏Ï≤¥Ïã§Ìóò"',
            validate:function(i){return i.replace(/\s/g,'')==='Ïù∏Ï≤¥Ïã§Ìóò'} },
          { type:'cpq', cpqIndex:0,
            story:'"304Ìò∏Ïùò ÏßÑÏßú ÎπÑÎ∞Ä. Îçî ÌÅ∞ ÏùåÎ™®Í∞Ä ÏûàÎã§."\nÍπÄ ÏùòÏÇ¨Í∞Ä Î™©Ïà® Í±∏Í≥† Ï∂îÏ†ÅÌïú Ïû•ÏÜå.',
            storyAfter:'Î≥¥Í≥†ÏÑúÏùò ÎßàÏßÄÎßâ Ïû•Ïù¥ Ìï¥ÎèÖÎêêÎã§.' }
        ],
        cliffhanger:'ÍπÄÏòÅÌò∏ ÏùòÏÇ¨Ïùò ÏµúÏ¢Ö Î≥¥Í≥†ÏÑú.\n\n"304Ìò∏ ÌôòÏûê 5Î™Ö. Ï†ÑÏõê Í∞ôÏùÄ Í≥†ÏïÑÏõê Ï∂úÏã†."\n"Íµ¨ÏÑ∏Ï£º Í≥†ÏïÑÏõê. 30ÎÖÑ Ï†Ñ ÌôîÏû¨Î°ú ÌèêÏáÑÎêú Î∞îÎ°ú Í∑∏Í≥≥."\n"ÌôòÏûêÎì§ÏùÄ Ïñ¥Î¶∞ ÏãúÏ†à Ïã§Ìóò ÎåÄÏÉÅÏù¥ÏóàÎã§."\n"Í∑∏Î¶¨Í≥† ÎàÑÍµ∞Í∞Ä Í∑∏Îì§ÏùÑ Îã§Ïãú Î™®ÏïòÎã§."\n\nÎ≥¥Í≥†ÏÑúÏóê Ï≤®Î∂ÄÎêú ÏÇ¨ÏßÑ.\nÍ≥†ÏïÑÏõê Ï†ïÎ¨∏. ÏµúÍ∑ºÏóê Ï∞çÌûå Í≤ÉÏù¥Îã§.\nÏ≤†Ï°∞ÎßùÏù¥ ÏÉàÍ≤ÉÏúºÎ°ú ÍµêÏ≤¥ÎêòÏñ¥ ÏûàÎã§.\n\nÎàÑÍµ∞Í∞Ä Í∑∏Í≥≥ÏùÑ Îã§Ïãú ÏÇ¨Ïö©ÌïòÍ≥† ÏûàÎã§.'
      },
      {
        id:'ch2_orphanage', title:'Ch.2 ‚Äî Î≤ÑÎ†§ÏßÑ Í≥†ÏïÑÏõê', desc:'30ÎÖÑ Ï†Ñ Î∂àÌÉÑ Í≥†ÏïÑÏõê. Î∞§ÎßàÎã§ ÏïÑÏù¥Îì§Ïùò Ïö∏ÏùåÏÜåÎ¶¨Í∞Ä Îì§Î¶∞Îã§.', time:'16Î∂Ñ',
        intro:'Íµ¨ÏÑ∏Ï£º Í≥†ÏïÑÏõê. Ïô∏Î≤ΩÏùÄ Í∑∏ÏùÑÏùåÏúºÎ°ú ÍπåÎß£Îã§.\nÏÉà Ï≤†Ï°∞Îßù. ÏÉà ÏûêÎ¨ºÏá†. ÎàÑÍµ∞Í∞Ä Í¥ÄÎ¶¨ÌïòÍ≥† ÏûàÎã§.\nÏïàÏúºÎ°ú Îì§Ïñ¥ÏÑúÏûê ÏÜåÎèÖÏïΩ ÎÉÑÏÉà. 30ÎÖÑ Ï†Ñ Í±¥Î¨ºÏóêÏÑú?\n2Ï∏µÏóêÏÑú Ìù¨ÎØ∏Ìïú Î∂àÎπõ. Î∞úÏûêÍµ≠ ÏÜåÎ¶¨.\nÏù¥Í≥≥ÏùÄ Î≤ÑÎ†§ÏßÄÏßÄ ÏïäÏïòÎã§.',
        puzzles:[
          { type:'interactive', interactionType:'simon', title:'üéµ ÌçºÏ¶ê 1: ÎÜÄÏù¥Î∞© Ïò§Î•¥Í≥®',
            story:'2Ï∏µ ÎÜÄÏù¥Î∞©. Íπ®ÏßÑ Ïò§Î•¥Í≥®Ïù¥ Î©úÎ°úÎîîÎ•º Ïû¨ÏÉùÌïúÎã§.\nÎ©úÎ°úÎîîÏùò Ìå®ÌÑ¥ÏùÑ Í∏∞ÏñµÌïòÍ≥† Îî∞ÎùºÌïòÎùº.',
            config:{ rounds:6, answer:'ÏûÖÏñëÏÑúÎ•ò' },
            hint:'ÏÉâÍπî Î≤ÑÌäº ÏàúÏÑúÎ•º Í∏∞ÏñµÌïòÍ≥† Îî∞ÎùºÌïòÏÑ∏Ïöî. 6ÎùºÏö¥Îìú!',
            validate:function(i){return i.replace(/\s/g,'')==='ÏûÖÏñëÏÑúÎ•ò'} },
          { type:'interactive', interactionType:'wire-cutting', title:'üîå ÌçºÏ¶ê 2: Ï†ÑÍ∏∞ Ïö∏ÌÉÄÎ¶¨',
            story:'ÏßÄÌïòÏã§ ÏûÖÍµ¨. Ï†ÑÍ∏∞ Ïö∏ÌÉÄÎ¶¨Í∞Ä ÏÑ§ÏπòÎêòÏñ¥ ÏûàÎã§.\n5Í∞úÏùò Ï†ÑÏÑ†ÏùÑ Ïò¨Î∞îÎ•∏ ÏàúÏÑúÎ°ú Ï†àÎã®Ìï¥Ïïº ÌÜµÍ≥ºÌï† Ïàò ÏûàÎã§.',
            config:{ wires:[{color:'#e74c3c',label:'Îπ®Í∞ï'},{color:'#3498db',label:'ÌååÎûë'},{color:'#2ecc71',label:'Ï¥àÎ°ù'},{color:'#f1c40f',label:'ÎÖ∏Îûë'},{color:'#9b59b6',label:'Î≥¥Îùº'}],
              correctOrder:[4,2,0,3,1], hintText:'üí° "Î≥¥ÎùºÎ∂ÄÌÑ∞ ÏãúÏûë, Ï¥àÎ°ù, Îπ®Í∞ï, ÎÖ∏Îûë Ïàú. ÌååÎûëÏù¥ ÎßàÏßÄÎßâ"', answer:'Ïö∏ÌÉÄÎ¶¨Ìï¥Ï†ú' },
            hint:'ÏàúÏÑú: Î≥¥Îùº‚ÜíÏ¥àÎ°ù‚ÜíÎπ®Í∞ï‚ÜíÎÖ∏Îûë‚ÜíÌååÎûë',
            validate:function(i){return i.replace(/\s/g,'')==='Ïö∏ÌÉÄÎ¶¨Ìï¥Ï†ú'} },
          { type:'interactive', interactionType:'mini-sudoku', title:'üß© ÌçºÏ¶ê 3: ÏõêÏû•Ïã§ ÏÑúÎûç',
            story:'ÏõêÏû•Ïã§ ÏÑúÎûçÏùò Ïà´Ïûê ÌçºÏ¶ê. ÏôÑÏÑ±ÌïòÎ©¥ ÏÑúÎûçÏù¥ Ïó¥Î¶∞Îã§.',
            config:{ grid:[[0,4,0,3],[1,0,4,0],[3,0,2,4],[0,2,3,1]], solution:[[2,4,1,3],[1,3,4,2],[3,1,2,4],[4,2,3,1]], answer:'ÎπÑÎ∞ÄÎ¨∏ÏÑú' },
            hint:'4√ó4 Ïä§ÎèÑÏø†. Í∞Å Ìñâ/Ïó¥/Î∏îÎ°ùÏóê 1~4 Ìïú Î≤àÏî©.',
            validate:function(i){return i.replace(/\s/g,'')==='ÎπÑÎ∞ÄÎ¨∏ÏÑú'} },
          { type:'interactive', interactionType:'trivia', title:'üö™ ÌçºÏ¶ê 4: ÏßÄÌïòÏã§ ÏûÖÍµ¨',
            story:'ÏßÄÌïòÏã§ Î¨∏Ïùò Ïû†Í∏àÏû•ÏπòÏóê ÏßàÎ¨∏Ïù¥ Ï†ÅÌòÄÏûàÎã§.',
            config:{ question:'ÌïúÍµ≠ Ï†ÑÏüÅ Ïù¥ÌõÑ Í≥†ÏïÑÏõêÏóêÏÑú Ìï¥Ïô∏Î°ú Î≥¥ÎÇ¥ÏßÑ ÏïÑÏù¥Îì§Ïùò Ï†úÎèÑÎ•º Î¨¥ÏóáÏù¥Îùº ÌïòÎäîÍ∞Ä?', options:['Ìï¥Ïô∏ÏûÖÏñë','ÏÜåÎÖÑÏõê','ÏúÑÌÉÅÎ≥¥Ìò∏','Í∑∏Î£πÌôà'] },
            hint:'ÌïúÍµ≠ Ï†ÑÏüÅ ÌõÑ ÏàòÎßå Î™ÖÏùò ÏïÑÏù¥Îì§Ïù¥ Ìï¥Ïô∏ÏûÖÏñëÏúºÎ°ú Î≥¥ÎÇ¥Ï°åÎã§.',
            validate:function(i){return i.replace(/\s/g,'').indexOf('Ìï¥Ïô∏ÏûÖÏñë')!==-1} },
          { type:'cpq', cpqIndex:0,
            story:'ÏßÄÌïòÏã§ Î≤Ω Îí§ Ïà®Í≤®ÏßÑ Î∞©.\n"ÏïÑÏù¥Îì§ÏùÄ Ïó¨Í∏∞ÏÑú Ïã§ÌóòÎãπÌñàÎã§." Ï¶ùÍ±∞Í∞Ä Ïà®Í≤®ÏßÑ ÎßàÏßÄÎßâ Ïû•ÏÜå.',
            storyAfter:'Î≤Ω Îí§ Î∞©ÏóêÏÑú ÏÉÅÏûêÍ∞Ä ÎÇòÏôîÎã§.' }
        ],
        cliffhanger:'ÏÉÅÏûê Ïïà. ÏûÖÏñë ÏÑúÎ•ò ÏàòÏã≠ ÌÜµ.\n\nÏ†ÑÎ∂Ä Í∞ÄÏßúÎã§. ÏûÖÏñëÎêú ÏïÑÏù¥Îì§ÏùÄ Í∞ÄÏ†ïÏóê Í∞Ñ Í≤å ÏïÑÎãàÏóàÎã§.\nÏÑúÎ•òÏùò Ïã§Ï†ú Î™©Ï†ÅÏßÄ:\n"ÏßÄÌïòÏ≤† 7Ìò∏ÏÑ† ‚Äî Íµ∞ÏÇ¨ ÌèêÏó≠ B-7"\n\nÏïÑÏù¥Îì§ÏùÄ Í∑∏Í≥≥ÏúºÎ°ú Î≥¥ÎÇ¥Ï°åÎã§.\nÏÑúÎ•ò Îí∑Î©¥, ÏµúÍ∑º ÎÇ†ÏßúÏùò Î©îÎ™®:\n"Ïã§ÌóòÏùÄ Í≥ÑÏÜçÎêòÍ≥† ÏûàÎã§. ÏÉàÎ°úÏö¥ ÌîºÌóòÏûêÍ∞Ä ÌïÑÏöîÌïòÎã§."\n\n304Ìò∏ ÌôòÏûêÎì§Ïù¥ ÏÇ¨ÎùºÏßÑ Ïù¥Ïú†.\nÍ∑∏Îì§ÏùÄ Îã§Ïãú ÎèåÏïÑÍ∞Ñ Í≤ÉÏù¥Îã§.'
      },
      {
        id:'ch3_subway', title:'Ch.3 ‚Äî ÏßÄÌïòÏ≤† ÌèêÏó≠', desc:'Î¥âÏù∏Îêú Íµ∞ÏÇ¨ ÌèêÏó≠. ÏïÑÏù¥Îì§Ïù¥ Î≥¥ÎÇ¥ÏßÑ Í≥≥.', time:'16Î∂Ñ',
        intro:'7Ìò∏ÏÑ† ÎßàÏßÄÎßâ Ïó¥Ï∞®Í∞Ä Îñ†ÎÇú Îí§.\nÏú†ÏßÄÎ≥¥Ïàò ÌÜµÎ°úÎ•º ÌÜµÌï¥ Î¥âÏù∏Îêú B-7 ÌèêÏó≠ÏúºÎ°ú ÏßÑÏûÖÌñàÎã§.\nÌîåÎû´ÌèºÏùÄ Íπ®ÎÅóÌïòÎã§. ÎÑàÎ¨¥ Íπ®ÎÅóÌïòÎã§. Í¥ÄÎ¶¨ÎêòÍ≥† ÏûàÎã§.\nÌòïÍ¥ëÎì±Ïù¥ ÍπúÎπ°Ïù¥Í≥†, Ïñ¥ÎîòÍ∞ÄÏóêÏÑú Í∏∞Í≥ÑÏùåÏù¥ Îì§Î¶∞Îã§.\nÏù¥Í≥≥ÏùÄ Ïó≠Ïù¥ ÏïÑÎãàÎã§. ÏúÑÏû•Îêú ÏãúÏÑ§Ïù¥Îã§.',
        puzzles:[
          { type:'interactive', interactionType:'mini-sudoku', title:'üß© ÌçºÏ¶ê 1: Í¥ÄÏ†úÏã§ Ïû†Í∏àÏû•Ïπò',
            story:'Í¥ÄÏ†úÏã§ Î¨∏Ïùò Ïà´Ïûê Ìå®Îìú. 4√ó4 Ïä§ÎèÑÏø†Î•º ÏôÑÏÑ±Ìï¥Ïïº Î¨∏Ïù¥ Ïó¥Î¶∞Îã§.',
            config:{ grid:[[0,2,0,0],[3,0,4,0],[0,4,0,3],[2,0,1,0]], solution:[[4,2,3,1],[3,1,4,2],[1,4,2,3],[2,3,1,4]], answer:'Í¥ÄÏ†úÏã§Ïó¥Î¶º' },
            hint:'Îπà Ïπ∏Ïóê 1~4Î•º Ï±ÑÏö∞ÏÑ∏Ïöî. Ìñâ/Ïó¥/Î∏îÎ°ù Ï§ëÎ≥µ ÏóÜÏù¥!',
            validate:function(i){return i.replace(/\s/g,'')==='Í¥ÄÏ†úÏã§Ïó¥Î¶º'} },
          { type:'interactive', interactionType:'simon', title:'üéµ ÌçºÏ¶ê 2: Í¥ÄÏ†ú ÏãúÏä§ÌÖú',
            story:'Í¥ÄÏ†ú Ïª¥Ìì®ÌÑ∞Ïùò Ïù∏Ï¶ù ÏãúÏä§ÌÖú. ÏÉâÍπî ÏàúÏÑúÎ•º Í∏∞ÏñµÌïòÍ≥† Îî∞ÎùºÌï¥Ïïº Ï†ëÍ∑º Í∞ÄÎä•.',
            config:{ rounds:6, answer:'Î¥âÏù∏Íµ¨Ïó≠' },
            hint:'6ÎùºÏö¥Îìú. ÏÉâÍπî Ìå®ÌÑ¥ÏùÑ Ïûò Í∏∞ÏñµÌïòÏÑ∏Ïöî!',
            validate:function(i){return i.replace(/\s/g,'')==='Î¥âÏù∏Íµ¨Ïó≠'} },
          { type:'interactive', interactionType:'wire-cutting', title:'üîå ÌçºÏ¶ê 3: Î¥âÏù∏ Ïû•Ïπò Ìï¥Ï†ú',
            story:'Î¥âÏù∏ Íµ¨Ïó≠ ÏûÖÍµ¨. 5Í∞úÏùò Ï†ÑÏÑ†Ïù¥ Î¥âÏù∏ÏùÑ Ïú†ÏßÄÌïòÍ≥† ÏûàÎã§.\nÏò¨Î∞îÎ•∏ ÏàúÏÑúÎ°ú Ï†àÎã®ÌïòÎùº.',
            config:{ wires:[{color:'#e74c3c',label:'Îπ®Í∞ï'},{color:'#3498db',label:'ÌååÎûë'},{color:'#2ecc71',label:'Ï¥àÎ°ù'},{color:'#f1c40f',label:'ÎÖ∏Îûë'},{color:'#e67e22',label:'Ï£ºÌô©'}],
              correctOrder:[3,0,4,2,1], hintText:'üí° "ÎÖ∏ÎûëÏù¥ Ï≤´ Î≤àÏß∏. Îπ®Í∞ï, Ï£ºÌô©, Ï¥àÎ°ù Ïàú. ÌååÎûëÏù¥ ÎßàÏßÄÎßâ"', answer:'Î¥âÏù∏Ìï¥Ï†ú' },
            hint:'ÏàúÏÑú: ÎÖ∏Îûë‚ÜíÎπ®Í∞ï‚ÜíÏ£ºÌô©‚ÜíÏ¥àÎ°ù‚ÜíÌååÎûë',
            validate:function(i){return i.replace(/\s/g,'')==='Î¥âÏù∏Ìï¥Ï†ú'} },
          { type:'interactive', interactionType:'logic', title:'‚è∞ ÌçºÏ¶ê 4: Ï¶ùÏñ∏ Î∂ÑÏÑù',
            story:'ÎÖπÏùåÍ∏∞Ïóê Ï¶ùÏù∏ 3Î™ÖÏùò Ï¶ùÏñ∏.',
            config:{ scenario:'<b>Ï¶ùÏù∏ X</b>: "ÌèêÏó≠Ïóê ÏÇ¨ÎûåÏù¥ ÏûàÏóàÎã§. Ìù∞ Í∞ÄÏö¥ÏùÑ ÏûÖÍ≥† ÏûàÏóàÎã§."<br><b>Ï¶ùÏù∏ Y</b>: "XÎäî Í±∞ÏßìÎßêÏù¥Îã§. ÌèêÏó≠ÏùÄ ÏôÑÏ†ÑÌûà ÎπÑÏñ¥ÏûàÏóàÎã§."<br><b>Ï¶ùÏù∏ Z</b>: "ÎÇòÎèÑ Ìù∞ Í∞ÄÏö¥ÏùÑ ÏûÖÏùÄ ÏÇ¨ÎûåÏùÑ Î¥§Îã§."<br><br>XÏôÄ ZÏùò Ï¶ùÏñ∏Ïù¥ ÏùºÏπòÌïúÎã§. Í±∞ÏßìÎßêÏüÅÏù¥Îäî?',
              choices:['X','Y','Z'] },
            hint:'XÏôÄ ZÍ∞Ä Í∞ôÏùÄ Ï¶ùÏñ∏. YÎßå Î∂ÄÏ†ï ‚Üí YÍ∞Ä Í±∞ÏßìÎßêÏüÅÏù¥.',
            validate:function(i){return i.toUpperCase().trim()==='Y'} },
          { type:'cpq', cpqIndex:0,
            story:'ÏãúÏÑ§ ÏµúÏã¨Î∂Ä. Ïã§ÌóòÏã§ Î¨∏ Ïïû.\nÎßàÏßÄÎßâ Ïù∏Ï¶ùÏù¥ ÌïÑÏöîÌïòÎã§.',
            storyAfter:'Ïã§ÌóòÏã§ Î¨∏Ïù¥ Ïó¥Î†∏Îã§.' }
        ],
        cliffhanger:'Ïã§ÌóòÏã§.\n\nÎ≤ΩÎ©¥ Í∞ÄÎìù ÏÇ¨ÏßÑÍ≥º ÏÑúÎ•ò. 30ÎÖÑÍ∞ÑÏùò Í∏∞Î°ù.\nÏïÑÏù¥Îì§Ïùò ÏÑ±Ïû• ÏÇ¨ÏßÑ. Í∞ôÏùÄ ÏïÑÏù¥Îì§Ïù¥ Ïñ¥Î•∏Ïù¥ ÎêòÏñ¥Í∞ÄÎäî Í≥ºÏ†ï.\n304Ìò∏ ÌôòÏûêÎì§Ïù¥Îã§.\n\nÍ∑∏Î¶¨Í≥† ÏÑúÎ•ò Îß® ÏúÑ, Ïû¨Îã® Î°úÍ≥†.\n"Íµ≠Î¶Ω Í≥†Í≥†Ìïô Î∞ïÎ¨ºÍ¥Ä ÏÇ∞Ìïò ÌäπÏàòÏó∞Íµ¨Ïû¨Îã®"\n\nÎ∞ïÎ¨ºÍ¥Ä.\nÍπÄÎèôÌòÑ ÍµêÏàòÍ∞Ä ÏÜåÏÜçÎêú Î∞îÎ°ú Í∑∏ Î∞ïÎ¨ºÍ¥Ä.\n\nÍµêÏàòÎäî Ïù¥ ÏÇ¨Ïã§ÏùÑ ÏïåÍ≥† ÏûàÏóàÎã§.\nÏïÑÎãà, ÍµêÏàòÎäî Ïù¥ Ïû¨Îã®Ïùò ÏùºÏõêÏù¥ÏóàÎã§.\n\nÎ≤ΩÏóê Î∂ôÏùÄ Ï°∞ÏßÅÎèÑ. ÏµúÏÉÅÏúÑÏóê Ï†ÅÌûå Ïù¥Î¶Ñ.\n"Ïû¨Îã® Ïù¥ÏÇ¨Ïû•: ‚ñ°‚ñ°‚ñ°"\nÏù¥Î¶ÑÏù¥ Í≤ÄÍ≤å Ïπ†Ìï¥Ï†∏ ÏûàÎã§.\n\nÌïòÏßÄÎßå ÏïÑÎûò Î©îÎ™®Í∞Ä ÏûàÎã§.\n"ÏßÄÌïò Ï†ÑÏãúÏã§ BÍ¥Ä. Î™®Îì† ÎãµÏù¥ Í±∞Í∏∞ ÏûàÎã§."'
      },
      {
        id:'ch4_museum', title:'Ch.4 ‚Äî Î∞ïÎ¨ºÍ¥ÄÏùò ÏßÄÌïò', desc:'Íµ≠Î¶Ω Î∞ïÎ¨ºÍ¥Ä Ï†ÑÏãúÍ¥Ä ÏïÑÎûò Ïà®Í≤®ÏßÑ Ïó∞Íµ¨ÏÜå.', time:'15Î∂Ñ',
        intro:'Íµ≠Î¶Ω Í≥†Í≥†Ìïô Î∞ïÎ¨ºÍ¥Ä. ÌèêÍ¥Ä ÌõÑ ÏïºÍ∞Ñ.\nÏßÄÌïò BÍ¥Ä ÏûÖÍµ¨. ÏùºÎ∞òÏù∏ Ï∂úÏûÖ Í∏àÏßÄ Íµ¨Ïó≠.\nÏπ¥ÎìúÌÇ§Í∞Ä ÏûëÎèôÌïúÎã§. ÍµêÏàòÏùò Í≤ÉÏù¥ÎãàÍπå.\nÏóòÎ¶¨Î≤†Ïù¥ÌÑ∞Í∞Ä ÏßÄÌïò 3Ï∏µÍπåÏßÄ ÎÇ¥Î†§Í∞ÑÎã§.\nÎ¨∏Ïù¥ Ïó¥Î¶¨Ïûê ÏÑúÎäòÌïú Í≥µÍ∏∞ÏôÄ Ìï®Íªò Í∏∞Í≥ÑÏùå.\nÏó¨Í∏∞Îäî Î∞ïÎ¨ºÍ¥ÄÏù¥ ÏïÑÎãàÎã§.',
        puzzles:[
          { type:'interactive', interactionType:'skill-check', title:'üîê ÌçºÏ¶ê 1: Ï†ÑÏãúÏã§ Í∏àÍ≥†',
            story:'Ï†ÑÏãúÏã§ÏùÑ ÏúÑÏû•Ìïú ÌÜµÎ°úÏùò Í∏àÍ≥†. Ï†ïÎ∞ÄÌïú Ï°∞ÏûëÏù¥ ÌïÑÏöîÌïòÎã§.\nÍ≤åÏù¥ÏßÄÏùò Ï¥àÎ°ù Íµ¨Í∞ÑÏóê ÎßûÏ∂∞ ÌÅ¥Î¶≠!',
            config:{ total:10, required:7, speed:3.5, targetSize:15, answer:'Í∏àÍ≥†Ìï¥Ï†ú' },
            hint:'10Î≤à Ï§ë 7Î≤à ÏÑ±Í≥µ ÌïÑÏöî. Î∞îÎäòÏù¥ Ï¥àÎ°ù Íµ¨Í∞ÑÏóê ÏûàÏùÑ Îïå ÌÅ¥Î¶≠!',
            validate:function(i){return i.trim()==='Í∏àÍ≥†Ìï¥Ï†ú'} },
          { type:'interactive', interactionType:'wire-cutting', title:'üîå ÌçºÏ¶ê 2: Ï†ÑÏãúÏã§ Î≥¥Ïïà',
            story:'ÏàòÏû•Í≥† ÏûÖÍµ¨ Î≥¥Ïïà ÏãúÏä§ÌÖú. 5Í∞úÏùò Ï†ÑÏÑ†.\nÏ†ÑÏãú ÏÑ§Î™ÖÎ¨∏Ïóê ÌûåÌä∏Í∞Ä Ïà®Í≤®Ï†∏ ÏûàÎã§.',
            config:{ wires:[{color:'#e74c3c',label:'Îπ®Í∞ï'},{color:'#3498db',label:'ÌååÎûë'},{color:'#2ecc71',label:'Ï¥àÎ°ù'},{color:'#f1c40f',label:'ÎÖ∏Îûë'},{color:'#9b59b6',label:'Î≥¥Îùº'}],
              correctOrder:[1,3,0,4,2], hintText:'üí° "ÌååÎûÄ ÌïòÎäò ÏïÑÎûò ÎÖ∏ÎûÄ Îì§Ìåê, Î∂âÏùÄ ÏÑùÏñëÏù¥ Î≥¥ÎùºÎπõÏúºÎ°ú Î¨ºÎì§Í≥†, Ï¥àÎ°ù ÏûéÏù¥ ÎßàÏßÄÎßâÏúºÎ°ú Îñ®Ïñ¥ÏßÑÎã§"', answer:'Î≥¥ÏïàÌÜµÍ≥º' },
            hint:'ÏÉâÍπî ÏàúÏÑú: ÌååÎûë‚ÜíÎÖ∏Îûë‚ÜíÎπ®Í∞ï‚ÜíÎ≥¥Îùº‚ÜíÏ¥àÎ°ù',
            validate:function(i){return i.replace(/\s/g,'')==='Î≥¥ÏïàÌÜµÍ≥º'} },
          { type:'interactive', interactionType:'simon', title:'üèõÔ∏è ÌçºÏ¶ê 3: Ïú†Î¨º Î≥¥Í¥ÄÌï®',
            story:'Ïú†Î¨º Î≥¥Í¥ÄÌï®Ïùò Ïù∏Ï¶ù ÏãúÏä§ÌÖú. ÏÉâÍπî Ìå®ÌÑ¥ÏùÑ Í∏∞ÏñµÌïòÍ≥† Îî∞ÎùºÌï¥Ïïº ÌïúÎã§.',
            config:{ rounds:6, answer:'Ïû¨Îã®Ïù¥ÏÇ¨Ïû•' },
            hint:'6ÎùºÏö¥Îìú Ìå®ÌÑ¥ÏùÑ Í∏∞ÏñµÌïòÏÑ∏Ïöî!',
            validate:function(i){return i.replace(/\s/g,'')==='Ïû¨Îã®Ïù¥ÏÇ¨Ïû•'} },
          { type:'interactive', interactionType:'mini-sudoku', title:'üß© ÌçºÏ¶ê 4: ÏàòÏû•Í≥† Ïû†Í∏àÏû•Ïπò',
            story:'ÏàòÏû•Í≥† ÏµúÏ¢Ö Ïû†Í∏àÏû•Ïπò. Ïà´Ïûê ÌçºÏ¶êÏùÑ ÏôÑÏÑ±ÌïòÎùº.',
            config:{ grid:[[0,0,4,0],[2,0,0,1],[0,2,0,0],[1,0,2,0]], solution:[[3,1,4,2],[2,4,3,1],[4,2,1,3],[1,3,2,4]], answer:'Î¥âÏù∏Ìï¥Ï†ú' },
            hint:'4√ó4 Ïä§ÎèÑÏø†. Îπà Ïπ∏ 8Í∞ú. Ïã†Ï§ëÌïòÍ≤å!',
            validate:function(i){return i.replace(/\s/g,'')==='Î¥âÏù∏Ìï¥Ï†ú'} },
          { type:'cpq', cpqIndex:0,
            story:'ÏµúÏã¨Î∂Ä ÎπÑÎ∞Ä ÏàòÏû•Í≥†.\n"Î™®Îì† Ï¶ùÍ±∞Í∞Ä Ïó¨Í∏∞ ÏûàÎã§."',
            storyAfter:'ÏàòÏû•Í≥†Ïùò ÏµúÏ¢Ö Î¨∏ÏÑúÍ∞Ä ÎìúÎü¨ÎÇ¨Îã§.' }
        ],
        cliffhanger:'ÏàòÏû•Í≥† Ï§ëÏïô. ÎåÄÌòï Ïä§ÌÅ¨Î¶∞.\n\nÏû¨ÏÉù Î≤ÑÌäºÏùÑ ÎàÑÎ•¥Ïûê ÏòÅÏÉÅÏù¥ ÌùòÎü¨ÎÇòÏò®Îã§.\nÏû¨Îã® Ïù¥ÏÇ¨Ïû•Ïùò ÏñºÍµ¥.\n\n"304Ìò∏ ÌôòÏûêÎì§ÏùÄ ÏÇ¨ÎùºÏßÑ Í≤å ÏïÑÎãôÎãàÎã§."\n"Í∑∏Îì§ÏùÄ ÏÑ±Í≥µÌïú Í≤ÅÎãàÎã§."\n"30ÎÖÑÍ∞ÑÏùò Ïã§ÌóòÏù¥ ÎìúÎîîÏñ¥ Í≤∞Ïã§ÏùÑ Îß∫ÏóàÏäµÎãàÎã§."\n"Ïù¥Ï†ú 2Îã®Í≥ÑÎ•º ÏãúÏûëÌï©ÎãàÎã§."\n\nÏòÅÏÉÅÏù¥ ÎÅäÍ∏¥Îã§.\n\nÏä§ÌÅ¨Î¶∞ ÏïÑÎûò ÏÑúÎ•ò. 2Îã®Í≥Ñ Í≥ÑÌöçÏÑú.\nÎ™©Ìëú: "Ïã¨Ìï¥ Ïó∞Íµ¨ÏÜå Í∞ÄÎèô"\nÏúÑÏπò: "Î∂ÅÌÉúÌèâÏñë Ìï¥Ï†Ä 1000m"\n\nÍµêÏàòÎäî Ïù¥Í±∏ ÎßâÏúºÎ†§Îã§ Í∞êÍ∏àÎãπÌïú Í≤ÉÏù¥Îã§.\nÏµúÌòÑÏö∞Îäî Ïù¥Í±∏ ÏïåÎ¶¨Î†§Îã§ ÏÇ¨ÎùºÏßÑ Í≤ÉÏù¥Îã§.\n\nÏÑúÎ•ò ÎßàÏßÄÎßâ Ï§Ñ.\n"Ïπ¥Ïö¥Ìä∏Îã§Ïö¥ ÏãúÏûë. ÏãúÍ≥ÑÌÉëÏóêÏÑú Ïã†Ìò∏Î•º Î≥¥ÎÇ¥Îùº."\n\nÎèÑÏãú Ï§ëÏã¨Ïùò ÏãúÍ≥ÑÌÉë.\n3Ïãú 33Î∂ÑÏóê Î©àÏ∂ò ÏãúÍ≥Ñ.\n\nÏπ¥Ïö¥Ìä∏Îã§Ïö¥ÏùÄ Ïù¥ÎØ∏ ÏãúÏûëÎêêÎã§.'
      }
    ]
  },
  {
    id:'deep', title:'Ïã¨Ìï¥Ïùò ÎπÑÎ∞Ä', icon:'üî±', difficulty:3,
    desc:'Î™®Îì† ÏÇ¨Í±¥Ïùò Î∞∞ÌõÑ. ÏãúÍ≥ÑÌÉëÏóêÏÑú ÏãúÏûëÎêú Ïπ¥Ïö¥Ìä∏Îã§Ïö¥. ÎÅùÎÇ¥ÏßÄ ÏïäÏúºÎ©¥ ÎÅùÎÇòÏßÄ ÏïäÎäîÎã§.',
    chapters:[
      {
        id:'ch1_clock', title:'Ch.1 ‚Äî ÏãúÍ≥ÑÌÉë', desc:'ÎèÑÏãú Ï§ëÏã¨Ïùò ÏãúÍ≥ÑÌÉë. Í∞ëÏûêÍ∏∞ Î©àÏ∂ò ÏãúÍ≥ÑÏôÄ Ìï®Íªò ÏãúÏûëÎêòÎäî Ïπ¥Ïö¥Ìä∏Îã§Ïö¥.', time:'14Î∂Ñ',
        intro:'Í≥†Îîï ÏãúÍ≥ÑÌÉë. 50ÎÖÑÍ∞Ñ Ìïú Î≤àÎèÑ Î©àÏ∂îÏßÄ ÏïäÏïòÎã§.\nÏßÄÍ∏àÏùÄ 3Ïãú 33Î∂ÑÏóê Î©àÏ∂∞ ÏûàÎã§.\nÏ¢ÖÏßÄÍ∏∞ Î∞ïÏãúÍ≥ÑÍ∞Ä ÏÇ¨ÎùºÏ°åÎã§.\nÌÉë Íº≠ÎåÄÍ∏∞Ïóê Ïò¨ÎùºÏÑúÏûê Í≥ÑÎã®Ïù¥ Î¨¥ÎÑàÏ°åÎã§.\nÍ∏∞Ïñ¥ ÎèåÏïÑÍ∞ÄÎäî ÏÜåÎ¶¨ ÏÇ¨Ïù¥Î°ú Îπ®Í∞Ñ LED Ïà´ÏûêÍ∞Ä ÍπúÎπ°Ïù∏Îã§.\nÏπ¥Ïö¥Ìä∏Îã§Ïö¥. 72:00:00.',
        puzzles:[
          { type:'interactive', interactionType:'mastermind', title:'‚è∞ ÌçºÏ¶ê 1: ÏãúÍ≥Ñ Í∏∞Ïñ¥ ÏΩîÎìú',
            story:'ÏãúÍ≥Ñ Í∏∞Ïñ¥ Ïû•ÏπòÏùò Ïû†Í∏à ÏΩîÎìú. 4ÏûêÎ¶¨ Ïà´ÏûêÎ•º Ï∂îÎ°†ÌïòÎùº.',
            config:{ answer:[3,7,1,5], digits:4, maxAttempts:8, maxNum:8, answerStr:'Í∏∞Ïñ¥Ìï¥Ï†ú' },
            hint:'4ÏûêÎ¶¨ Ïà´Ïûê(1~8). Ïä§Ìä∏ÎùºÏù¥ÌÅ¨/Î≥ºÎ°ú Ï∂îÎ°†! 8Ìöå Ïù¥ÎÇ¥Ïóê ÎßûÏ∂îÏÑ∏Ïöî.',
            validate:function(i){return i.trim()==='Í∏∞Ïñ¥Ìï¥Ï†ú'} },
          { type:'interactive', interactionType:'pipe-connect', title:'‚öôÔ∏è ÌçºÏ¶ê 2: ÏãúÍ≥Ñ Í∏∞Ïñ¥ Ïó∞Í≤∞',
            story:'ÏãúÍ≥Ñ ÎÇ¥Î∂Ä Í∏∞Ïñ¥Í∞Ä Îπ†Ï†∏ÏûàÎã§. Í∏∞Ïñ¥ Ïó∞Í≤∞Í¥ÄÏùÑ Ïò¨Î∞îÎ•¥Í≤å Î∞∞ÏπòÌï¥Ïïº ÏãúÍ≥ÑÍ∞Ä Îã§Ïãú ÏûëÎèôÌïúÎã§.',
            config:{ size:5, answer:'ÏãúÍ≥ÑÏûëÎèô',
              start:{r:0,c:0}, end:{r:4,c:4},
              pipes:[
                {r:0,c:0,type:'corner',initial:3,correct:1},
                {r:1,c:0,type:'straight',initial:0,correct:1},
                {r:2,c:0,type:'corner',initial:1,correct:0},
                {r:2,c:1,type:'straight',initial:1,correct:0},
                {r:2,c:2,type:'corner',initial:3,correct:1},
                {r:3,c:2,type:'straight',initial:0,correct:1},
                {r:4,c:2,type:'corner',initial:2,correct:0},
                {r:4,c:3,type:'straight',initial:1,correct:0},
                {r:4,c:4,type:'corner',initial:1,correct:3}
              ] },
            hint:'5√ó5 Í≤©Ïûê. ÏûÖÍµ¨‚ÜíÏ∂úÍµ¨ÍπåÏßÄ ÌååÏù¥ÌîÑÎ•º Ïó∞Í≤∞!',
            validate:function(i){return i.replace(/\s/g,'')==='ÏãúÍ≥ÑÏûëÎèô'} },
          { type:'interactive', interactionType:'skill-check', title:'üîê ÌçºÏ¶ê 3: Ï¢ÖÎ£® Ïû†Í∏àÏû•Ïπò',
            story:'Ï¢ÖÎ£® Î¨∏Ïùò Ï†ïÎ∞Ä Ïû†Í∏àÏû•Ïπò. Îß§Ïö∞ ÎÜíÏùÄ Ï†ïÎ∞ÄÎèÑÍ∞Ä ÌïÑÏöîÌïòÎã§.',
            config:{ total:10, required:8, speed:4, targetSize:12, answer:'Ï¢ÖÎ£®Ïó¥Î¶º' },
            hint:'10Î≤à Ï§ë 8Î≤à ÏÑ±Í≥µ ÌïÑÏöî! ÏÜçÎèÑÍ∞Ä Îπ†Î•¥Îãà ÏßëÏ§ëÌïòÏÑ∏Ïöî.',
            validate:function(i){return i.trim()==='Ï¢ÖÎ£®Ïó¥Î¶º'} },
          { type:'interactive', interactionType:'simon', title:'üîî ÌçºÏ¶ê 4: Ï¢ÖÏÜåÎ¶¨ ÏàúÏÑú',
            story:'Ï¢ÖÎ£®Ïùò 4Í∞ú Ï¢ÖÏù¥ ÌäπÏ†ï ÏàúÏÑúÎ°ú Ïö∏Î†§Ïïº ÎπÑÎ∞Ä Î∞©Ïù¥ Ïó¥Î¶∞Îã§.\nÏ¢ÖÏùò Ìå®ÌÑ¥ÏùÑ Í∏∞ÏñµÌïòÍ≥† Îî∞ÎùºÌïòÎùº.',
            config:{ rounds:7, answer:'Ìï¥Ï†ÄÏó∞Íµ¨ÏÜå' },
            hint:'7ÎùºÏö¥Îìú! Ï¢ÖÏÜåÎ¶¨(ÏÉâÍπî) Ìå®ÌÑ¥ÏùÑ Ï†ïÌôïÌûà Í∏∞ÏñµÌïòÏÑ∏Ïöî.',
            validate:function(i){return i.replace(/\s/g,'')==='Ìï¥Ï†ÄÏó∞Íµ¨ÏÜå'} },
          { type:'cpq', cpqIndex:0,
            story:'ÏãúÍ≥Ñ ÎÇ¥Î∂Ä Ïà®Í≤®ÏßÑ Î∞©. Ï¢åÌëúÍ∞Ä ÏÉàÍ≤®ÏßÑ Í∏àÏÜçÌåê.',
            storyAfter:'Í∏àÏÜçÌåê Îí∑Î©¥Ïùò Î©îÏãúÏßÄÍ∞Ä Ìï¥ÎèÖÎêêÎã§.' }
        ],
        cliffhanger:'Í∏àÏÜçÌåê Îí∑Î©¥.\nÌï¥Ï†Ä Ï¢åÌëú: N 35¬∞12\'48" E 129¬∞45\'36"\n\nÍ∑∏Î¶¨Í≥† Ìïú Ï§ÑÏùò Î©îÏãúÏßÄ.\n"Î™®Îì† ÎãµÏùÄ Î∞îÎã§ ÏïÑÎûòÏóê ÏûàÎã§."\n\nÏπ¥Ïö¥Ìä∏Îã§Ïö¥Ïù¥ Î©àÏ∑ÑÎã§.\nÏãúÍ≥ÑÍ∞Ä Îã§Ïãú ÏõÄÏßÅÏù¥Í∏∞ ÏãúÏûëÌïúÎã§.\n\nÌïòÏßÄÎßå Î∞©Ìñ•Ïù¥ Î∞òÎåÄÎã§.\nÏãúÍ≥ÑÍ∞Ä Í±∞Íæ∏Î°ú Í∞ÄÍ≥† ÏûàÎã§.\n\nÏ¢ÖÏßÄÍ∏∞Ïùò ÎßàÏßÄÎßâ Î©îÎ™®.\n"Ïù¥ ÏÇ¨Í±¥ÏùÑ 20ÎÖÑÍ∞Ñ Ï∂îÏ†ÅÌï¥Ïò® ÏÇ¨ÎûåÏù¥ ÏûàÎã§."\n"ÌÉêÏ†ï Ïû•ÌòúÎ¶∞. Í∑∏ÎÖÄÏùò ÏÇ¨Î¨¥ÏÜåÏóê Î™®Îì† Ïó∞Í≤∞Í≥†Î¶¨Í∞Ä ÏûàÎã§."'
      },
      {
        id:'ch2_detective', title:'Ch.2 ‚Äî ÌÉêÏ†ï ÏÇ¨Î¨¥ÏÜå', desc:'20ÎÖÑÍ∞Ñ Ïù¥ ÏÇ¨Í±¥ÏùÑ Ï∂îÏ†ÅÌï¥Ïò® ÌÉêÏ†ï. Î™®Îì† Ïó∞Í≤∞Í≥†Î¶¨Î•º Ï†ïÎ¶¨ÌïúÎã§.', time:'13Î∂Ñ',
        intro:'ÏÇ¨Î¶ΩÌÉêÏ†ï Ïû•ÌòúÎ¶∞. 20ÎÖÑ Í≤ΩÎ†•.\n"Í≤∞Ï†ïÏ†Å Îã®ÏÑúÎ•º Ï∞æÏïòÎã§"Îäî Ï†ÑÌôîÎ•º ÎßàÏßÄÎßâÏúºÎ°ú 3ÏùºÏß∏ Ïó∞ÎùΩ ÎëêÏ†à.\nÏÇ¨Î¨¥ÏÜåÏóê Îì§Ïñ¥ÏÑúÏûê ÏùåÏÑ±Ïù¥ ÌùòÎü¨ÎÇòÏò®Îã§.\n"Ïó¨Í∏∞ÍπåÏßÄ ÏôîÎã§Î©¥, ÎãπÏã†ÎèÑ ÏßÑÏã§Ïóê Í∞ÄÍπåÏõåÏßÑ Í±∞Ïïº."\n"ÎÇ¥Í∞Ä Ï†ïÎ¶¨Ìïú Í±∏ Î¥ê. Î™®Îì† Í±¥ Ïó∞Í≤∞ÎêòÏñ¥ ÏûàÏñ¥."',
        puzzles:[
          { type:'interactive', interactionType:'jigsaw', title:'üîç ÌçºÏ¶ê 1: ÏÇ¨Í±¥ ÏàòÏ≤© Ï°∞Í∞Å',
            story:'Ïû•ÌòúÎ¶∞Ïùò ÏÇ¨Í±¥ ÏàòÏ≤©Ïù¥ Ï∞¢Ïñ¥Ï†∏ ÏûàÎã§. Ï°∞Í∞ÅÏùÑ ÎßûÏ∂îÎ©¥ Ïö©ÏùòÏûêÍ∞Ä ÎìúÎü¨ÎÇúÎã§.',
            config:{ pieces:['ÍπÄÎåÄÌëú: 9Ïãú ÌöåÏùò Ï§ë','Î∞ïÏ∞®Ïû•: 9Ïãú ÏòÅÌôîÍ¥Ä','ÏµúÎ∂ÄÏû•: 9Ïãú Ïù¥Îèô Ï§ë','Ïù¥ÎπÑÏÑú: 9Ïãú ÏÇ¨Ïö∞ÎÇò'], cols:2,
              correctOrder:[0,1,2,3], revealText:'Ïù¥Îèô Ï§ëÏù∏ ÏÇ¨Îûå = ÏµúÎ∂ÄÏû•. Îãµ: Ïµú' },
            hint:'9ÏãúÏóê ÏûêÏú†Î°≠Í≤å Ïù¥Îèô Í∞ÄÎä•Ìïú ÏÇ¨Îûå = ÏµúÎ∂ÄÏû•',
            validate:function(i){return i.trim()==='Ïµú'} },
          { type:'interactive', interactionType:'wire-cutting', title:'üîå ÌçºÏ¶ê 2: ÎÖπÏùåÍ∏∞ Ìï¥Ï†ú',
            story:'Ïû•ÌòúÎ¶∞Ïùò Í∏àÍ≥† Ïïà ÎÖπÏùåÍ∏∞. 6Í∞úÏùò Ï†ÑÏÑ†Ïù¥ Î∂ÄÎπÑÌä∏Îû©ÏúºÎ°ú Ïó∞Í≤∞ÎêòÏñ¥ ÏûàÎã§.\nÏûòÎ™ª ÏûêÎ•¥Î©¥ ÎÖπÏùåÏù¥ ÏßÄÏõåÏßÑÎã§!',
            config:{ wires:[{color:'#e74c3c',label:'Îπ®Í∞ï'},{color:'#3498db',label:'ÌååÎûë'},{color:'#2ecc71',label:'Ï¥àÎ°ù'},{color:'#f1c40f',label:'ÎÖ∏Îûë'},{color:'#9b59b6',label:'Î≥¥Îùº'},{color:'#e67e22',label:'Ï£ºÌô©'}],
              correctOrder:[5,2,3,0,4,1], hintText:'üí° Ïû•ÌòúÎ¶∞ Î©îÎ™®: "Ï£ºÌô©ÏÉâ ÎÖ∏ÏùÑ, Ï¥àÎ°ù Ïûé, ÎÖ∏ÎûÄ Îì§Ìåê, Îπ®Í∞Ñ ÏÑùÏñë, Î≥¥ÎùºÎπõ Ìô©Ìòº, ÌååÎûÄ Î∞§"', answer:'ÎÖπÏùåÏû¨ÏÉù' },
            hint:'ÏàúÏÑú: Ï£ºÌô©‚ÜíÏ¥àÎ°ù‚ÜíÎÖ∏Îûë‚ÜíÎπ®Í∞ï‚ÜíÎ≥¥Îùº‚ÜíÌååÎûë',
            validate:function(i){return i.replace(/\s/g,'')==='ÎÖπÏùåÏû¨ÏÉù'} },
          { type:'interactive', interactionType:'memory-card', title:'üì∏ ÌçºÏ¶ê 3: Ïö©ÏùòÏûê ÏÇ¨ÏßÑ',
            story:'ÏàòÏÇ¨ÌåêÏóê Î∂ôÏùÄ Ïö©ÏùòÏûê ÏÇ¨ÏßÑÎì§. Í∞ôÏùÄ Ïù∏Î¨ºÏùò ÏÇ¨ÏßÑ ÏßùÏùÑ ÎßûÏ∂∞Îùº.',
            config:{ pairs:['üë§','üïµÔ∏è','üë®‚Äç‚öïÔ∏è','üë®‚Äçüî¨','üßë‚Äçüíº','üé≠'], answer:'ÎÇ¥Î∂ÄÏ≤©Ïûê' },
            hint:'6ÏåçÏùò Ïπ¥ÎìúÎ•º Î™®Îëê Îß§Ïπ≠ÌïòÏÑ∏Ïöî.',
            validate:function(i){return i.replace(/\s/g,'')==='ÎÇ¥Î∂ÄÏ≤©Ïûê'} },
          { type:'interactive', interactionType:'logic', title:'üìã ÌçºÏ¶ê 4: ÏµúÏ¢Ö Ïö©ÏùòÏûê',
            story:'ÏàòÏÇ¨ ÎÖ∏Ìä∏Ïùò ÎßàÏßÄÎßâ ÌéòÏù¥ÏßÄ. Ïö©ÏùòÏûê 3Î™ÖÏùò ÏßÑÏà†ÏùÑ Î∂ÑÏÑùÌïòÎùº.',
            config:{ scenario:'<b>Ïö©ÏùòÏûê Áî≤</b>: "ÎÇòÎäî Ïû¨Îã®Í≥º Î¨¥Í¥ÄÌïòÎã§."<br><b>Ïö©ÏùòÏûê ‰πô</b>: "Áî≤ÏùÄ Ïû¨Îã® ÏÜåÏÜçÏù¥Îã§."<br><b>Ïö©ÏùòÏûê ‰∏ô</b>: "‰πôÏùò ÎßêÏù¥ ÏÇ¨Ïã§Ïù¥Îã§."<br><br>Áî≤, ‰πô, ‰∏ô Ï§ë Ïû¨Îã®Ïùò ÎÇ¥Î∂Ä Ï≤©ÏûêÎäî?',
              choices:['Áî≤','‰πô','‰∏ô'] },
            hint:'‰πôÍ≥º ‰∏ôÏùò ÏßÑÏà†Ïù¥ ÏùºÏπò. Áî≤Îßå Î∂ÄÏ†ï ‚Üí Áî≤Ïù¥ Í±∞ÏßìÎßê ‚Üí Áî≤Ïù¥ Ïû¨Îã® ÏÜåÏÜç.',
            validate:function(i){return i.trim()==='Áî≤'} },
          { type:'cpq', cpqIndex:0,
            story:'"ÏßÑÎ≤îÏùÑ Ï∞æÏïòÎã§. Í∞êÏãúÎãπÌïòÍ≥† ÏûàÎã§."\nÏû•ÌòúÎ¶∞Ïù¥ ÎßàÏßÄÎßâÏúºÎ°ú Ìñ•ÌïòÎ†§Îçò Ïû•ÏÜå.',
            storyAfter:'Ïû•ÌòúÎ¶∞Ïùò ÎßàÏßÄÎßâ ÎÖπÏùåÏù¥ Ïû¨ÏÉùÎêêÎã§.' }
        ],
        cliffhanger:'Ïû•ÌòúÎ¶∞Ïùò ÎßàÏßÄÎßâ ÎÖπÏùå.\n\n"20ÎÖÑÍ∞Ñ Ï∂îÏ†ÅÌïú ÎÅùÏóê Î™®Îì† Í±∏ Ïó∞Í≤∞ÌñàÏñ¥."\n"ÍµêÏàò ÍπÄÎèôÌòÑ, ÎßàÏà†ÏÇ¨ ÏµúÌòÑÏö∞, ÏÑ∏ Î≤àÏß∏ ÎÇ®Ïûê."\n"304Ìò∏ ÌôòÏûêÎì§, Íµ¨ÏÑ∏Ï£º Í≥†ÏïÑÏõê, ÏÑ∏Ï¢ÖÍ≥† ÌôîÏû¨."\n"Ï†ÑÎ∂Ä ÌïòÎÇòÏùò ÌîÑÎ°úÏ†ùÌä∏Ïïº."\n"ÏΩîÎìúÎ™Ö: QUBE."\n\n"Ìï¥Ï†Ä Ïó∞Íµ¨ÏÜå. Î∂ÅÌÉúÌèâÏñë ÏàòÏã¨ 1000m."\n"Í±∞Í∏∞ÏÑú Î™®Îì† Í≤å ÏãúÏûëÎêêÍ≥†, Í±∞Í∏∞ÏÑú ÎÅùÎÇ¥Ïïº Ìï¥."\n"ÎÇòÎäî ÏßÄÍ∏à Í∑∏Í≥≥ÏúºÎ°ú Í∞ÑÎã§."\n\nÎÖπÏùåÏù¥ ÎÅäÍ∏¥Îã§.\n\nÏ±ÖÏÉÅ ÏÑúÎûçÏóê Ïû†ÏàòÏ†ï ÌÉëÏäπÍ∂å Îëê Ïû•.\nÌïú Ïû•ÏùÄ Ïû•ÌòúÎ¶∞ Í≤É. Ìïú Ïû•ÏùÄ... ÎπÑÏñ¥ ÏûàÎã§.\n\nÎãπÏã†Ïùò Ïù¥Î¶ÑÏùÑ Ï†ÅÏúºÎùºÎäî ÎúªÏù¥Îã§.'
      },
      {
        id:'ch3_abyss', title:'Ch.3 ‚Äî Ìï¥Ï†Ä Ïó∞Íµ¨ÏÜå', desc:'ÏàòÏã¨ 1000m. Î™®Îì† Îñ°Î∞•Ïù¥ ÌöåÏàòÎêòÎäî ÏµúÏ¢Ö Ïä§ÌÖåÏù¥ÏßÄ.', time:'20Î∂Ñ',
        intro:'Ïû†ÏàòÏ†ïÏù¥ ÌïòÍ∞ïÌïúÎã§. ÏàòÏã¨ 100m... 500m... 1000m.\nÌï¥Ï†Ä Ïó∞Íµ¨ÏÜå "Îî• Î∏îÎ£®". Ï∞ΩÎ∞ñÏúºÎ°ú Ìë∏Î•∏ ÎπõÏù¥ ÌùêÎ•∏Îã§.\nÎèÑÌÇπ ÏôÑÎ£å. ÏóêÏñ¥Î°ùÏù¥ Ïó¥Î¶∞Îã§.\nÏû•ÌòúÎ¶∞Ïù¥ ÏûàÎã§. ÏÇ¥ÏïÑ ÏûàÎã§.\n"ÎìúÎîîÏñ¥ ÏôîÍµ¨ÎÇò. Ïù¥Ï†ú ÎÅùÎÇº ÎïåÏïº."\nÏÇ∞ÏÜå ÏûîÎüâ: 3ÏãúÍ∞Ñ. ÏãúÍ∞ÑÏù¥ ÏóÜÎã§.',
        puzzles:[
          { type:'interactive', interactionType:'skill-check', title:'üîê ÌçºÏ¶ê 1: ÏóêÏñ¥Î°ù Ïû†Í∏àÏû•Ïπò',
            story:'Ï§ëÏïô Ï†úÏñ¥Ïã§ ÏóêÏñ¥Î°ù. Í∑πÎèÑÎ°ú Ï†ïÎ∞ÄÌïú Ï°∞ÏûëÏù¥ ÌïÑÏöîÌïòÎã§.\nÏã§Ìå®ÌïòÎ©¥ Ïπ®ÏàòÎêúÎã§.',
            config:{ total:10, required:8, speed:4.5, targetSize:10, answer:'ÏóêÏñ¥Î°ùÌï¥Ï†ú' },
            hint:'10Î≤à Ï§ë 8Î≤à! ÏÜçÎèÑÍ∞Ä Îß§Ïö∞ Îπ†Î¶ÖÎãàÎã§. ÏßëÏ§ë!',
            validate:function(i){return i.replace(/\s/g,'')==='ÏóêÏñ¥Î°ùÌï¥Ï†ú'} },
          { type:'interactive', interactionType:'trivia', title:'üìä ÌçºÏ¶ê 2: Ïó∞Íµ¨Ïã§ Ïû†Í∏àÏû•Ïπò',
            story:'Í¥ÄÏ∏° Í∏∞Î°ùÏã§Ïùò Ïû†Í∏àÏû•ÏπòÏóê ÏßàÎ¨∏Ïù¥ Ï†ÅÌòÄ ÏûàÎã§.\n"Ïã¨Ìï¥Î•º ÏïÑÎäî ÏûêÎßå Ïó¥ Ïàò ÏûàÎã§."',
            config:{ question:'Ìï¥Ï†ÄÏóêÏÑú Îú®Í±∞Ïö¥ Î¨ºÏù¥ Î∂ÑÏ∂úÎêòÎ©∞ ÎèÖÌäπÌïú ÏÉùÌÉúÍ≥ÑÎ•º ÌòïÏÑ±ÌïòÎäî ÏßÄÌòïÏùÑ Î¨¥ÏóáÏù¥Îùº ÌïòÎäîÍ∞Ä?', options:['Ïó¥ÏàòÍµ¨','Ìï¥Íµ¨','Ìï¥Ï†ÄÏÇ∞','ÎåÄÎ•ôÎ∂ï'] },
            hint:'Ïó¥ÏàòÍµ¨(Hydrothermal vent). Ïã¨Ìï¥ Î∞îÎã•ÏóêÏÑú Îú®Í±∞Ïö¥ Í¥ëÎ¨ºÏàòÍ∞Ä Î∂ÑÏ∂úÎêòÎäî Í≥≥.',
            validate:function(i){return i.replace(/\s/g,'').indexOf('Ïó¥ÏàòÍµ¨')!==-1} },
          { type:'interactive', interactionType:'pipe-connect', title:'üîß ÌçºÏ¶ê 3: ÏÇ∞ÏÜå Î∞∞Í¥Ä',
            story:'ÏÇ∞ÏÜå Í≥µÍ∏â Î∞∞Í¥ÄÏù¥ ÎÅäÏñ¥Ï°åÎã§! Î∞∞Í¥ÄÏùÑ Ïò¨Î∞îÎ•¥Í≤å Ïó∞Í≤∞Ìï¥Ïïº ÏÇ∞ÏÜåÍ∞Ä Í≥µÍ∏âÎêúÎã§.',
            config:{ size:5, answer:'ÏÇ∞ÏÜåÍ≥µÍ∏â',
              start:{r:0,c:0}, end:{r:4,c:4},
              pipes:[
                {r:0,c:0,type:'straight',initial:1,correct:0},
                {r:0,c:1,type:'straight',initial:1,correct:0},
                {r:0,c:2,type:'corner',initial:0,correct:1},
                {r:1,c:2,type:'corner',initial:3,correct:0},
                {r:1,c:3,type:'corner',initial:0,correct:1},
                {r:2,c:3,type:'straight',initial:0,correct:1},
                {r:3,c:3,type:'corner',initial:1,correct:2},
                {r:3,c:2,type:'corner',initial:2,correct:0},
                {r:3,c:1,type:'corner',initial:0,correct:1},
                {r:4,c:1,type:'corner',initial:3,correct:0},
                {r:4,c:2,type:'straight',initial:1,correct:0},
                {r:4,c:3,type:'straight',initial:1,correct:0},
                {r:4,c:4,type:'corner',initial:0,correct:3}
              ] },
            hint:'5√ó5 Í≤©Ïûê. ÏÇ∞ÏÜå ÏûÖÍµ¨‚ÜíÏ∂úÍµ¨ Ïó∞Í≤∞! ÏãúÍ∞ÑÏù¥ ÏóÜÎã§!',
            validate:function(i){return i.replace(/\s/g,'')==='ÏÇ∞ÏÜåÍ≥µÍ∏â'} },
          { type:'interactive', interactionType:'mastermind', title:'üí£ ÌçºÏ¶ê 4: ÏûêÌè≠ ÏΩîÎìú Ìï¥Ï†ú',
            story:'ÏûêÌè≠ Ïû•ÏπòÍ∞Ä Í∞ÄÎèôÎêêÎã§! 4ÏûêÎ¶¨ Ìï¥Ï†ú ÏΩîÎìúÎ•º Ï∂îÎ°†ÌïòÎùº.\nÏã§Ìå®ÌïòÎ©¥ Ïó∞Íµ¨ÏÜåÍ∞Ä Ìè≠Î∞úÌïúÎã§.',
            config:{ answer:[6,2,8,4], digits:4, maxAttempts:8, maxNum:8, answerStr:'ÏûêÌè≠Ìï¥Ï†ú' },
            hint:'4ÏûêÎ¶¨ Ïà´Ïûê(1~8). ÏµúÎåÄ 8Ìöå. Ïä§Ìä∏ÎùºÏù¥ÌÅ¨/Î≥ºÎ°ú Îπ†Î•¥Í≤å Ï∂îÎ°†!',
            validate:function(i){return i.trim()==='ÏûêÌè≠Ìï¥Ï†ú'} },
          { type:'cpq', cpqIndex:0,
            story:'"Ïù¥ ÏÉùÎ™ÖÏ≤¥Îì§ÏùÄ ÏßÄÍµ¨ ÏÉùÎ™ÖÏ≤¥Í∞Ä ÏïÑÎãàÎã§."\nÏµúÏ¢Ö Ï¢åÌëú. ÎßàÏßÄÎßâ Ïû•ÏÜåÏùò Í±∞Î¶¨Î•º Ï∏°Ï†ïÌïòÎùº.',
            storyAfter:'ÎπÑÏÉÅ ÌÉàÏ∂ú ÏãúÏä§ÌÖúÏù¥ Í∞ÄÎèôÎêêÎã§.' }
        ],
        cliffhanger:'ÌÉàÏ∂ú ÏßÅÏ†Ñ, Ïû•ÌòúÎ¶∞Ïù¥ Ï§ëÏïô Ïª¥Ìì®ÌÑ∞Ïùò ÎßàÏßÄÎßâ ÌååÏùºÏùÑ Ïó¥ÏóàÎã§.\n\nQUBE ÌîÑÎ°úÏ†ùÌä∏ ÏµúÏ¢Ö Î≥¥Í≥†ÏÑú.\n\n"1994ÎÖÑ, ÏÑ∏Ï¢ÖÍ≥† ÏßÄÌïòÏã§ÏóêÏÑú Î∞úÍ≤¨Îêú ÎØ∏ÏßÄÏùò Î¨ºÏßà."\n"ÏÑ∏ Î™ÖÏùò ÌïôÏÉùÏù¥ Î™©Í≤©. ÍπÄÎèôÌòÑ, ÏµúÌòÑÏö∞, Í∑∏Î¶¨Í≥† ‚ñà‚ñà‚ñà‚ñà."\n"Î¨ºÏßàÏùÄ Ìï¥Ï†ÄÏóêÏÑú Ïò® Í≤ÉÏù¥ÏóàÎã§."\n"30ÎÖÑÍ∞ÑÏùò Ïó∞Íµ¨ Í≤∞Í≥º: Ïù¥Í≤ÉÏùÄ Ïã†Ìò∏ÏòÄÎã§."\n"ÎàÑÍµ∞Í∞Ä Ïö∞Î¶¨ÏóêÍ≤å Î≥¥ÎÇ∏ Î©îÏãúÏßÄ."\n\nÏû•ÌòúÎ¶∞Ïù¥ ÎßêÌñàÎã§.\n"ÍµêÏàòÎèÑ, ÎßàÏà†ÏÇ¨ÎèÑ, ÌôòÏûêÎì§ÎèÑ... Ï†ÑÎ∂Ä Ïù¥ ÎπÑÎ∞ÄÏùÑ ÏßÄÌÇ§Í∏∞ ÏúÑÌï¥ Ìù¨ÏÉùÎêú Í±∞Ïïº."\n"ÌïòÏßÄÎßå Ïù¥Ï†ú ÏÑ∏ÏÉÅÏù¥ ÏïåÏïÑÏïº Ìï¥."\n\nÎπÑÏÉÅ ÌÉàÏ∂ú Ìè¨ÎìúÍ∞Ä ÏÉÅÏäπÌïúÎã§.\nÏàòÎ©¥ ÏúÑÎ°ú Îñ†Ïò§Î•¥Îäî ÏàúÍ∞Ñ, ÎùºÎîîÏò§ÏóêÏÑú Îâ¥Ïä§Í∞Ä ÌùòÎü¨ÎÇòÏò®Îã§.\n\n"ÏÜçÎ≥¥ÏûÖÎãàÎã§. Íµ≠Î¶Ω Í≥†Í≥†Ìïô Î∞ïÎ¨ºÍ¥Ä ÌäπÏàòÏó∞Íµ¨Ïû¨Îã®Ïùò ÎπÑÎ∞Ä Ïã§ÌóòÏù¥ Ìè≠Î°úÎêòÏóàÏäµÎãàÎã§."\n"Ïã§Ï¢ÖÎêú ÍµêÏàò ÍπÄÎèôÌòÑÏù¥ Î¨¥ÏÇ¨Ìûà Íµ¨Ï∂úÎêòÏóàÏúºÎ©∞..."\n\nÏµúÌòÑÏö∞Ïùò ÎßàÏßÄÎßâ Ìä∏Î¶≠.\nÍ∑∏Îäî ÏÇ¨ÎùºÏßÑ Í≤å ÏïÑÎãàÎùº, Ï¶ùÍ±∞Î•º ÏÑ∏ÏÉÅÏóê Î≥¥ÎÇ¥Í≥† ÏûàÏóàÎã§.\n\nÎãπÏã†ÏùÄ Ìï¥ÎÉàÎã§.\n\nüèÜ QUBE ‚Äî ALL CLEAR'
      }
    ]
  }
];

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   Game Engine
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
var state = { currentSeries:null, currentChapter:null, currentPuzzle:0, cpqCampaigns:[], startTime:null, attempts:0, hintCount:0, hintPenalty:0 };

function getProgress() { try{return JSON.parse(localStorage.getItem('qube_progress')||'{}');}catch(e){return {};} }
function saveProgressData(p) { localStorage.setItem('qube_progress', JSON.stringify(p)); }
function isChapterCleared(sid,cid) { var p=getProgress(); return !!(p[sid]&&p[sid][cid]); }
function isChapterUnlocked(si,ci) { if(ci===0) return true; var s=SERIES[si]; return isChapterCleared(s.id,s.chapters[ci-1].id); }
function isSeriesUnlocked(si){return true;}
function isSeriesCleared(si){var s=SERIES[si];for(var i=0;i<s.chapters.length;i++)if(!isChapterCleared(s.id,s.chapters[i].id))return false;return true;}
function getTotalCleared(){var c=0;SERIES.forEach(function(s){s.chapters.forEach(function(ch){if(isChapterCleared(s.id,ch.id))c++;});});return c;}
function getSeriesCleared(){var c=0;SERIES.forEach(function(_,si){if(isSeriesCleared(si))c++;});return c;}
function getGrade(c){return c>=10?'üïµÔ∏è ÏÖúÎ°ù':c>=7?'üîç Î™ÖÌÉêÏ†ï':c>=4?'üßê ÌÉêÏ†ï':c>=2?'üìã ÏàòÏäµÌÉêÏ†ï':'üî∞ Ï¥àÎ≥¥ÌÉêÏ†ï';}
function formatTime(s){return Math.floor(s/60)+':'+String(s%60).padStart(2,'0');}

function createParticles(){var c=document.getElementById('particles');for(var i=0;i<50;i++){var p=document.createElement('div');p.className='particle';p.style.left=Math.random()*100+'%';p.style.animationDuration=(8+Math.random()*12)+'s';p.style.animationDelay=Math.random()*10+'s';var sz=(2+Math.random()*3)+'px';p.style.width=p.style.height=sz;p.style.background=Math.random()>.5?'#b44aff':'#00e5ff';p.style.boxShadow='0 0 6px '+p.style.background;c.appendChild(p);}}
function scrollToSeries(){document.getElementById('series-section').scrollIntoView({behavior:'smooth'});}

function showScreen(id){['home','chapters','game','result'].forEach(function(s){document.getElementById(s).classList.toggle('hidden',s!==id);});document.getElementById('loadingScreen').classList.remove('active');if(id!=='home')window.scrollTo(0,0);}
function goHome(){cleanupInteractive();state.currentSeries=null;state.currentChapter=null;showScreen('home');renderHome();}
function confirmExit(){if(confirm('Ï†ïÎßê ÎÇòÍ∞ÄÏãúÍ≤†ÏäµÎãàÍπå? ÏßÑÌñâ ÏÉÅÌô©Ïù¥ Ï¥àÍ∏∞ÌôîÎê©ÎãàÎã§.'))goHome();}

function renderHome(){
  var cleared=getTotalCleared(),totalChapters=0;
  SERIES.forEach(function(s){totalChapters+=s.chapters.length;});
  document.getElementById('statCleared').textContent=cleared;
  document.getElementById('statGrade').textContent=getGrade(cleared).split(' ')[0];
  document.getElementById('statStreak').textContent=getSeriesCleared();
  document.getElementById('seriesProgressText').textContent='‚úÖ '+cleared+'/'+totalChapters+' Ï±ïÌÑ∞ ÌÅ¥Î¶¨Ïñ¥';
  var html='';
  for(var si=0;si<SERIES.length;si++){
    var s=SERIES[si],unlocked=isSeriesUnlocked(si),serCleared=isSeriesCleared(si),chapCleared=0;
    for(var ci=0;ci<s.chapters.length;ci++)if(isChapterCleared(s.id,s.chapters[ci].id))chapCleared++;
    var stars='';for(var d=0;d<3;d++)stars+='<span class="star '+(d<s.difficulty?'':'empty')+'">'+(d<s.difficulty?'‚òÖ':'‚òÜ')+'</span>';
    var badge='';
    if(serCleared)badge='<span class="series-badge badge-clear">‚úÖ ÌÅ¥Î¶¨Ïñ¥</span>';
    else if(chapCleared>0)badge='<span class="series-badge badge-progress">'+chapCleared+'/'+s.chapters.length+'</span>';
    else if(unlocked)badge='<span class="series-badge badge-new">NEW</span>';
    var lockOverlay='';
    if(!unlocked){var prevTitle=si>0?SERIES[si-1].title:'';lockOverlay='<div class="series-lock-overlay"><span>üîí "'+prevTitle+'" ÌÅ¥Î¶¨Ïñ¥ Ïãú Ìï¥Í∏à</span></div>';}
    html+='<div class="series-card '+(unlocked?'':'locked')+' '+(serCleared?'cleared':'')+'" onclick="'+(unlocked?'openSeries('+si+')':'')+'">';
    html+=lockOverlay+'<div class="series-header"><div class="series-icon">'+s.icon+'</div><div class="series-info"><div class="series-title">'+s.title+'</div><div class="series-diff">'+stars+'</div></div>'+badge+'</div>';
    html+='<div class="series-desc">'+s.desc+'</div><div class="series-footer"><div class="series-chapter-progress">';
    for(var ci2=0;ci2<s.chapters.length;ci2++){if(isChapterCleared(s.id,s.chapters[ci2].id))html+='<span class="done">‚úÖ</span> ';else if(isChapterUnlocked(si,ci2))html+='üîì ';else html+='üîí ';}
    html+='</div></div></div>';
  }
  document.getElementById('seriesGrid').innerHTML=html;
}

function openSeries(si){
  var s=SERIES[si];showScreen('chapters');
  var html='<div class="chapter-header"><button class="chapter-back" onclick="goHome()">‚Üê</button><div class="chapter-series-title">'+s.icon+' '+s.title+'</div></div>';
  html+='<div class="chapter-series-desc">'+s.desc+'</div><div class="chapter-timeline">';
  for(var ci=0;ci<s.chapters.length;ci++){
    var ch=s.chapters[ci],cleared=isChapterCleared(s.id,ch.id),unlocked=isChapterUnlocked(si,ci);
    var cls=cleared?'cleared':(unlocked?'unlocked':'locked'),dotContent=cleared?'‚úì':(unlocked?(ci+1):'üîí');
    html+='<div class="chapter-item '+cls+'"><div class="chapter-dot">'+dotContent+'</div><div class="chapter-card"><div class="chapter-card-title">'+ch.title+'</div><div class="chapter-card-desc">'+ch.desc+'</div><div class="chapter-card-meta"><span>‚è± '+ch.time+'</span>';
    if(cleared)html+='<button class="chapter-replay" onclick="startChapter('+si+','+ci+')">Îã§Ïãú ÎèÑÏ†Ñ üîÑ</button>';
    else if(unlocked)html+='<button class="chapter-enter" onclick="startChapter('+si+','+ci+')">ÏûÖÏû•ÌïòÍ∏∞ üîë</button>';
    else html+='<span>üîí Ïù¥Ï†Ñ Ï±ïÌÑ∞ ÌÅ¥Î¶¨Ïñ¥ ÌïÑÏöî</span>';
    html+='</div></div></div>';
  }
  html+='</div>';
  document.getElementById('chapters').innerHTML=html;
}

async function startChapter(si,ci){
  var s=SERIES[si],ch=s.chapters[ci];
  state.currentSeries=s;state.currentChapter=ch;state.currentSeriesIdx=si;state.currentChapIdx=ci;state.currentPuzzle=0;state.startTime=Date.now();state.attempts=0;state.hintCount=0;state.hintPenalty=0;
  document.getElementById('loadingScreen').classList.add('active');
  try{var cpqCount=ch.puzzles.filter(function(p){return p.type==='cpq';}).length;var res=await fetch(API+'/api/random?count='+cpqCount);var data=await res.json();state.cpqCampaigns=data.campaigns||[];}catch(e){state.cpqCampaigns=[];}
  showScreen('game');document.getElementById('gameTitle').textContent=ch.title;renderIntro();
}

function renderIntro(){
  renderProgressBar();
  document.getElementById('gameContent').innerHTML='<div class="story-box"><div class="label">üìñ ÌîÑÎ°§Î°úÍ∑∏</div><p>'+state.currentChapter.intro.replace(/\n/g,'<br>')+'</p></div><button class="btn-next" onclick="renderPuzzle(0)">Ï°∞ÏÇ¨ ÏãúÏûë ‚Üí</button>';
}

function renderProgressBar(){
  var total=state.currentChapter.puzzles.length;
  document.getElementById('gameProgressText').textContent=(state.currentPuzzle+1)+' / '+total;
  var dots='';for(var i=0;i<total;i++){var cls=i<state.currentPuzzle?'done':(i===state.currentPuzzle?'active':'');dots+='<div class="prog-dot '+cls+'"></div>';}
  document.getElementById('progressBar').innerHTML=dots;
}

function renderPuzzle(idx){
  cleanupInteractive();
  state.currentPuzzle=idx;renderProgressBar();
  var puzzle=state.currentChapter.puzzles[idx];
  if(puzzle.type==='cpq') renderCpqPuzzle(idx,puzzle);
  else renderInteractivePuzzle(idx,puzzle);
}

function renderInteractivePuzzle(idx,puzzle){
  var html='<div class="story-box"><div class="label">üìñ ÏÉÅÌô©</div><p>'+puzzle.story.replace(/\n/g,'<br>')+'</p></div>';
  html+='<div class="puzzle-box"><div class="puzzle-label">'+puzzle.title+'</div>';
  html+='<div id="interactiveArea"></div>';
  html+='<div class="hint-box hidden" id="hintBox">üí° '+puzzle.hint+'</div>';
  html+='<button class="hint-btn" onclick="useHint(this)">üí° ÌûåÌä∏ Î≥¥Í∏∞ (+30Ï¥à)</button>';
  var autoComplete=['pipe-connect','wire-cutting','mini-sudoku','memory-card','simon','skill-check','mastermind','dial','timing'];
  if(autoComplete.indexOf(puzzle.interactionType)===-1){
    html+='<div class="answer-area"><input type="text" id="answerInput" placeholder="Ï†ïÎãµÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" onkeydown="handleEnter(event,'+idx+')"><button class="btn-submit" onclick="checkGeneral('+idx+')">ÌôïÏù∏</button></div>';
  }
  html+='<div id="feedback"></div></div>';
  document.getElementById('gameContent').innerHTML=html;

  switch(puzzle.interactionType){
    case 'flashlight': initFlashlight(puzzle.config); break;
    case 'jigsaw': initJigsaw(puzzle.config); break;
    case 'dial': initDial(puzzle.config); break;
    case 'timing': initTiming(puzzle.config); break;
    case 'trivia': initTrivia(puzzle.config); break;
    case 'logic': initLogic(puzzle.config); break;
    case 'skill-check': initSkillCheck(puzzle.config); break;
    case 'mini-sudoku': initSudoku(puzzle.config); break;
    case 'pipe-connect': initPipe(puzzle.config); break;
    case 'wire-cutting': initWire(puzzle.config); break;
    case 'mastermind': initMastermind(puzzle.config); break;
    case 'memory-card': initMemory(puzzle.config); break;
    case 'simon': initSimon(puzzle.config); break;
  }
  setTimeout(function(){document.getElementById('gameContent').scrollIntoView({behavior:'smooth'});},100);
}

function renderCpqPuzzle(idx,puzzle){
  var camp=state.cpqCampaigns[puzzle.cpqIndex];
  if(!camp){nextPuzzle(idx);return;}
  var desc=camp.join_desc||'',keyword=camp.search_keyword||'';
  var placeMatch=desc.match(/\[([^\]]*X[^\]]*)\]/),placeHint=placeMatch?placeMatch[1]:'Ìï¥Îãπ Ïû•ÏÜå';
  var startMatch=desc.match(/Ï∂úÎ∞úÏßÄÎ•º\s*\[([^\]]+)\]/),startPlace=startMatch?startMatch[1]:'ÏßÄÏ†ïÎêú Ï∂úÎ∞úÏßÄ';
  document.getElementById('gameContent').innerHTML=
    '<div class="story-box"><div class="label">üìñ Îã®ÏÑú Î∞úÍ≤¨</div><p>'+puzzle.story.replace(/\n/g,'<br>')+'</p></div>'+
    '<div class="puzzle-box"><div class="puzzle-label">üîç ÌçºÏ¶ê '+(idx+1)+': Ïû•ÏÜå Ï∂îÏ†Å ÎØ∏ÏÖò</div>'+
    '<div class="puzzle-question">Îã®ÏÑúÏóê Ï†ÅÌûå Ïû•ÏÜåÎ•º Ï∞æÏïÑÏïº ÌïúÎã§. ÎÑ§Ïù¥Î≤ÑÏóêÏÑú Í≤ÄÏÉâÌïòÏó¨ Í±∏Ïùå ÏàòÎ•º ÌôïÏù∏ÌïòÎùº.</div>'+
    '<div class="cpq-mission"><div class="mission-title">üìã ÎØ∏ÏÖò ÏàúÏÑú</div>'+
    '<ol class="cpq-steps"><li>ÏïÑÎûò ÌÇ§ÏõåÎìúÎ•º Î≥µÏÇ¨ÌïòÏó¨ <b>ÎÑ§Ïù¥Î≤Ñ</b>ÏóêÏÑú Í≤ÄÏÉâ</li>'+
    '<li>Í≤ÄÏÉâ Í≤∞Í≥ºÏóêÏÑú <b>'+placeHint+'</b> ÌÅ¥Î¶≠</li>'+
    '<li>ÌîåÎ†àÏù¥Ïä§ÏóêÏÑú <b>ÏßÄÎèÑ</b> ÌÉ≠ ‚Üí <b>ÏßÄÎèÑÏï±ÏúºÎ°ú Î≥¥Í∏∞</b></li>'+
    '<li><b>ÎèÑÏ∞©</b> Î≤ÑÌäº ÌÅ¥Î¶≠</li>'+
    '<li>Ï∂úÎ∞úÏßÄÎ•º <b>'+startPlace+'</b>(Ïúº)Î°ú ÏÑ§Ï†ï</li>'+
    '<li><b>ÎèÑÎ≥¥</b> ‚Üí <b>Í∞ÄÏû• Îπ†Î•∏</b> Í≤ΩÎ°úÏùò Í±∏Ïùå Ïàò ÌôïÏù∏</li></ol>'+
    '<div class="cpq-keyword-box"><span class="cpq-keyword" onclick="copyKeyword(this)" title="ÌÅ¥Î¶≠ÌïòÏó¨ Î≥µÏÇ¨">üîé '+keyword+'</span></div></div>'+
    '<div class="answer-area" style="margin-top:16px"><input type="number" id="answerInput" placeholder="Í±∏Ïùå ÏàòÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî" onkeydown="handleEnter(event,'+idx+',\'cpq\')">'+
    '<button class="btn-submit" onclick="checkCpq('+idx+')">ÌôïÏù∏</button></div>'+
    '<div id="feedback"></div></div>';
  setTimeout(function(){document.getElementById('gameContent').scrollIntoView({behavior:'smooth'});},100);
}

var isComposing=false;
document.addEventListener('compositionstart',function(){isComposing=true;});
document.addEventListener('compositionend',function(){isComposing=false;});
function handleEnter(e,idx,type){if(e.key==='Enter'&&!isComposing){e.preventDefault();type==='cpq'?checkCpq(idx):checkGeneral(idx);}}

function useHint(btn){
  if(!confirm('ÌûåÌä∏Î•º ÏÇ¨Ïö©ÌïòÎ©¥ 30Ï¥àÍ∞Ä Ï∂îÍ∞ÄÎê©ÎãàÎã§. ÏÇ¨Ïö©ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;
  state.hintCount++;state.hintPenalty+=30;
  document.getElementById('hintBox').classList.remove('hidden');
  btn.remove();
  var notice=document.createElement('div');notice.className='hint-penalty-notice';notice.textContent='‚è±Ô∏è +30Ï¥à Ìå®ÎÑêÌã∞!';document.body.appendChild(notice);
  setTimeout(function(){notice.remove();},2200);
}
function checkGeneral(idx){var input=document.getElementById('answerInput').value.trim();if(!input)return;state.attempts++;showFeedback(state.currentChapter.puzzles[idx].validate(input),idx);}
async function checkCpq(idx){var input=document.getElementById('answerInput').value.trim();if(!input)return;state.attempts++;var camp=state.cpqCampaigns[state.currentChapter.puzzles[idx].cpqIndex];try{var res=await fetch(API+'/api/verify',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({campaign_id:camp.id,user_answer:input})});var data=await res.json();showFeedback(data.correct,idx);}catch(e){showFeedback(false,idx);}}

function showFeedback(correct,idx){
  var fb=document.getElementById('feedback'),puzzle=state.currentChapter.puzzles[idx],isLast=idx>=state.currentChapter.puzzles.length-1;
  if(correct){
    var after=puzzle.storyAfter||'';
    fb.innerHTML='<div class="feedback correct">‚úÖ Ï†ïÎãµ!'+(after?' '+after:'')+'</div><button class="btn-next" onclick="nextPuzzle('+idx+')">'+(isLast?'üö™ Ï±ïÌÑ∞ ÏôÑÎ£å!':'Îã§Ïùå ÌçºÏ¶ê ‚Üí')+'</button>';
    fb.scrollIntoView({behavior:'smooth',block:'center'});
  }else{
    fb.innerHTML='<div class="feedback wrong">‚ùå Ïò§Îãµ. Îã§Ïãú ÏãúÎèÑÌï¥Î≥¥ÏÑ∏Ïöî.</div>';
    var inp=document.getElementById('answerInput');if(inp)inp.value='';
    fb.scrollIntoView({behavior:'smooth',block:'center'});
  }
}
function nextPuzzle(cur){cleanupInteractive();if(cur+1>=state.currentChapter.puzzles.length)showCliffhanger();else renderPuzzle(cur+1);}

function showCliffhanger(){
  cleanupInteractive();
  var ch=state.currentChapter,s=state.currentSeries,si=state.currentSeriesIdx,ci=state.currentChapIdx;
  var elapsed=Math.floor((Date.now()-state.startTime)/1000)+state.hintPenalty;
  var p=getProgress();if(!p[s.id])p[s.id]={};p[s.id][ch.id]={cleared:true,bestTime:elapsed,lastPlayed:Date.now(),hints:state.hintCount};saveProgressData(p);
  var isLastChapter=ci>=s.chapters.length-1,isLastSeries=si>=SERIES.length-1,isFinalClear=isLastChapter&&isLastSeries;
  var gameGrade='S';if(elapsed>600)gameGrade='C';else if(elapsed>300)gameGrade='B';else if(elapsed>180)gameGrade='A';
  showScreen('result');var html='';
  if(isFinalClear){spawnConfetti();html+='<div class="result-emoji">üèÜ</div><div class="result-title">QUBE ‚Äî ALL CLEAR</div><div class="result-sub">Î™®Îì† ÎØ∏Ïä§ÌÑ∞Î¶¨Î•º Ìï¥Í≤∞ÌñàÏäµÎãàÎã§</div>';}
  else if(isLastChapter){spawnConfetti();html+='<div class="result-emoji">üéä</div><div class="result-title">ÏãúÎ¶¨Ï¶à ÌÅ¥Î¶¨Ïñ¥!</div><div class="result-sub">"'+s.title+'" ÏôÑÎ£å!</div>';}
  else{html+='<div class="result-emoji">üéâ</div><div class="result-title">Ï±ïÌÑ∞ ÌÅ¥Î¶¨Ïñ¥!</div><div class="result-sub">'+ch.title+' ÏôÑÎ£å</div>';}
  html+='<div class="result-grade">'+gameGrade+' RANK</div><div class="result-stats">';
  html+='<div class="result-stat"><div class="result-stat-val">'+formatTime(elapsed)+'</div><div class="result-stat-label">ÏÜåÏöîÏãúÍ∞Ñ'+(state.hintPenalty>0?' (Ìå®ÎÑêÌã∞ +'+state.hintPenalty+'Ï¥à)':'')+'</div></div>';
  html+='<div class="result-stat"><div class="result-stat-val">'+state.attempts+'</div><div class="result-stat-label">ÏãúÎèÑÌöüÏàò</div></div>';
  html+='<div class="result-stat"><div class="result-stat-val">'+(state.hintCount>0?state.hintCount+'Ìöå':'üèÖ')+'</div><div class="result-stat-label">'+(state.hintCount>0?'ÌûåÌä∏ ÏÇ¨Ïö©':'ÌûåÌä∏ ÏóÜÏù¥ ÌÅ¥Î¶¨Ïñ¥!')+'</div></div>';
  var totalCleared=getTotalCleared(),grade=getGrade(totalCleared);
  html+='<div class="result-stat"><div class="result-stat-val">'+grade.split(' ')[0]+'</div><div class="result-stat-label">'+(grade.split(' ')[1]||'')+'</div></div></div>';
  if(ch.cliffhanger)html+='<div class="cliffhanger-box"><div class="label">üìñ TO BE CONTINUED...</div><p>'+ch.cliffhanger.replace(/\n/g,'<br>')+'</p></div>';
  html+='<div class="result-btns">';
  if(!isLastChapter)html+='<button class="btn-home" onclick="startChapter('+si+','+(ci+1)+')">Îã§Ïùå Ï±ïÌÑ∞Î°ú ‚Üí</button>';
  else if(!isLastSeries)html+='<button class="btn-home" onclick="openSeries('+(si+1)+')">Îã§Ïùå ÏãúÎ¶¨Ï¶à ‚Üí</button>';
  html+='<button class="btn-home" style="background:var(--bg3);color:var(--text2)" onclick="goHome()">üö™ Î°úÎπÑÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞</button>';
  html+='<button class="btn-share" onclick="shareResult()">üì§ Í≤∞Í≥º Í≥µÏú†ÌïòÍ∏∞</button></div>';
  document.getElementById('resultContent').innerHTML=html;
}

function shareResult(){
  var ch=state.currentChapter,s=state.currentSeries,elapsed=Math.floor((Date.now()-state.startTime)/1000);
  var text='üîê QUBE - '+s.title+' / '+ch.title+'\n‚è± '+formatTime(elapsed)+'Ïóê ÌÅ¥Î¶¨Ïñ¥!\n\nÎÇòÎäî ÌÉàÏ∂úÌñàÎã§. ÎãπÏã†ÏùÄ?\nüëâ https://qube.salmonholic.com';
  if(navigator.share)navigator.share({text:text});else{navigator.clipboard&&navigator.clipboard.writeText(text);alert('ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêêÏäµÎãàÎã§!');}
}
function copyKeyword(el){var text=el.textContent.replace('üîé ','').trim();navigator.clipboard&&navigator.clipboard.writeText(text);var orig=el.textContent;el.textContent='‚úì Î≥µÏÇ¨Îê®!';setTimeout(function(){el.textContent=orig;},1500);}

function spawnConfetti(){
  var container=document.createElement('div');container.className='confetti-container';document.body.appendChild(container);
  var colors=['#b44aff','#00e5ff','#00ff88','#ff4444','#f59e0b','#fff'];
  for(var i=0;i<60;i++){var piece=document.createElement('div');piece.className='confetti-piece';piece.style.left=Math.random()*100+'%';piece.style.background=colors[Math.floor(Math.random()*colors.length)];piece.style.animationDelay=Math.random()*2+'s';piece.style.animationDuration=(2+Math.random()*2)+'s';var size=(6+Math.random()*8)+'px';piece.style.width=size;piece.style.height=size;piece.style.borderRadius=Math.random()>.5?'50%':'2px';container.appendChild(piece);}
  setTimeout(function(){container.remove();},5000);
}

createParticles();renderHome();
</script>
</body>
</html>
