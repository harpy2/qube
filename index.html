<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QUBE ‚Äî ÌíÄÏñ¥Îùº. ÌÉàÏ∂úÌïòÎùº.</title>
<meta name="description" content="Î∞©ÌÉàÏ∂ú Ï∂îÎ¶¨ ÌçºÏ¶ê Í≤åÏûÑ. Îã®ÏÑúÎ•º Ï∞æÍ≥†, ÌçºÏ¶êÏùÑ ÌíÄÍ≥†, ÌÉàÏ∂úÌïòÎùº.">
<meta property="og:title" content="QUBE ‚Äî Î∞©ÌÉàÏ∂ú Ï∂îÎ¶¨ ÌçºÏ¶ê Í≤åÏûÑ">
<meta property="og:description" content="ÌíÄÏñ¥Îùº. ÌÉàÏ∂úÌïòÎùº.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://qube.salmonholic.com">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üîí</text></svg>">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#0a0a0a;--bg2:#111;--bg3:#1a1a1a;
  --text:#e0e0e0;--text2:#888;--text3:#555;
  --accent:#b44aff;--accent2:#9333ea;--accent-glow:rgba(180,74,255,.15);
  --cyan:#00e5ff;--danger:#ff4444;--success:#00ff88;
  --card:rgba(255,255,255,.03);--card-border:rgba(255,255,255,.06);
}
html{scroll-behavior:smooth}
body{background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Noto Sans KR',sans-serif;line-height:1.6;overflow-x:hidden}
.hidden{display:none!important}
.hero{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;position:relative;overflow:hidden;padding:2rem}
.hero::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at 50% 40%,rgba(180,74,255,.06) 0%,transparent 70%);pointer-events:none}
.hero h1{font-size:clamp(3rem,10vw,6rem);font-weight:900;letter-spacing:0.1em;margin-bottom:1rem;background:linear-gradient(135deg,#fff 0%,#b44aff 50%,#00e5ff 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hero p{font-size:clamp(1rem,3vw,1.3rem);color:var(--text2);max-width:450px;margin-bottom:2.5rem}
.hero-cta{padding:16px 48px;background:linear-gradient(135deg,var(--accent),var(--cyan));color:#000;font-size:1.1rem;font-weight:700;border:none;border-radius:50px;cursor:pointer;transition:all .3s;letter-spacing:.05em}
.hero-cta:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(180,74,255,.4)}
.scroll-hint{position:absolute;bottom:2rem;animation:bounce 2s infinite;color:var(--text3);font-size:1.5rem}
@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(10px)}}
.particles{position:absolute;inset:0;pointer-events:none;overflow:hidden}
.particle{position:absolute;width:3px;height:3px;border-radius:50%;opacity:.4;animation:float linear infinite}
@keyframes float{0%{transform:translateY(100vh) scale(0);opacity:0}10%{opacity:.4}90%{opacity:.4}100%{transform:translateY(-10vh) scale(1);opacity:0}}
.stats-bar{display:flex;justify-content:center;gap:40px;padding:24px 0;margin-bottom:1rem}
.stat{text-align:center}
.stat-val{font-size:2rem;font-weight:900;background:linear-gradient(135deg,var(--accent),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.stat-label{font-size:.8rem;color:var(--text2);margin-top:4px}
.series-section{max-width:700px;margin:0 auto;padding:0 1.5rem 4rem}
.series-section h2{font-size:1.5rem;margin-bottom:.5rem;display:flex;align-items:center;gap:8px}
.series-progress-text{color:var(--text2);font-size:.85rem;margin-bottom:1.5rem}
.series-card{background:var(--card);border:1px solid var(--card-border);border-radius:20px;padding:1.8rem;margin-bottom:1.2rem;backdrop-filter:blur(10px);transition:all .3s;cursor:pointer;position:relative;overflow:hidden}
.series-card:hover:not(.locked){border-color:rgba(180,74,255,.3);background:rgba(255,255,255,.05);transform:translateY(-3px);box-shadow:0 8px 30px rgba(180,74,255,.1)}
.series-card.locked{opacity:.45;filter:saturate(.3);cursor:not-allowed}
.series-card.cleared{border-color:rgba(0,255,136,.2)}
.series-lock-overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.4);backdrop-filter:blur(2px);border-radius:20px;z-index:2}
.series-lock-overlay span{font-size:1rem;color:var(--text2);background:rgba(0,0,0,.6);padding:8px 20px;border-radius:50px}
.series-header{display:flex;align-items:center;gap:16px;margin-bottom:12px}
.series-icon{font-size:2.8rem}
.series-info{flex:1}
.series-title{font-size:1.2rem;font-weight:700}
.series-diff{font-size:.85rem;color:var(--text2);margin-top:2px}
.series-diff .star{color:var(--accent)}
.series-diff .star.empty{color:var(--text3)}
.series-desc{font-size:.9rem;color:var(--text2);line-height:1.6;margin-bottom:12px}
.series-footer{display:flex;align-items:center;justify-content:space-between}
.series-chapter-progress{font-size:.85rem;color:var(--text2)}
.series-chapter-progress .done{color:var(--success)}
.series-badge{padding:4px 14px;border-radius:20px;font-size:.75rem;font-weight:700}
.badge-clear{background:var(--success);color:#000}
.badge-progress{background:var(--accent);color:#fff}
.badge-new{background:rgba(180,74,255,.2);color:var(--accent);border:1px solid rgba(180,74,255,.3)}
#chapters{max-width:700px;margin:0 auto;min-height:100vh;padding:1rem}
.chapter-header{display:flex;align-items:center;padding:1rem 0;border-bottom:1px solid var(--card-border);margin-bottom:2rem;gap:12px}
.chapter-back{background:none;border:none;color:var(--text2);font-size:1.3rem;cursor:pointer;padding:4px 8px}
.chapter-back:hover{color:var(--text)}
.chapter-series-title{font-size:1.2rem;font-weight:700;flex:1}
.chapter-series-desc{color:var(--text2);font-size:.9rem;line-height:1.7;margin-bottom:2rem;padding:0 .5rem}
.chapter-timeline{position:relative;padding-left:32px}
.chapter-timeline::before{content:'';position:absolute;left:11px;top:20px;bottom:20px;width:2px;background:linear-gradient(to bottom,var(--accent),var(--cyan));opacity:.3}
.chapter-item{position:relative;margin-bottom:1.5rem}
.chapter-dot{position:absolute;left:-32px;top:18px;width:22px;height:22px;border-radius:50%;border:2px solid var(--text3);background:var(--bg);display:flex;align-items:center;justify-content:center;font-size:.7rem;z-index:1}
.chapter-item.unlocked .chapter-dot{border-color:var(--accent);box-shadow:0 0 8px rgba(180,74,255,.4)}
.chapter-item.cleared .chapter-dot{border-color:var(--success);background:var(--success);color:#000}
.chapter-card{background:var(--card);border:1px solid var(--card-border);border-radius:16px;padding:1.3rem 1.5rem;transition:all .3s}
.chapter-item.unlocked .chapter-card{border-color:rgba(180,74,255,.2)}
.chapter-item.unlocked .chapter-card:hover{border-color:rgba(180,74,255,.4);background:rgba(255,255,255,.05);transform:translateX(4px)}
.chapter-item.locked .chapter-card{opacity:.4;filter:saturate(.3)}
.chapter-card-title{font-size:1.05rem;font-weight:700;margin-bottom:4px}
.chapter-card-desc{font-size:.85rem;color:var(--text2);margin-bottom:10px}
.chapter-card-meta{display:flex;align-items:center;gap:12px;font-size:.8rem;color:var(--text2)}
.chapter-enter{padding:8px 20px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;border:none;border-radius:50px;cursor:pointer;font-size:.85rem;font-weight:600;transition:all .3s}
.chapter-enter:hover{box-shadow:0 4px 15px rgba(180,74,255,.4)}
.chapter-replay{padding:8px 20px;background:var(--bg3);color:var(--text2);border:1px solid var(--card-border);border-radius:50px;cursor:pointer;font-size:.85rem;transition:all .3s}
.chapter-replay:hover{border-color:var(--accent);color:var(--text)}
#game{max-width:700px;margin:0 auto;min-height:100vh;padding:1rem}
.game-header{display:flex;align-items:center;padding:1rem 0;border-bottom:1px solid var(--card-border);margin-bottom:1.5rem;gap:12px}
.game-back{background:none;border:none;color:var(--text2);font-size:1.3rem;cursor:pointer;padding:4px 8px}
.game-back:hover{color:var(--text)}
.game-title{font-size:1.1rem;font-weight:700;flex:1}
.game-progress-text{color:var(--text2);font-size:.85rem}
.progress-bar{display:flex;gap:6px;margin-bottom:1.5rem}
.prog-dot{flex:1;height:4px;border-radius:2px;background:var(--bg3);transition:all .3s}
.prog-dot.active{background:var(--accent);box-shadow:0 0 8px rgba(180,74,255,.4)}
.prog-dot.done{background:var(--success)}
.story-box{background:var(--bg3);border:1px solid var(--card-border);border-radius:16px;padding:1.5rem;margin-bottom:1.5rem;animation:fadeIn .5s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(15px)}to{opacity:1;transform:translateY(0)}}
.story-box .label{color:var(--accent);font-size:.75rem;font-weight:700;margin-bottom:8px;text-transform:uppercase;letter-spacing:.15em}
.story-box p{color:var(--text2);line-height:1.8}
.puzzle-box{background:rgba(180,74,255,.05);border:1px solid rgba(180,74,255,.15);border-radius:16px;padding:1.5rem;margin-bottom:1.5rem;animation:fadeIn .5s ease}
.puzzle-label{color:var(--cyan);font-size:.8rem;font-weight:700;margin-bottom:12px;letter-spacing:.05em}
.puzzle-question{font-size:1rem;line-height:1.8;margin-bottom:1.2rem}
.cpq-mission{background:rgba(0,229,255,.05);border:1px solid rgba(0,229,255,.15);border-radius:12px;padding:1.2rem;margin:1rem 0}
.cpq-mission .mission-title{color:var(--cyan);font-size:.8rem;font-weight:700;margin-bottom:10px}
.cpq-steps{font-size:.9rem;color:var(--text2);line-height:2;padding-left:1.2rem}
.cpq-steps b{color:var(--text)}
.cpq-keyword-box{margin-top:12px;display:flex;align-items:center;gap:10px}
.cpq-keyword{display:inline-block;background:linear-gradient(135deg,var(--accent),var(--cyan));color:#000;padding:8px 20px;border-radius:50px;font-size:.9rem;font-weight:700;cursor:pointer;transition:all .2s}
.cpq-keyword:hover{transform:scale(1.03);box-shadow:0 4px 15px rgba(180,74,255,.3)}
.hint-btn{background:none;border:1px solid var(--text3);color:var(--text2);padding:8px 16px;border-radius:50px;font-size:.8rem;cursor:pointer;transition:all .2s;margin-bottom:1rem}
.hint-btn:hover{border-color:var(--accent);color:var(--accent)}
.hint-box{background:rgba(255,165,0,.08);border:1px solid rgba(255,165,0,.2);border-radius:10px;padding:12px 16px;font-size:.9rem;color:#f59e0b;margin-bottom:1rem}
.answer-area{display:flex;flex-direction:column;gap:10px}
.answer-area input{width:100%;padding:14px 18px;background:var(--bg3);border:1px solid var(--card-border);border-radius:12px;color:var(--text);font-size:1rem;font-family:inherit;outline:none;transition:border-color .3s}
.answer-area input:focus{border-color:var(--accent)}
.answer-area input::placeholder{color:var(--text3)}
.btn-submit{width:100%;padding:14px 28px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;border:none;border-radius:12px;font-weight:700;cursor:pointer;transition:all .2s;white-space:nowrap;font-family:inherit;font-size:.95rem}
.btn-submit:hover{box-shadow:0 4px 15px rgba(180,74,255,.4)}
.btn-next{width:100%;padding:14px;background:linear-gradient(135deg,var(--accent),var(--cyan));color:#000;border:none;border-radius:50px;font-weight:700;cursor:pointer;transition:all .3s;font-size:1rem;font-family:inherit;margin-top:1rem}
.btn-next:hover{box-shadow:0 4px 20px rgba(180,74,255,.4);transform:translateY(-1px)}
.feedback{padding:14px 18px;border-radius:12px;margin-top:1rem;font-size:.95rem;animation:fadeIn .3s}
.feedback.correct{background:rgba(0,255,136,.1);color:var(--success);border:1px solid rgba(0,255,136,.2)}
.feedback.wrong{background:rgba(255,68,68,.1);color:var(--danger);border:1px solid rgba(255,68,68,.2)}
.cliffhanger-box{background:linear-gradient(135deg,rgba(180,74,255,.08),rgba(0,229,255,.08));border:1px solid rgba(180,74,255,.25);border-radius:16px;padding:2rem;margin:1.5rem 0;text-align:center;animation:fadeIn .8s ease}
.cliffhanger-box .label{color:var(--cyan);font-size:.75rem;font-weight:700;margin-bottom:12px;letter-spacing:.2em}
.cliffhanger-box p{color:var(--text);line-height:2;font-size:1.05rem;font-style:italic}
.series-clear-box{text-align:center;padding:2rem 0;animation:fadeIn .5s}
.series-clear-emoji{font-size:4rem;margin-bottom:1rem}
.series-clear-title{font-size:1.8rem;font-weight:900;background:linear-gradient(135deg,#fff,var(--accent),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:.5rem}
.series-clear-sub{color:var(--text2);margin-bottom:1.5rem}
#result{max-width:600px;margin:0 auto;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:2rem}
.result-card{text-align:center;width:100%}
.result-emoji{font-size:4rem;margin-bottom:1rem}
.result-title{font-size:2rem;font-weight:900;margin-bottom:.5rem;background:linear-gradient(135deg,#fff,var(--accent),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.result-sub{color:var(--text2);margin-bottom:2rem}
.result-grade{display:inline-block;font-size:1.5rem;font-weight:900;padding:10px 30px;border-radius:50px;background:linear-gradient(135deg,var(--accent),var(--cyan));color:#000;margin-bottom:2rem}
.result-stats{display:flex;justify-content:center;gap:20px;margin-bottom:2rem;flex-wrap:wrap}
.result-stat{background:var(--card);border:1px solid var(--card-border);border-radius:16px;padding:18px 24px;min-width:100px}
.result-stat-val{font-size:1.5rem;font-weight:900;color:var(--accent)}
.result-stat-label{font-size:.75rem;color:var(--text2);margin-top:4px}
.result-btns{display:flex;flex-direction:column;gap:10px;max-width:300px;margin:0 auto}
.btn-home{padding:14px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;border:none;border-radius:50px;font-weight:700;cursor:pointer;font-size:1rem;font-family:inherit;transition:all .3s}
.btn-home:hover{box-shadow:0 4px 15px rgba(180,74,255,.4)}
.btn-share{padding:14px;background:transparent;border:1px solid var(--card-border);color:var(--text2);border-radius:50px;cursor:pointer;font-size:.9rem;font-family:inherit;transition:all .2s}
.btn-share:hover{border-color:var(--accent);color:var(--text)}
.loading-screen{display:none;position:fixed;inset:0;background:var(--bg);z-index:1000;flex-direction:column;align-items:center;justify-content:center;gap:16px}
.loading-screen.active{display:flex}
.spinner{width:40px;height:40px;border:3px solid var(--bg3);border-top-color:var(--accent);border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-text{color:var(--text2);font-size:.9rem}
.confetti-container{position:fixed;inset:0;pointer-events:none;z-index:999;overflow:hidden}
.confetti-piece{position:absolute;width:10px;height:10px;top:-20px;animation:confettiFall 3s ease-in forwards}
@keyframes confettiFall{0%{transform:translateY(0) rotate(0deg);opacity:1}100%{transform:translateY(100vh) rotate(720deg);opacity:0}}

/* ‚ïê‚ïê‚ïê Interactive Puzzle Styles ‚ïê‚ïê‚ïê */

/* Flashlight */
.flashlight-area{position:relative;width:100%;height:300px;border-radius:12px;overflow:hidden;cursor:none;touch-action:none;margin-bottom:16px;background:#111}
.flashlight-overlay{position:absolute;inset:0;background:radial-gradient(circle 60px at var(--fx,50%) var(--fy,50%),transparent 0%,rgba(0,0,0,.97) 100%);z-index:2;pointer-events:none;transition:none}
.flashlight-item{position:absolute;color:var(--cyan);font-size:1.5rem;font-weight:900;z-index:1;user-select:none;text-shadow:0 0 8px var(--cyan)}
.flashlight-hint-text{text-align:center;color:var(--text3);font-size:.85rem;margin-bottom:12px}

/* Jigsaw */
.jigsaw-area{display:grid;gap:8px;margin-bottom:16px}
.jigsaw-slots{display:grid;gap:8px;margin-bottom:16px}
.jigsaw-slot{background:rgba(180,74,255,.08);border:2px dashed rgba(180,74,255,.3);border-radius:10px;min-height:60px;display:flex;align-items:center;justify-content:center;font-size:.8rem;color:var(--text3);transition:all .3s}
.jigsaw-slot.hover{border-color:var(--cyan);background:rgba(0,229,255,.1)}
.jigsaw-slot.correct{border-color:var(--success);background:rgba(0,255,136,.1);border-style:solid}
.jigsaw-piece{background:var(--bg3);border:1px solid var(--accent);border-radius:10px;padding:12px 16px;cursor:grab;user-select:none;touch-action:none;font-size:.9rem;color:var(--text);transition:all .2s;text-align:center}
.jigsaw-piece:active{cursor:grabbing;transform:scale(1.05);box-shadow:0 4px 15px rgba(180,74,255,.3)}
.jigsaw-piece.placed{opacity:.4;pointer-events:none}
.jigsaw-tray{display:flex;flex-wrap:wrap;gap:8px;padding:12px;background:var(--bg2);border-radius:12px;margin-bottom:16px;justify-content:center}
.jigsaw-reveal{text-align:center;font-size:1.3rem;font-weight:700;color:var(--success);padding:16px;animation:fadeIn .5s}

/* Dial */
.dial-container{display:flex;flex-direction:column;align-items:center;gap:20px;margin-bottom:16px}
.dial-row{display:flex;gap:16px;align-items:center}
.dial-digit{display:flex;flex-direction:column;align-items:center;gap:6px}
.dial-digit .label{font-size:.75rem;color:var(--text3)}
.dial-ring{width:70px;height:70px;border-radius:50%;border:3px solid var(--accent);display:flex;align-items:center;justify-content:center;font-size:1.8rem;font-weight:900;color:var(--text);cursor:pointer;user-select:none;transition:all .2s;background:var(--bg3)}
.dial-ring:hover{border-color:var(--cyan);box-shadow:0 0 15px rgba(0,229,255,.3)}
.dial-ring:active{transform:scale(.95)}
.dial-arrows{display:flex;flex-direction:column;gap:2px}
.dial-arrow{width:70px;padding:4px;background:var(--bg3);border:1px solid var(--card-border);border-radius:6px;cursor:pointer;text-align:center;font-size:1rem;color:var(--text2);transition:all .2s}
.dial-arrow:hover{border-color:var(--accent);color:var(--text)}
.dial-lock-btn{padding:12px 32px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;border:none;border-radius:50px;cursor:pointer;font-weight:700;font-size:.95rem;transition:all .2s}
.dial-lock-btn:hover{box-shadow:0 4px 15px rgba(180,74,255,.4)}
.dial-result{font-size:.9rem;margin-top:8px;min-height:24px}

/* Piano */
.piano-area{margin-bottom:16px}
.piano-keys{display:flex;gap:4px;justify-content:center;margin-bottom:12px;flex-wrap:wrap}
.piano-key{width:48px;height:120px;border-radius:0 0 8px 8px;cursor:pointer;display:flex;flex-direction:column;align-items:center;justify-content:flex-end;padding-bottom:10px;font-size:.75rem;font-weight:700;transition:all .1s;user-select:none;border:1px solid rgba(255,255,255,.1)}
.piano-key.white{background:linear-gradient(180deg,#e8e8e8,#fff);color:#333}
.piano-key.black{background:linear-gradient(180deg,#222,#444);color:#aaa;height:80px;width:36px;margin:0 -10px;z-index:2;border-color:rgba(0,0,0,.3)}
.piano-key:active,.piano-key.pressed{transform:scaleY(.97);filter:brightness(.8)}
.piano-key.correct-flash{background:var(--success)!important;color:#000!important}
.piano-sequence{display:flex;gap:6px;justify-content:center;flex-wrap:wrap;margin-bottom:12px}
.piano-seq-dot{width:28px;height:28px;border-radius:50%;border:2px solid var(--text3);display:flex;align-items:center;justify-content:center;font-size:.7rem;color:var(--text3)}
.piano-seq-dot.hit{border-color:var(--success);color:var(--success);background:rgba(0,255,136,.1)}
.piano-seq-dot.miss{border-color:var(--danger);color:var(--danger);background:rgba(255,68,68,.1)}
.piano-display{text-align:center;color:var(--text2);font-size:.85rem;margin-bottom:12px}

/* Hidden Text */
.hidden-text-area{padding:20px;background:var(--bg2);border-radius:12px;margin-bottom:16px;line-height:2.2;font-size:1rem;user-select:text;cursor:text}
.hidden-text-area .secret{color:transparent;background:transparent;transition:color .3s,background .3s;border-radius:4px;padding:2px 4px}
.hidden-text-area .secret::selection{color:var(--cyan);background:rgba(0,229,255,.2)}
.hidden-text-area .secret::-moz-selection{color:var(--cyan);background:rgba(0,229,255,.2)}
.hidden-text-area .secret.revealed{color:var(--cyan);background:rgba(0,229,255,.1)}
.hidden-text-hint{text-align:center;color:var(--text3);font-size:.8rem;margin-bottom:12px;font-style:italic}

/* Timing */
.timing-area{margin-bottom:16px}
.timing-track{position:relative;width:100%;height:50px;background:var(--bg2);border-radius:25px;overflow:hidden;margin-bottom:12px;border:1px solid var(--card-border)}
.timing-zone{position:absolute;height:100%;background:rgba(0,255,136,.15);border-left:2px solid var(--success);border-right:2px solid var(--success)}
.timing-cursor{position:absolute;top:5px;bottom:5px;width:8px;background:var(--accent);border-radius:4px;box-shadow:0 0 10px var(--accent);transition:none}
.timing-btn{display:block;width:100%;padding:16px;background:linear-gradient(135deg,var(--accent),var(--cyan));color:#000;border:none;border-radius:12px;font-size:1.1rem;font-weight:700;cursor:pointer;transition:all .1s;font-family:inherit}
.timing-btn:active{transform:scale(.97)}
.timing-btn:disabled{opacity:.5;cursor:not-allowed}
.timing-progress{display:flex;gap:8px;justify-content:center;margin-bottom:12px}
.timing-pip{width:32px;height:32px;border-radius:50%;border:2px solid var(--text3);display:flex;align-items:center;justify-content:center;font-size:.9rem}
.timing-pip.hit{border-color:var(--success);color:var(--success);background:rgba(0,255,136,.1)}
.timing-pip.miss{border-color:var(--danger);color:var(--danger);background:rgba(255,68,68,.1)}

/* Connect Dots */
.dots-area{position:relative;width:100%;height:300px;background:var(--bg2);border-radius:12px;margin-bottom:16px;overflow:hidden;touch-action:none}
.dots-area svg{position:absolute;inset:0;width:100%;height:100%}
.dot-point{cursor:pointer;transition:all .2s}
.dot-point:hover circle{r:14;fill:rgba(180,74,255,.3)}
.dot-label{font-size:12px;fill:var(--text);font-weight:700;pointer-events:none;text-anchor:middle;dominant-baseline:central}
.dot-line{stroke:var(--cyan);stroke-width:2;stroke-linecap:round;fill:none;opacity:.7}
.dots-reveal{text-align:center;font-size:1.2rem;font-weight:700;color:var(--success);padding:12px;animation:fadeIn .5s}

/* Color Code */
.color-grid{display:flex;gap:16px;justify-content:center;flex-wrap:wrap;margin-bottom:16px}
.color-item{display:flex;flex-direction:column;align-items:center;gap:6px}
.color-circle{width:56px;height:56px;border-radius:50%;border:3px solid rgba(255,255,255,.1);box-shadow:0 4px 12px rgba(0,0,0,.3)}
.color-name{font-size:.75rem;color:var(--text2)}
.color-hint{text-align:center;color:var(--text2);font-size:.9rem;margin-bottom:16px;line-height:1.8}

/* Mirror */
.mirror-area{padding:24px;background:var(--bg2);border-radius:12px;margin-bottom:16px;text-align:center;overflow:hidden}
.mirror-text{font-size:1.8rem;font-weight:900;color:var(--text);letter-spacing:.15em;display:inline-block;line-height:1.6}
.mirror-text.flip-h{transform:scaleX(-1)}
.mirror-text.flip-v{transform:scaleY(-1)}
.mirror-text.flip-both{transform:scale(-1)}
.mirror-label{color:var(--text3);font-size:.8rem;margin-top:10px}

/* Shake */
.shake-area{text-align:center;margin-bottom:16px}
.shake-icon{font-size:4rem;display:inline-block;animation:none}
.shake-icon.shaking{animation:shakeAnim .1s infinite}
@keyframes shakeAnim{0%{transform:rotate(-5deg)}50%{transform:rotate(5deg)}100%{transform:rotate(-5deg)}}
.shake-progress{margin:16px auto;width:80%;max-width:300px}
.shake-bar{height:12px;background:var(--bg3);border-radius:6px;overflow:hidden;border:1px solid var(--card-border)}
.shake-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--cyan));border-radius:6px;transition:width .15s;width:0%}
.shake-count{font-size:.85rem;color:var(--text2);margin-top:8px}
.shake-instruction{font-size:.9rem;color:var(--text2);margin-bottom:12px}
.shake-reveal{font-size:1.1rem;color:var(--cyan);font-weight:700;margin-top:16px;animation:fadeIn .5s}
.shake-spacebar{padding:14px 32px;background:var(--bg3);border:2px solid var(--accent);color:var(--text);border-radius:12px;font-size:1rem;font-weight:700;cursor:pointer;transition:all .1s;font-family:inherit;margin-top:8px}
.shake-spacebar:active{background:var(--accent);color:#000;transform:scale(.97)}
.hint-penalty-notice{position:fixed;top:20%;left:50%;transform:translateX(-50%);background:rgba(255,68,68,.95);color:#fff;padding:14px 28px;border-radius:12px;font-size:1.1rem;font-weight:700;z-index:1000;animation:penaltyFade 2s ease forwards;pointer-events:none;text-align:center}
@keyframes penaltyFade{0%{opacity:1;transform:translateX(-50%) translateY(0)}70%{opacity:1}100%{opacity:0;transform:translateX(-50%) translateY(-30px)}}
.hint-bonus{color:var(--success);font-weight:700;font-size:1rem;margin-top:8px}

/* Trivia */
.trivia-area{margin-bottom:16px}
.trivia-question{font-size:1.1rem;color:var(--text);line-height:1.8;margin-bottom:16px;font-weight:700}
.trivia-options{display:flex;flex-direction:column;gap:10px}
.trivia-option{padding:14px 18px;background:var(--bg3);border:1px solid var(--card-border);border-radius:12px;cursor:pointer;font-size:.95rem;color:var(--text);transition:all .2s;text-align:left}
.trivia-option:hover{border-color:var(--accent);background:rgba(180,74,255,.08)}
.trivia-option.selected{border-color:var(--accent);background:rgba(180,74,255,.15)}
/* Caesar */
.caesar-area{margin-bottom:16px}
.caesar-cipher{font-size:1.4rem;font-weight:900;letter-spacing:.2em;color:var(--cyan);text-align:center;padding:20px;background:var(--bg2);border-radius:12px;margin-bottom:12px;font-family:monospace}
.caesar-shift{text-align:center;color:var(--text2);font-size:.9rem;margin-bottom:12px}
.caesar-table{display:flex;flex-wrap:wrap;gap:4px;justify-content:center;margin-bottom:16px;font-size:.7rem;color:var(--text3)}
.caesar-table span{padding:2px 5px;background:var(--bg3);border-radius:4px}
/* Morse */
.morse-area{margin-bottom:16px}
.morse-code{font-size:1.6rem;font-weight:900;letter-spacing:.15em;color:var(--cyan);text-align:center;padding:20px;background:var(--bg2);border-radius:12px;margin-bottom:12px;font-family:monospace;word-break:break-all;line-height:2}
.morse-play-btn{display:block;margin:0 auto 16px;padding:12px 32px;background:linear-gradient(135deg,var(--accent),var(--cyan));color:#000;border:none;border-radius:50px;cursor:pointer;font-weight:700;font-size:.95rem;transition:all .2s}
.morse-play-btn:hover{box-shadow:0 4px 15px rgba(180,74,255,.4)}
.morse-ref{display:grid;grid-template-columns:repeat(auto-fill,minmax(70px,1fr));gap:4px;margin-bottom:16px;font-size:.7rem}
.morse-ref span{padding:3px 5px;background:var(--bg3);border-radius:4px;text-align:center;color:var(--text2)}
/* Konami */
.konami-area{margin-bottom:16px;text-align:center}
.konami-sequence{font-size:1.8rem;letter-spacing:.4em;color:var(--cyan);padding:16px;background:var(--bg2);border-radius:12px;margin-bottom:16px;line-height:1.6}
.konami-buttons{display:grid;grid-template-columns:repeat(3,64px);gap:8px;justify-content:center;margin-bottom:16px}
.konami-buttons button{width:64px;height:64px;background:var(--bg3);border:2px solid var(--card-border);border-radius:12px;color:var(--text);font-size:1.5rem;cursor:pointer;transition:all .15s}
.konami-buttons button:hover{border-color:var(--accent)}
.konami-buttons button:active{background:var(--accent);color:#000;transform:scale(.95)}
.konami-progress{display:flex;gap:6px;justify-content:center;flex-wrap:wrap;margin-bottom:12px}
.konami-pip{width:28px;height:28px;border-radius:50%;border:2px solid var(--text3);display:flex;align-items:center;justify-content:center;font-size:.8rem;color:var(--text3)}
.konami-pip.hit{border-color:var(--success);color:var(--success);background:rgba(0,255,136,.1)}
.konami-pip.miss{border-color:var(--danger);color:var(--danger);background:rgba(255,68,68,.1)}
/* Acrostic */
.acrostic-area{margin-bottom:16px}
.acrostic-text{padding:20px;background:var(--bg2);border-radius:12px;line-height:2.4;font-size:.95rem;color:var(--text2)}
.acrostic-text .first-char{color:var(--accent);font-weight:900;font-size:1.15em}
.acrostic-hint{text-align:center;color:var(--text3);font-size:.85rem;margin-top:12px;margin-bottom:16px;font-style:italic}
/* Logic */
.logic-area{margin-bottom:16px}
.logic-scenario{padding:20px;background:var(--bg2);border-radius:12px;line-height:2;font-size:.95rem;color:var(--text2);margin-bottom:16px}
.logic-scenario b{color:var(--text)}
.logic-choices{display:flex;flex-direction:column;gap:10px}
.logic-choice{padding:14px 18px;background:var(--bg3);border:1px solid var(--card-border);border-radius:12px;cursor:pointer;font-size:.95rem;color:var(--text);transition:all .2s}
.logic-choice:hover{border-color:var(--accent);background:rgba(180,74,255,.08)}
.logic-choice.selected{border-color:var(--cyan);background:rgba(0,229,255,.1)}
/* Book Cipher */
.book-area{margin-bottom:16px}
.book-text{padding:20px;background:var(--bg2);border-radius:12px;line-height:2.2;font-size:.85rem;color:var(--text2);font-family:monospace;white-space:pre-wrap;margin-bottom:12px}
.book-coords{text-align:center;color:var(--cyan);font-size:1rem;font-weight:700;margin-bottom:16px;line-height:2}
/* Hidden Interaction */
.hidden-int-area{margin-bottom:16px;text-align:center}
.hidden-int-target{width:180px;height:180px;margin:0 auto 16px;background:var(--bg3);border:2px solid var(--card-border);border-radius:16px;display:flex;align-items:center;justify-content:center;font-size:3rem;cursor:pointer;user-select:none;transition:all .3s}
.hidden-int-target:hover{border-color:var(--accent)}
.hidden-int-target.active{border-color:var(--cyan);box-shadow:0 0 20px rgba(0,229,255,.3);background:rgba(0,229,255,.05)}
.hidden-int-instruction{color:var(--text2);font-size:.9rem;margin-bottom:16px}
.hidden-int-reveal{color:var(--cyan);font-size:1.1rem;font-weight:700;animation:fadeIn .5s;margin-top:12px}

@media(max-width:600px){
  .hero h1{letter-spacing:.05em}
  .stats-bar{gap:24px}
  .result-stats{gap:12px}
  .series-card{padding:1.3rem}
  .chapter-timeline{padding-left:28px}
  .piano-key{width:38px;height:100px}
  .piano-key.black{width:28px;height:65px;margin:0 -8px}
  .dial-ring{width:56px;height:56px;font-size:1.4rem}
  .flashlight-area{height:250px}
  .dots-area{height:250px}
}
</style>
</head>
<body>

<div id="home">
  <div class="hero">
    <div class="particles" id="particles"></div>
    <h1>QUBE</h1>
    <p>ÌíÄÏñ¥Îùº. ÌÉàÏ∂úÌïòÎùº.</p>
    <button class="hero-cta" onclick="scrollToSeries()">ÏãúÎ¶¨Ï¶à ÏÑ†ÌÉùÌïòÍ∏∞</button>
    <div class="scroll-hint">‚Üì</div>
  </div>
  <div class="stats-bar">
    <div class="stat"><div class="stat-val" id="statCleared">0</div><div class="stat-label">ÌÅ¥Î¶¨Ïñ¥</div></div>
    <div class="stat"><div class="stat-val" id="statGrade">üî∞</div><div class="stat-label">Îì±Í∏â</div></div>
    <div class="stat"><div class="stat-val" id="statStreak">0</div><div class="stat-label">ÏãúÎ¶¨Ï¶à</div></div>
  </div>
  <div class="series-section" id="series-section">
    <h2>üìñ ÎØ∏Ïä§ÌÑ∞Î¶¨ ÏãúÎ¶¨Ï¶à</h2>
    <div class="series-progress-text" id="seriesProgressText"></div>
    <div id="seriesGrid"></div>
  </div>
</div>

<div id="chapters" class="hidden"></div>

<div class="loading-screen" id="loadingScreen">
  <div class="spinner"></div>
  <div class="loading-text">ÏßÑÏûÖ Ï§ë...</div>
</div>

<div id="game" class="hidden">
  <div class="game-header">
    <button class="game-back" onclick="confirmExit()">‚Üê</button>
    <div class="game-title" id="gameTitle"></div>
    <div class="game-progress-text" id="gameProgressText"></div>
  </div>
  <div class="progress-bar" id="progressBar"></div>
  <div id="gameContent"></div>
</div>

<div id="result" class="hidden">
  <div class="result-card" id="resultContent"></div>
</div>

<script>
var API = 'https://qube-api.harpy922.workers.dev';

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   Interactive Puzzle Renderers
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

var _activeTimingAnim = null;
var _activePianoCtx = null;

function cleanupInteractive() {
  if (_activeTimingAnim) { cancelAnimationFrame(_activeTimingAnim); _activeTimingAnim = null; }
}

// ‚îÄ‚îÄ Flashlight ‚îÄ‚îÄ
function initFlashlight(cfg) {
  var area = document.getElementById('interactiveArea');
  var itemsHtml = '';
  cfg.items.forEach(function(it) {
    itemsHtml += '<div class="flashlight-item" style="left:'+it.x+'%;top:'+it.y+'%">'+it.text+'</div>';
  });
  area.innerHTML = '<div class="flashlight-hint-text">üî¶ Ïñ¥Îë† ÏÜçÏùÑ ÎπÑÏ∂∞ Ïà®Í≤®ÏßÑ Îã®ÏÑúÎ•º Ï∞æÏúºÏÑ∏Ïöî (ÎßàÏö∞Ïä§/ÌÑ∞Ïπò Ïù¥Îèô)</div>' +
    '<div class="flashlight-area" id="flArea">' + itemsHtml +
    '<div class="flashlight-overlay" id="flOverlay"></div></div>';
  var el = document.getElementById('flArea');
  var ov = document.getElementById('flOverlay');
  function updatePos(x, y) {
    var r = el.getBoundingClientRect();
    var px = ((x - r.left) / r.width * 100);
    var py = ((y - r.top) / r.height * 100);
    ov.style.setProperty('--fx', px + '%');
    ov.style.setProperty('--fy', py + '%');
  }
  el.addEventListener('mousemove', function(e) { updatePos(e.clientX, e.clientY); });
  el.addEventListener('touchmove', function(e) {
    e.preventDefault();
    var t = e.touches[0];
    updatePos(t.clientX, t.clientY);
  }, {passive:false});
}

// ‚îÄ‚îÄ Jigsaw ‚îÄ‚îÄ
function initJigsaw(cfg) {
  var area = document.getElementById('interactiveArea');
  var slotsHtml = '<div class="jigsaw-slots" style="grid-template-columns:repeat('+cfg.cols+',1fr)">';
  for (var i = 0; i < cfg.pieces.length; i++) {
    slotsHtml += '<div class="jigsaw-slot" data-slot="'+i+'" id="jslot'+i+'"><span>Ïä¨Î°Ø '+(i+1)+'</span></div>';
  }
  slotsHtml += '</div>';
  // Shuffle pieces
  var indices = cfg.pieces.map(function(_,i){return i;});
  for(var j=indices.length-1;j>0;j--){var k=Math.floor(Math.random()*(j+1));var tmp=indices[j];indices[j]=indices[k];indices[k]=tmp;}
  var trayHtml = '<div class="jigsaw-tray" id="jigsawTray">';
  indices.forEach(function(pi) {
    trayHtml += '<div class="jigsaw-piece" draggable="true" data-piece="'+pi+'" id="jpiece'+pi+'">'+cfg.pieces[pi]+'</div>';
  });
  trayHtml += '</div>';
  area.innerHTML = trayHtml + slotsHtml + '<div id="jigsawReveal"></div>';

  // State
  var placed = {};
  var pieces = document.querySelectorAll('.jigsaw-piece');
  var slots = document.querySelectorAll('.jigsaw-slot');

  // Drag events
  pieces.forEach(function(p) {
    p.addEventListener('dragstart', function(e) { e.dataTransfer.setData('text/plain', p.dataset.piece); });
    // Touch drag
    var startX, startY, clone;
    p.addEventListener('touchstart', function(e) {
      var t = e.touches[0];
      startX = t.clientX; startY = t.clientY;
      clone = p.cloneNode(true);
      clone.style.position='fixed'; clone.style.zIndex='999'; clone.style.opacity='.8';
      clone.style.pointerEvents='none'; clone.style.width=p.offsetWidth+'px';
      document.body.appendChild(clone);
      clone.style.left=(t.clientX-30)+'px'; clone.style.top=(t.clientY-20)+'px';
    }, {passive:true});
    p.addEventListener('touchmove', function(e) {
      e.preventDefault();
      if(clone){var t=e.touches[0]; clone.style.left=(t.clientX-30)+'px'; clone.style.top=(t.clientY-20)+'px';}
    }, {passive:false});
    p.addEventListener('touchend', function(e) {
      if(clone){clone.remove();clone=null;}
      var t = e.changedTouches[0];
      var el = document.elementFromPoint(t.clientX, t.clientY);
      if(el && el.classList.contains('jigsaw-slot')) {
        handleDrop(el, p.dataset.piece);
      }
    });
  });

  slots.forEach(function(s) {
    s.addEventListener('dragover', function(e){e.preventDefault();s.classList.add('hover');});
    s.addEventListener('dragleave', function(){s.classList.remove('hover');});
    s.addEventListener('drop', function(e){
      e.preventDefault(); s.classList.remove('hover');
      handleDrop(s, e.dataTransfer.getData('text/plain'));
    });
  });

  function handleDrop(slot, pieceId) {
    var si = parseInt(slot.dataset.slot);
    var pi = parseInt(pieceId);
    if(cfg.correctOrder[pi] === si) {
      placed[pi] = true;
      slot.classList.add('correct');
      slot.innerHTML = '<span style="color:var(--success)">'+cfg.pieces[pi]+'</span>';
      var pc = document.getElementById('jpiece'+pi);
      if(pc) pc.classList.add('placed');
      if(Object.keys(placed).length === cfg.pieces.length) {
        document.getElementById('jigsawReveal').innerHTML = '<div class="jigsaw-reveal">üß© '+cfg.revealText+'</div>';
      }
    } else {
      slot.classList.add('hover');
      setTimeout(function(){slot.classList.remove('hover');},300);
    }
  }
}

// ‚îÄ‚îÄ Dial ‚îÄ‚îÄ
function initDial(cfg) {
  var area = document.getElementById('interactiveArea');
  var html = '<div class="dial-container">';
  html += '<div class="dial-row">';
  cfg.combination.forEach(function(_, i) {
    html += '<div class="dial-digit">';
    html += '<div class="dial-arrows"><button class="dial-arrow" onclick="dialChange('+i+',1)">‚ñ≤</button></div>';
    html += '<div class="dial-ring" id="dialRing'+i+'" onclick="dialChange('+i+',1)">0</div>';
    html += '<div class="dial-arrows"><button class="dial-arrow" onclick="dialChange('+i+',-1)">‚ñº</button></div>';
    if(cfg.labels && cfg.labels[i]) html += '<div class="label">'+cfg.labels[i]+'</div>';
    html += '</div>';
  });
  html += '</div>';
  html += '<button class="dial-lock-btn" onclick="dialCheck()">üîì ÏûêÎ¨ºÏá† Ïó¥Í∏∞</button>';
  html += '<div class="dial-result" id="dialResult"></div>';
  html += '</div>';
  area.innerHTML = html;
  window._dialValues = cfg.combination.map(function(){return 0;});
  window._dialTarget = cfg.combination;
}
function dialChange(i, dir) {
  window._dialValues[i] = (window._dialValues[i] + dir + 10) % 10;
  document.getElementById('dialRing'+i).textContent = window._dialValues[i];
}
function dialCheck() {
  var ok = true;
  for(var i=0;i<window._dialTarget.length;i++){
    if(window._dialValues[i] !== window._dialTarget[i]) ok=false;
  }
  var res = document.getElementById('dialResult');
  if(ok) {
    res.innerHTML = '<span style="color:var(--success)">üîì ÏûêÎ¨ºÏá†Í∞Ä Ïó¥Î†∏Îã§!</span>';
    var inp = document.getElementById('answerInput');
    if(inp) inp.value = window._dialTarget.join('');
  } else {
    res.innerHTML = '<span style="color:var(--danger)">Îî∏Íπç... Ïó¥Î¶¨ÏßÄ ÏïäÎäîÎã§.</span>';
    setTimeout(function(){res.innerHTML='';},1500);
  }
}

// ‚îÄ‚îÄ Piano ‚îÄ‚îÄ
function initPiano(cfg) {
  var area = document.getElementById('interactiveArea');
  var notes = cfg.keys || ['C','D','E','F','G','A','B'];
  var noteNames = {'C':'ÎèÑ','D':'Î†à','E':'ÎØ∏','F':'Ìåå','G':'ÏÜî','A':'Îùº','B':'Ïãú'};
  var freqs = {'C':261.63,'D':293.66,'E':329.63,'F':349.23,'G':392,'A':440,'B':493.88};
  var isBlack = {'C':false,'D':false,'E':false,'F':false,'G':false,'A':false,'B':false,'C#':true,'D#':true,'F#':true,'G#':true,'A#':true};

  var keysHtml = '<div class="piano-keys">';
  notes.forEach(function(n) {
    var cls = isBlack[n] ? 'black' : 'white';
    keysHtml += '<div class="piano-key '+cls+'" data-note="'+n+'" onclick="pianoPress(\''+n+'\')">'+(noteNames[n]||n)+'</div>';
  });
  keysHtml += '</div>';

  var seqHtml = '<div class="piano-display">Ïó∞Ï£ºÌï† ÏàúÏÑú: <b>'+cfg.display+'</b></div>';
  seqHtml += '<div class="piano-sequence" id="pianoSeq">';
  cfg.sequence.forEach(function(_, i) {
    seqHtml += '<div class="piano-seq-dot" id="pseq'+i+'">'+(i+1)+'</div>';
  });
  seqHtml += '</div>';

  area.innerHTML = seqHtml + keysHtml;
  window._pianoSeq = cfg.sequence;
  window._pianoPos = 0;
  window._pianoFailed = false;

  // Setup audio
  try { if(!_activePianoCtx) _activePianoCtx = new (window.AudioContext||window.webkitAudioContext)(); }
  catch(e) { _activePianoCtx = null; }
  window._pianoFreqs = freqs;
}
function pianoPress(note) {
  // Play sound
  if(_activePianoCtx) {
    try {
      var osc = _activePianoCtx.createOscillator();
      var gain = _activePianoCtx.createGain();
      osc.connect(gain); gain.connect(_activePianoCtx.destination);
      osc.frequency.value = window._pianoFreqs[note] || 440;
      osc.type = 'sine';
      gain.gain.setValueAtTime(0.3, _activePianoCtx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, _activePianoCtx.currentTime + 0.5);
      osc.start(); osc.stop(_activePianoCtx.currentTime + 0.5);
    } catch(e){}
  }
  // Visual feedback
  var keys = document.querySelectorAll('.piano-key[data-note="'+note+'"]');
  keys.forEach(function(k){k.classList.add('pressed');setTimeout(function(){k.classList.remove('pressed');},200);});

  if(window._pianoFailed) return;
  var expected = window._pianoSeq[window._pianoPos];
  var dot = document.getElementById('pseq'+window._pianoPos);
  if(note === expected) {
    dot.classList.add('hit');
    window._pianoPos++;
    if(window._pianoPos >= window._pianoSeq.length) {
      // Auto-fill answer
      var inp = document.getElementById('answerInput');
      if(inp && window._pianoAnswer) inp.value = window._pianoAnswer;
      keys.forEach(function(k){k.classList.add('correct-flash');});
    }
  } else {
    dot.classList.add('miss');
    window._pianoFailed = true;
    setTimeout(function(){
      window._pianoPos = 0;
      window._pianoFailed = false;
      document.querySelectorAll('.piano-seq-dot').forEach(function(d){d.classList.remove('hit','miss');});
    }, 800);
  }
}

// ‚îÄ‚îÄ Hidden Text ‚îÄ‚îÄ
function initHiddenText(cfg) {
  var area = document.getElementById('interactiveArea');
  var html = '<div class="hidden-text-hint">üí° ÌÖçÏä§Ìä∏Î•º ÎìúÎûòÍ∑∏(ÏÑ†ÌÉù)ÌïòÏó¨ Ïà®Í≤®ÏßÑ Í∏ÄÏûêÎ•º Ï∞æÏúºÏÑ∏Ïöî</div>';
  html += '<div class="hidden-text-area" id="htArea">';
  cfg.segments.forEach(function(seg) {
    if(seg.hidden) {
      html += '<span class="secret" onclick="this.classList.toggle(\'revealed\')">'+seg.text+'</span>';
    } else {
      html += '<span>'+seg.text+'</span>';
    }
  });
  html += '</div>';
  area.innerHTML = html;
}

// ‚îÄ‚îÄ Timing ‚îÄ‚îÄ
function initTiming(cfg) {
  var area = document.getElementById('interactiveArea');
  var zoneStart = (cfg.zoneStart || 0.35) * 100;
  var zoneEnd = (cfg.zoneEnd || 0.55) * 100;
  var required = cfg.required || 3;
  var html = '<div class="timing-area">';
  html += '<div class="timing-progress" id="timingPips">';
  for(var i=0;i<required;i++) html += '<div class="timing-pip" id="tpip'+i+'">'+(i+1)+'</div>';
  html += '</div>';
  html += '<div class="timing-track"><div class="timing-zone" style="left:'+zoneStart+'%;width:'+(zoneEnd-zoneStart)+'%"></div>';
  html += '<div class="timing-cursor" id="timingCursor"></div></div>';
  html += '<button class="timing-btn" id="timingBtn" onclick="timingHit()">‚ö° ÌÉÄÏù¥Î∞ç ÎßûÏ∂îÍ∏∞!</button>';
  html += '</div>';
  area.innerHTML = html;

  window._timingState = {hits:0, required:required, zs:cfg.zoneStart||0.35, ze:cfg.zoneEnd||0.55, pos:0, dir:1, speed:cfg.speed||0.008, running:true, revealText:cfg.revealText||''};
  var cursor = document.getElementById('timingCursor');
  function animate() {
    if(!window._timingState.running) return;
    var s = window._timingState;
    s.pos += s.dir * s.speed;
    if(s.pos >= 1) { s.pos = 1; s.dir = -1; }
    if(s.pos <= 0) { s.pos = 0; s.dir = 1; }
    cursor.style.left = (s.pos * 95) + '%';
    _activeTimingAnim = requestAnimationFrame(animate);
  }
  animate();
}
function timingHit() {
  var s = window._timingState;
  if(!s || !s.running) return;
  var inZone = s.pos >= s.zs && s.pos <= s.ze;
  var pip = document.getElementById('tpip'+s.hits);
  if(inZone) {
    if(pip) pip.classList.add('hit');
    s.hits++;
    if(s.hits >= s.required) {
      s.running = false;
      document.getElementById('timingBtn').disabled = true;
      document.getElementById('timingBtn').textContent = '‚úÖ ÏÑ±Í≥µ!';
      if(s.revealText) {
        var inp = document.getElementById('answerInput');
        if(inp) inp.value = s.revealText;
      }
    } else {
      s.speed += 0.003; // gets faster
    }
  } else {
    if(pip) pip.classList.add('miss');
    setTimeout(function(){
      s.hits = 0;
      document.querySelectorAll('.timing-pip').forEach(function(p){p.classList.remove('hit','miss');});
    }, 500);
  }
}

// ‚îÄ‚îÄ Connect Dots ‚îÄ‚îÄ
function initConnectDots(cfg) {
  var area = document.getElementById('interactiveArea');
  var html = '<div class="dots-area" id="dotsArea"><svg id="dotsSvg">';
  // Lines placeholder
  html += '<g id="dotsLines"></g>';
  // Dots
  cfg.dots.forEach(function(d, i) {
    html += '<g class="dot-point" data-order="'+d.order+'" onclick="dotClick('+d.order+')">';
    html += '<circle cx="'+d.x+'%" cy="'+d.y+'%" r="12" fill="rgba(180,74,255,.15)" stroke="var(--accent)" stroke-width="2"/>';
    html += '<text class="dot-label" x="'+d.x+'%" y="'+d.y+'%">'+d.order+'</text>';
    html += '</g>';
  });
  html += '</svg></div><div id="dotsReveal"></div>';
  area.innerHTML = html;
  window._dotsState = {current:1, total:cfg.dots.length, dots:cfg.dots, revealText:cfg.revealText||''};
}
function dotClick(order) {
  var s = window._dotsState;
  if(order !== s.current) return;
  // Highlight dot
  var dot = document.querySelector('.dot-point[data-order="'+order+'"] circle');
  if(dot) { dot.setAttribute('fill','rgba(0,255,136,.3)'); dot.setAttribute('stroke','var(--success)'); }
  // Draw line from previous
  if(s.current > 1) {
    var prev = s.dots.find(function(d){return d.order===s.current-1;});
    var curr = s.dots.find(function(d){return d.order===s.current;});
    if(prev && curr) {
      var svg = document.getElementById('dotsLines');
      var line = document.createElementNS('http://www.w3.org/2000/svg','line');
      line.setAttribute('x1',prev.x+'%'); line.setAttribute('y1',prev.y+'%');
      line.setAttribute('x2',curr.x+'%'); line.setAttribute('y2',curr.y+'%');
      line.setAttribute('class','dot-line');
      svg.appendChild(line);
    }
  }
  s.current++;
  if(s.current > s.total) {
    document.getElementById('dotsReveal').innerHTML = '<div class="dots-reveal">‚ú® '+s.revealText+'</div>';
    var inp = document.getElementById('answerInput');
    if(inp && s.answerFill) inp.value = s.answerFill;
  }
}

// ‚îÄ‚îÄ Color Code ‚îÄ‚îÄ
function initColorCode(cfg) {
  var area = document.getElementById('interactiveArea');
  var html = '<div class="color-grid">';
  cfg.colors.forEach(function(c) {
    html += '<div class="color-item"><div class="color-circle" style="background:'+c.color+'"></div><div class="color-name">'+c.name+'</div></div>';
  });
  html += '</div>';
  html += '<div class="color-hint">'+cfg.clueText+'</div>';
  area.innerHTML = html;
}

// ‚îÄ‚îÄ Mirror ‚îÄ‚îÄ
function initMirror(cfg) {
  var area = document.getElementById('interactiveArea');
  var cls = 'mirror-text';
  if(cfg.direction === 'horizontal') cls += ' flip-h';
  else if(cfg.direction === 'vertical') cls += ' flip-v';
  else if(cfg.direction === 'both') cls += ' flip-both';
  area.innerHTML = '<div class="mirror-area"><div class="'+cls+'">'+cfg.text+'</div>' +
    '<div class="mirror-label">ü™û Í±∞Ïö∏Ïóê ÎπÑÏπú Í∏ÄÏûêÎ•º Ìï¥ÎèÖÌïòÏÑ∏Ïöî</div></div>';
}

// ‚îÄ‚îÄ Shake ‚îÄ‚îÄ
function initShake(cfg) {
  var area = document.getElementById('interactiveArea');
  var required = cfg.required || 20;
  var html = '<div class="shake-area">';
  html += '<div class="shake-icon" id="shakeIcon">üì±</div>';
  html += '<div class="shake-instruction" id="shakeInst"></div>';
  html += '<div class="shake-progress"><div class="shake-bar"><div class="shake-fill" id="shakeFill"></div></div></div>';
  html += '<div class="shake-count" id="shakeCount">0 / '+required+'</div>';
  html += '<div id="shakeReveal"></div>';
  html += '</div>';
  area.innerHTML = html;

  window._shakeState = {count:0, required:required, done:false, revealText:cfg.revealText||''};

  // Check mobile
  var isMobile = /Android|iPhone|iPad/i.test(navigator.userAgent);
  if(isMobile && window.DeviceMotionEvent) {
    document.getElementById('shakeInst').textContent = 'üì± Í∏∞Í∏∞Î•º ÌùîÎì§Ïñ¥ Îã®ÏÑúÎ•º Ï∞æÏúºÏÑ∏Ïöî!';
    // Request permission for iOS
    if(typeof DeviceMotionEvent.requestPermission === 'function') {
      DeviceMotionEvent.requestPermission().then(function(p){
        if(p==='granted') window.addEventListener('devicemotion', shakeHandler);
      }).catch(function(){
        // Fallback to button
        addShakeButton();
      });
    } else {
      window.addEventListener('devicemotion', shakeHandler);
    }
  } else {
    document.getElementById('shakeInst').textContent = '‚å®Ô∏è Ïä§ÌéòÏù¥Ïä§Î∞îÎ•º Ïó∞ÌÉÄÌïòÏÑ∏Ïöî!';
    addShakeButton();
    document.addEventListener('keydown', shakeKeyHandler);
  }
}
function addShakeButton() {
  var area = document.querySelector('.shake-area');
  if(area && !document.getElementById('shakeBtn')) {
    var btn = document.createElement('button');
    btn.className = 'shake-spacebar';
    btn.id = 'shakeBtn';
    btn.textContent = 'üëä ÎëêÎìúÎ¶¨Í∏∞!';
    btn.onclick = doShake;
    area.insertBefore(btn, document.getElementById('shakeReveal'));
  }
}
function shakeHandler(e) {
  var acc = e.accelerationIncludingGravity;
  if(!acc) return;
  var total = Math.abs(acc.x||0) + Math.abs(acc.y||0) + Math.abs(acc.z||0);
  if(total > 30) doShake();
}
function shakeKeyHandler(e) {
  if(e.code === 'Space' && window._shakeState && !window._shakeState.done) {
    e.preventDefault();
    doShake();
  }
}
function doShake() {
  var s = window._shakeState;
  if(!s || s.done) return;
  s.count++;
  var pct = Math.min(100, s.count / s.required * 100);
  document.getElementById('shakeFill').style.width = pct + '%';
  document.getElementById('shakeCount').textContent = Math.min(s.count, s.required) + ' / ' + s.required;
  document.getElementById('shakeIcon').classList.add('shaking');
  setTimeout(function(){document.getElementById('shakeIcon').classList.remove('shaking');},100);
  if(s.count >= s.required && !s.done) {
    s.done = true;
    document.getElementById('shakeReveal').innerHTML = '<div class="shake-reveal">üí° '+s.revealText+'</div>';
    window.removeEventListener('devicemotion', shakeHandler);
    document.removeEventListener('keydown', shakeKeyHandler);
    var btn = document.getElementById('shakeBtn');
    if(btn) btn.disabled = true;
  }
}

// ‚îÄ‚îÄ Trivia ‚îÄ‚îÄ
function initTrivia(cfg) {
  var area = document.getElementById('interactiveArea');
  var html = '<div class="trivia-area"><div class="trivia-question">'+cfg.question+'</div><div class="trivia-options">';
  cfg.options.forEach(function(opt, i) {
    html += '<div class="trivia-option" onclick="triviaSelect(this)">'+opt+'</div>';
  });
  html += '</div></div>';
  area.innerHTML = html;
}
function triviaSelect(el) {
  document.querySelectorAll('.trivia-option').forEach(function(o){o.classList.remove('selected');});
  el.classList.add('selected');
  var inp = document.getElementById('answerInput');
  if(inp) inp.value = el.textContent.trim();
}

// ‚îÄ‚îÄ Caesar ‚îÄ‚îÄ
function initCaesar(cfg) {
  var area = document.getElementById('interactiveArea');
  var alpha = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
  var tableHtml = '<div class="caesar-table">';
  for(var i=0;i<26;i++) tableHtml += '<span>'+alpha[i]+'‚Üí'+alpha[(i+26-cfg.shift)%26]+'</span>';
  tableHtml += '</div>';
  area.innerHTML = '<div class="caesar-area">' +
    '<div class="caesar-cipher">'+cfg.cipherText+'</div>' +
    '<div class="caesar-shift">üîë ÌûåÌä∏: ÏïåÌååÎ≤≥ÏùÑ '+cfg.shift+'Ïπ∏ Îí§Î°ú Î∞ÄÏñ¥Îùº ('+cfg.shiftHint+')</div>' +
    tableHtml + '</div>';
}

// ‚îÄ‚îÄ Morse ‚îÄ‚îÄ
var MORSE_MAP = {A:'¬∑‚Äî',B:'‚Äî¬∑¬∑¬∑',C:'‚Äî¬∑‚Äî¬∑',D:'‚Äî¬∑¬∑',E:'¬∑',F:'¬∑¬∑‚Äî¬∑',G:'‚Äî‚Äî¬∑',H:'¬∑¬∑¬∑¬∑',I:'¬∑¬∑',J:'¬∑‚Äî‚Äî‚Äî',K:'‚Äî¬∑‚Äî',L:'¬∑‚Äî¬∑¬∑',M:'‚Äî‚Äî',N:'‚Äî¬∑',O:'‚Äî‚Äî‚Äî',P:'¬∑‚Äî‚Äî¬∑',Q:'‚Äî‚Äî¬∑‚Äî',R:'¬∑‚Äî¬∑',S:'¬∑¬∑¬∑',T:'‚Äî',U:'¬∑¬∑‚Äî',V:'¬∑¬∑¬∑‚Äî',W:'¬∑‚Äî‚Äî',X:'‚Äî¬∑¬∑‚Äî',Y:'‚Äî¬∑‚Äî‚Äî',Z:'‚Äî‚Äî¬∑¬∑','0':'‚Äî‚Äî‚Äî‚Äî‚Äî','1':'¬∑‚Äî‚Äî‚Äî‚Äî','2':'¬∑¬∑‚Äî‚Äî‚Äî','3':'¬∑¬∑¬∑‚Äî‚Äî','4':'¬∑¬∑¬∑¬∑‚Äî','5':'¬∑¬∑¬∑¬∑¬∑','6':'‚Äî¬∑¬∑¬∑¬∑','7':'‚Äî‚Äî¬∑¬∑¬∑','8':'‚Äî‚Äî‚Äî¬∑¬∑','9':'‚Äî‚Äî‚Äî‚Äî¬∑'};
function initMorse(cfg) {
  var area = document.getElementById('interactiveArea');
  var refHtml = '<div class="morse-ref">';
  'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'.split('').forEach(function(c){refHtml+='<span>'+c+' '+MORSE_MAP[c]+'</span>';});
  refHtml += '</div>';
  area.innerHTML = '<div class="morse-area">' +
    '<div class="morse-code">'+cfg.code+'</div>' +
    '<button class="morse-play-btn" onclick="playMorse(\''+cfg.answer+'\')">üîä ÏÜåÎ¶¨ Ïû¨ÏÉù</button>' +
    refHtml + '</div>';
}
function playMorse(text) {
  try {
    var ctx = new (window.AudioContext||window.webkitAudioContext)();
    var t = ctx.currentTime + 0.1;
    var unit = 0.08;
    text.toUpperCase().split('').forEach(function(ch) {
      var code = MORSE_MAP[ch];
      if(!code) { t += unit * 7; return; }
      code.split('').forEach(function(sym) {
        var dur = sym === '‚Äî' ? unit*3 : unit;
        var osc = ctx.createOscillator();
        var gain = ctx.createGain();
        osc.connect(gain); gain.connect(ctx.destination);
        osc.frequency.value = 700; osc.type = 'sine';
        gain.gain.setValueAtTime(0.3, t);
        gain.gain.setValueAtTime(0, t+dur);
        osc.start(t); osc.stop(t+dur+0.01);
        t += dur + unit;
      });
      t += unit * 2;
    });
  } catch(e){}
}

// ‚îÄ‚îÄ Konami (Arrow Sequence) ‚îÄ‚îÄ
function initKonami(cfg) {
  var area = document.getElementById('interactiveArea');
  var arrows = {up:'‚Üë',down:'‚Üì',left:'‚Üê',right:'‚Üí'};
  var seqDisplay = cfg.sequence.map(function(s){return arrows[s]||s;}).join(' ');
  var html = '<div class="konami-area">';
  html += '<div class="konami-sequence">'+seqDisplay+'</div>';
  html += '<div class="konami-progress" id="konamiPips">';
  cfg.sequence.forEach(function(_,i){html+='<div class="konami-pip" id="kpip'+i+'">'+(i+1)+'</div>';});
  html += '</div>';
  html += '<div class="konami-buttons">';
  html += '<div></div><button onclick="konamiPress(\'up\')">‚Üë</button><div></div>';
  html += '<button onclick="konamiPress(\'left\')">‚Üê</button><button onclick="konamiPress(\'down\')">‚Üì</button><button onclick="konamiPress(\'right\')">‚Üí</button>';
  html += '</div></div>';
  area.innerHTML = html;
  window._konamiState = {sequence:cfg.sequence, pos:0, failed:false, answer:cfg.answer||''};
  document.addEventListener('keydown', konamiKeyHandler);
}
function konamiKeyHandler(e) {
  var map = {ArrowUp:'up',ArrowDown:'down',ArrowLeft:'left',ArrowRight:'right'};
  if(map[e.key]) { e.preventDefault(); konamiPress(map[e.key]); }
}
function konamiPress(dir) {
  var s = window._konamiState;
  if(!s || s.done) return;
  if(s.failed) return;
  var expected = s.sequence[s.pos];
  var pip = document.getElementById('kpip'+s.pos);
  if(dir === expected) {
    if(pip) pip.classList.add('hit');
    s.pos++;
    if(s.pos >= s.sequence.length) {
      s.done = true;
      document.removeEventListener('keydown', konamiKeyHandler);
      var inp = document.getElementById('answerInput');
      if(inp) inp.value = s.answer;
    }
  } else {
    if(pip) pip.classList.add('miss');
    s.failed = true;
    setTimeout(function(){
      s.pos = 0; s.failed = false;
      document.querySelectorAll('.konami-pip').forEach(function(p){p.classList.remove('hit','miss');});
    }, 600);
  }
}

// ‚îÄ‚îÄ Acrostic ‚îÄ‚îÄ
function initAcrostic(cfg) {
  var area = document.getElementById('interactiveArea');
  var html = '<div class="acrostic-area"><div class="acrostic-text">';
  cfg.lines.forEach(function(line) {
    html += '<div><span class="first-char">'+line.charAt(0)+'</span>'+line.substring(1)+'</div>';
  });
  html += '</div><div class="acrostic-hint">üí° Í∞Å Ï§ÑÏùò Ï≤´ Í∏ÄÏûêÎ•º Î™®ÏïÑ ÏùΩÏñ¥Î≥¥ÏÑ∏Ïöî</div></div>';
  area.innerHTML = html;
}

// ‚îÄ‚îÄ Logic ‚îÄ‚îÄ
function initLogic(cfg) {
  var area = document.getElementById('interactiveArea');
  var html = '<div class="logic-area"><div class="logic-scenario">'+cfg.scenario+'</div><div class="logic-choices">';
  cfg.choices.forEach(function(ch) {
    html += '<div class="logic-choice" onclick="logicSelect(this)">'+ch+'</div>';
  });
  html += '</div></div>';
  area.innerHTML = html;
}
function logicSelect(el) {
  document.querySelectorAll('.logic-choice').forEach(function(o){o.classList.remove('selected');});
  el.classList.add('selected');
  var inp = document.getElementById('answerInput');
  if(inp) inp.value = el.textContent.trim();
}

// ‚îÄ‚îÄ Book Cipher ‚îÄ‚îÄ
function initBookCipher(cfg) {
  var area = document.getElementById('interactiveArea');
  var lines = cfg.text.split('\n');
  var numberedText = lines.map(function(l,i){return '<span style="color:var(--accent);font-size:.75rem">'+(i+1)+'‚îÇ</span> '+l;}).join('\n');
  area.innerHTML = '<div class="book-area">' +
    '<div class="book-text">'+numberedText+'</div>' +
    '<div class="book-coords">üìç Ï¢åÌëú: '+cfg.coordsText+'</div></div>';
}

// ‚îÄ‚îÄ Hidden Interaction ‚îÄ‚îÄ
function initHiddenInteraction(cfg) {
  var area = document.getElementById('interactiveArea');
  var html = '<div class="hidden-int-area">';
  html += '<div class="hidden-int-instruction">'+cfg.instruction+'</div>';
  html += '<div class="hidden-int-target" id="hidIntTarget">'+cfg.icon+'</div>';
  html += '<div id="hidIntReveal"></div></div>';
  area.innerHTML = html;
  var el = document.getElementById('hidIntTarget');
  if(cfg.type === 'longpress') {
    var timer = null;
    function startPress(e) {
      e.preventDefault();
      el.classList.add('active');
      timer = setTimeout(function(){
        document.getElementById('hidIntReveal').innerHTML = '<div class="hidden-int-reveal">üí° '+cfg.revealText+'</div>';
        var inp = document.getElementById('answerInput');
        if(inp) inp.value = cfg.answer;
      }, cfg.duration || 3000);
    }
    function endPress() { el.classList.remove('active'); if(timer) clearTimeout(timer); }
    el.addEventListener('mousedown', startPress);
    el.addEventListener('mouseup', endPress);
    el.addEventListener('mouseleave', endPress);
    el.addEventListener('touchstart', startPress, {passive:false});
    el.addEventListener('touchend', endPress);
    el.addEventListener('touchcancel', endPress);
  } else if(cfg.type === 'doubleclick') {
    var clickCount = 0, clickTimer = null;
    el.addEventListener('click', function() {
      clickCount++;
      if(clickCount === 1) {
        clickTimer = setTimeout(function(){ clickCount = 0; }, 400);
      } else if(clickCount >= 2) {
        clearTimeout(clickTimer); clickCount = 0;
        el.classList.add('active');
        document.getElementById('hidIntReveal').innerHTML = '<div class="hidden-int-reveal">üí° '+cfg.revealText+'</div>';
        var inp = document.getElementById('answerInput');
        if(inp) inp.value = cfg.answer;
      }
    });
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   Series & Chapter Data
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
var SERIES = [
  {
    id:'professor', title:'ÏÇ¨ÎùºÏßÑ ÍµêÏàò', icon:'üîÆ', difficulty:1,
    desc:'Í≥†Í≥†Ìïô ÍµêÏàò ÍπÄÎèôÌòÑÏù¥ Î∞úÍµ¥ ÌòÑÏû•ÏóêÏÑú Ïã§Ï¢ÖÎêêÎã§. ÎÇ®ÏùÄ Í±¥ ÏïîÌò∏ÌôîÎêú Ïó∞Íµ¨ÎÖ∏Ìä∏ Ìïú Í∂åÎøê.',
    chapters:[
      {
        id:'ch1_study', title:'Ch.1 ‚Äî ÍµêÏàòÏùò ÏÑúÏû¨', desc:'Ïã§Ï¢Ö 3ÏùºÏß∏. ÏÑúÏû¨Ïóê Ïπ®ÏûÖÌï¥ Îã®ÏÑúÎ•º Ï∞æÎäîÎã§.', time:'12Î∂Ñ',
        intro:'ÍπÄÎèôÌòÑ ÍµêÏàòÍ∞Ä ÏÇ¨ÎùºÏ°åÎã§.\n3ÏùºÏß∏ Ïó∞ÎùΩ ÎëêÏ†à. Í≤ΩÏ∞∞ÏùÄ "ÏûêÎ∞úÏ†Å Ïû†Ï†Å"Ïù¥Îùº ÌñàÏßÄÎßå, ÎãπÏã†ÏùÄ ÎØøÏßÄ ÏïäÏïòÎã§.\nÎßàÏä§ÌÑ∞ÌÇ§Î°ú ÏÑúÏû¨Ïóê Îì§Ïñ¥ÏÑ† ÏàúÍ∞Ñ, Îì± Îí§ÏóêÏÑú Î¨∏Ïù¥ Ïû†Í≤ºÎã§.\nÌù¨ÎØ∏Ìïú Ïä§ÌÉ†Îìú Î∂àÎπõ ÏïÑÎûò, Í∏âÌïòÍ≤å Ï∞¢Í∏¥ ÏÑúÎ•òÏôÄ Ïì∞Îü¨ÏßÑ Ïª§ÌîºÏûî.\nÍµêÏàòÎäî Î≠îÍ∞ÄÎ•º Ïà®Í∏∞Îã§ Ï´ìÍ∏¥ Í≤ÉÏù¥Îã§.',
        puzzles:[
          { type:'interactive', interactionType:'hidden-text', title:'üìã ÌçºÏ¶ê 1: Ï±ÖÏÉÅ ÏúÑÏùò ÏïîÌò∏ Î©îÎ™®',
            story:'Ï±ÖÏÉÅ ÏúÑ, Ìîº Î¨ªÏùÄ Ìè¨Ïä§Ìä∏Ïûá ÌïòÎÇò. ÍµêÏàòÏùò Îñ®Î¶¨Îäî ÌïÑÏ≤¥. Ï¢åÌëú ÏïîÌò∏Îã§.',
            config:{ segments:[
              {text:'Í≤©ÏûêÏóêÏÑú Ï¢åÌëú (1,1)=', hidden:false},
              {text:'ÏÑú', hidden:true},
              {text:', (1,2)=', hidden:false},
              {text:'Îûç', hidden:true},
              {text:', (2,1)=', hidden:false},
              {text:'Ïó¥', hidden:true},
              {text:', (2,2)=', hidden:false},
              {text:'Ïñ¥', hidden:true},
              {text:', (2,3)=', hidden:false},
              {text:'Í≥†', hidden:true},
              {text:' ‚Äî Ïù¥ Îã§ÏÑØ Í∏ÄÏûêÍ∞Ä Î©îÏãúÏßÄÎã§. Ìè¨Ïä§Ìä∏ÏûáÏùò ÎÇòÎ®∏ÏßÄ Î∂ÄÎ∂ÑÏùÄ ÌïèÏûêÍµ≠ÏúºÎ°ú Î≤àÏ†∏ ÏûàÎã§.', hidden:false}
            ]},
            hint:'Ïà®Í≤®ÏßÑ Í∏ÄÏûêÎ•º ÎìúÎûòÍ∑∏ÌïòÏó¨ Ï∞æÏúºÏÑ∏Ïöî. Îã§ÏÑØ Í∏ÄÏûêÎ•º Ïù¥Ïñ¥ÏÑú ÏûÖÎ†•.',
            validate:function(i){return i.replace(/\s/g,'') === 'ÏÑúÎûçÏó¥Ïñ¥Í≥†'} },
          { type:'interactive', interactionType:'color-code', title:'üì¶ ÌçºÏ¶ê 2: ÏÑúÎûç ÏÜç ÌÉùÎ∞∞ ÏòÅÏàòÏ¶ù',
            story:'ÏÑúÎûçÏù¥ Ïó¥Î†∏Îã§. ÏïàÏóêÎäî ÌÉùÎ∞∞ ÏòÅÏàòÏ¶ù Ìïú Ïû•. Ïã§Ï¢Ö Ïù¥ÌãÄ Ï†Ñ, ÎÇØÏÑ† Ï£ºÏÜåÎ°ú Î≥¥ÎÇ∏ ÌôîÎ¨º.\nÍµêÏàòÍ∞Ä Îπ®Í∞Ñ ÌéúÏúºÎ°ú Î∞ëÏ§Ñ Í∑∏ÏùÄ Î∂ÄÎ∂Ñ: "ÏÉâÏÉÅ ÏΩîÎìúÍ∞Ä Î∞∞ÏÜ°Î£åÎã§."',
            config:{ colors:[
              {color:'#ff4444', name:'Îπ®Í∞ï (Í∏∞Î≥∏Î£å)', value:'3'},
              {color:'#4488ff', name:'ÌååÎûë (Í±∞Î¶¨Ìï†Ï¶ù)', value:'2'},
              {color:'#44ff88', name:'Ï¥àÎ°ù (Î¨¥Í≤åÌï†Ï¶ù)', value:'1.5'},
              {color:'#ffaa00', name:'ÎÖ∏Îûë (Ìï†Ïù∏)', value:'-0.5'}
            ], clueText:'Í∞Å ÏÉâÏÉÅÏùò Í∞í(Ï≤ú Ïõê Îã®ÏúÑ): Îπ®Í∞ï=3, ÌååÎûë=2, Ï¥àÎ°ù=1.5, ÎÖ∏Îûë=-0.5<br>Î™®Îëê ÎçîÌïú Í∞í √ó 1000 = ÏµúÏ¢Ö Î∞∞ÏÜ°Î£å'},
            hint:'3 + 2 + 1.5 - 0.5 = 6 ‚Üí 6000Ïõê',
            validate:function(i){return i.replace(/[^\d]/g,'') === '6000'} },
          { type:'interactive', interactionType:'mirror', title:'üî¢ ÌçºÏ¶ê 3: Î≤Ω ÏÜçÏùò Í∏àÍ≥†',
            story:'ÏòÅÏàòÏ¶ù Îí∑Î©¥: "Î≤ΩÏùÑ ÌôïÏù∏ÌïòÎùº." Ï±ÖÏû• ÏÑ∏ Î≤àÏß∏ Ïπ∏ Îí§Ïóê Ïà®Í≤®ÏßÑ Í∏àÍ≥†.\nÍ∏àÍ≥† ÏúÑÏóê Í±∞Ïö∏Ïù¥ ÎÜìÏó¨ÏûàÍ≥†, Í∑∏ ÏïàÏóê Ïà´ÏûêÍ∞Ä ÎπÑÏπúÎã§.',
            config:{ text:'3 2 1 5 7', direction:'horizontal' },
            hint:'Í±∞Ïö∏Ïóê ÎπÑÏπú Ïà´ÏûêÎ•º Îí§ÏßëÏúºÎ©¥ 75123',
            validate:function(i){return i.replace(/\s/g,'') === '75123'} },
          { type:'interactive', interactionType:'flashlight', title:'üìì ÌçºÏ¶ê 4: Í∏àÍ≥† ÏÜç ÏàòÏ≤©',
            story:'Í∏àÍ≥†Í∞Ä Ïó¥Î†∏Îã§. "PRIVATE" Í∞ÅÏù∏Îêú Í∞ÄÏ£Ω ÏàòÏ≤©.\nÍ∞ëÏûêÍ∏∞ Ï†ïÏ†Ñ. ÏÜêÏ†ÑÎì±ÏùÑ Í∫ºÎÇ¥ ÎπÑÏ∂∞Ïïº ÌïúÎã§.',
            config:{ items:[
              {x:15, y:25, text:'D=4'},
              {x:65, y:40, text:'O=15'},
              {x:35, y:70, text:'O=15'},
              {x:80, y:75, text:'R=18'},
              {x:50, y:15, text:'DOOR=?'}
            ]},
            hint:'D(4)+O(15)+O(15)+R(18)=52. Ïñ¥Îë† ÏÜçÏùÑ ÎπÑÏ∂∞ Îã®ÏÑúÎ•º Ï∞æÏúºÏÑ∏Ïöî.',
            validate:function(i){return i.trim() === '52'} },
          { type:'cpq', cpqIndex:0,
            story:'ÏàòÏ≤© ÎßàÏßÄÎßâ Ïû•Ïóê Îπ®Í∞Ñ ÎèôÍ∑∏ÎùºÎØ∏ Ïπú Ï£ºÏÜå.\n"Ïó¨Í∏∞Í∞Ä ÌïµÏã¨Ïù¥Îã§." ÍµêÏàòÍ∞Ä ÏÇ¨ÎùºÏßÄÍ∏∞ ÏßÅÏ†Ñ, ÎßàÏßÄÎßâÏúºÎ°ú Ìñ•ÌïòÎ†§Îçò Ïû•ÏÜå.',
            storyAfter:'ÏΩîÎìúÍ∞Ä ÎßûÏïòÎã§. ÏàòÏ≤© Îí∑ÌëúÏßÄ ÏïàÏ™Ω, ÍµêÏàòÏùò ÎßàÏßÄÎßâ Î©îÎ™®Í∞Ä ÎìúÎü¨ÎÇ¨Îã§.' }
        ],
        cliffhanger:'ÏàòÏ≤© Îí∑ÌëúÏßÄÎ•º Î≤óÍ∏∞Ïûê Ï†ëÌûå Ï¢ÖÏù¥Í∞Ä Îñ®Ïñ¥Ï°åÎã§.\nÎñ®Î¶¨Îäî ÏÜêÏúºÎ°ú ÌéºÏ≥§Îã§. ÍµêÏàòÏùò ÌïÑÏ≤¥.\n\n"Í∑∏Îì§Ïù¥ ÎÇòÎ•º Ï∞æÍ≥† ÏûàÎã§. Ïó∞Íµ¨ ÏÉòÌîåÏùÄ ÌôîÎ¨ºÏÑ†Ïóê Ïã§ÏóàÎã§."\n"ÏïÑÎ¶¨ÏïÑÌò∏... Ïù∏Ï≤úÌï≠ 2Î≤à ÏÑ†Ï∞©Ïû•..."\n\nÍµêÏàòÎäî Ïó¨Í∏∞ÏÑú Î∞∞Î•º ÌÉîÎã§.\nÍ∑∏Î¶¨Í≥† ÏÇ¨ÎùºÏ°åÎã§.'
      },
      {
        id:'ch2_ship', title:'Ch.2 ‚Äî ÌôîÎ¨ºÏÑ† ÏïÑÎ¶¨ÏïÑÌò∏', desc:'ÍµêÏàòÍ∞Ä ÎßàÏßÄÎßâÏúºÎ°ú ÌÉëÏäπÌïú Ïú†Î†π ÌôîÎ¨ºÏÑ†Ïóê Ïû†ÏûÖÌïúÎã§.', time:'14Î∂Ñ',
        intro:'Ïù∏Ï≤úÌï≠ 2Î≤à ÏÑ†Ï∞©Ïû•.\nÎÖπÏä® ÌôîÎ¨ºÏÑ† "ÏïÑÎ¶¨ÏïÑÌò∏"Í∞Ä ÏïàÍ∞ú ÏÜçÏóê Ï†ïÎ∞ïÌï¥ ÏûàÎã§.\nÏÑ†Ïõê 12Î™ÖÏù¥ ÌÉÄÍ≥† ÏûàÏóàÎã§. ÏßÄÍ∏àÏùÄ ÏïÑÎ¨¥ÎèÑ ÏóÜÎã§. Íµ¨Î™ÖÎ≥¥Ìä∏ÎèÑ, ÏÜåÏßÄÌíàÎèÑ Í∑∏ÎåÄÎ°úÏù∏ Ï±Ñ.\nÎãπÏã†Ïù¥ Í∞ëÌåêÏóê Ïò¨ÎùºÏÑ† ÏàúÍ∞Ñ, Ìï¥ÏπòÍ∞Ä Îã´ÌòîÎã§.\nÎπÑÏÉÅÎì±Îßå ÍπúÎπ°Ïù¥Í≥†, Ïñ¥ÎîòÍ∞ÄÏóêÏÑú Í∏àÏÜçÏù¥ ÏÇêÍ±±Í±∞Î¶∞Îã§.',
        puzzles:[
          { type:'interactive', interactionType:'flashlight', title:'üß≠ ÌçºÏ¶ê 1: Ìï≠Ìï¥ ÏùºÏßÄÏùò ÎßàÏßÄÎßâ Í∏∞Î°ù',
            story:'ÏÑ†Ïû•Ïã§. ÎπÑÏÉÅÎì±Ïù¥ ÍπúÎπ°Ïù∏Îã§. Ïñ¥Îë† ÏÜçÏóêÏÑú Í∏àÍ≥† ÎπÑÎ∞ÄÎ≤àÌò∏Î•º Ï∞æÏïÑÏïº ÌïúÎã§.\nÎ≤ΩÎ©¥Ïóê ÏÑ∏ Í∂åÏùò Ï±ÖÏù¥ ÍΩÇÌòÄÏûàÎã§.',
            config:{ items:[
              {x:12, y:30, text:'"ÎåÄÌïúÎØºÍµ≠"=4Í∏ÄÏûê'},
              {x:55, y:55, text:'"ÎÇòÏπ®Î∞ò"=3Í∏ÄÏûê'},
              {x:80, y:20, text:'"Ïö©Í≥®"=2Í∏ÄÏûê'},
              {x:40, y:80, text:'ÎπÑÎ∞ÄÎ≤àÌò∏: Í∏ÄÏûêÏàò'}
            ]},
            hint:'ÎåÄÌïúÎØºÍµ≠=4, ÎÇòÏπ®Î∞ò=3, Ïö©Í≥®=2 ‚Üí 432',
            validate:function(i){return i.replace(/\s/g,'') === '432'} },
          { type:'interactive', interactionType:'hidden-text', title:'üì¶ ÌçºÏ¶ê 2: ÌôîÎ¨º Ï†ÅÌïò Î™©Î°ù',
            story:'Í∏àÍ≥† ÏïàÏóê "HELP" Ìïú Îã®Ïñ¥ÏôÄ Ï†ÅÌïò Î™©Î°ù.\nÎπ®Í∞Ñ Ï§Ñ Í∑∏ÏùÄ Ìï≠Î™©: "ÌäπÏàò ÌôîÎ¨º #7 ‚Äî Î∞úÏÜ°ÏßÄ ÌôïÏù∏ ÏöîÎßù."',
            config:{ segments:[
              {text:'ÌôîÎ¨º #7 Ï†úÏõê: Í∏∏Ïù¥ 120cm √ó Ìè≠ 80cm √ó ÎÜíÏù¥ 50cm. Î∂ÄÌîº = ', hidden:false},
              {text:'480000', hidden:true},
              {text:' cm¬≥. Ïù¥ ÌôîÎ¨ºÏùÄ ÏùºÎ∞ò ÌôîÎ¨ºÏù¥ ÏïÑÎãàÎã§. Ïù∏Ï≤¥ ÌÅ¨Í∏∞Ïóê ÎßûÏ∂∞ Ï†úÏûëÎêòÏóàÎã§.', hidden:false}
            ]},
            hint:'120√ó80√ó50=480000. Ïà®Í≤®ÏßÑ Ïà´ÏûêÎ•º ÎìúÎûòÍ∑∏ÌïòÏó¨ Ï∞æÏúºÏÑ∏Ïöî.',
            validate:function(i){return i.replace(/[^\d]/g,'') === '480000'} },
          { type:'interactive', interactionType:'mirror', title:'‚öì ÌçºÏ¶ê 3: Í∏∞Í¥ÄÏã§Ïùò Ïù¥ÏßÑÎ≤ï',
            story:'Í∏∞Í¥ÄÏã§. ÏóîÏßÑÏù¥ Î©àÏ∂∞ÏûàÎã§. Î∞∞Ï†ÑÎ∞ò ÏúÑ Í±∞Ïö∏Ïóê Ïù¥ÏßÑÏàòÍ∞Ä ÎπÑÏπúÎã§.',
            config:{ text:'3 4 9', direction:'horizontal' },
            hint:'Í±∞Ïö∏Ïóê ÎπÑÏπú Ïà´Ïûê 349Î•º Î∞òÏ†Ñ ‚Üí 943',
            validate:function(i){return i.replace(/\s/g,'') === '943'} },
          { type:'interactive', interactionType:'color-code', title:'üìª ÌçºÏ¶ê 4: Î¨¥Ï†ÑÍ∏∞ SOS Ïã†Ìò∏',
            story:'Í∏∞Í¥ÄÏû• Î∞ïÏ≤†ÏàòÏùò ÎÖ∏Ìä∏.\n"ÏÑ†Ïû•Ïù¥ ÌôîÎ¨º #7ÏùÑ Ïó¥ÏóàÎã§. Í∑∏ ÏïàÏóê ÏûàÎçò Í±¥... Ïó∞Íµ¨ ÏÉòÌîåÏù¥ ÏïÑÎãàÏóàÎã§."\nÎ¨¥Ï†ÑÍ∏∞ ÏòÜÏóê ÏÉâÏÉÅ ÏΩîÎìúÌëú.',
            config:{ colors:[
              {color:'#ff4444', name:'Îπ®Í∞ï (S=Ï†ê3Í∞ú)', value:'3'},
              {color:'#ffaa00', name:'ÎÖ∏Îûë (O=ÏÑ†3Í∞ú)', value:'3'},
              {color:'#4488ff', name:'ÌååÎûë (S=Ï†ê3Í∞ú)', value:'3'}
            ], clueText:'SOS = S(3) + O(3) + S(3)<br>Ï¥ù Ïã†Ìò∏ Í∞úÏàòÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî'},
            hint:'3 + 3 + 3 = 9',
            validate:function(i){return i.trim() === '9'} },
          { type:'cpq', cpqIndex:0,
            story:'Í∏∞Í¥ÄÏû•Ïùò ÎÖ∏Ìä∏ ÎßàÏßÄÎßâ ÌéòÏù¥ÏßÄ.\n"ÌôîÎ¨º #7Ïùò ÏßÑÏßú Î∞úÏÜ°ÏßÄÎ•º Ï∞æÏïòÎã§. Ïù¥ Ï£ºÏÜåÎã§."',
            storyAfter:'ÎßûÏïòÎã§. Í∏∞Í¥ÄÏû•Ïùò ÎßàÏßÄÎßâ Í∏∞Î°ùÏù¥ Ìï¥ÎèÖÎêêÎã§.' }
        ],
        cliffhanger:'Í∏∞Í¥ÄÏû•Ïùò ÎßàÏßÄÎßâ Í∏∞Î°ù.\n\n"ÌôîÎ¨º #7 ÏïàÏóê Îì† Í±¥ ÍµêÏàòÏùò Ïó∞Íµ¨ ÏÉòÌîåÏù¥ ÏïÑÎãàÏóàÎã§.\nÏù∏Ï≤¥ Ï°∞ÏßÅÏù¥ÏóàÎã§."\n\nÏ†ÅÌïò Î™©Î°ù Îí∑Î©¥, Î∞∞ÏÜ°ÏßÄ Ï£ºÏÜåÍ∞Ä Ï†ÅÌòÄ ÏûàÎã§.\n\n"Í∑∏ÎûúÎìú ÌååÌÅ¨ Ìò∏ÌÖî 1408Ìò∏ ‚Äî VIP Ï†ÑÏö© Î∞∞ÏÜ°"\n\nÍµêÏàòÎäî Ïù¥Í±∏ ÏïåÍ≥† ÏûàÏóàÎã§. Í∑∏ÎûòÏÑú Ï´ìÍ∏¥ Í≤ÉÏù¥Îã§.'
      },
      {
        id:'ch3_hotel', title:'Ch.3 ‚Äî Ìò∏ÌÖî Ïä§ÏúÑÌä∏Î£∏', desc:'5ÏÑ±Í∏â Ìò∏ÌÖî 1408Ìò∏. ÍµêÏàòÍ∞Ä ÎßàÏßÄÎßâÏúºÎ°ú Î™©Í≤©Îêú Í≥≥.', time:'15Î∂Ñ',
        intro:'Í∑∏ÎûúÎìú ÌååÌÅ¨ Ìò∏ÌÖî. Î°úÎπÑÏùò ÏÉπÎì§Î¶¨ÏóêÍ∞Ä Ï∞®Í∞ëÍ≤å ÎπõÎÇúÎã§.\n1408Ìò∏. VIP Ï†ÑÏö© Ïä§ÏúÑÌä∏Î£∏. ÍµêÏàòÍ∞Ä ÎßàÏßÄÎßâÏúºÎ°ú Î™©Í≤©Îêú Í≥≥.\nÏπ¥ÎìúÌÇ§Î•º ÎåÄÏûê Î¨∏Ïù¥ Ïó¥Î†∏Îã§. ÏïàÏóê Îì§Ïñ¥ÏÑúÎäî ÏàúÍ∞Ñ, ÏûêÎèô Ïû†Í∏à.\nÏπ®ÎåÄÎäî Ï†ïÎèàÎêòÏñ¥ ÏûàÏßÄÎßå, ÏöïÏã§ÏóêÏÑú Ìù¨ÎØ∏Ìïú Î¨ºÏÜåÎ¶¨Í∞Ä Îì§Î¶∞Îã§.\nÎàÑÍµ∞Í∞Ä Ïó¨Í∏∞ ÏûàÏóàÎã§. ÏïÑÏ£º ÏµúÍ∑ºÍπåÏßÄ.',
        puzzles:[
          { type:'interactive', interactionType:'color-code', title:'üîë ÌçºÏ¶ê 1: ÎÖ∏Ìä∏Î∂ÅÏùò Ïù¥Î™®ÏßÄ ÏïîÌò∏',
            story:'Ï±ÖÏÉÅ ÏúÑ ÎÖ∏Ìä∏Î∂ÅÏù¥ Ïó¥Î†§ÏûàÎã§. Ïû†Í∏à ÌôîÎ©¥Ïóê Ïù¥Î™®ÏßÄ ÏàòÏãùÏù¥ ÍπúÎπ°Ïù∏Îã§.',
            config:{ colors:[
              {color:'#ffd700', name:'üè® Ìò∏ÌÖî', value:'14'},
              {color:'#c0c0c0', name:'üîë Ïó¥Ïá†', value:'4'}
            ], clueText:'üè®+üè®=28 ‚Üí üè®=14<br>üîë√óüîë=16 ‚Üí üîë=4<br>üè®-üîë=?'},
            hint:'14 - 4 = 10',
            validate:function(i){return i.trim() === '10'} },
          { type:'interactive', interactionType:'mirror', title:'üíª ÌçºÏ¶ê 2: Í≤ÄÏÉâ Í∏∞Î°ù Î∂ÑÏÑù',
            story:'ÎÖ∏Ìä∏Î∂ÅÏù¥ Ïó¥Î†∏Îã§. ÌôîÎ©¥Ïóê Í±∞Ïö∏Ï≤òÎüº Î∞òÏ†ÑÎêú Ïà´ÏûêÍ∞Ä ÌëúÏãúÎêúÎã§.\n"Ìò∏ÌÖî 1408Ìò∏ ÎπÑÎ∞Ä" Í≤ÄÏÉâÍ≥º "Ïà´Ïûê 7Ïùò ÏùòÎØ∏" Í≤ÄÏÉâ Í≤∞Í≥º.',
            config:{ text:'5 1 4 1', direction:'horizontal' },
            hint:'Î∞òÏ†ÑÎêú 1415 ‚Üí 1415',
            validate:function(i){return i.trim() === '1415'} },
          { type:'interactive', interactionType:'flashlight', title:'ü™û ÌçºÏ¶ê 3: ÏöïÏã§ Í±∞Ïö∏Ïùò Î©îÏãúÏßÄ',
            story:'"Í±∞Ïö∏ Îí§Ïóê ÏßÑÏã§Ïù¥ ÏûàÎã§."\nÏöïÏã§Ïù¥ ÍπúÍπúÌïòÎã§. ÏÜêÏ†ÑÎì±ÏúºÎ°ú ÍπÄ ÏÑúÎ¶∞ Í±∞Ïö∏ÏùÑ ÎπÑÏ∂∞Ïïº ÌïúÎã§.',
            config:{ items:[
              {x:20, y:35, text:'5'},
              {x:45, y:55, text:'6'},
              {x:65, y:25, text:'7'},
              {x:85, y:70, text:'5'},
              {x:50, y:85, text:'ÏàúÏÑúÎåÄÎ°ú ÏùΩÏñ¥Îùº'}
            ]},
            hint:'ÏàúÏÑúÎåÄÎ°ú 5675',
            validate:function(i){return i.trim() === '5675'} },
          { type:'interactive', interactionType:'hidden-text', title:'üìÖ ÌçºÏ¶ê 4: ÎπÑÎ∞Ä Í∏àÍ≥†Ïùò ÏùºÏ†ïÌëú',
            story:'ÏöïÏã§ ÌÉÄÏùº Î∞ëÏóê Í∏àÍ≥†. Ìò∏ÌÖî ÎπÑÌíàÏù¥ ÏïÑÎãàÎã§. ÏïàÏóê ÍµêÏàòÏùò ÎπÑÎ∞Ä ÏùºÏ†ïÌëú.',
            config:{ segments:[
              {text:'09:00 AÏÇ¨ ÎØ∏ÌåÖ: 3Î™Ö / 14:00 BÏÇ¨ Í≤ÄÌÜ†: 2Î™Ö / 16:30 CÏÇ¨ ÌòëÏùò: 4Î™Ö / 19:00 Ï†ÄÎÖÅ: 1Î™Ö. Ï¥ù Ï∞∏ÏÑùÏûê = ', hidden:false},
              {text:'10', hidden:true},
              {text:'Î™Ö. ÎßàÏßÄÎßâ ÎØ∏ÌåÖ Ïû•ÏÜåÎßåÏù¥ ÏßÑÏßú Îã®ÏÑúÎã§.', hidden:false}
            ]},
            hint:'3+2+4+1=10. Ïà®Í≤®ÏßÑ Ïà´ÏûêÎ•º Ï∞æÏúºÏÑ∏Ïöî.',
            validate:function(i){return i.trim() === '10'} },
          { type:'cpq', cpqIndex:0,
            story:'Í∏àÍ≥† Ïïà Î¥âÌà¨. ÍµêÏàòÏùò Ìé∏ÏßÄ.\n"Ïù¥ Ìò∏ÌÖîÏùÄ Í±∞Ï†êÏù¥Îã§. ÏßÑÏßú Î™©Ï†ÅÏßÄÏùò ÏúÑÏπòÎ•º ÎÇ®Í∏¥Îã§."',
            storyAfter:'Ìé∏ÏßÄÏùò ÎßàÏßÄÎßâ Ï§ÑÏù¥ ÎìúÎü¨ÎÇ¨Îã§.' }
        ],
        cliffhanger:'Ìé∏ÏßÄÏùò ÎßàÏßÄÎßâ Ï§Ñ.\n\n"ÎÇòÎäî ÎèÑÎßùÏπú Í≤å ÏïÑÎãàÎã§. Í∞êÍ∏àÎãπÌñàÎã§."\n"Ïπ®ÎåÄ Ìó§ÎìúÎ≥¥Îìú Îí§Ïóê ÎπÑÎ∞Ä ÌÜµÎ°úÍ∞Ä ÏûàÎã§. ÌïòÏßÄÎßå Ïó¥ÏßÄ ÎßàÎùº."\n"Í∑∏Îì§Ïù¥ Í∏∞Îã§Î¶¨Í≥† ÏûàÎã§."\n\nÌó§ÎìúÎ≥¥ÎìúÎ•º Î∞ÄÏûê Ï∞®Í∞ÄÏö¥ Î∞îÎûåÏù¥ Î∂àÏñ¥ÏôîÎã§.\nÌÜµÎ°ú Î≤ΩÏóê ÏÇ¨ÏßÑ Ìïú Ïû•Ïù¥ Î∂ôÏñ¥ÏûàÎã§.\nÍµêÏàòÏôÄ Ìï®Íªò Ï∞çÌûå ÎÇ®Ïûê ‚Äî ÎßàÏà†ÏÇ¨ ÏµúÌòÑÏö∞.\n\nÏÇ¨ÏßÑ Îí∑Î©¥: "Í∑∏ÎèÑ ÏÇ¨ÎùºÏ°åÎã§. Ïö∞Î¶¨Îäî Í∞ôÏùÄ Í≤ÉÏùÑ Î∞úÍ≤¨ÌñàÎã§."'
      }
    ]
  },
  {
    id:'magician', title:'ÎßàÏà†ÏÇ¨Ïùò Ïú†ÏÇ∞', icon:'üé≠', difficulty:2,
    desc:'Ï†ÑÏÑ§Ïùò ÎßàÏà†ÏÇ¨ ÏµúÌòÑÏö∞Í∞Ä Í≥µÏó∞ Ï§ë ÏÇ¨ÎùºÏ°åÎã§. Ïú†Ïñ∏Ïû•ÏóêÎäî "ÎßàÏßÄÎßâ Ìä∏Î¶≠ÏùÑ ÌíÄÏñ¥Îùº"Í≥†Îßå Ï†ÅÌòÄÏûàÎã§.',
    chapters:[
      {
        id:'ch1_magic', title:'Ch.1 ‚Äî ÎßàÏà†ÏÇ¨Ïùò ÎπÑÎ∞Ä Î∞©', desc:'ÏµúÌòÑÏö∞Ïùò Í∞úÏù∏ Ïó∞ÏäµÏã§. Î¨¥ÎåÄÏû•ÏπòÏôÄ Í±∞Ïö∏Î°ú Í∞ÄÎìùÌïú Î∞©.', time:'12Î∂Ñ',
        intro:'ÎßàÏà†ÏÇ¨ ÏµúÌòÑÏö∞. "ÎåÄÌÉàÏ∂ú" Í≥µÏó∞ Ï§ë ÏÇ¨ÎùºÏ°åÎã§.\nÏùºÏ£ºÏùºÏß∏ ÌñâÎ∞©Î∂àÎ™Ö. Í≤ΩÏ∞∞ÏùÄ "ÏûêÏûëÍ∑π"Ïù¥Îùº Í≤∞Î°† ÎÇ¥Î†∏Îã§.\nÌïòÏßÄÎßå ÍµêÏàòÏùò ÏÇ¨ÏßÑÏù¥ Î™®Îì† Í±∏ Î∞îÍø®Îã§.\nÍ∑πÏû• Îí§Ìé∏ ÎπÑÎ∞Ä Î∞©Ïóê Ïû†ÏûÖÌñàÏßÄÎßå, ÎßàÏà† Ïû•ÏπòÍ∞Ä ÏûëÎèôÌïòÎ©∞ Î¨∏Ïù¥ Î¥âÏáÑÎêêÎã§.\nÏò§Î•¥Í≥®Ïù¥ Ïö∏Î¶∞Îã§. ÏµúÌòÑÏö∞Ïùò Î™©ÏÜåÎ¶¨: "ÏßÑÏßú ÌÉêÏ†ïÏù¥ÎùºÎ©¥ Ïù¥Í≤ÉÏùÑ ÌíÄÏñ¥Îùº."',
        puzzles:[
          { type:'interactive', interactionType:'dial', title:'üÉè ÌçºÏ¶ê 1: ÎßàÏà†ÏÇ¨Ïùò Ïπ¥Îìú Ìä∏Î¶≠',
            story:'Î≤®Î≤≥ ÌÖåÏù¥Î∏î ÏúÑ, Îã§Ïù¥Ïñº ÏûêÎ¨ºÏá†Í∞Ä Îã¨Î¶∞ ÏÉÅÏûê.\nÎ©îÎ™®: "Ïπ¥Îìú Ìå®ÌÑ¥Ïùò ÎßàÏßÄÎßâ ÏàòÍ∞Ä Ïó¥Ïá†Îã§."\n‚ô•: +2Ïî©(2,4,6,8,?) ‚ô¶: +2Ïî©(1,3,5,7,?) ‚ô£: +3Ïî©(3,6,9,12,?)',
            config:{ combination:[1,0,9,1,5], labels:['‚ô•?','‚ô¶?','‚ô£?','',''] },
            hint:'‚ô•10, ‚ô¶9, ‚ô£15 ‚Üí Îã§Ïù¥ÏñºÏùÑ 10915Î°ú ÎßûÏ∂îÏÑ∏Ïöî',
            validate:function(i){return i.replace(/\s/g,'') === '10915'} },
          { type:'interactive', interactionType:'piano', title:'üìî ÌçºÏ¶ê 2: Îã§Ïù¥Ïñ¥Î¶¨Ïùò ÏùåÏïÖ ÏïîÌò∏',
            story:'Í∏àÍ≥† Ïïà Îã§Ïù¥Ïñ¥Î¶¨. ÏïÖÎ≥¥Í∞Ä Í∑∏Î†§Ï†∏ ÏûàÎã§.\n"Ïò¨Î∞îÎ•∏ ÏàúÏÑúÎ°ú Ïó∞Ï£ºÌïòÎ©¥ Ïà´ÏûêÍ∞Ä ÎÇòÌÉÄÎÇúÎã§."',
            config:{ keys:['C','D','E','F','G','A','B'], sequence:['G','A','G','E','D'], display:'ÏÜî Îùº ÏÜî ÎØ∏ Î†à' },
            hint:'ÏÜî(G) Îùº(A) ÏÜî(G) ÎØ∏(E) Î†à(D) ÏàúÏÑúÎ°ú Í±¥Î∞òÏùÑ ÎàÑÎ•¥ÏÑ∏Ïöî. Ï†ïÎãµ: 50',
            validate:function(i){return i.trim() === '50'} },
          { type:'interactive', interactionType:'jigsaw', title:'ü™û ÌçºÏ¶ê 3: ÎßàÎ≤ïÏùò Í±∞Ïö∏ LED',
            story:'"ÎßàÏßÄÎßâ Îã®ÏÑúÎäî Í±∞Ïö∏ ÏÜçÏóê."\nLED Ìå®ÌÑ¥ Ï°∞Í∞ÅÏù¥ Ìù©Ïñ¥Ï†∏ ÏûàÎã§. Ïò¨Î∞îÎ•∏ ÏàúÏÑúÎ°ú ÎßûÏ∂îÎ©¥ Ïà´ÏûêÍ∞Ä Î≥¥Ïù∏Îã§.',
            config:{ pieces:['‚óè‚óã‚óè‚óã‚óè','‚óã‚óè‚óã‚óè‚óã','‚óè‚óã‚óã‚óã‚óè','‚óã‚óè‚óã‚óè‚óã','‚óè‚óã‚óè‚óã‚óã'], cols:1, correctOrder:[0,1,2,3,4],
              revealText:'‚óè Ï¥ù Í∞úÏàò: 3+2+2+2+2 = 11' },
            hint:'Í∞Å Ï§ÑÏùò ‚óèÎ•º ÏÑ∏Î©¥ 3,2,2,2,2 ‚Üí Ìï©: 11',
            validate:function(i){return i.trim() === '11'} },
          { type:'interactive', interactionType:'timing', title:'üé© ÌçºÏ¶ê 4: ÎßàÏà† ÎèÑÍµ¨ Î™©Î°ù',
            story:'Í±∞Ïö∏Ïù¥ ÌöåÏ†ÑÌïúÎã§. ÌÉÄÏù¥Î∞çÏóê ÎßûÏ∂∞ Î≤ÑÌäºÏùÑ ÎàåÎü¨Ïïº ÎπÑÎ∞Ä ÏÑúÎûçÏù¥ Ïó¥Î¶∞Îã§.\nÎßàÏà† ÎèÑÍµ¨: Ïã§ÌÅ¨7 + Ïπ¥Îìú12 + ÏßÄÌå°Ïù¥3 + Í±∞Ïö∏5 + ÎèôÏ†Ñ20',
            config:{ zoneStart:0.38, zoneEnd:0.52, required:4, speed:0.011, revealText:'47' },
            hint:'7+12+3+5+20=47. Ï¥àÎ°ù Íµ¨Í∞ÑÏóê ÎßûÏ∂∞ 4Î≤à Ïó∞ÏÜç ÏÑ±Í≥µÌïòÏÑ∏Ïöî.',
            validate:function(i){return i.trim() === '47'} },
          { type:'cpq', cpqIndex:0,
            story:'"ÎåÄÌÉàÏ∂úÏùÄ Í≥µÏó∞Ïù¥ ÏïÑÎãàÏóàÎã§."\nÏµúÌòÑÏö∞Í∞Ä ÎßàÏßÄÎßâÏúºÎ°ú Ìñ•ÌïòÎ†§Îçò Ïû•ÏÜåÏùò Îã®ÏÑú.',
            storyAfter:'ÎèÑÍµ¨Ìï® Ïù¥Ï§ëÎ∞îÎã• ÏïÑÎûò, Î¥âÌà¨ ÌïòÎÇòÍ∞Ä ÎÇòÏôîÎã§.' }
        ],
        cliffhanger:'Î¥âÌà¨ ÏïàÏóêÎäî ÎπõÎ∞îÎûú Ï°∏ÏóÖÏï®Î≤î Ìïú ÌéòÏù¥ÏßÄ.\nÏÑ∏Ï¢ÖÍ≥†Îì±ÌïôÍµê 3ÌïôÎÖÑ 2Î∞ò, 1994ÎÖÑ.\n\nÏÑ∏ Î™ÖÏóêÍ≤å ÎèôÍ∑∏ÎùºÎØ∏Í∞Ä Ï≥êÏ†∏ ÏûàÎã§.\nÍπÄÎèôÌòÑ. ÏµúÌòÑÏö∞. Í∑∏Î¶¨Í≥† ÏÑ∏ Î≤àÏß∏ ÏÇ¨Îûå ‚Äî Ïù¥Î¶ÑÏù¥ ÍπåÎß£Í≤å ÏßÄÏõåÏ†∏ ÏûàÎã§.\n\nÏï®Î≤î Ïó¨Î∞±Ïóê ÏµúÌòÑÏö∞Ïùò Í∏ÄÏî®:\n"Ïö∞Î¶¨ ÏÖãÏùÄ Í∞ôÏùÄ Í±∏ Î¥§Îã§. Í∑∏ÎÇ† Î∞§, ÌïôÍµêÏóêÏÑú."\n\n1994ÎÖÑ ÏÑ∏Ï¢ÖÍ≥†. ÌôîÏû¨Î°ú ÌèêÍµêÎêú Î∞îÎ°ú Í∑∏ ÌïôÍµêÎã§.'
      },
      {
        id:'ch2_school', title:'Ch.2 ‚Äî ÏïºÍ∞Ñ ÌïôÍµê', desc:'30ÎÖÑ Ï†Ñ ÌôîÏû¨Î°ú ÌèêÍµêÎêú ÏÑ∏Ï¢ÖÍ≥†. Í∑∏ÎÇ† Î∞§Ïùò ÏßÑÏã§ÏùÑ ÌååÌó§ÏπúÎã§.', time:'14Î∂Ñ',
        intro:'ÏÑ∏Ï¢ÖÍ≥†Îì±ÌïôÍµê. 30ÎÖÑÍ∞Ñ Î∞©ÏπòÎêú ÌèêÍµê.\nÏ≤†Ï°∞ÎßùÏùÑ ÎÑòÏñ¥ Ï†ïÎ¨∏Ïóê Îì§Ïñ¥ÏÑ∞Îã§. Ïú†Î¶¨Ï∞ΩÏùÄ Íπ®Ï†∏ ÏûàÍ≥†, Î≥µÎèÑÏóê ÎÇôÏÑúÍ∞Ä Í∞ÄÎìùÌïòÎã§.\n3ÌïôÎÖÑ 2Î∞ò ÍµêÏã§. Ïπ†ÌåêÏóê ÎàÑÍµ∞Í∞Ä ÏµúÍ∑ºÏóê Ï†ÅÏñ¥ÎÜìÏùÄ Í∏ÄÏî®.\n"Ïó¨Í∏∞ÏÑú ÏãúÏûëÎêêÎã§."\nÎ¨∏Ïù¥ ÏïàÏóêÏÑú Ïû†Í≤ºÎã§. ÎπÑÏÉÅÎì±Îßå ÍπúÎπ°Ïù¥Îäî ÍµêÏã§. 30ÎÖÑ Ï†ÑÏùò Î©îÏïÑÎ¶¨Í∞Ä Îì§Î¶∞Îã§.',
        puzzles:[
          { type:'interactive', interactionType:'jigsaw', title:'üìö ÌçºÏ¶ê 1: ÏÇ¨Î¨ºÌï®Ïùò Ï°∞Ìï©',
            story:'ÍπÄÎèôÌòÑÏùò ÏÇ¨Î¨ºÌï®. Ï°∞Ìï©ÏùÑ ÏïåÎ†§Ï£ºÎäî Ï°∞Í∞Å Î©îÎ™®Í∞Ä Ï∞¢Ïñ¥Ï†∏ Î∞îÎã•Ïóê Ìù©Ïñ¥Ï†∏ ÏûàÎã§.',
            config:{ pieces:['Î∞òÎ≤àÌò∏(2)√ó2=4','ÏÉùÏùº: 12Ïõî8Ïùº‚Üí20','Ï∞ΩÍ∞ÄÏ§ÑÏàò=5','Ìï©ÏπòÎ©¥‚Üí4205'], cols:2,
              correctOrder:[0,1,2,3], revealText:'ÎπÑÎ∞ÄÎ≤àÌò∏: 4205' },
            hint:'Î©îÎ™® Ï°∞Í∞ÅÏùÑ Ïò¨Î∞îÎ•∏ ÏúÑÏπòÏóê ÎßûÏ∂îÏÑ∏Ïöî. 4, 20, 5 ‚Üí 4205',
            validate:function(i){return i.replace(/\s/g,'') === '4205'} },
          { type:'interactive', interactionType:'timing', title:'üìù ÌçºÏ¶ê 2: ÌïôÏäµ Í≥ÑÌöçÌëú',
            story:'"Ïò§Îäò Î∞§ ÏßÄÌïòÏã§ÏóêÏÑú ÎßåÎÇò." ÏÑúÎûçÏóêÏÑú Î∞úÍ≤¨Ìïú Ï™ΩÏßÄ.\nÏûêÏäµ ÏãúÍ∞ÑÌëú ÏïûÏóê ÌÉÄÏù¥Î®∏ ÏûêÎ¨ºÏá†Í∞Ä Í±∏Î†§ÏûàÎã§.',
            config:{ zoneStart:0.33, zoneEnd:0.47, required:4, speed:0.013, revealText:'20' },
            hint:'Ïõî3+Ìôî5+Ïàò2+Î™©4+Í∏à6=20. ÌÉÄÏù¥Î∞çÏóê ÎßûÏ∂∞ 4Î≤à ÏÑ±Í≥µÌïòÏÑ∏Ïöî.',
            validate:function(i){return i.trim() === '20'} },
          { type:'interactive', interactionType:'dial', title:'üìê ÌçºÏ¶ê 3: Ïπ†ÌåêÏùò ÏàòÌïô Î¨∏Ï†ú',
            story:'"ÏßÑÏßú ÎπÑÎ∞ÄÏùÄ Ïπ†Ìåê Îí§Ïóê ÏûàÎã§."\nÏπ†ÌåêÏóê Îã§Ïù¥Ïñº ÏûêÎ¨ºÏá†. Ï†ïÌåîÍ∞ÅÌòïÏùò ÎÇ¥Í∞ÅÏùò Ìï©ÏùÑ Íµ¨ÌïòÎùº. Í≥µÏãù: (n-2)√ó180¬∞',
            config:{ combination:[1,0,8,0], labels:['Ï≤ú','Î∞±','Ïã≠','Ïùº'] },
            hint:'(8-2)√ó180=1080. Îã§Ïù¥ÏñºÏùÑ 1080ÏúºÎ°ú ÎßûÏ∂îÏÑ∏Ïöî.',
            validate:function(i){return i.trim() === '1080'} },
          { type:'interactive', interactionType:'piano', title:'üì∞ ÌçºÏ¶ê 4: ÎπÑÎ∞Ä ÏûêÎ£åÏã§',
            story:'Ïπ†ÌåêÏù¥ ÏõÄÏßÅÏù∏Îã§. Îí§Ìé∏ ÏûêÎ£åÏã§Ïùò Ïû†Í∏àÏû•Ïπò. ÏùåÍ≥Ñ ÏàúÏÑúÎ•º ÎßûÏ∂∞Ïïº Ïó¥Î¶∞Îã§.\nÏÑ∏Ï¢ÖÍ≥† ÏÇ¨Í±¥ Í∏∞Î°ù: 95ÎÖÑ1Í±¥+03ÎÖÑ2Í±¥+10ÎÖÑ1Í±¥+18ÎÖÑ3Í±¥+23ÎÖÑ3Í±¥',
            config:{ keys:['C','D','E','F','G','A','B'], sequence:['C','D','C','E','E'], display:'ÎèÑ Î†à ÎèÑ ÎØ∏ ÎØ∏ (1,2,1,3,3)' },
            hint:'ÏÇ¨Í±¥ Ïàò Ìå®ÌÑ¥ 1,2,1,3,3ÏùÑ ÏùåÍ≥ÑÎ°ú. Ìï©Í≥Ñ=10',
            validate:function(i){return i.trim() === '10'} },
          { type:'cpq', cpqIndex:0,
            story:'ÏûêÎ£åÏã§ Î≤ΩÏóê Î∂ôÏùÄ ÏßÄÎèÑ. ÌôîÏû¨ ÏõêÏù∏ Ï°∞ÏÇ¨ Î≥¥Í≥†ÏÑú.\n"ÌôîÏû¨Îäî ÏÇ¨Í≥†Í∞Ä ÏïÑÎãàÏóàÎã§." Í≤∞Ï†ïÏ†Å Ïû•ÏÜåÍ∞Ä ÌëúÏãúÎêòÏñ¥ ÏûàÎã§.',
            storyAfter:'Î≥¥Í≥†ÏÑúÏùò ÎßàÏßÄÎßâ ÌéòÏù¥ÏßÄÍ∞Ä ÌéºÏ≥êÏ°åÎã§.' }
        ],
        cliffhanger:'ÌôîÏû¨ Ï°∞ÏÇ¨ Î≥¥Í≥†ÏÑú. Í∏∞Î∞Ä Ïä§ÌÉ¨ÌîÑÍ∞Ä Ï∞çÌòÄÏûàÎã§.\n\n"1994ÎÖÑ 12Ïõî 24Ïùº. ÏÑ∏Ï¢ÖÍ≥† ÏßÄÌïò Î≥¥ÏùºÎü¨Ïã§ÏóêÏÑú Î∞úÌôî."\n"ÌôîÏû¨Îäî ÏÇ¨Í≥†Í∞Ä ÏïÑÎãàÎùº ÏùòÎèÑÏ†Å Î∞©Ìôî."\n"Î™©Ï†Å: ÏßÄÌïòÏã§Ïùò Ï¶ùÍ±∞ Ïù∏Î©∏."\n\nÏ¶ùÍ±∞Í∞Ä Î≠êÏòÄÏùÑÍπå?\n\nÎ≥¥Í≥†ÏÑúÏóê Ï≤®Î∂ÄÎêú ÏÉùÏ°¥Ïûê Î™ÖÎã®. ÏÑ∏ Î≤àÏß∏ Ïù¥Î¶Ñ.\nÏßÅÏóÖÎûÄ: "Í∑∏ÎûÄÎç∞ Ïò§ÌéòÎùº ÌïòÏö∞Ïä§ Îã®Ïõê"\n\nÏ°∏ÏóÖÏï®Î≤îÏóêÏÑú ÏßÄÏõåÏ°åÎçò ÏÑ∏ Î≤àÏß∏ ÏÇ¨Îûå.\nÍ∑∏Í∞Ä Ïò§ÌéòÎùº Í∑πÏû•Ïóê ÏûàÎã§.'
      },
      {
        id:'ch3_opera', title:'Ch.3 ‚Äî Ïò§ÌéòÎùº Í∑πÏû•', desc:'100ÎÖÑ Îêú Í∑πÏû•. Î¨¥ÎåÄ ÏïÑÎûòÏóê Ïà®Í≤®ÏßÑ ÎπÑÎ∞Ä.', time:'15Î∂Ñ',
        intro:'Í∑∏ÎûÄÎç∞ Ïò§ÌéòÎùº ÌïòÏö∞Ïä§. 100ÎÖÑ Ïó≠ÏÇ¨Ïùò Í∑πÏû•.\nÍ≥µÏó∞ÏùÄ ÎÅùÎÇ¨ÏßÄÎßå Ï°∞Î™ÖÏù¥ ÏºúÏ†∏ ÏûàÎã§. Î¨¥ÎåÄ ÏúÑÏóê Ìïú ÏÇ¨ÎûåÏù¥ ÏÑú ÏûàÎã§.\nÎãπÏã†ÏùÑ Í∏∞Îã§Î¶¨Í≥† ÏûàÏóàÎã§Îäî ÎìØÏù¥.\n"Ïûò ÏôîÏñ¥. ÍµêÏàòÎèÑ, ÌòÑÏö∞ÎèÑ Ïó¨Í∏∞ÍπåÏßÄ ÏôîÏóàÏßÄ."\nÍ∑∏Í∞Ä Îí§ÎèåÏïÑÏÑúÎäî ÏàúÍ∞Ñ, Î¨¥ÎåÄÍ∞Ä Í∫ºÏßÄÍ≥† Í∏∞Í≥ÑÏû•ÏπòÍ∞Ä ÏûëÎèôÌïúÎã§.',
        puzzles:[
          { type:'interactive', interactionType:'piano', title:'üéº ÌçºÏ¶ê 1: ÏïÖÎ≥¥Ïùò ÏïåÌååÎ≤≥ ÏïîÌò∏',
            story:'Î∂ÑÏû•Ïã§. ÌôîÏû•ÎåÄ ÏúÑ ÏïÖÎ≥¥Ïóê Îπ®Í∞Ñ ÌéúÏúºÎ°ú ÏùåÌëúÏóê ÎèôÍ∑∏ÎùºÎØ∏. ÏàúÏÑúÎåÄÎ°ú Ïó∞Ï£ºÌïòÎùº.',
            config:{ keys:['C','D','E','F','G','A','B'], sequence:['C','D','E','C','G'], display:'ÎèÑ(C) Î†à(D) ÎØ∏(E) ÎèÑ(C) ÏÜî(G) ‚Üí Ïà´Ïûê: 3,4,5,3,7' },
            hint:'C=3,D=4,E=5,C=3,G=7 ‚Üí 34537',
            validate:function(i){return i.replace(/\s/g,'') === '34537'} },
          { type:'interactive', interactionType:'dial', title:'üìî ÌçºÏ¶ê 2: ÏúÑÌòë Ìé∏ÏßÄÏùò Î°úÎßà Ïà´Ïûê',
            story:'Î∂ÑÏû•ÎåÄ ÏÑúÎûç. ÏúÑÌòë Ìé∏ÏßÄ ÎÑ§ ÌÜµ.\nÌé∏ÏßÄÏùò Ïõî Ïà´ÏûêÎ•º Îã§Ïù¥ÏñºÏóê ÎßûÏ∂∞ Í∏àÍ≥†Î•º Ïó¥Ïñ¥Îùº.',
            config:{ combination:[3,1], labels:['Ïã≠','Ïùº'] },
            hint:'IIIÏõî(3)+VIIÏõî(7)+IXÏõî(9)+XIIÏõî(12)=31',
            validate:function(i){return i.trim() === '31'} },
          { type:'interactive', interactionType:'timing', title:'üéª ÌçºÏ¶ê 3: Ïò§ÏºÄÏä§Ìä∏Îùº Î∞∞Ïπò Ìå®ÌÑ¥',
            story:'ÏßÄÌïò ÏïÖÍ∏∞ Î≥¥Í¥ÄÏÜå. Î¨¥ÎåÄ Ïû•ÏπòÏùò ÌÉÄÏù¥Î∞çÏóê ÎßûÏ∂∞ Î≤ÑÌäºÏùÑ ÎàÑÎ•¥Î©¥ ÎãµÏù¥ ÎìúÎü¨ÎÇúÎã§.\nÌå®ÌÑ¥: 8‚Üí6‚Üí4‚Üí2‚Üí?',
            config:{ zoneStart:0.40, zoneEnd:0.55, required:4, speed:0.015, revealText:'0' },
            hint:'-2Ïî© Í∞êÏÜå: 8,6,4,2,0. ÌÉÄÏù¥Î∞ç 4Î≤à ÏÑ±Í≥µÏãú ÎãµÏù¥ ÎÇòÌÉÄÎÇ®.',
            validate:function(i){return i.trim() === '0'} },
          { type:'interactive', interactionType:'jigsaw', title:'üö™ ÌçºÏ¶ê 4: Î¨¥ÎåÄ Í∏∞Í≥ÑÏã§',
            story:'Í∏∞Í≥ÑÏã§. 100ÎÖÑ Îêú Ïû•ÏπòÎì§ ÏÇ¨Ïù¥Ïóê ÌçºÏ¶ê Ï°∞Í∞ÅÏù¥ Ìù©Ïñ¥Ï†∏ ÏûàÎã§.',
            config:{ pieces:['Í±¥Î¶Ω: 1924ÎÖÑ','ÌòÑÏû¨: 2024ÎÖÑ','Ï∞®Ïù¥ = ?ÎÖÑ','Ï†ïÎãµ: 100'], cols:2,
              correctOrder:[0,1,2,3], revealText:'Í∑πÏû• Ïó∞Ïàò: 100ÎÖÑ' },
            hint:'2024-1924=100',
            validate:function(i){return i.trim() === '100'} },
          { type:'cpq', cpqIndex:0,
            story:'Î¨¥ÎåÄ ÏïÑÎûò ÎπÑÎ∞Ä Í∏∞Î°ùÎ≥¥Í¥ÄÏÜå.\n"Ïú†Î†πÏùò Ï†ïÏ≤¥Î•º ÏïåÏïÑÎÉàÎã§. Ï¶ùÍ±∞Í∞Ä Ïù¥ Ïû•ÏÜåÏóê ÏûàÎã§."',
            storyAfter:'Í∏∞Î°ùÎ≥¥Í¥ÄÏÜåÏùò ÎßàÏßÄÎßâ ÏÑúÎ•òÍ∞Ä ÎìúÎü¨ÎÇ¨Îã§.' }
        ],
        cliffhanger:'Í∏∞Î°ùÎ≥¥Í¥ÄÏÜåÏóêÏÑú ÎÇòÏò® ÏÑúÎ•òÎ≠âÏπò.\n\nÏÑ∏ Î≤àÏß∏ ÎÇ®ÏûêÏùò Í≥†Î∞±.\n"Ïö∞Î¶¨ ÏÖãÏùÄ 1994ÎÖÑ ÌÅ¨Î¶¨Ïä§ÎßàÏä§ Ïù¥Î∏å, ÌïôÍµê ÏßÄÌïòÏã§ÏóêÏÑú Í∑∏Í≤ÉÏùÑ Î¥§Îã§."\n"Ïù∏Ï≤¥ Ïã§Ìóò Í∏∞Î°ù. ÏïÑÏù¥Îì§ÏùÑ ÎåÄÏÉÅÏúºÎ°ú Ìïú."\n"ÌôîÏû¨Îäî Ï¶ùÍ±∞Î•º ÌÉúÏö∞Í∏∞ ÏúÑÌïú Í≤ÉÏù¥ÏóàÎã§."\n\nÎßàÏßÄÎßâ ÌéòÏù¥ÏßÄ.\n"ÏµúÌòÑÏö∞Îäî Ïù¥Í±∏ ÏÑ∏ÏÉÅÏóê ÏïåÎ¶¨Î†§Îã§ ÏÇ¨ÎùºÏ°åÎã§."\n"ÍπÄÎèôÌòÑ ÍµêÏàòÎäî Ï¶ùÍ±∞Î•º Î™®ÏúºÎã§ Í∞êÍ∏àÎãπÌñàÎã§."\n"ÎÇòÎäî... ÎßàÏßÄÎßâ Ìä∏Î¶≠ÏùÑ Ï§ÄÎπÑÌñàÎã§."\n\nÏÑúÎ•ò Îí∑Î©¥Ïóê ÎèÑÏû•.\n"ÏÑ±Î™®ÏùòÎ£åÏû¨Îã®"\n\nÌèêÏáÑÎêú ÏÑ±Î™®Î≥ëÏõê. 304Ìò∏.\nÎ™®Îì† Í≤ÉÏùÄ Í±∞Í∏∞ÏÑú ÏãúÏûëÎêêÎã§.'
      }
    ]
  },
  {
    id:'hospital', title:'304Ìò∏Ïùò Í∏∞Ïñµ', icon:'üè•', difficulty:3,
    desc:'10ÎÖÑ Ï†Ñ ÌèêÏáÑÎêú Î≥ëÏõê. 304Ìò∏ ÌôòÏûêÎì§Ïù¥ Ï†ÑÏõê ÎèôÏãúÏóê ÏÇ¨ÎùºÏßÑ ÏÇ¨Í±¥. ÏßÑÏã§ÏùÑ ÌååÌó§Ï≥êÎùº.',
    chapters:[
      {
        id:'ch1_hospital', title:'Ch.1 ‚Äî ÌèêÎ≥ëÏõê 304Ìò∏', desc:'Î∞§ÎßàÎã§ Î∂àÏù¥ ÏºúÏßÄÎäî ÌèêÎ≥ëÏõê. 10ÎÖÑ Ï†Ñ Í∑∏ÎÇ† Î∞§Ïùò ÏßÑÏã§.', time:'14Î∂Ñ',
        intro:'ÏÑ±Î™®Î≥ëÏõê. 10ÎÖÑ Ï†Ñ ÏùòÎ£åÏÇ¨Í≥†Î°ú ÌèêÏáÑÎêêÎã§.\nÌïòÏßÄÎßå "ÏùòÎ£åÏÇ¨Í≥†"Îäî Í≥µÏãù Î∞úÌëúÏùº ÎøêÏù¥Îã§.\n304Ìò∏ÏóêÏÑú Î∞§ÎßàÎã§ Î∂àÎπõÏù¥ ÏºúÏßÑÎã§Îäî Ï†úÎ≥¥.\nÎãπÏã†Ïù¥ Îì§Ïñ¥ÏÑ† ÏàúÍ∞Ñ, Î≥µÎèÑ ÎÅùÏóêÏÑú Î∞úÏûêÍµ≠ ÏÜåÎ¶¨.\n10ÎÖÑÍ∞Ñ ÏïÑÎ¨¥ÎèÑ Îì§Ïñ¥Ïò§ÏßÄ ÏïäÏïòÏùÑ Ïù¥ Î≥ëÏõêÏóêÏÑú.',
        puzzles:[
          { type:'interactive', interactionType:'connect-dots', title:'üíä ÌçºÏ¶ê 1: ÌôòÏûê Ï∞®Ìä∏Ïùò Î≥µÏö©Îüâ',
            story:'304Ìò∏ Ïπ®ÎåÄ ÏòÜ, ÎÇ°ÏùÄ ÌôòÏûê Ï∞®Ìä∏. Ï†êÎì§ÏùÑ ÏàúÏÑúÎåÄÎ°ú Ïó∞Í≤∞ÌïòÎ©¥ Î≥µÏö©ÎüâÏù¥ ÎÇòÌÉÄÎÇúÎã§.',
            config:{ dots:[
              {x:15, y:20, order:1}, {x:40, y:15, order:2},
              {x:65, y:25, order:3}, {x:85, y:50, order:4},
              {x:60, y:75, order:5}, {x:30, y:80, order:6}
            ], revealText:'ÏïÑÏπ®2+Ï†êÏã¨1+Ï†ÄÎÖÅ3 = 6' },
            hint:'Ï†êÏùÑ 1‚Üí2‚Üí3‚Üí4‚Üí5‚Üí6 ÏàúÏÑúÎ°ú ÌÅ¥Î¶≠. Îãµ: 6',
            validate:function(i){return i.trim() === '6'} },
          { type:'interactive', interactionType:'shake', title:'üìã ÌçºÏ¶ê 2: ÏùòÏÇ¨Ïùò ÏßÑÎ£å Í∏∞Î°ù',
            story:'Ïπ®ÎåÄ ÏïÑÎûò Í∏àÍ≥†. Î®ºÏßÄÍ∞Ä ÎëêÍªçÍ≤å ÏåìÏó¨ÏûàÎã§. ÌùîÎì§Ïñ¥ÏÑú Î®ºÏßÄÎ•º ÌÑ∏Ïñ¥ÎÇ¥Ïïº ÌïúÎã§.',
            config:{ required:25, revealText:'Ï£ºÍ∞Ñ ÏßÑÎ£å: 12+8+15+6+9 = 50' },
            hint:'Í∏∞Í∏∞Î•º ÌùîÎì§Í±∞ÎÇò Ïä§ÌéòÏù¥Ïä§Î∞îÎ•º Ïó∞ÌÉÄ! Îãµ: 50',
            validate:function(i){return i.trim() === '50'} },
          { type:'interactive', interactionType:'flashlight', title:'üî¨ ÌçºÏ¶ê 3: Ï∞ΩÍ∞ÄÏùò ÌôîÌïô Í≥µÏãù',
            story:'Ï†ïÏ†ÑÎêú Ïã§ÌóòÏã§. ÏÜêÏ†ÑÎì±ÏúºÎ°ú Î≤ΩÎ©¥Ïùò ÌôîÌïô Í≥µÏãùÏùÑ Ï∞æÏïÑÏïº ÌïúÎã§.',
            config:{ items:[
              {x:10, y:20, text:'H‚ÇÇO'},
              {x:50, y:40, text:'NaCl'},
              {x:30, y:65, text:'C‚ÇÜH‚ÇÅ‚ÇÇO‚ÇÜ'},
              {x:75, y:30, text:'ÏõêÏÜå Ï≤´Í∏ÄÏûê:'},
              {x:70, y:55, text:'H,O,Na,Cl,C'},
              {x:45, y:85, text:'‚Üí HONCC'},
              {x:88, y:10, text:'Fe‚ÇÇO‚ÇÉ(Ìï®Ï†ï)'},
              {x:15, y:90, text:'KMnO‚ÇÑ(Ìï®Ï†ï)'}
            ]},
            hint:'ÏõêÏÜå Ï≤´ Í∏ÄÏûê: H,O,N,C,C ‚Üí HONCC',
            validate:function(i){return i.toUpperCase().replace(/\s/g,'') === 'HONCC'} },
          { type:'interactive', interactionType:'dial', title:'üóÇÔ∏è ÌçºÏ¶ê 4: Î≥ëÏõê Ï¥ù Ïù∏Ïõê',
            story:'ÎπÑÎ∞Ä ÏÑúÎûçÏùò Îã§Ïù¥Ïñº Ïû†Í∏à. Î≥ëÏõê Ï†ÑÏ≤¥ Ïù∏ÏõêÏàò √ó 10ÏúºÎ°ú Ïó¥Î¶∞Îã§.\nÏûÖÏõê45+Ïô∏Îûò128+ÏùòÎ£åÏßÑ23+Í¥ÄÎ¶¨14',
            config:{ combination:[2,1,0,0], labels:['Ï≤ú','Î∞±','Ïã≠','Ïùº'] },
            hint:'ÏûÖÏõê45+Ïô∏Îûò128+ÏùòÎ£åÏßÑ23+Í¥ÄÎ¶¨14=210. √ó10=2100. Îã§Ïù¥ÏñºÏùÑ 2100ÏúºÎ°ú.',
            validate:function(i){return i.trim() === '2100'} },
          { type:'cpq', cpqIndex:0,
            story:'"304Ìò∏Ïùò ÏßÑÏßú ÎπÑÎ∞Ä. Îçî ÌÅ∞ ÏùåÎ™®Í∞Ä ÏûàÎã§."\nÍπÄ ÏùòÏÇ¨Í∞Ä Î™©Ïà® Í±∏Í≥† Ï∂îÏ†ÅÌïú Ïû•ÏÜå.',
            storyAfter:'Î≥¥Í≥†ÏÑúÏùò ÎßàÏßÄÎßâ Ïû•Ïù¥ Ìï¥ÎèÖÎêêÎã§.' }
        ],
        cliffhanger:'ÍπÄÏòÅÌò∏ ÏùòÏÇ¨Ïùò ÏµúÏ¢Ö Î≥¥Í≥†ÏÑú.\n\n"304Ìò∏ ÌôòÏûê 5Î™Ö. Ï†ÑÏõê Í∞ôÏùÄ Í≥†ÏïÑÏõê Ï∂úÏã†."\n"Íµ¨ÏÑ∏Ï£º Í≥†ÏïÑÏõê. 30ÎÖÑ Ï†Ñ ÌôîÏû¨Î°ú ÌèêÏáÑÎêú Î∞îÎ°ú Í∑∏Í≥≥."\n"ÌôòÏûêÎì§ÏùÄ Ïñ¥Î¶∞ ÏãúÏ†à Ïã§Ìóò ÎåÄÏÉÅÏù¥ÏóàÎã§."\n"Í∑∏Î¶¨Í≥† ÎàÑÍµ∞Í∞Ä Í∑∏Îì§ÏùÑ Îã§Ïãú Î™®ÏïòÎã§."\n\nÎ≥¥Í≥†ÏÑúÏóê Ï≤®Î∂ÄÎêú ÏÇ¨ÏßÑ.\nÍ≥†ÏïÑÏõê Ï†ïÎ¨∏. ÏµúÍ∑ºÏóê Ï∞çÌûå Í≤ÉÏù¥Îã§.\nÏ≤†Ï°∞ÎßùÏù¥ ÏÉàÍ≤ÉÏúºÎ°ú ÍµêÏ≤¥ÎêòÏñ¥ ÏûàÎã§.\n\nÎàÑÍµ∞Í∞Ä Í∑∏Í≥≥ÏùÑ Îã§Ïãú ÏÇ¨Ïö©ÌïòÍ≥† ÏûàÎã§.'
      },
      {
        id:'ch2_orphanage', title:'Ch.2 ‚Äî Î≤ÑÎ†§ÏßÑ Í≥†ÏïÑÏõê', desc:'30ÎÖÑ Ï†Ñ Î∂àÌÉÑ Í≥†ÏïÑÏõê. Î∞§ÎßàÎã§ ÏïÑÏù¥Îì§Ïùò Ïö∏ÏùåÏÜåÎ¶¨Í∞Ä Îì§Î¶∞Îã§.', time:'16Î∂Ñ',
        intro:'Íµ¨ÏÑ∏Ï£º Í≥†ÏïÑÏõê. Ïô∏Î≤ΩÏùÄ Í∑∏ÏùÑÏùåÏúºÎ°ú ÍπåÎß£Îã§.\nÏÉà Ï≤†Ï°∞Îßù. ÏÉà ÏûêÎ¨ºÏá†. ÎàÑÍµ∞Í∞Ä Í¥ÄÎ¶¨ÌïòÍ≥† ÏûàÎã§.\nÏïàÏúºÎ°ú Îì§Ïñ¥ÏÑúÏûê ÏÜåÎèÖÏïΩ ÎÉÑÏÉà. 30ÎÖÑ Ï†Ñ Í±¥Î¨ºÏóêÏÑú?\n2Ï∏µÏóêÏÑú Ìù¨ÎØ∏Ìïú Î∂àÎπõ. Î∞úÏûêÍµ≠ ÏÜåÎ¶¨.\nÏù¥Í≥≥ÏùÄ Î≤ÑÎ†§ÏßÄÏßÄ ÏïäÏïòÎã§.',
        puzzles:[
          { type:'interactive', interactionType:'flashlight', title:'üë∂ ÌçºÏ¶ê 1: Ïû¨ÏõêÏÉù Î™ÖÎã® Î∂ÑÏÑù',
            story:'ÏÇ¨Î¨¥Ïã§Ïù¥ ÍπúÍπúÌïòÎã§. ÏÜêÏ†ÑÎì±ÏúºÎ°ú 30ÎÖÑ Ï†Ñ Ïû¨ÏõêÏÉù Î™ÖÎã®ÏùÑ Ï∞æÏïÑÏïº ÌïúÎã§.',
            config:{ items:[
              {x:15, y:20, text:'Í∞ïÌòúÏßÑ'},
              {x:40, y:35, text:'ÍπÄÎØºÏàò'},
              {x:65, y:50, text:'Î∞ïÏòÅÌù¨'},
              {x:25, y:65, text:'Ïò§ÌÉúÏãù'},
              {x:80, y:25, text:'Ïú§ÏÑúÏó∞'},
              {x:50, y:80, text:'5Î≤àÏß∏=Ïú§'}
            ]},
            hint:'Í∞ÄÎÇòÎã§Ïàú: Í∞ï,ÍπÄ,Î∞ï,Ïò§,Ïú§... Îã§ÏÑØ Î≤àÏß∏ Í∏ÄÏûêÎäî Ïú§',
            validate:function(i){return i.trim() === 'Ïú§'} },
          { type:'interactive', interactionType:'connect-dots', title:'üìñ ÌçºÏ¶ê 2: ÏõêÏû• ÏàòÎÖÄÏùò ÏùºÍ∏∞',
            story:'ÏõêÏû• ÏàòÎÖÄÏùò ÏùºÍ∏∞ÏóêÏÑú Ïô∏Ï∂ú Í∏∞Î°ù Ìå®ÌÑ¥ÏùÑ Ï†êÏúºÎ°ú Ïó∞Í≤∞Ìï¥Ïïº ÌïúÎã§.',
            config:{ dots:[
              {x:10, y:50, order:1}, {x:30, y:30, order:2},
              {x:50, y:50, order:3}, {x:70, y:30, order:4},
              {x:90, y:50, order:5}
            ], revealText:'Í∞ÑÍ≤©: 4Ïùº. 1,5,9,13,17 ‚Üí Îãµ: 17' },
            hint:'4Ïùº Í∞ÑÍ≤©: 1‚Üí5‚Üí9‚Üí13‚Üí17',
            validate:function(i){return i.trim() === '17'} },
          { type:'interactive', interactionType:'shake', title:'üß∏ ÌçºÏ¶ê 3: ÎÜÄÏù¥Î∞©Ïùò Ïù¥ÏßÑÎ≤ï',
            story:'2Ï∏µ ÎÜÄÏù¥Î∞©. Ïπ†ÌåêÏù¥ Î®ºÏßÄÎ°ú ÎçÆÏó¨ÏûàÎã§. ÌùîÎì§Ïñ¥ÏÑú Î®ºÏßÄÎ•º ÌÑ∏Ïñ¥ÎÇ¥Ïïº ÌïúÎã§.',
            config:{ required:35, revealText:'10101001(Ïù¥ÏßÑÎ≤ï) = 128+32+8+1 = 169' },
            hint:'Í∏∞Í∏∞Î•º ÌùîÎì§Í±∞ÎÇò Î≤ÑÌäº Ïó∞ÌÉÄ! Îãµ: 169',
            validate:function(i){return i.trim() === '169'} },
          { type:'interactive', interactionType:'timing', title:'üö™ ÌçºÏ¶ê 4: ÏßÄÌïòÏã§Ïùò Ïó∞Ïàò Í≥ÑÏÇ∞',
            story:'ÏßÄÌïòÏã§ Î¨∏Ïùò ÌÉÄÏù¥Î®∏ Ïû†Í∏àÏû•Ïπò. Ï†ïÌôïÌïú ÌÉÄÏù¥Î∞çÏóê ÎßûÏ∂∞Ïïº Ïó¥Î¶∞Îã§.\nÌôîÏû¨: 1994ÎÖÑ, ÌòÑÏû¨: 2024ÎÖÑ',
            config:{ zoneStart:0.37, zoneEnd:0.48, required:4, speed:0.016, revealText:'30' },
            hint:'2024-1994=30. ÌÉÄÏù¥Î∞ç 4Î≤à ÏÑ±Í≥µÌïòÏÑ∏Ïöî.',
            validate:function(i){return i.trim() === '30'} },
          { type:'cpq', cpqIndex:0,
            story:'ÏßÄÌïòÏã§ Î≤Ω Îí§ Ïà®Í≤®ÏßÑ Î∞©.\n"ÏïÑÏù¥Îì§ÏùÄ Ïó¨Í∏∞ÏÑú Ïã§ÌóòÎãπÌñàÎã§." Ï¶ùÍ±∞Í∞Ä Ïà®Í≤®ÏßÑ ÎßàÏßÄÎßâ Ïû•ÏÜå.',
            storyAfter:'Î≤Ω Îí§ Î∞©ÏóêÏÑú ÏÉÅÏûêÍ∞Ä ÎÇòÏôîÎã§.' }
        ],
        cliffhanger:'ÏÉÅÏûê Ïïà. ÏûÖÏñë ÏÑúÎ•ò ÏàòÏã≠ ÌÜµ.\n\nÏ†ÑÎ∂Ä Í∞ÄÏßúÎã§. ÏûÖÏñëÎêú ÏïÑÏù¥Îì§ÏùÄ Í∞ÄÏ†ïÏóê Í∞Ñ Í≤å ÏïÑÎãàÏóàÎã§.\nÏÑúÎ•òÏùò Ïã§Ï†ú Î™©Ï†ÅÏßÄ:\n"ÏßÄÌïòÏ≤† 7Ìò∏ÏÑ† ‚Äî Íµ∞ÏÇ¨ ÌèêÏó≠ B-7"\n\nÏïÑÏù¥Îì§ÏùÄ Í∑∏Í≥≥ÏúºÎ°ú Î≥¥ÎÇ¥Ï°åÎã§.\nÏÑúÎ•ò Îí∑Î©¥, ÏµúÍ∑º ÎÇ†ÏßúÏùò Î©îÎ™®:\n"Ïã§ÌóòÏùÄ Í≥ÑÏÜçÎêòÍ≥† ÏûàÎã§. ÏÉàÎ°úÏö¥ ÌîºÌóòÏûêÍ∞Ä ÌïÑÏöîÌïòÎã§."\n\n304Ìò∏ ÌôòÏûêÎì§Ïù¥ ÏÇ¨ÎùºÏßÑ Ïù¥Ïú†.\nÍ∑∏Îì§ÏùÄ Îã§Ïãú ÎèåÏïÑÍ∞Ñ Í≤ÉÏù¥Îã§.'
      },
      {
        id:'ch3_subway', title:'Ch.3 ‚Äî ÏßÄÌïòÏ≤† ÌèêÏó≠', desc:'Î¥âÏù∏Îêú Íµ∞ÏÇ¨ ÌèêÏó≠. ÏïÑÏù¥Îì§Ïù¥ Î≥¥ÎÇ¥ÏßÑ Í≥≥.', time:'16Î∂Ñ',
        intro:'7Ìò∏ÏÑ† ÎßàÏßÄÎßâ Ïó¥Ï∞®Í∞Ä Îñ†ÎÇú Îí§.\nÏú†ÏßÄÎ≥¥Ïàò ÌÜµÎ°úÎ•º ÌÜµÌï¥ Î¥âÏù∏Îêú B-7 ÌèêÏó≠ÏúºÎ°ú ÏßÑÏûÖÌñàÎã§.\nÌîåÎû´ÌèºÏùÄ Íπ®ÎÅóÌïòÎã§. ÎÑàÎ¨¥ Íπ®ÎÅóÌïòÎã§. Í¥ÄÎ¶¨ÎêòÍ≥† ÏûàÎã§.\nÌòïÍ¥ëÎì±Ïù¥ ÍπúÎπ°Ïù¥Í≥†, Ïñ¥ÎîòÍ∞ÄÏóêÏÑú Í∏∞Í≥ÑÏùåÏù¥ Îì§Î¶∞Îã§.\nÏù¥Í≥≥ÏùÄ Ïó≠Ïù¥ ÏïÑÎãàÎã§. ÏúÑÏû•Îêú ÏãúÏÑ§Ïù¥Îã§.',
        puzzles:[
          { type:'interactive', interactionType:'timing', title:'üó∫Ô∏è ÌçºÏ¶ê 1: ÎÖ∏ÏÑ†ÎèÑÏùò ÌôòÏäπÏó≠',
            story:'Î≤ΩÎ©¥ ÎÖ∏ÏÑ†ÎèÑ ÏïûÏóê ÌÉÄÏù¥Î∞ç Ïû†Í∏àÏû•Ïπò. ÌôòÏäπÏó≠ Í∞úÏàòÍ∞Ä ÎãµÏù¥Îã§.\nÌôçÎåÄÏûÖÍµ¨(ÌôòÏäπ), Ïã†Ï¥å(X), Ïù¥ÎåÄ(X), Ï∂©Ï†ïÎ°ú(ÌôòÏäπ)',
            config:{ zoneStart:0.33, zoneEnd:0.45, required:4, speed:0.018, revealText:'2' },
            hint:'ÌôòÏäπÏó≠: ÌôçÎåÄÏûÖÍµ¨, Ï∂©Ï†ïÎ°ú = 2Í∞ú. ÌÉÄÏù¥Î∞ç 4Î≤à!',
            validate:function(i){return i.trim() === '2'} },
          { type:'interactive', interactionType:'shake', title:'üìã ÌçºÏ¶ê 2: Ïã§Ï¢ÖÏûê Í∏∞Î°ù',
            story:'Í¥ÄÏ†úÏã§ ÏÑúÎûçÏù¥ Ïû†Í≤®ÏûàÎã§. ÌûòÏúºÎ°ú ÌùîÎì§Ïñ¥ Ïó¥Ïñ¥Ïïº ÌïúÎã§.',
            config:{ required:30, revealText:'Ïã§Ï¢ÖÏûê: 2+3+5+2 = 12Î™Ö' },
            hint:'AÎèô2+BÎèô3+CÎèô5+DÎèô2=12. ÌùîÎì§Ïñ¥ÏÑú ÏÑúÎûçÏùÑ Ïó¥Ïñ¥Îùº!',
            validate:function(i){return i.trim() === '12'} },
          { type:'interactive', interactionType:'piano', title:'‚è∞ ÌçºÏ¶ê 3: Ïö¥Ìñâ ÏãúÍ∞Ñ Í≥ÑÏÇ∞',
            story:'Ïö¥Ï†ÑÏÑù ÏΩòÏÜîÏùò ÏùåÏÑ± Ïù∏Ï¶ù. Ïò¨Î∞îÎ•∏ ÏùåÍ≥ÑÎ•º ÏûÖÎ†•Ìï¥Ïïº ÏãúÍ∞ÑÌëúÍ∞Ä ÎÇòÏò®Îã§.\n23:45‚Üí01:15 = 15+75 = 90Î∂Ñ',
            config:{ keys:['C','D','E','F','G','A','B'], sequence:['G','A','B','A','G'], display:'ÏÜî Îùº Ïãú Îùº ÏÜî (ÏãúÏä§ÌÖú Ïù∏Ï¶ù ÏΩîÎìú)' },
            hint:'ÏùåÍ≥ÑÎ•º ÎßûÏ∂îÎ©¥ ÎãµÏù¥ ÎÇòÌÉÄÎÇ®. 23:45‚Üí01:15 = 90Î∂Ñ',
            validate:function(i){return i.trim() === '90'} },
          { type:'interactive', interactionType:'connect-dots', title:'üö™ ÌçºÏ¶ê 4: Ï¶ùÏñ∏ Î∂ÑÏÑù',
            story:'ÎÖπÏùåÍ∏∞Ïùò Ï¶ùÏñ∏ Í¥ÄÍ≥ÑÎèÑ. Ï†êÏùÑ Ïó∞Í≤∞ÌïòÎ©¥ ÏßÑÏã§Ïù¥ Î≥¥Ïù∏Îã§.',
            config:{ dots:[
              {x:20, y:30, order:1}, {x:50, y:15, order:2},
              {x:80, y:30, order:3}, {x:50, y:60, order:4},
              {x:50, y:85, order:5}
            ], revealText:'A(Ï∞∏),C(Ï∞∏),D(Ï∞∏) = ÏßÑÏã§ 3Î™Ö' },
            hint:'BÍ∞Ä Í±∞ÏßìÏù¥Î©¥ A,C,DÍ∞Ä ÏßÑÏã§ = 3Î™Ö',
            validate:function(i){return i.trim() === '3'} },
          { type:'cpq', cpqIndex:0,
            story:'ÏãúÏÑ§ ÏµúÏã¨Î∂Ä. Ïã§ÌóòÏã§ Î¨∏ Ïïû.\nÎßàÏßÄÎßâ Ïù∏Ï¶ùÏù¥ ÌïÑÏöîÌïòÎã§. Í≤∞Ï†ïÏ†Å Ïû•ÏÜåÏùò Í±∞Î¶¨Î•º ÌôïÏù∏ÌïòÎùº.',
            storyAfter:'Ïã§ÌóòÏã§ Î¨∏Ïù¥ Ïó¥Î†∏Îã§.' }
        ],
        cliffhanger:'Ïã§ÌóòÏã§.\n\nÎ≤ΩÎ©¥ Í∞ÄÎìù ÏÇ¨ÏßÑÍ≥º ÏÑúÎ•ò. 30ÎÖÑÍ∞ÑÏùò Í∏∞Î°ù.\nÏïÑÏù¥Îì§Ïùò ÏÑ±Ïû• ÏÇ¨ÏßÑ. Í∞ôÏùÄ ÏïÑÏù¥Îì§Ïù¥ Ïñ¥Î•∏Ïù¥ ÎêòÏñ¥Í∞ÄÎäî Í≥ºÏ†ï.\n304Ìò∏ ÌôòÏûêÎì§Ïù¥Îã§.\n\nÍ∑∏Î¶¨Í≥† ÏÑúÎ•ò Îß® ÏúÑ, Ïû¨Îã® Î°úÍ≥†.\n"Íµ≠Î¶Ω Í≥†Í≥†Ìïô Î∞ïÎ¨ºÍ¥Ä ÏÇ∞Ìïò ÌäπÏàòÏó∞Íµ¨Ïû¨Îã®"\n\nÎ∞ïÎ¨ºÍ¥Ä.\nÍπÄÎèôÌòÑ ÍµêÏàòÍ∞Ä ÏÜåÏÜçÎêú Î∞îÎ°ú Í∑∏ Î∞ïÎ¨ºÍ¥Ä.\n\nÍµêÏàòÎäî Ïù¥ ÏÇ¨Ïã§ÏùÑ ÏïåÍ≥† ÏûàÏóàÎã§.\nÏïÑÎãà, ÍµêÏàòÎäî Ïù¥ Ïû¨Îã®Ïùò ÏùºÏõêÏù¥ÏóàÎã§.\n\nÎ≤ΩÏóê Î∂ôÏùÄ Ï°∞ÏßÅÎèÑ. ÏµúÏÉÅÏúÑÏóê Ï†ÅÌûå Ïù¥Î¶Ñ.\n"Ïû¨Îã® Ïù¥ÏÇ¨Ïû•: ‚ñ°‚ñ°‚ñ°"\nÏù¥Î¶ÑÏù¥ Í≤ÄÍ≤å Ïπ†Ìï¥Ï†∏ ÏûàÎã§.\n\nÌïòÏßÄÎßå ÏïÑÎûò Î©îÎ™®Í∞Ä ÏûàÎã§.\n"ÏßÄÌïò Ï†ÑÏãúÏã§ BÍ¥Ä. Î™®Îì† ÎãµÏù¥ Í±∞Í∏∞ ÏûàÎã§."'
      },
      {
        id:'ch4_museum', title:'Ch.4 ‚Äî Î∞ïÎ¨ºÍ¥ÄÏùò ÏßÄÌïò', desc:'Íµ≠Î¶Ω Î∞ïÎ¨ºÍ¥Ä Ï†ÑÏãúÍ¥Ä ÏïÑÎûò Ïà®Í≤®ÏßÑ Ïó∞Íµ¨ÏÜå. 10ÎÖÑ Ï†Ñ ÏÇ¨Í±¥Ïùò Ï†ÑÎ™®.', time:'15Î∂Ñ',
        intro:'Íµ≠Î¶Ω Í≥†Í≥†Ìïô Î∞ïÎ¨ºÍ¥Ä. ÌèêÍ¥Ä ÌõÑ ÏïºÍ∞Ñ.\nÏßÄÌïò BÍ¥Ä ÏûÖÍµ¨. ÏùºÎ∞òÏù∏ Ï∂úÏûÖ Í∏àÏßÄ Íµ¨Ïó≠.\nÏπ¥ÎìúÌÇ§Í∞Ä ÏûëÎèôÌïúÎã§. ÍµêÏàòÏùò Í≤ÉÏù¥ÎãàÍπå.\nÏóòÎ¶¨Î≤†Ïù¥ÌÑ∞Í∞Ä ÏßÄÌïò 3Ï∏µÍπåÏßÄ ÎÇ¥Î†§Í∞ÑÎã§.\nÎ¨∏Ïù¥ Ïó¥Î¶¨Ïûê ÏÑúÎäòÌïú Í≥µÍ∏∞ÏôÄ Ìï®Íªò Í∏∞Í≥ÑÏùå.\nÏó¨Í∏∞Îäî Î∞ïÎ¨ºÍ¥ÄÏù¥ ÏïÑÎãàÎã§.',
        puzzles:[
          { type:'interactive', interactionType:'connect-dots', title:'üè∫ ÌçºÏ¶ê 1: Ïú†Î¨º Ïó∞ÎèÑ ÏïîÌò∏',
            story:'Ï†ÑÏãú Íµ¨Ïó≠ÏùÑ ÏúÑÏû•Ìïú ÌÜµÎ°ú. Ïú†Î¨º 4Ï†êÏùò Ïó∞ÎèÑÎ•º ÏàúÏÑúÎåÄÎ°ú Ïó∞Í≤∞ÌïòÎùº.',
            config:{ dots:[
              {x:15, y:30, order:1}, {x:40, y:60, order:2},
              {x:65, y:25, order:3}, {x:88, y:55, order:4}
            ], revealText:'ÎßàÏßÄÎßâ ÏûêÎ¶¨: 3,0,6,9 ‚Üí 3069' },
            hint:'BC1323‚Üí3, BC1550‚Üí0, BC196‚Üí6, BC69‚Üí9',
            validate:function(i){return i.replace(/\s/g,'') === '3069'} },
          { type:'interactive', interactionType:'dial', title:'üìì ÌçºÏ¶ê 2: ÏàúÏ∞∞ Í∏∞Î°ù Ìå®ÌÑ¥',
            story:'Í≤ΩÎπÑÏõê ÏàúÏ∞∞ ÏùºÏßÄÏùò Îã§Ïù¥Ïñº Ïû†Í∏à.\nÏù¥ÎèôÍ∞êÏßÄ: 3,5,7,9,? (+2Ïî©)',
            config:{ combination:[1,1], labels:['Ïã≠','Ïùº'] },
            hint:'3‚Üí5‚Üí7‚Üí9‚Üí11. Îã§Ïù¥ÏñºÏùÑ 11Î°ú.',
            validate:function(i){return i.trim() === '11'} },
          { type:'interactive', interactionType:'flashlight', title:'üèõÔ∏è ÌçºÏ¶ê 3: ÏùåÏïÖ ÏïîÌò∏',
            story:'Í∑∏Î¶¨Ïä§Í¥ÄÏù¥ Ï†ïÏ†ÑÎêêÎã§. ÏïÑÌè¥Î°ú Ï°∞Í∞ÅÏÉÅ ÎåÄÏ¢åÏùò ÏùåÌëúÎ•º Ï∞æÏïÑÎùº.',
            config:{ items:[
              {x:20, y:30, text:'ÏÜî=5'},
              {x:55, y:50, text:'ÎèÑ=1'},
              {x:35, y:75, text:'Î†à=2'},
              {x:80, y:35, text:'ÎØ∏=3'},
              {x:60, y:80, text:'‚Üí5123'}
            ]},
            hint:'ÏÜîÎèÑÎ†àÎØ∏ = 5123',
            validate:function(i){return i.replace(/\s/g,'') === '5123'} },
          { type:'interactive', interactionType:'shake', title:'üö™ ÌçºÏ¶ê 4: Ìô©Ï†úÏùò Ïû¨ÏúÑ Í∏∞Í∞Ñ',
            story:'Î°úÎßàÍ¥Ä Ìï¥ÏãúÍ≥ÑÍ∞Ä Î®ºÏßÄÎ°ú ÎçÆÏó¨ÏûàÎã§. ÌùîÎì§Ïñ¥ÏÑú Îã¶ÏïÑÎÇ¥Ïïº ÌïúÎã§.\nÏïÑÏö∞Íµ¨Ïä§Ìà¨Ïä§45, Ìä∏ÎùºÏïºÎàÑÏä§19, ÌïòÎìúÎ¶¨ÏïÑÎàÑÏä§21, ÎßàÎ•¥Ïø†Ïä§19',
            config:{ required:30, revealText:'ÏµúÎåÄ Ïû¨ÏúÑ: ÏïÑÏö∞Íµ¨Ïä§Ìà¨Ïä§ 45ÎÖÑ' },
            hint:'45,19,21,19 Ï§ë ÏµúÎåÄÍ∞íÏùÄ 45',
            validate:function(i){return i.trim() === '45'} },
          { type:'cpq', cpqIndex:0,
            story:'ÏµúÏã¨Î∂Ä ÎπÑÎ∞Ä ÏàòÏû•Í≥†.\n"Î™®Îì† Ï¶ùÍ±∞Í∞Ä Ïó¨Í∏∞ ÏûàÎã§." ÎßàÏßÄÎßâ Ïû•ÏÜåÏùò Í±∞Î¶¨Î•º ÌôïÏù∏ÌïòÎùº.',
            storyAfter:'ÏàòÏû•Í≥†Ïùò ÏµúÏ¢Ö Î¨∏ÏÑúÍ∞Ä ÎìúÎü¨ÎÇ¨Îã§.' }
        ],
        cliffhanger:'ÏàòÏû•Í≥† Ï§ëÏïô. ÎåÄÌòï Ïä§ÌÅ¨Î¶∞.\n\nÏû¨ÏÉù Î≤ÑÌäºÏùÑ ÎàÑÎ•¥Ïûê ÏòÅÏÉÅÏù¥ ÌùòÎü¨ÎÇòÏò®Îã§.\nÏû¨Îã® Ïù¥ÏÇ¨Ïû•Ïùò ÏñºÍµ¥.\n\n"304Ìò∏ ÌôòÏûêÎì§ÏùÄ ÏÇ¨ÎùºÏßÑ Í≤å ÏïÑÎãôÎãàÎã§."\n"Í∑∏Îì§ÏùÄ ÏÑ±Í≥µÌïú Í≤ÅÎãàÎã§."\n"30ÎÖÑÍ∞ÑÏùò Ïã§ÌóòÏù¥ ÎìúÎîîÏñ¥ Í≤∞Ïã§ÏùÑ Îß∫ÏóàÏäµÎãàÎã§."\n"Ïù¥Ï†ú 2Îã®Í≥ÑÎ•º ÏãúÏûëÌï©ÎãàÎã§."\n\nÏòÅÏÉÅÏù¥ ÎÅäÍ∏¥Îã§.\n\nÏä§ÌÅ¨Î¶∞ ÏïÑÎûò ÏÑúÎ•ò. 2Îã®Í≥Ñ Í≥ÑÌöçÏÑú.\nÎ™©Ìëú: "Ïã¨Ìï¥ Ïó∞Íµ¨ÏÜå Í∞ÄÎèô"\nÏúÑÏπò: "Î∂ÅÌÉúÌèâÏñë Ìï¥Ï†Ä 1000m"\n\nÍµêÏàòÎäî Ïù¥Í±∏ ÎßâÏúºÎ†§Îã§ Í∞êÍ∏àÎãπÌïú Í≤ÉÏù¥Îã§.\nÏµúÌòÑÏö∞Îäî Ïù¥Í±∏ ÏïåÎ¶¨Î†§Îã§ ÏÇ¨ÎùºÏßÑ Í≤ÉÏù¥Îã§.\n\nÏÑúÎ•ò ÎßàÏßÄÎßâ Ï§Ñ.\n"Ïπ¥Ïö¥Ìä∏Îã§Ïö¥ ÏãúÏûë. ÏãúÍ≥ÑÌÉëÏóêÏÑú Ïã†Ìò∏Î•º Î≥¥ÎÇ¥Îùº."\n\nÎèÑÏãú Ï§ëÏã¨Ïùò ÏãúÍ≥ÑÌÉë.\n3Ïãú 33Î∂ÑÏóê Î©àÏ∂ò ÏãúÍ≥Ñ.\n\nÏπ¥Ïö¥Ìä∏Îã§Ïö¥ÏùÄ Ïù¥ÎØ∏ ÏãúÏûëÎêêÎã§.'
      }
    ]
  },
  {
    id:'deep', title:'Ïã¨Ìï¥Ïùò ÎπÑÎ∞Ä', icon:'üî±', difficulty:3,
    desc:'Î™®Îì† ÏÇ¨Í±¥Ïùò Î∞∞ÌõÑ. ÏãúÍ≥ÑÌÉëÏóêÏÑú ÏãúÏûëÎêú Ïπ¥Ïö¥Ìä∏Îã§Ïö¥. ÎÅùÎÇ¥ÏßÄ ÏïäÏúºÎ©¥ ÎÅùÎÇòÏßÄ ÏïäÎäîÎã§.',
    chapters:[
      {
        id:'ch1_clock', title:'Ch.1 ‚Äî ÏãúÍ≥ÑÌÉë', desc:'ÎèÑÏãú Ï§ëÏã¨Ïùò ÏãúÍ≥ÑÌÉë. Í∞ëÏûêÍ∏∞ Î©àÏ∂ò ÏãúÍ≥ÑÏôÄ Ìï®Íªò ÏãúÏûëÎêòÎäî Ïπ¥Ïö¥Ìä∏Îã§Ïö¥.', time:'14Î∂Ñ',
        intro:'Í≥†Îîï ÏãúÍ≥ÑÌÉë. 50ÎÖÑÍ∞Ñ Ìïú Î≤àÎèÑ Î©àÏ∂îÏßÄ ÏïäÏïòÎã§.\nÏßÄÍ∏àÏùÄ 3Ïãú 33Î∂ÑÏóê Î©àÏ∂∞ ÏûàÎã§.\nÏ¢ÖÏßÄÍ∏∞ Î∞ïÏãúÍ≥ÑÍ∞Ä ÏÇ¨ÎùºÏ°åÎã§.\nÌÉë Íº≠ÎåÄÍ∏∞Ïóê Ïò¨ÎùºÏÑúÏûê Í≥ÑÎã®Ïù¥ Î¨¥ÎÑàÏ°åÎã§.\nÍ∏∞Ïñ¥ ÎèåÏïÑÍ∞ÄÎäî ÏÜåÎ¶¨ ÏÇ¨Ïù¥Î°ú Îπ®Í∞Ñ LED Ïà´ÏûêÍ∞Ä ÍπúÎπ°Ïù∏Îã§.\nÏπ¥Ïö¥Ìä∏Îã§Ïö¥. 72:00:00.',
        puzzles:[
          { type:'interactive', interactionType:'timing', title:'‚è∞ ÌçºÏ¶ê 1: ÏãúÍ≥ÑÎ∞îÎäò Í∞ÅÎèÑ',
            story:'Í±∞ÎåÄÌïú ÏãúÍ≥Ñ Í∏∞Í≥ÑÏû•Ïπò. 3Ïãú 33Î∂ÑÏóê Î©àÏ∂∞ÏûàÎã§.\nÌÉÄÏù¥Î∞çÏóê ÎßûÏ∂∞ Í∏∞Ïñ¥Î•º ÎßûÏ∂îÎ©¥ Í∞ÅÎèÑÍ∞Ä Í≥ÑÏÇ∞ÎêúÎã§.\nÎ∂ÑÏπ®198¬∞-ÏãúÏπ®106.5¬∞=91.5¬∞',
            config:{ zoneStart:0.40, zoneEnd:0.50, required:5, speed:0.018, revealText:'91.5' },
            hint:'|198-106.5|=91.5. ÌÉÄÏù¥Î∞ç 5Î≤à ÏÑ±Í≥µ!',
            validate:function(i){return i.trim()==='91.5'||i.trim()==='91'} },
          { type:'interactive', interactionType:'mirror', title:'üìí ÌçºÏ¶ê 2: ÏãúÍ≥Ñ Ïò§Ï∞® Ìå®ÌÑ¥',
            story:'ÏûëÏóÖ ÏùºÏßÄÍ∞Ä Í±∞Ïö∏Ïóê Î∞òÏÇ¨ÎêòÏñ¥ Î≥¥Ïù∏Îã§. Ï¢åÏö∞+ÏÉÅÌïò Î™®Îëê Îí§ÏßëÌòîÎã§.\nÏò§Ï∞®: 2‚Üí4‚Üí8‚Üí16‚Üí?‚Üí?',
            config:{ text:'3 2 6 4', direction:'both' },
            hint:'Îß§Ïùº 2Î∞∞: 16‚Üí32‚Üí64. Í±∞Ïö∏Ïóê Ï¢åÏö∞+ÏÉÅÌïò Î∞òÏ†ÑÎêú Ïà´ÏûêÎ•º Ìï¥ÎèÖÌïòÎ©¥ 3264',
            validate:function(i){return i.replace(/\s/g,'') === '3264'} },
          { type:'interactive', interactionType:'piano', title:'üîî ÌçºÏ¶ê 3: Ï¢ÖÏùò ÏßÑÎèô Ï£ºÌååÏàò',
            story:'Ï¢ÖÎ£®Ïùò ÏùåÏÑ± Ïû†Í∏à. Ïò¨Î∞îÎ•∏ ÏùåÍ≥ÑÎ°ú Ï¢ÖÏùÑ Ïö∏Î†§Ïïº ÌïúÎã§.\nf = 1500 √∑ 4 = 375',
            config:{ keys:['C','D','E','F','G','A','B'], sequence:['E','G','A','B','A','G','E'], display:'ÎØ∏ ÏÜî Îùº Ïãú Îùº ÏÜî ÎØ∏ (Í≥µÎ™Ö Ï£ºÌååÏàò ÏΩîÎìú ‚Äî 7Ïùå)' },
            hint:'1500√∑4=375. 7Í∞ú ÏùåÍ≥ÑÎ•º Ï†ïÌôïÌïú ÏàúÏÑúÎ°ú Ïó∞Ï£ºÌïòÏÑ∏Ïöî.',
            validate:function(i){return i.trim() === '375'} },
          { type:'interactive', interactionType:'connect-dots', title:'üö™ ÌçºÏ¶ê 4: ÏãúÍ≥ÑÌÉë Ïó∞Ïàò',
            story:'Í∏∞Í≥Ñ ÎÇ¥Î∂ÄÏóê Ïà®Í≤®ÏßÑ Ï†êÎì§. Ïó∞Í≤∞ÌïòÎ©¥ Í±¥ÏÑ§ Ïó∞ÎèÑÍ∞Ä ÎìúÎü¨ÎÇúÎã§.',
            config:{ dots:[
              {x:15, y:25, order:1}, {x:35, y:55, order:2},
              {x:55, y:25, order:3}, {x:75, y:55, order:4},
              {x:90, y:25, order:5}
            ], revealText:'2024-1974 = 50ÎÖÑ' },
            hint:'Í±¥ÏÑ§1974, ÌòÑÏû¨2024. Îãµ: 50',
            validate:function(i){return i.trim() === '50'} },
          { type:'cpq', cpqIndex:0,
            story:'ÏãúÍ≥Ñ ÎÇ¥Î∂Ä Ïà®Í≤®ÏßÑ Î∞©. Ï¢åÌëúÍ∞Ä ÏÉàÍ≤®ÏßÑ Í∏àÏÜçÌåê.\n"Ïù¥ Ï¢åÌëúÍ∞Ä Í∞ÄÎ¶¨ÌÇ§Îäî Í≥≥." ÎßàÏßÄÎßâ Ïû•ÏÜåÏùò Í±∞Î¶¨Î•º ÌôïÏù∏ÌïòÎùº.',
            storyAfter:'Í∏àÏÜçÌåê Îí∑Î©¥Ïùò Î©îÏãúÏßÄÍ∞Ä Ìï¥ÎèÖÎêêÎã§.' }
        ],
        cliffhanger:'Í∏àÏÜçÌåê Îí∑Î©¥.\nÌï¥Ï†Ä Ï¢åÌëú: N 35¬∞12\'48" E 129¬∞45\'36"\n\nÍ∑∏Î¶¨Í≥† Ìïú Ï§ÑÏùò Î©îÏãúÏßÄ.\n"Î™®Îì† ÎãµÏùÄ Î∞îÎã§ ÏïÑÎûòÏóê ÏûàÎã§."\n\nÏπ¥Ïö¥Ìä∏Îã§Ïö¥Ïù¥ Î©àÏ∑ÑÎã§.\nÏãúÍ≥ÑÍ∞Ä Îã§Ïãú ÏõÄÏßÅÏù¥Í∏∞ ÏãúÏûëÌïúÎã§.\n\nÌïòÏßÄÎßå Î∞©Ìñ•Ïù¥ Î∞òÎåÄÎã§.\nÏãúÍ≥ÑÍ∞Ä Í±∞Íæ∏Î°ú Í∞ÄÍ≥† ÏûàÎã§.\n\nÏ¢ÖÏßÄÍ∏∞Ïùò ÎßàÏßÄÎßâ Î©îÎ™®.\n"Ïù¥ ÏÇ¨Í±¥ÏùÑ 20ÎÖÑÍ∞Ñ Ï∂îÏ†ÅÌï¥Ïò® ÏÇ¨ÎûåÏù¥ ÏûàÎã§."\n"ÌÉêÏ†ï Ïû•ÌòúÎ¶∞. Í∑∏ÎÖÄÏùò ÏÇ¨Î¨¥ÏÜåÏóê Î™®Îì† Ïó∞Í≤∞Í≥†Î¶¨Í∞Ä ÏûàÎã§."'
      },
      {
        id:'ch2_detective', title:'Ch.2 ‚Äî ÌÉêÏ†ï ÏÇ¨Î¨¥ÏÜå', desc:'20ÎÖÑÍ∞Ñ Ïù¥ ÏÇ¨Í±¥ÏùÑ Ï∂îÏ†ÅÌï¥Ïò® ÌÉêÏ†ï. Î™®Îì† Ïó∞Í≤∞Í≥†Î¶¨Î•º Ï†ïÎ¶¨ÌïúÎã§.', time:'13Î∂Ñ',
        intro:'ÏÇ¨Î¶ΩÌÉêÏ†ï Ïû•ÌòúÎ¶∞. 20ÎÖÑ Í≤ΩÎ†•.\n"Í≤∞Ï†ïÏ†Å Îã®ÏÑúÎ•º Ï∞æÏïòÎã§"Îäî Ï†ÑÌôîÎ•º ÎßàÏßÄÎßâÏúºÎ°ú 3ÏùºÏß∏ Ïó∞ÎùΩ ÎëêÏ†à.\nÏÇ¨Î¨¥ÏÜåÏóê Îì§Ïñ¥ÏÑúÏûê ÏùåÏÑ±Ïù¥ ÌùòÎü¨ÎÇòÏò®Îã§.\n"Ïó¨Í∏∞ÍπåÏßÄ ÏôîÎã§Î©¥, ÎãπÏã†ÎèÑ ÏßÑÏã§Ïóê Í∞ÄÍπåÏõåÏßÑ Í±∞Ïïº."\n"ÎÇ¥Í∞Ä Ï†ïÎ¶¨Ìïú Í±∏ Î¥ê. Î™®Îì† Í±¥ Ïó∞Í≤∞ÎêòÏñ¥ ÏûàÏñ¥."',
        puzzles:[
          { type:'interactive', interactionType:'jigsaw', title:'üîç ÌçºÏ¶ê 1: ÏïåÎ¶¨Î∞îÏù¥ Î∂ÑÏÑù',
            story:'ÏÇ¨Í±¥ ÏàòÏ≤©Ïùò ÏïåÎ¶¨Î∞îÏù¥ Ï°∞Í∞ÅÏù¥ Ï∞¢Ïñ¥Ï†∏ ÏûàÎã§. ÎßûÏ∂îÎ©¥ Î≤îÏù∏Ïù¥ ÎìúÎü¨ÎÇúÎã§.',
            config:{ pieces:['ÍπÄÎåÄÌëú: Ïßë','Î∞ïÏ∞®Ïû•: ÏòÅÌôî','ÏµúÎ∂ÄÏû•: Ïù¥ÎèôÏ§ë','Ïù¥ÎπÑÏÑú: ÏÇ¨Ïö∞ÎÇò'], cols:2,
              correctOrder:[0,1,2,3], revealText:'Ïù¥Îèô Ï§ëÏù∏ ÏµúÎ∂ÄÏû•Îßå ÏûêÏú†ÏãúÍ∞Ñ ‚Üí Îãµ: Ïµú' },
            hint:'9Ïãú~9Ïãú30Î∂Ñ ÏûêÏú†ÏãúÍ∞Ñ ÏûàÎäî ÏÇ¨Îûå = Ïµú',
            validate:function(i){return i.trim() === 'Ïµú'} },
          { type:'interactive', interactionType:'color-code', title:'üïµÔ∏è ÌçºÏ¶ê 2: Ïù¥Îèô ÏãúÍ∞Ñ Í≥ÑÏÇ∞',
            story:'Ï∂îÏ†Å Í∏∞Î°ùÏùò ÏÉâÏÉÅ ÏΩîÎìú ÏßÄÎèÑ.',
            config:{ colors:[
              {color:'#ff4444', name:'Îπ®Í∞ï (ÌöåÏÇ¨‚ÜíÏπ¥Ìéò)', value:'15'},
              {color:'#4488ff', name:'ÌååÎûë (Ïπ¥Ìéò‚ÜíÏùÄÌñâ)', value:'25'},
              {color:'#44ff88', name:'Ï¥àÎ°ù (ÏùÄÌñâ‚ÜíÏßë)', value:'20'}
            ], clueText:'Í∞Å ÏÉâÏÉÅ = Ïù¥Îèô ÏãúÍ∞Ñ(Î∂Ñ)<br>Îπ®Í∞ï15 + ÌååÎûë25 + Ï¥àÎ°ù20 = ?'},
            hint:'15+25+20=60',
            validate:function(i){return i.trim() === '60'} },
          { type:'interactive', interactionType:'shake', title:'üí∞ ÌçºÏ¶ê 3: Ïû¨Îã® ÏûêÍ∏à Ï∂îÏ†Å',
            story:'Ïû•ÌòúÎ¶∞Ïùò Í∏àÍ≥†Í∞Ä ÎÖπÏä¨Ïñ¥ ÏûàÎã§. ÌûòÏúºÎ°ú ÌùîÎì§Ïñ¥ Ïó¥Ïñ¥Ïïº ÌïúÎã§.\nÏïÑÎì§1/2+Îî∏1/3+ÏÜêÏûê1/6=1. ÏûêÏÑ†Îã®Ï≤¥=0',
            config:{ required:35, revealText:'3/6+2/6+1/6=6/6 ‚Üí ÏûêÏÑ†Îã®Ï≤¥: 0' },
            hint:'Ï†ÑÎ∂Ä Î∂ÑÎ∞∞Îê®. ÏûêÏÑ†Îã®Ï≤¥ Î™´ = 0',
            validate:function(i){return i.trim()==='0'||i.trim()==='0/6'} },
          { type:'interactive', interactionType:'dial', title:'üìã ÌçºÏ¶ê 4: Ï†ëÏ¥â ÌöüÏàò Ìï©ÏÇ∞',
            story:'ÏàòÏÇ¨ ÎÖ∏Ìä∏Ïùò Îã§Ïù¥Ïñº Ïû†Í∏à. Ï¥ù Ï†ëÏ¥â ÌöüÏàòÏùò Ï†úÍ≥±Í∑º √ó Ï†ëÏ¥â ÌöüÏàòÎ°ú Ïó¥Î¶∞Îã§.\nÍπÄ7+Î∞ï12+Ïµú5+Ïù¥9+Î≥ÄÌò∏ÏÇ¨6. Ìï©Ïùò Ï†úÍ≥±Í∑º(Î∞òÏò¨Î¶º)ÏùÑ ÏïûÏóê Î∂ôÏó¨Îùº.',
            config:{ combination:[6,3,9], labels:['Î∞±','Ïã≠','Ïùº'] },
            hint:'Ìï©=39, ‚àö39‚âà6.24‚Üí6. Îãµ: 639',
            validate:function(i){return i.trim() === '639'} },
          { type:'cpq', cpqIndex:0,
            story:'"ÏßÑÎ≤îÏùÑ Ï∞æÏïòÎã§. Í∞êÏãúÎãπÌïòÍ≥† ÏûàÎã§."\nÏû•ÌòúÎ¶∞Ïù¥ ÎßàÏßÄÎßâÏúºÎ°ú Ìñ•ÌïòÎ†§Îçò Ïû•ÏÜå.',
            storyAfter:'Ïû•ÌòúÎ¶∞Ïùò ÎßàÏßÄÎßâ ÎÖπÏùåÏù¥ Ïû¨ÏÉùÎêêÎã§.' }
        ],
        cliffhanger:'Ïû•ÌòúÎ¶∞Ïùò ÎßàÏßÄÎßâ ÎÖπÏùå.\n\n"20ÎÖÑÍ∞Ñ Ï∂îÏ†ÅÌïú ÎÅùÏóê Î™®Îì† Í±∏ Ïó∞Í≤∞ÌñàÏñ¥."\n"ÍµêÏàò ÍπÄÎèôÌòÑ, ÎßàÏà†ÏÇ¨ ÏµúÌòÑÏö∞, ÏÑ∏ Î≤àÏß∏ ÎÇ®Ïûê."\n"304Ìò∏ ÌôòÏûêÎì§, Íµ¨ÏÑ∏Ï£º Í≥†ÏïÑÏõê, ÏÑ∏Ï¢ÖÍ≥† ÌôîÏû¨."\n"Ï†ÑÎ∂Ä ÌïòÎÇòÏùò ÌîÑÎ°úÏ†ùÌä∏Ïïº."\n"ÏΩîÎìúÎ™Ö: QUBE."\n\n"Ìï¥Ï†Ä Ïó∞Íµ¨ÏÜå. Î∂ÅÌÉúÌèâÏñë ÏàòÏã¨ 1000m."\n"Í±∞Í∏∞ÏÑú Î™®Îì† Í≤å ÏãúÏûëÎêêÍ≥†, Í±∞Í∏∞ÏÑú ÎÅùÎÇ¥Ïïº Ìï¥."\n"ÎÇòÎäî ÏßÄÍ∏à Í∑∏Í≥≥ÏúºÎ°ú Í∞ÑÎã§."\n\nÎÖπÏùåÏù¥ ÎÅäÍ∏¥Îã§.\n\nÏ±ÖÏÉÅ ÏÑúÎûçÏóê Ïû†ÏàòÏ†ï ÌÉëÏäπÍ∂å Îëê Ïû•.\nÌïú Ïû•ÏùÄ Ïû•ÌòúÎ¶∞ Í≤É. Ìïú Ïû•ÏùÄ... ÎπÑÏñ¥ ÏûàÎã§.\n\nÎãπÏã†Ïùò Ïù¥Î¶ÑÏùÑ Ï†ÅÏúºÎùºÎäî ÎúªÏù¥Îã§.'
      },
      {
        id:'ch3_abyss', title:'Ch.3 ‚Äî Ìï¥Ï†Ä Ïó∞Íµ¨ÏÜå', desc:'ÏàòÏã¨ 1000m. Î™®Îì† Îñ°Î∞•Ïù¥ ÌöåÏàòÎêòÎäî ÏµúÏ¢Ö Ïä§ÌÖåÏù¥ÏßÄ.', time:'20Î∂Ñ',
        intro:'Ïû†ÏàòÏ†ïÏù¥ ÌïòÍ∞ïÌïúÎã§. ÏàòÏã¨ 100m... 500m... 1000m.\nÌï¥Ï†Ä Ïó∞Íµ¨ÏÜå "Îî• Î∏îÎ£®". Ï∞ΩÎ∞ñÏúºÎ°ú Ìë∏Î•∏ ÎπõÏù¥ ÌùêÎ•∏Îã§.\nÎèÑÌÇπ ÏôÑÎ£å. ÏóêÏñ¥Î°ùÏù¥ Ïó¥Î¶∞Îã§.\nÏû•ÌòúÎ¶∞Ïù¥ ÏûàÎã§. ÏÇ¥ÏïÑ ÏûàÎã§.\n"ÎìúÎîîÏñ¥ ÏôîÍµ¨ÎÇò. Ïù¥Ï†ú ÎÅùÎÇº ÎïåÏïº."\nÏÇ∞ÏÜå ÏûîÎüâ: 3ÏãúÍ∞Ñ. ÏãúÍ∞ÑÏù¥ ÏóÜÎã§.',
        puzzles:[
          { type:'interactive', interactionType:'flashlight', title:'üß¨ ÌçºÏ¶ê 1: Ìï¥Ï†Ä Í∏∞Ïïï Í≥ÑÏÇ∞',
            story:'Ï§ëÏïô Ï†úÏñ¥Ïã§Ïù¥ Ïπ®Ïàò ÏßÅÏ†ÑÏù¥Îã§. ÎπÑÏÉÅÎì±Îßå ÍπúÎπ°Ïù¥Îäî Ïñ¥Îë† ÏÜçÏóêÏÑú Í∏∞Ïïï Îç∞Ïù¥ÌÑ∞Î•º Ï∞æÏïÑÎùº.',
            config:{ items:[
              {x:15, y:25, text:'ÏàòÎ©¥=1Í∏∞Ïïï'},
              {x:50, y:40, text:'10mÎãπ +1Í∏∞Ïïï'},
              {x:30, y:65, text:'ÏàòÏã¨=1000m'},
              {x:75, y:55, text:'1+100='},
              {x:80, y:80, text:'101Í∏∞Ïïï'},
              {x:5, y:85, text:'Ïò®ÎèÑ=2¬∞C(Ìï®Ï†ï)'},
              {x:90, y:15, text:'ÏóºÎèÑ=35‚Ä∞(Ìï®Ï†ï)'},
              {x:60, y:10, text:'ÏÇ∞ÏÜå=0%(Ìï®Ï†ï)'}
            ]},
            hint:'1+(1000√∑10)=101',
            validate:function(i){return i.trim() === '101'} },
          { type:'interactive', interactionType:'connect-dots', title:'üìä ÌçºÏ¶ê 2: ÏÉùÎ™ÖÏ≤¥ Ï∂úÌòÑ Ìå®ÌÑ¥',
            story:'Í¥ÄÏ∏° Í∏∞Î°ùÏùò Îç∞Ïù¥ÌÑ∞ Ìè¨Ïù∏Ìä∏Î•º Ïó∞Í≤∞ÌïòÎ©¥ ÌîºÎ≥¥ÎÇòÏπò Ìå®ÌÑ¥Ïù¥ Î≥¥Ïù∏Îã§.',
            config:{ dots:[
              {x:10, y:80, order:1}, {x:25, y:80, order:2},
              {x:40, y:65, order:3}, {x:55, y:50, order:4},
              {x:70, y:30, order:5}, {x:85, y:15, order:6}
            ], revealText:'ÌîºÎ≥¥ÎÇòÏπò: 1,1,2,3,5,8 ‚Üí 6Ï£ºÏ∞®: 8' },
            hint:'3+5=8. Ï†êÏùÑ ÏàúÏÑúÎåÄÎ°ú Ïó∞Í≤∞!',
            validate:function(i){return i.trim() === '8'} },
          { type:'interactive', interactionType:'dial', title:'üî¨ ÌçºÏ¶ê 3: DNA ÏÑúÏó¥ Î≥ÄÌôò',
            story:'Ïã§ÌóòÏã§Ïùò Îã§Ïù¥Ïñº Ïû†Í∏à. DNA ÏÑúÏó¥ÏùÑ Ïà´ÏûêÎ°ú Î≥ÄÌôòÌï¥Ïïº ÌïúÎã§.\nA=1,T=2,C=3,G=4. ATCG TACG GCTA ATGC',
            config:{ combination:[1,2,3,4,2,1,3,4,4,3,2,1,1,2,4,3], labels:[] },
            hint:'ATCG=1234 TACG=2134 GCTA=4321 ATGC=1243',
            validate:function(i){return i.replace(/[\s-]/g,'') === '1234213443211243'} },
          { type:'interactive', interactionType:'piano', title:'üö™ ÌçºÏ¶ê 4: ÎπÑÏÉÅ ÌÉàÏ∂ú ÏΩîÎìú',
            story:'ÎπÑÏÉÅ ÌÉàÏ∂ú ÏãúÏä§ÌÖúÏùò ÏùåÏÑ± Ïù∏Ï¶ù. Ïò¨Î∞îÎ•∏ ÏàúÏÑúÎ°ú ÌÇ§Î•º ÎàåÎü¨Ïïº ÌïúÎã§.\n2019+2015=4034',
            config:{ keys:['C','D','E','F','G','A','B'], sequence:['F','A','E','G','F','D','B','A'], display:'Ìåå Îùº ÎØ∏ ÏÜî Ìåå Î†à Ïãú Îùº (8Ïùå ÌÉàÏ∂ú Ïù∏Ï¶ù ÏΩîÎìú)' },
            hint:'Ïó∞ÎèÑ Ìï©: 2019+2015=4034. 8Í∞ú ÏùåÍ≥ÑÎ•º Ï†ïÌôïÌûà Ïó∞Ï£ºÌïòÏÑ∏Ïöî.',
            validate:function(i){return i.trim() === '4034'} },
          { type:'cpq', cpqIndex:0,
            story:'"Ïù¥ ÏÉùÎ™ÖÏ≤¥Îì§ÏùÄ ÏßÄÍµ¨ ÏÉùÎ™ÖÏ≤¥Í∞Ä ÏïÑÎãàÎã§."\nÏµúÏ¢Ö Ï¢åÌëú. ÎßàÏßÄÎßâ Ïû•ÏÜåÏùò Í±∞Î¶¨Î•º Ï∏°Ï†ïÌïòÎùº.',
            storyAfter:'ÎπÑÏÉÅ ÌÉàÏ∂ú ÏãúÏä§ÌÖúÏù¥ Í∞ÄÎèôÎêêÎã§.' }
        ],
        cliffhanger:'ÌÉàÏ∂ú ÏßÅÏ†Ñ, Ïû•ÌòúÎ¶∞Ïù¥ Ï§ëÏïô Ïª¥Ìì®ÌÑ∞Ïùò ÎßàÏßÄÎßâ ÌååÏùºÏùÑ Ïó¥ÏóàÎã§.\n\nQUBE ÌîÑÎ°úÏ†ùÌä∏ ÏµúÏ¢Ö Î≥¥Í≥†ÏÑú.\n\n"1994ÎÖÑ, ÏÑ∏Ï¢ÖÍ≥† ÏßÄÌïòÏã§ÏóêÏÑú Î∞úÍ≤¨Îêú ÎØ∏ÏßÄÏùò Î¨ºÏßà."\n"ÏÑ∏ Î™ÖÏùò ÌïôÏÉùÏù¥ Î™©Í≤©. ÍπÄÎèôÌòÑ, ÏµúÌòÑÏö∞, Í∑∏Î¶¨Í≥† ‚ñà‚ñà‚ñà‚ñà."\n"Î¨ºÏßàÏùÄ Ìï¥Ï†ÄÏóêÏÑú Ïò® Í≤ÉÏù¥ÏóàÎã§."\n"30ÎÖÑÍ∞ÑÏùò Ïó∞Íµ¨ Í≤∞Í≥º: Ïù¥Í≤ÉÏùÄ Ïã†Ìò∏ÏòÄÎã§."\n"ÎàÑÍµ∞Í∞Ä Ïö∞Î¶¨ÏóêÍ≤å Î≥¥ÎÇ∏ Î©îÏãúÏßÄ."\n\nÏû•ÌòúÎ¶∞Ïù¥ ÎßêÌñàÎã§.\n"ÍµêÏàòÎèÑ, ÎßàÏà†ÏÇ¨ÎèÑ, ÌôòÏûêÎì§ÎèÑ... Ï†ÑÎ∂Ä Ïù¥ ÎπÑÎ∞ÄÏùÑ ÏßÄÌÇ§Í∏∞ ÏúÑÌï¥ Ìù¨ÏÉùÎêú Í±∞Ïïº."\n"ÌïòÏßÄÎßå Ïù¥Ï†ú ÏÑ∏ÏÉÅÏù¥ ÏïåÏïÑÏïº Ìï¥."\n\nÎπÑÏÉÅ ÌÉàÏ∂ú Ìè¨ÎìúÍ∞Ä ÏÉÅÏäπÌïúÎã§.\nÏàòÎ©¥ ÏúÑÎ°ú Îñ†Ïò§Î•¥Îäî ÏàúÍ∞Ñ, ÎùºÎîîÏò§ÏóêÏÑú Îâ¥Ïä§Í∞Ä ÌùòÎü¨ÎÇòÏò®Îã§.\n\n"ÏÜçÎ≥¥ÏûÖÎãàÎã§. Íµ≠Î¶Ω Í≥†Í≥†Ìïô Î∞ïÎ¨ºÍ¥Ä ÌäπÏàòÏó∞Íµ¨Ïû¨Îã®Ïùò ÎπÑÎ∞Ä Ïã§ÌóòÏù¥ Ìè≠Î°úÎêòÏóàÏäµÎãàÎã§."\n"Ïã§Ï¢ÖÎêú ÍµêÏàò ÍπÄÎèôÌòÑÏù¥ Î¨¥ÏÇ¨Ìûà Íµ¨Ï∂úÎêòÏóàÏúºÎ©∞..."\n\nÏµúÌòÑÏö∞Ïùò ÎßàÏßÄÎßâ Ìä∏Î¶≠.\nÍ∑∏Îäî ÏÇ¨ÎùºÏßÑ Í≤å ÏïÑÎãàÎùº, Ï¶ùÍ±∞Î•º ÏÑ∏ÏÉÅÏóê Î≥¥ÎÇ¥Í≥† ÏûàÏóàÎã§.\n\nÎãπÏã†ÏùÄ Ìï¥ÎÉàÎã§.\n\nüèÜ QUBE ‚Äî ALL CLEAR'
      }
    ]
  }
];

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   Game State & Logic
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
var state = { currentSeries:null, currentChapter:null, currentPuzzle:0, cpqCampaigns:[], startTime:null, attempts:0, hintCount:0, hintPenalty:0 };

function getProgress() { try{return JSON.parse(localStorage.getItem('qube_progress')||'{}');}catch(e){return {};} }
function saveProgressData(p) { localStorage.setItem('qube_progress', JSON.stringify(p)); }
function isChapterCleared(sid,cid) { var p=getProgress(); return !!(p[sid]&&p[sid][cid]); }
function isChapterUnlocked(si,ci) {
  if(ci===0) return true;
  var s=SERIES[si];
  return isChapterCleared(s.id,s.chapters[ci-1].id);
}
function isSeriesUnlocked(si){return true;}
function isSeriesCleared(si){var s=SERIES[si];for(var i=0;i<s.chapters.length;i++)if(!isChapterCleared(s.id,s.chapters[i].id))return false;return true;}
function getTotalCleared(){var c=0;SERIES.forEach(function(s,si){s.chapters.forEach(function(ch){if(isChapterCleared(s.id,ch.id))c++;});});return c;}
function getSeriesCleared(){var c=0;SERIES.forEach(function(_,si){if(isSeriesCleared(si))c++;});return c;}
function getGrade(c){return c>=10?'üïµÔ∏è ÏÖúÎ°ù':c>=7?'üîç Î™ÖÌÉêÏ†ï':c>=4?'üßê ÌÉêÏ†ï':c>=2?'üìã ÏàòÏäµÌÉêÏ†ï':'üî∞ Ï¥àÎ≥¥ÌÉêÏ†ï';}
function formatTime(s){return Math.floor(s/60)+':'+String(s%60).padStart(2,'0');}

function createParticles(){var c=document.getElementById('particles');for(var i=0;i<50;i++){var p=document.createElement('div');p.className='particle';p.style.left=Math.random()*100+'%';p.style.animationDuration=(8+Math.random()*12)+'s';p.style.animationDelay=Math.random()*10+'s';var sz=(2+Math.random()*3)+'px';p.style.width=p.style.height=sz;p.style.background=Math.random()>.5?'#b44aff':'#00e5ff';p.style.boxShadow='0 0 6px '+p.style.background;c.appendChild(p);}}
function scrollToSeries(){document.getElementById('series-section').scrollIntoView({behavior:'smooth'});}

function showScreen(id){['home','chapters','game','result'].forEach(function(s){document.getElementById(s).classList.toggle('hidden',s!==id);});document.getElementById('loadingScreen').classList.remove('active');if(id!=='home')window.scrollTo(0,0);}
function goHome(){cleanupInteractive();state.currentSeries=null;state.currentChapter=null;showScreen('home');renderHome();}
function confirmExit(){if(confirm('Ï†ïÎßê ÎÇòÍ∞ÄÏãúÍ≤†ÏäµÎãàÍπå? ÏßÑÌñâ ÏÉÅÌô©Ïù¥ Ï¥àÍ∏∞ÌôîÎê©ÎãàÎã§.'))goHome();}

function renderHome(){
  var cleared=getTotalCleared(),totalChapters=0;
  SERIES.forEach(function(s){totalChapters+=s.chapters.length;});
  document.getElementById('statCleared').textContent=cleared;
  document.getElementById('statGrade').textContent=getGrade(cleared).split(' ')[0];
  document.getElementById('statStreak').textContent=getSeriesCleared();
  document.getElementById('seriesProgressText').textContent='‚úÖ '+cleared+'/'+totalChapters+' Ï±ïÌÑ∞ ÌÅ¥Î¶¨Ïñ¥';
  var html='';
  for(var si=0;si<SERIES.length;si++){
    var s=SERIES[si],unlocked=isSeriesUnlocked(si),serCleared=isSeriesCleared(si),chapCleared=0;
    for(var ci=0;ci<s.chapters.length;ci++)if(isChapterCleared(s.id,s.chapters[ci].id))chapCleared++;
    var stars='';for(var d=0;d<3;d++)stars+='<span class="star '+(d<s.difficulty?'':'empty')+'">'+(d<s.difficulty?'‚òÖ':'‚òÜ')+'</span>';
    var badge='';
    if(serCleared)badge='<span class="series-badge badge-clear">‚úÖ ÌÅ¥Î¶¨Ïñ¥</span>';
    else if(chapCleared>0)badge='<span class="series-badge badge-progress">'+chapCleared+'/'+s.chapters.length+'</span>';
    else if(unlocked)badge='<span class="series-badge badge-new">NEW</span>';
    var lockOverlay='';
    if(!unlocked){var prevTitle=si>0?SERIES[si-1].title:'';lockOverlay='<div class="series-lock-overlay"><span>üîí "'+prevTitle+'" ÌÅ¥Î¶¨Ïñ¥ Ïãú Ìï¥Í∏à</span></div>';}
    html+='<div class="series-card '+(unlocked?'':'locked')+' '+(serCleared?'cleared':'')+'" onclick="'+(unlocked?'openSeries('+si+')':'')+'">';
    html+=lockOverlay+'<div class="series-header"><div class="series-icon">'+s.icon+'</div><div class="series-info"><div class="series-title">'+s.title+'</div><div class="series-diff">'+stars+'</div></div>'+badge+'</div>';
    html+='<div class="series-desc">'+s.desc+'</div><div class="series-footer"><div class="series-chapter-progress">';
    for(var ci2=0;ci2<s.chapters.length;ci2++){if(isChapterCleared(s.id,s.chapters[ci2].id))html+='<span class="done">‚úÖ</span> ';else if(isChapterUnlocked(si,ci2))html+='üîì ';else html+='üîí ';}
    html+='</div></div></div>';
  }
  document.getElementById('seriesGrid').innerHTML=html;
}

function openSeries(si){
  var s=SERIES[si];showScreen('chapters');
  var html='<div class="chapter-header"><button class="chapter-back" onclick="goHome()">‚Üê</button><div class="chapter-series-title">'+s.icon+' '+s.title+'</div></div>';
  html+='<div class="chapter-series-desc">'+s.desc+'</div><div class="chapter-timeline">';
  for(var ci=0;ci<s.chapters.length;ci++){
    var ch=s.chapters[ci],cleared=isChapterCleared(s.id,ch.id),unlocked=isChapterUnlocked(si,ci);
    var cls=cleared?'cleared':(unlocked?'unlocked':'locked'),dotContent=cleared?'‚úì':(unlocked?(ci+1):'üîí');
    html+='<div class="chapter-item '+cls+'"><div class="chapter-dot">'+dotContent+'</div><div class="chapter-card"><div class="chapter-card-title">'+ch.title+'</div><div class="chapter-card-desc">'+ch.desc+'</div><div class="chapter-card-meta"><span>‚è± '+ch.time+'</span>';
    if(cleared)html+='<button class="chapter-replay" onclick="startChapter('+si+','+ci+')">Îã§Ïãú ÎèÑÏ†Ñ üîÑ</button>';
    else if(unlocked)html+='<button class="chapter-enter" onclick="startChapter('+si+','+ci+')">ÏûÖÏû•ÌïòÍ∏∞ üîë</button>';
    else html+='<span>üîí Ïù¥Ï†Ñ Ï±ïÌÑ∞ ÌÅ¥Î¶¨Ïñ¥ ÌïÑÏöî</span>';
    html+='</div></div></div>';
  }
  html+='</div>';
  document.getElementById('chapters').innerHTML=html;
}

async function startChapter(si,ci){
  var s=SERIES[si],ch=s.chapters[ci];
  state.currentSeries=s;state.currentChapter=ch;state.currentSeriesIdx=si;state.currentChapIdx=ci;state.currentPuzzle=0;state.startTime=Date.now();state.attempts=0;state.hintCount=0;state.hintPenalty=0;
  document.getElementById('loadingScreen').classList.add('active');
  try{var cpqCount=ch.puzzles.filter(function(p){return p.type==='cpq';}).length;var res=await fetch(API+'/api/random?count='+cpqCount);var data=await res.json();state.cpqCampaigns=data.campaigns||[];}catch(e){state.cpqCampaigns=[];}
  showScreen('game');document.getElementById('gameTitle').textContent=ch.title;renderIntro();
}

function renderIntro(){
  renderProgressBar();
  document.getElementById('gameContent').innerHTML='<div class="story-box"><div class="label">üìñ ÌîÑÎ°§Î°úÍ∑∏</div><p>'+state.currentChapter.intro.replace(/\n/g,'<br>')+'</p></div><button class="btn-next" onclick="renderPuzzle(0)">Ï°∞ÏÇ¨ ÏãúÏûë ‚Üí</button>';
}

function renderProgressBar(){
  var total=state.currentChapter.puzzles.length;
  document.getElementById('gameProgressText').textContent=(state.currentPuzzle+1)+' / '+total;
  var dots='';for(var i=0;i<total;i++){var cls=i<state.currentPuzzle?'done':(i===state.currentPuzzle?'active':'');dots+='<div class="prog-dot '+cls+'"></div>';}
  document.getElementById('progressBar').innerHTML=dots;
}

function renderPuzzle(idx){
  cleanupInteractive();
  state.currentPuzzle=idx;renderProgressBar();
  var puzzle=state.currentChapter.puzzles[idx];
  if(puzzle.type==='cpq') renderCpqPuzzle(idx,puzzle);
  else if(puzzle.type==='interactive') renderInteractivePuzzle(idx,puzzle);
  else renderGeneralPuzzle(idx,puzzle);
}

function renderInteractivePuzzle(idx,puzzle){
  var html='<div class="story-box"><div class="label">üìñ ÏÉÅÌô©</div><p>'+puzzle.story.replace(/\n/g,'<br>')+'</p></div>';
  html+='<div class="puzzle-box"><div class="puzzle-label">'+puzzle.title+'</div>';
  html+='<div id="interactiveArea"></div>';
  html+='<div class="hint-box hidden" id="hintBox">üí° '+puzzle.hint+'</div>';
  html+='<button class="hint-btn" onclick="useHint(this)">üí° ÌûåÌä∏ Î≥¥Í∏∞ (+30Ï¥à)</button>';
  html+='<div class="answer-area"><input type="text" id="answerInput" placeholder="Ï†ïÎãµÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" onkeydown="handleEnter(event,'+idx+')"><button class="btn-submit" onclick="checkGeneral('+idx+')">ÌôïÏù∏</button></div>';
  html+='<div id="feedback"></div></div>';
  document.getElementById('gameContent').innerHTML=html;

  // Set piano answer for auto-fill
  if(puzzle.interactionType==='piano') window._pianoAnswer = '';

  switch(puzzle.interactionType){
    case 'flashlight': initFlashlight(puzzle.config); break;
    case 'jigsaw': initJigsaw(puzzle.config); break;
    case 'dial': initDial(puzzle.config); break;
    case 'piano': initPiano(puzzle.config); break;
    case 'hidden-text': initHiddenText(puzzle.config); break;
    case 'timing': initTiming(puzzle.config); break;
    case 'connect-dots': initConnectDots(puzzle.config); break;
    case 'color-code': initColorCode(puzzle.config); break;
    case 'mirror': initMirror(puzzle.config); break;
    case 'shake': initShake(puzzle.config); break;
    case 'trivia': initTrivia(puzzle.config); break;
    case 'caesar': initCaesar(puzzle.config); break;
    case 'morse': initMorse(puzzle.config); break;
    case 'konami': initKonami(puzzle.config); break;
    case 'acrostic': initAcrostic(puzzle.config); break;
    case 'logic': initLogic(puzzle.config); break;
    case 'book-cipher': initBookCipher(puzzle.config); break;
    case 'hidden-interaction': initHiddenInteraction(puzzle.config); break;
  }
  setTimeout(function(){document.getElementById('gameContent').scrollIntoView({behavior:'smooth'});},100);
}

function renderGeneralPuzzle(idx,puzzle){
  document.getElementById('gameContent').innerHTML=
    '<div class="story-box"><div class="label">üìñ ÏÉÅÌô©</div><p>'+puzzle.story.replace(/\n/g,'<br>')+'</p></div>'+
    '<div class="puzzle-box"><div class="puzzle-label">'+puzzle.title+'</div>'+
    '<div class="puzzle-question">'+puzzle.question.replace(/\n/g,'<br>')+'</div>'+
    '<div class="hint-box hidden" id="hintBox">üí° '+puzzle.hint+'</div>'+
    '<button class="hint-btn" onclick="useHint(this)">üí° ÌûåÌä∏ Î≥¥Í∏∞ (+30Ï¥à)</button>'+
    '<div class="answer-area"><input type="text" id="answerInput" placeholder="Ï†ïÎãµÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" onkeydown="handleEnter(event,'+idx+')">'+
    '<button class="btn-submit" onclick="checkGeneral('+idx+')">ÌôïÏù∏</button></div>'+
    '<div id="feedback"></div></div>';
  setTimeout(function(){document.getElementById('gameContent').scrollIntoView({behavior:'smooth'});},100);
}

function renderCpqPuzzle(idx,puzzle){
  var camp=state.cpqCampaigns[puzzle.cpqIndex];
  if(!camp){nextPuzzle(idx);return;}
  var desc=camp.join_desc||'',keyword=camp.search_keyword||'';
  var placeMatch=desc.match(/\[([^\]]*X[^\]]*)\]/),placeHint=placeMatch?placeMatch[1]:'Ìï¥Îãπ Ïû•ÏÜå';
  var startMatch=desc.match(/Ï∂úÎ∞úÏßÄÎ•º\s*\[([^\]]+)\]/),startPlace=startMatch?startMatch[1]:'ÏßÄÏ†ïÎêú Ï∂úÎ∞úÏßÄ';
  document.getElementById('gameContent').innerHTML=
    '<div class="story-box"><div class="label">üìñ Îã®ÏÑú Î∞úÍ≤¨</div><p>'+puzzle.story.replace(/\n/g,'<br>')+'</p></div>'+
    '<div class="puzzle-box"><div class="puzzle-label">üîç ÌçºÏ¶ê '+(idx+1)+': Ïû•ÏÜå Ï∂îÏ†Å ÎØ∏ÏÖò</div>'+
    '<div class="puzzle-question">Îã®ÏÑúÏóê Ï†ÅÌûå Ïû•ÏÜåÎ•º Ï∞æÏïÑÏïº ÌïúÎã§. ÎÑ§Ïù¥Î≤ÑÏóêÏÑú Í≤ÄÏÉâÌïòÏó¨ Í±∏Ïùå ÏàòÎ•º ÌôïÏù∏ÌïòÎùº.</div>'+
    '<div class="cpq-mission"><div class="mission-title">üìã ÎØ∏ÏÖò ÏàúÏÑú</div>'+
    '<ol class="cpq-steps"><li>ÏïÑÎûò ÌÇ§ÏõåÎìúÎ•º Î≥µÏÇ¨ÌïòÏó¨ <b>ÎÑ§Ïù¥Î≤Ñ</b>ÏóêÏÑú Í≤ÄÏÉâ</li>'+
    '<li>Í≤ÄÏÉâ Í≤∞Í≥ºÏóêÏÑú <b>'+placeHint+'</b> ÌÅ¥Î¶≠</li>'+
    '<li>ÌîåÎ†àÏù¥Ïä§ÏóêÏÑú <b>ÏßÄÎèÑ</b> ÌÉ≠ ‚Üí <b>ÏßÄÎèÑÏï±ÏúºÎ°ú Î≥¥Í∏∞</b></li>'+
    '<li><b>ÎèÑÏ∞©</b> Î≤ÑÌäº ÌÅ¥Î¶≠</li>'+
    '<li>Ï∂úÎ∞úÏßÄÎ•º <b>'+startPlace+'</b>(Ïúº)Î°ú ÏÑ§Ï†ï</li>'+
    '<li><b>ÎèÑÎ≥¥</b> ‚Üí <b>Í∞ÄÏû• Îπ†Î•∏</b> Í≤ΩÎ°úÏùò Í±∏Ïùå Ïàò ÌôïÏù∏</li></ol>'+
    '<div class="cpq-keyword-box"><span class="cpq-keyword" onclick="copyKeyword(this)" title="ÌÅ¥Î¶≠ÌïòÏó¨ Î≥µÏÇ¨">üîé '+keyword+'</span></div></div>'+
    '<div class="answer-area" style="margin-top:16px"><input type="number" id="answerInput" placeholder="Í±∏Ïùå ÏàòÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî" onkeydown="handleEnter(event,'+idx+',\'cpq\')">'+
    '<button class="btn-submit" onclick="checkCpq('+idx+')">ÌôïÏù∏</button></div>'+
    '<div id="feedback"></div></div>';
  setTimeout(function(){document.getElementById('gameContent').scrollIntoView({behavior:'smooth'});},100);
}

var isComposing=false;
document.addEventListener('compositionstart',function(){isComposing=true;});
document.addEventListener('compositionend',function(){isComposing=false;});
function handleEnter(e,idx,type){if(e.key==='Enter'&&!isComposing){e.preventDefault();type==='cpq'?checkCpq(idx):checkGeneral(idx);}}

function useHint(btn){
  if(!confirm('ÌûåÌä∏Î•º ÏÇ¨Ïö©ÌïòÎ©¥ 30Ï¥àÍ∞Ä Ï∂îÍ∞ÄÎê©ÎãàÎã§. ÏÇ¨Ïö©ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;
  state.hintCount++;state.hintPenalty+=30;
  document.getElementById('hintBox').classList.remove('hidden');
  btn.remove();
  var notice=document.createElement('div');notice.className='hint-penalty-notice';notice.textContent='‚è±Ô∏è +30Ï¥à Ìå®ÎÑêÌã∞!';document.body.appendChild(notice);
  setTimeout(function(){notice.remove();},2200);
}
function checkGeneral(idx){var input=document.getElementById('answerInput').value.trim();if(!input)return;state.attempts++;showFeedback(state.currentChapter.puzzles[idx].validate(input),idx);}
async function checkCpq(idx){var input=document.getElementById('answerInput').value.trim();if(!input)return;state.attempts++;var camp=state.cpqCampaigns[state.currentChapter.puzzles[idx].cpqIndex];try{var res=await fetch(API+'/api/verify',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({campaign_id:camp.id,user_answer:input})});var data=await res.json();showFeedback(data.correct,idx);}catch(e){showFeedback(false,idx);}}

function showFeedback(correct,idx){
  var fb=document.getElementById('feedback'),puzzle=state.currentChapter.puzzles[idx],isLast=idx>=state.currentChapter.puzzles.length-1;
  if(correct){
    var after=puzzle.storyAfter||'';
    fb.innerHTML='<div class="feedback correct">‚úÖ Ï†ïÎãµ!'+(after?' '+after:'')+'</div><button class="btn-next" onclick="nextPuzzle('+idx+')">'+(isLast?'üö™ Ï±ïÌÑ∞ ÏôÑÎ£å!':'Îã§Ïùå ÌçºÏ¶ê ‚Üí')+'</button>';
  }else{
    fb.innerHTML='<div class="feedback wrong">‚ùå Ïò§Îãµ. Îã§Ïãú ÏãúÎèÑÌï¥Î≥¥ÏÑ∏Ïöî.</div>';
    document.getElementById('answerInput').value='';fb.scrollIntoView({behavior:'smooth',block:'center'});
  }
}
function nextPuzzle(cur){cleanupInteractive();if(cur+1>=state.currentChapter.puzzles.length)showCliffhanger();else renderPuzzle(cur+1);}

function showCliffhanger(){
  cleanupInteractive();
  var ch=state.currentChapter,s=state.currentSeries,si=state.currentSeriesIdx,ci=state.currentChapIdx;
  var elapsed=Math.floor((Date.now()-state.startTime)/1000)+state.hintPenalty;
  var p=getProgress();if(!p[s.id])p[s.id]={};p[s.id][ch.id]={cleared:true,bestTime:elapsed,lastPlayed:Date.now(),hints:state.hintCount};saveProgressData(p);
  var isLastChapter=ci>=s.chapters.length-1,isLastSeries=si>=SERIES.length-1,isFinalClear=isLastChapter&&isLastSeries;
  var gameGrade='S';if(elapsed>600)gameGrade='C';else if(elapsed>300)gameGrade='B';else if(elapsed>180)gameGrade='A';
  showScreen('result');var html='';
  if(isFinalClear){spawnConfetti();html+='<div class="result-emoji">üèÜ</div><div class="result-title">QUBE ‚Äî ALL CLEAR</div><div class="result-sub">Î™®Îì† ÎØ∏Ïä§ÌÑ∞Î¶¨Î•º Ìï¥Í≤∞ÌñàÏäµÎãàÎã§</div>';}
  else if(isLastChapter){spawnConfetti();html+='<div class="result-emoji">üéä</div><div class="result-title">ÏãúÎ¶¨Ï¶à ÌÅ¥Î¶¨Ïñ¥!</div><div class="result-sub">"'+s.title+'" ÏôÑÎ£å!</div>';}
  else{html+='<div class="result-emoji">üéâ</div><div class="result-title">Ï±ïÌÑ∞ ÌÅ¥Î¶¨Ïñ¥!</div><div class="result-sub">'+ch.title+' ÏôÑÎ£å</div>';}
  html+='<div class="result-grade">'+gameGrade+' RANK</div><div class="result-stats">';
  html+='<div class="result-stat"><div class="result-stat-val">'+formatTime(elapsed)+'</div><div class="result-stat-label">ÏÜåÏöîÏãúÍ∞Ñ'+(state.hintPenalty>0?' (Ìå®ÎÑêÌã∞ +'+state.hintPenalty+'Ï¥à)':'')+'</div></div>';
  html+='<div class="result-stat"><div class="result-stat-val">'+state.attempts+'</div><div class="result-stat-label">ÏãúÎèÑÌöüÏàò</div></div>';
  html+='<div class="result-stat"><div class="result-stat-val">'+(state.hintCount>0?state.hintCount+'Ìöå':'üèÖ')+'</div><div class="result-stat-label">'+(state.hintCount>0?'ÌûåÌä∏ ÏÇ¨Ïö©':'ÌûåÌä∏ ÏóÜÏù¥ ÌÅ¥Î¶¨Ïñ¥!')+'</div></div>';
  var totalCleared=getTotalCleared(),grade=getGrade(totalCleared);
  html+='<div class="result-stat"><div class="result-stat-val">'+grade.split(' ')[0]+'</div><div class="result-stat-label">'+(grade.split(' ')[1]||'')+'</div></div></div>';
  if(ch.cliffhanger)html+='<div class="cliffhanger-box"><div class="label">üìñ TO BE CONTINUED...</div><p>'+ch.cliffhanger.replace(/\n/g,'<br>')+'</p></div>';
  html+='<div class="result-btns">';
  if(!isLastChapter)html+='<button class="btn-home" onclick="startChapter('+si+','+(ci+1)+')">Îã§Ïùå Ï±ïÌÑ∞Î°ú ‚Üí</button>';
  else if(!isLastSeries)html+='<button class="btn-home" onclick="openSeries('+(si+1)+')">Îã§Ïùå ÏãúÎ¶¨Ï¶à ‚Üí</button>';
  html+='<button class="btn-home" style="background:var(--bg3);color:var(--text2)" onclick="goHome()">üö™ Î°úÎπÑÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞</button>';
  html+='<button class="btn-share" onclick="shareResult()">üì§ Í≤∞Í≥º Í≥µÏú†ÌïòÍ∏∞</button></div>';
  document.getElementById('resultContent').innerHTML=html;
}

function shareResult(){
  var ch=state.currentChapter,s=state.currentSeries,elapsed=Math.floor((Date.now()-state.startTime)/1000);
  var text='üîê QUBE - '+s.title+' / '+ch.title+'\n‚è± '+formatTime(elapsed)+'Ïóê ÌÅ¥Î¶¨Ïñ¥!\n\nÎÇòÎäî ÌÉàÏ∂úÌñàÎã§. ÎãπÏã†ÏùÄ?\nüëâ https://qube.salmonholic.com';
  if(navigator.share)navigator.share({text:text});else{navigator.clipboard&&navigator.clipboard.writeText(text);alert('ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêêÏäµÎãàÎã§!');}
}
function copyKeyword(el){var text=el.textContent.replace('üîé ','').trim();navigator.clipboard&&navigator.clipboard.writeText(text);var orig=el.textContent;el.textContent='‚úì Î≥µÏÇ¨Îê®!';setTimeout(function(){el.textContent=orig;},1500);}

function spawnConfetti(){
  var container=document.createElement('div');container.className='confetti-container';document.body.appendChild(container);
  var colors=['#b44aff','#00e5ff','#00ff88','#ff4444','#f59e0b','#fff'];
  for(var i=0;i<60;i++){var piece=document.createElement('div');piece.className='confetti-piece';piece.style.left=Math.random()*100+'%';piece.style.background=colors[Math.floor(Math.random()*colors.length)];piece.style.animationDelay=Math.random()*2+'s';piece.style.animationDuration=(2+Math.random()*2)+'s';var size=(6+Math.random()*8)+'px';piece.style.width=size;piece.style.height=size;piece.style.borderRadius=Math.random()>.5?'50%':'2px';container.appendChild(piece);}
  setTimeout(function(){container.remove();},5000);
}

createParticles();renderHome();
</script>
</body>
</html>