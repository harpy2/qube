<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QUBE â€” í’€ì–´ë¼. íƒˆì¶œí•˜ë¼.</title>
<meta name="description" content="ë°©íƒˆì¶œ ì¶”ë¦¬ í¼ì¦ ê²Œì„. ë‹¨ì„œë¥¼ ì°¾ê³ , í¼ì¦ì„ í’€ê³ , íƒˆì¶œí•˜ë¼.">
<meta property="og:title" content="QUBE â€” ë°©íƒˆì¶œ ì¶”ë¦¬ í¼ì¦ ê²Œì„">
<meta property="og:description" content="í’€ì–´ë¼. íƒˆì¶œí•˜ë¼.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://qube.salmonholic.com">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ”’</text></svg>">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#0a0a0a;--bg2:#111;--bg3:#1a1a1a;
  --text:#e0e0e0;--text2:#888;--text3:#555;
  --accent:#b44aff;--accent2:#9333ea;--accent-glow:rgba(180,74,255,.15);
  --cyan:#00e5ff;--danger:#ff4444;--success:#00ff88;
  --card:rgba(255,255,255,.03);--card-border:rgba(255,255,255,.06);
}
html{scroll-behavior:smooth}
body{background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Noto Sans KR',sans-serif;line-height:1.6;overflow-x:hidden}
.hidden{display:none!important}

/* Hero */
.hero{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;position:relative;overflow:hidden;padding:2rem}
.hero::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at 50% 40%,rgba(180,74,255,.06) 0%,transparent 70%);pointer-events:none}
.hero h1{font-size:clamp(3rem,10vw,6rem);font-weight:900;letter-spacing:0.1em;margin-bottom:1rem;background:linear-gradient(135deg,#fff 0%,#b44aff 50%,#00e5ff 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hero p{font-size:clamp(1rem,3vw,1.3rem);color:var(--text2);max-width:450px;margin-bottom:2.5rem}
.hero-cta{padding:16px 48px;background:linear-gradient(135deg,var(--accent),var(--cyan));color:#000;font-size:1.1rem;font-weight:700;border:none;border-radius:50px;cursor:pointer;transition:all .3s;letter-spacing:.05em}
.hero-cta:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(180,74,255,.4)}
.scroll-hint{position:absolute;bottom:2rem;animation:bounce 2s infinite;color:var(--text3);font-size:1.5rem}
@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(10px)}}

/* Particles */
.particles{position:absolute;inset:0;pointer-events:none;overflow:hidden}
.particle{position:absolute;width:3px;height:3px;border-radius:50%;opacity:.4;animation:float linear infinite}
@keyframes float{0%{transform:translateY(100vh) scale(0);opacity:0}10%{opacity:.4}90%{opacity:.4}100%{transform:translateY(-10vh) scale(1);opacity:0}}

/* Stats Bar */
.stats-bar{display:flex;justify-content:center;gap:40px;padding:24px 0;margin-bottom:1rem}
.stat{text-align:center}
.stat-val{font-size:2rem;font-weight:900;background:linear-gradient(135deg,var(--accent),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.stat-label{font-size:.8rem;color:var(--text2);margin-top:4px}

/* Rooms Section */
.rooms-section{max-width:900px;margin:0 auto;padding:0 1.5rem 4rem}
.rooms-section h2{font-size:1.5rem;margin-bottom:.5rem;display:flex;align-items:center;gap:8px}
.rooms-progress{color:var(--text2);font-size:.85rem;margin-bottom:1.5rem}
.room-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:1.2rem}

/* Room Card */
.room-card{background:var(--card);border:1px solid var(--card-border);border-radius:16px;padding:1.5rem;backdrop-filter:blur(10px);transition:all .3s;cursor:pointer;position:relative;overflow:hidden}
.room-card:hover{border-color:rgba(180,74,255,.3);background:rgba(255,255,255,.05);transform:translateY(-3px);box-shadow:0 8px 30px rgba(180,74,255,.1)}
.room-card.cleared{border-color:rgba(0,255,136,.2)}
.room-card.cleared .room-start{background:var(--bg3);color:var(--text2)}
.room-badge{position:absolute;top:12px;right:12px;padding:4px 12px;border-radius:20px;font-size:.7rem;font-weight:700}
.badge-new{background:var(--accent);color:#fff}
.badge-cleared{background:var(--success);color:#000}
.room-emoji{font-size:2.5rem;margin-bottom:.8rem}
.room-title{font-size:1.15rem;font-weight:700;margin-bottom:.4rem}
.room-desc{font-size:.85rem;color:var(--text2);margin-bottom:.8rem;line-height:1.5}
.room-meta{display:flex;gap:12px;color:var(--text2);font-size:.85rem;margin-bottom:1rem}
.room-diff .star{color:var(--accent)}
.room-diff .star.empty{color:var(--text3)}
.room-start{width:100%;padding:10px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;border:none;border-radius:50px;cursor:pointer;font-size:.9rem;font-weight:600;transition:all .3s}
.room-start:hover{box-shadow:0 4px 15px rgba(180,74,255,.4)}

/* Game Screen */
#game{max-width:700px;margin:0 auto;min-height:100vh;padding:1rem}
.game-header{display:flex;align-items:center;padding:1rem 0;border-bottom:1px solid var(--card-border);margin-bottom:1.5rem;gap:12px}
.game-back{background:none;border:none;color:var(--text2);font-size:1.3rem;cursor:pointer;padding:4px 8px}
.game-back:hover{color:var(--text)}
.game-title{font-size:1.1rem;font-weight:700;flex:1}
.game-progress-text{color:var(--text2);font-size:.85rem}

.progress-bar{display:flex;gap:6px;margin-bottom:1.5rem}
.prog-dot{flex:1;height:4px;border-radius:2px;background:var(--bg3);transition:all .3s}
.prog-dot.active{background:var(--accent);box-shadow:0 0 8px rgba(180,74,255,.4)}
.prog-dot.done{background:var(--success)}

.story-box{background:var(--bg3);border:1px solid var(--card-border);border-radius:16px;padding:1.5rem;margin-bottom:1.5rem;animation:fadeIn .5s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(15px)}to{opacity:1;transform:translateY(0)}}
.story-box .label{color:var(--accent);font-size:.75rem;font-weight:700;margin-bottom:8px;text-transform:uppercase;letter-spacing:.15em}
.story-box p{color:var(--text2);line-height:1.8}

.puzzle-box{background:rgba(180,74,255,.05);border:1px solid rgba(180,74,255,.15);border-radius:16px;padding:1.5rem;margin-bottom:1.5rem;animation:fadeIn .5s ease}
.puzzle-label{color:var(--cyan);font-size:.8rem;font-weight:700;margin-bottom:12px;letter-spacing:.05em}
.puzzle-question{font-size:1rem;line-height:1.8;margin-bottom:1.2rem}

.cpq-mission{background:rgba(0,229,255,.05);border:1px solid rgba(0,229,255,.15);border-radius:12px;padding:1.2rem;margin:1rem 0}
.cpq-mission .mission-title{color:var(--cyan);font-size:.8rem;font-weight:700;margin-bottom:10px}
.cpq-steps{font-size:.9rem;color:var(--text2);line-height:2;padding-left:1.2rem}
.cpq-steps b{color:var(--text)}
.cpq-keyword-box{margin-top:12px;display:flex;align-items:center;gap:10px}
.cpq-keyword{display:inline-block;background:linear-gradient(135deg,var(--accent),var(--cyan));color:#000;padding:8px 20px;border-radius:50px;font-size:.9rem;font-weight:700;cursor:pointer;transition:all .2s}
.cpq-keyword:hover{transform:scale(1.03);box-shadow:0 4px 15px rgba(180,74,255,.3)}

.hint-btn{background:none;border:1px solid var(--text3);color:var(--text2);padding:8px 16px;border-radius:50px;font-size:.8rem;cursor:pointer;transition:all .2s;margin-bottom:1rem}
.hint-btn:hover{border-color:var(--accent);color:var(--accent)}
.hint-box{background:rgba(255,165,0,.08);border:1px solid rgba(255,165,0,.2);border-radius:10px;padding:12px 16px;font-size:.9rem;color:#f59e0b;margin-bottom:1rem}

.answer-area{display:flex;flex-direction:column;gap:10px}
.answer-area input{width:100%;padding:14px 18px;background:var(--bg3);border:1px solid var(--card-border);border-radius:12px;color:var(--text);font-size:1rem;font-family:inherit;outline:none;transition:border-color .3s}
.answer-area input:focus{border-color:var(--accent)}
.answer-area input::placeholder{color:var(--text3)}
.btn-submit{width:100%;padding:14px 28px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;border:none;border-radius:12px;font-weight:700;cursor:pointer;transition:all .2s;white-space:nowrap;font-family:inherit;font-size:.95rem}
.btn-submit:hover{box-shadow:0 4px 15px rgba(180,74,255,.4)}
.btn-next{width:100%;padding:14px;background:linear-gradient(135deg,var(--accent),var(--cyan));color:#000;border:none;border-radius:50px;font-weight:700;cursor:pointer;transition:all .3s;font-size:1rem;font-family:inherit;margin-top:1rem}
.btn-next:hover{box-shadow:0 4px 20px rgba(180,74,255,.4);transform:translateY(-1px)}

.feedback{padding:14px 18px;border-radius:12px;margin-top:1rem;font-size:.95rem;animation:fadeIn .3s}
.feedback.correct{background:rgba(0,255,136,.1);color:var(--success);border:1px solid rgba(0,255,136,.2)}
.feedback.wrong{background:rgba(255,68,68,.1);color:var(--danger);border:1px solid rgba(255,68,68,.2)}

/* Result */
#result{max-width:600px;margin:0 auto;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:2rem}
.result-card{text-align:center;width:100%}
.result-emoji{font-size:4rem;margin-bottom:1rem}
.result-title{font-size:2rem;font-weight:900;margin-bottom:.5rem;background:linear-gradient(135deg,#fff,var(--accent),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.result-sub{color:var(--text2);margin-bottom:2rem}
.result-grade{display:inline-block;font-size:1.5rem;font-weight:900;padding:10px 30px;border-radius:50px;background:linear-gradient(135deg,var(--accent),var(--cyan));color:#000;margin-bottom:2rem}
.result-stats{display:flex;justify-content:center;gap:20px;margin-bottom:2rem;flex-wrap:wrap}
.result-stat{background:var(--card);border:1px solid var(--card-border);border-radius:16px;padding:18px 24px;min-width:100px}
.result-stat-val{font-size:1.5rem;font-weight:900;color:var(--accent)}
.result-stat-label{font-size:.75rem;color:var(--text2);margin-top:4px}
.result-btns{display:flex;flex-direction:column;gap:10px;max-width:300px;margin:0 auto}
.btn-home{padding:14px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;border:none;border-radius:50px;font-weight:700;cursor:pointer;font-size:1rem;font-family:inherit;transition:all .3s}
.btn-home:hover{box-shadow:0 4px 15px rgba(180,74,255,.4)}
.btn-share{padding:14px;background:transparent;border:1px solid var(--card-border);color:var(--text2);border-radius:50px;cursor:pointer;font-size:.9rem;font-family:inherit;transition:all .2s}
.btn-share:hover{border-color:var(--accent);color:var(--text)}

/* Loading */
.loading-screen{display:none;position:fixed;inset:0;background:var(--bg);z-index:1000;flex-direction:column;align-items:center;justify-content:center;gap:16px}
.loading-screen.active{display:flex}
.spinner{width:40px;height:40px;border:3px solid var(--bg3);border-top-color:var(--accent);border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-text{color:var(--text2);font-size:.9rem}

@media(max-width:600px){
  .hero h1{letter-spacing:.05em}
  .room-grid{grid-template-columns:1fr}
  .stats-bar{gap:24px}
  .result-stats{gap:12px}
}
</style>
</head>
<body>

<!-- â”€â”€â”€ í™ˆ â”€â”€â”€ -->
<div id="home">
  <div class="hero">
    <div class="particles" id="particles"></div>
    <h1>QUBE</h1>
    <p>í’€ì–´ë¼. íƒˆì¶œí•˜ë¼.</p>
    <button class="hero-cta" onclick="scrollToRooms()">ë°© ì„ íƒí•˜ê¸°</button>
    <div class="scroll-hint">â†“</div>
  </div>
  <div class="stats-bar">
    <div class="stat"><div class="stat-val" id="statCleared">0</div><div class="stat-label">í´ë¦¬ì–´</div></div>
    <div class="stat"><div class="stat-val" id="statGrade">ğŸ”°</div><div class="stat-label">ë“±ê¸‰</div></div>
    <div class="stat"><div class="stat-val" id="statStreak">0</div><div class="stat-label">ì—°ì†</div></div>
  </div>
  <div class="rooms-section" id="rooms-section">
    <h2>ğŸšª ë¯¸ìŠ¤í„°ë¦¬ ëª©ë¡</h2>
    <div class="rooms-progress" id="rooms-progress"></div>
    <div class="room-grid" id="roomGrid"></div>
  </div>
</div>

<!-- â”€â”€â”€ ë¡œë”© â”€â”€â”€ -->
<div class="loading-screen" id="loadingScreen">
  <div class="spinner"></div>
  <div class="loading-text">ë°©ì— ì§„ì…í•˜ëŠ” ì¤‘...</div>
</div>

<!-- â”€â”€â”€ ê²Œì„ â”€â”€â”€ -->
<div id="game" class="hidden">
  <div class="game-header">
    <button class="game-back" onclick="confirmExit()">â†</button>
    <div class="game-title" id="gameTitle"></div>
    <div class="game-progress-text" id="gameProgressText"></div>
  </div>
  <div class="progress-bar" id="progressBar"></div>
  <div id="gameContent"></div>
</div>

<!-- â”€â”€â”€ ê²°ê³¼ â”€â”€â”€ -->
<div id="result" class="hidden">
  <div class="result-card" id="resultContent"></div>
</div>

<script>
const API = 'https://qube-api.harpy922.workers.dev';

// â”€â”€â”€ ë°© í…œí”Œë¦¿ â”€â”€â”€
const ROOMS = [
  {
    id: 'professor', emoji: 'ğŸšï¸', name: 'ì‚¬ë¼ì§„ êµìˆ˜ì˜ ì„œì¬',
    desc: 'ê³ ê³ í•™ êµìˆ˜ ê¹€ë™í˜„ì´ 3ì¼ì§¸ ì—°ë½ì´ ì—†ë‹¤. ê·¸ì˜ ì„œì¬ì—ëŠ” ì‹¤ì¢…ì˜ ë‹¨ì„œê°€ ìˆ¨ê²¨ì ¸ ìˆë‹¤. ì§„ì‹¤ì„ ë°í˜€ë¼.',
    difficulty: 1, time: '12ë¶„',
    intro: `ê³ ê³ í•™ êµìˆ˜ ê¹€ë™í˜„ì´ 3ì¼ì§¸ ì—°ë½ì´ ì—†ë‹¤. ëŒ€í•™ì› ì¡°êµì¸ ë‹¹ì‹ ì€ ë§ˆìŠ¤í„°í‚¤ë¡œ ê·¸ì˜ ì„œì¬ì— ì ì…í–ˆì§€ë§Œ, ë¬¸ì´ ìë™ìœ¼ë¡œ ì ê²¼ë‹¤. ì–´ë‘ìš´ ì„œì¬ ì•ˆ, ì±…ìƒ ìœ„ ìŠ¤íƒ ë“œë§Œ í¬ë¯¸í•˜ê²Œ ë¹›ë‚˜ê³  ìˆë‹¤. ì–´ì§€ëŸ½ê²Œ ë„ë¦° ì„œë¥˜, ë²½ë©´ì˜ ì±…ì¥, ê³ ëŒ€ ìœ ë¬¼ ë³µì œí’ˆë“¤... êµìˆ˜ëŠ” ë¬´ì–¸ê°€ë¥¼ ê¸‰íˆ ì •ë¦¬í•˜ë‹¤ ì‚¬ë¼ì§„ ê²ƒ ê°™ë‹¤. ì„œì¬ì˜ ë¹„ë°€ì„ í’€ê³  íƒˆì¶œí•˜ë¼.`,
    puzzles: [
      { type:'general', title:'ğŸ“‹ í¼ì¦ 1: ì±…ìƒ ìœ„ì˜ ì•”í˜¸ ë©”ëª¨',
        story: `ì±…ìƒ ìœ„ë¥¼ ì‚´í´ë³¸ë‹¤. ë…¼ë¬¸ ì´ˆì•ˆ, ë°œêµ´ ë³´ê³ ì„œ, ì»¤í”¼ ìêµ­ì´ ë¬»ì€ ë¨¸ê·¸ì»µ... ê·¸ ì‚¬ì´ì— í¬ìŠ¤íŠ¸ì‡ í•˜ë‚˜ê°€ ëˆˆì— ëˆë‹¤. êµìˆ˜ì˜ í•„ì²´ë¡œ ë­”ê°€ ì í˜€ìˆë‹¤.

í¬ìŠ¤íŠ¸ì‡ì—ëŠ” ì´ìƒí•œ í‘œê°€ ê·¸ë ¤ì ¸ ìˆë‹¤. êµìˆ˜ê°€ ì¦ê²¨ ì“°ë˜ "ì¢Œí‘œ ì•”í˜¸"ë‹¤. ê²©ìì— ê¸€ìë¥¼ ë°°ì¹˜í•˜ê³ , ì¢Œí‘œë¡œ ë©”ì‹œì§€ë¥¼ ì „ë‹¬í•˜ëŠ” ë°©ì‹.

<b>â”Œâ”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”
â”‚ ì„œ â”‚ ë â”‚ ì„ â”‚ ê¸ˆ â”‚
â”œâ”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¤
â”‚ ì—´ â”‚ ì–´ â”‚ ê³  â”‚ ë¼ â”‚
â”œâ”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¤
â”‚ ë²½ â”‚ í™• â”‚ ì¸ â”‚ í•´ â”‚
â””â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”˜</b>

ê·¸ ì•„ë˜ ì¢Œí‘œê°€ ì í˜€ìˆë‹¤: <b>(1,1) (1,2) (2,1) (2,2) (2,3)</b>
(í–‰,ì—´ ìˆœì„œ)`,
        question: `ê²©ìì—ì„œ ì¢Œí‘œë¥¼ ì½ì–´ ë©”ì‹œì§€ë¥¼ ì™„ì„±í•˜ë¼.

(1,1)=ì„œ, (1,2)=ë, (2,1)=ì—´, (2,2)=ì–´, (2,3)=?

ë‹¤ì„¯ ê¸€ìë¥¼ ì´ì–´ì„œ ì…ë ¥í•˜ì‹œì˜¤. (ê³µë°± ì—†ì´)`,
        hint: '(1,1)=ì„œ, (1,2)=ë, (2,1)=ì—´, (2,2)=ì–´, (2,3)=ê³  â†’ "ì„œëì—´ì–´ê³ "? ì•„ë‹ˆ, ë‹¤ì‹œ ì½ì–´ë³´ì.',
        validate: i => i.replace(/\s/g,'') === 'ì„œëì—´ì–´ê³ ' || i.replace(/\s/g,'') === 'ì„œëì„ì—´ì–´' },
      { type:'cpq', cpqIndex:0,
        story: `ì •ë‹µì´ë‹¤. í¬ìŠ¤íŠ¸ì‡ ë’·ë©´ì— ìˆ¨ê²¨ì§„ ê¸€ìê°€ ë“œëŸ¬ë‚œë‹¤. "ì„œëì„ ì—´ì–´ë¼."

ì±…ìƒ ì„œëì„ ë‹¹ê¸°ì, ì•ˆì—ëŠ” ì˜ì™¸ì˜ ë¬¼ê±´ì´ ë“¤ì–´ìˆë‹¤. íƒë°° ì˜ìˆ˜ì¦ í•œ ì¥. ë°°ì†¡ ë‚ ì§œëŠ” êµìˆ˜ê°€ ì‹¤ì¢…ë˜ê¸° ì´í‹€ ì „ì´ë‹¤. ì˜ìˆ˜ì¦ì—ëŠ” ìˆ˜ì‹ ì¸ì´ êµìˆ˜ ë³¸ì¸ìœ¼ë¡œ ë˜ì–´ìˆì§€ë§Œ, ë°°ì†¡ì§€ ì£¼ì†Œê°€ ìíƒì´ ì•„ë‹ˆë¼ ë‚¯ì„  ê³³ì´ë‹¤.

ì˜ìˆ˜ì¦ ì˜†ì— êµìˆ˜ê°€ ë¹¨ê°„ íœìœ¼ë¡œ ì ì–´ë†“ì€ ë©”ëª¨ê°€ ìˆë‹¤.
"ì´ê³³ê¹Œì§€ì˜ ê±°ë¦¬ë¥¼ í™•ì¸í•  ê²ƒ. ë„ë³´ ê¸°ì¤€."

êµìˆ˜ê°€ ì´ ì¥ì†Œë¥¼ ì§ì ‘ ë°©ë¬¸í•˜ë ¤ í–ˆë˜ ê²ƒ ê°™ë‹¤. ì˜ìˆ˜ì¦ì— ì íŒ ì •ë³´ë¥¼ ì¶”ì í•´ì•¼ í•œë‹¤.`,
        storyAfter: `ê±¸ìŒ ìˆ˜ë¥¼ í™•ì¸í–ˆë‹¤. ì˜ìˆ˜ì¦ ë’·ë©´ì„ ë’¤ì§‘ìœ¼ë‹ˆ êµìˆ˜ê°€ ì—°í•„ë¡œ íë¦¿í•˜ê²Œ ì ì–´ë‘” ë©”ëª¨ê°€ ë³´ì¸ë‹¤.

"ë‘ ë²ˆì§¸ ë‹¨ì„œëŠ” ë²½ì— ìˆë‹¤."

êµìˆ˜ëŠ” ì²´ê³„ì ìœ¼ë¡œ ë‹¨ì„œë¥¼ ë‚¨ê²¨ë‘” ê²ƒì´ë‹¤. ë§ˆì¹˜ ëˆ„êµ°ê°€ ìì‹ ì„ ë’¤ë”°ë¼ì˜¤ê¸¸ ì›í–ˆë˜ ê²ƒì²˜ëŸ¼... ë²½ë©´ì„ ì‚´í´ë³´ì.` },
      { type:'general', title:'ğŸ”¢ í¼ì¦ 3: ë²½ ì†ì˜ ê¸ˆê³ ',
        story: `ë²½ë©´ì˜ ì±…ì¥ì„ í•˜ë‚˜ì”© ì‚´í´ë³¸ë‹¤. ì„¸ ë²ˆì§¸ ì¹¸ì—ì„œ ì´ìƒí•œ ì ì„ ë°œê²¬í–ˆë‹¤. ì±…ë“¤ ì‚¬ì´ì— ë¹ˆ ê³µê°„ì´ ìˆê³ , ê·¸ ë’¤ì— ì‘ì€ ê¸ˆê³ ê°€ ìˆ¨ê²¨ì ¸ ìˆë‹¤.

ê¸ˆê³ ì—ëŠ” 4ìë¦¬ ìˆ«ìë¥¼ ì…ë ¥í•˜ëŠ” ë‹¤ì´ì–¼ì´ ë‹¬ë ¤ìˆë‹¤. ê¸ˆê³  ìœ„ì— ë„¤ ê¶Œì˜ ì±…ì´ ë‚˜ë€íˆ ê½‚í˜€ìˆë‹¤. êµìˆ˜ê°€ ì˜ë„ì ìœ¼ë¡œ ë°°ì¹˜í•œ ê²ƒ ê°™ë‹¤.

<b>ğŸ“• "ë¡œë§ˆì˜ ì¼ê³± ì–¸ë•" â€” 263í˜ì´ì§€
ğŸ“— "ì´ì§‘íŠ¸ ì œ5ì™•ì¡°" â€” 178í˜ì´ì§€
ğŸ“˜ "ê·¸ë¦¬ìŠ¤ 12ì‹ " â€” 412í˜ì´ì§€
ğŸ“™ "í•œêµ­ì˜ ì‚¼êµ­ì‹œëŒ€" â€” 95í˜ì´ì§€</b>

ê¸ˆê³  ì˜†ì— ë©”ëª¨:
"ê° ì±… ì œëª©ì— ìˆ¨ê²¨ì§„ ìˆ«ìê°€ ë¹„ë°€ë²ˆí˜¸ë‹¤. í˜ì´ì§€ ìˆ˜ì— ì†ì§€ ë§ˆë¼."`,
        question: `êµìˆ˜ì˜ ë©”ëª¨ë¥¼ í•´ì„í•˜ë¼.

ê° ì±… <b>ì œëª©</b> ì†ì— ìˆ¨ê²¨ì§„ ìˆ«ìë¥¼ ìˆœì„œëŒ€ë¡œ ë‚˜ì—´í•˜ë©´?

ğŸ“• ë¡œë§ˆì˜ <b>ì¼ê³±</b> ì–¸ë•
ğŸ“— ì´ì§‘íŠ¸ ì œ<b>5</b>ì™•ì¡°
ğŸ“˜ ê·¸ë¦¬ìŠ¤ <b>12</b>ì‹ 
ğŸ“™ í•œêµ­ì˜ <b>ì‚¼êµ­</b>ì‹œëŒ€

(íŒíŠ¸: ìˆ«ìë¥¼ ì•„ë¼ë¹„ì•„ ìˆ«ìë¡œ ë³€í™˜)`,
        hint: 'ì¼ê³±=7, 5=5, 12=12, ì‚¼êµ­=3 â†’ 4ìë¦¬ ìˆ«ìë¡œ...',
        validate: i => i.replace(/\s/g,'') === '75123' || i.replace(/\s/g,'') === '7-5-12-3' || i.replace(/\s/g,'').includes('75123') },
      { type:'cpq', cpqIndex:1,
        story: `ê¸ˆê³ ê°€ ì—´ë ¸ë‹¤. ì•ˆì—ëŠ” êµìˆ˜ì˜ ë¹„ë°€ ìˆ˜ì²©ì´ ìˆë‹¤. ê°€ì£½ í‘œì§€ì— "PRIVATE"ì´ë¼ê³  ê°ì¸ë˜ì–´ ìˆë‹¤.

ìˆ˜ì²©ì„ ë„˜ê¸°ì, ìµœê·¼ ëª‡ í˜ì´ì§€ì— ì§‘ì¤‘ì ìœ¼ë¡œ ë©”ëª¨ê°€ ì í˜€ìˆë‹¤. ë‚ ì§œë³„ë¡œ ì •ë¦¬ëœ ê¸°ë¡ì¸ë°, êµìˆ˜ê°€ ì–´ë–¤ ì¥ì†Œë“¤ì„ ì²´ê³„ì ìœ¼ë¡œ ì¡°ì‚¬í•˜ê³  ìˆì—ˆë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

ë§ˆì§€ë§‰ í˜ì´ì§€ì— ë˜ ë‹¤ë¥¸ ì¥ì†Œê°€ ì í˜€ìˆë‹¤. ë¹¨ê°„ ë™ê·¸ë¼ë¯¸ê°€ ì³ì ¸ ìˆê³ , ì˜†ì— "ì—¬ê¸°ê°€ í•µì‹¬"ì´ë¼ê³  ì í˜€ìˆë‹¤.

"ì´ ì¥ì†Œì˜ ë„ë³´ ê±°ë¦¬ë„ í™•ì¸í•´ì•¼ í•œë‹¤."

êµìˆ˜ì˜ ë™ì„ ì„ ì™„ì „íˆ íŒŒì•…í•˜ë ¤ë©´ ì´ê³³ë„ ì¶”ì í•´ì•¼ í•œë‹¤.`,
        storyAfter: `ë‘ ë²ˆì§¸ ì¥ì†Œì˜ ê±¸ìŒ ìˆ˜ê¹Œì§€ í™•ì¸í–ˆë‹¤. ìˆ˜ì²© ë§ˆì§€ë§‰ ì¥ì— êµìˆ˜ê°€ ë‚¨ê¸´ ê²°ë¡ ì´ ë³´ì¸ë‹¤.

"ëª¨ë“  ë‹¨ì„œë¥¼ ëª¨ì•˜ë‹¤ë©´, ë¬¸ ì˜† íŒ¨ë„ì„ í™•ì¸í•˜ë¼. ì½”ë“œëŠ” ë‚´ê°€ ì´ ë°©ì—ì„œ ê°€ì¥ ì†Œì¤‘íˆ ì—¬ê¸´ ê²ƒë“¤ ì†ì— ìˆë‹¤."

êµìˆ˜ëŠ” ì´ ì„œì¬ ìì²´ë¥¼ í•˜ë‚˜ì˜ í¼ì¦ë¡œ ì„¤ê³„í•´ë‘” ê²ƒì´ë‹¤. íƒˆì¶œì˜ ì‹¤ë§ˆë¦¬ê°€ ë³´ì´ê¸° ì‹œì‘í•œë‹¤.` },
      { type:'general', title:'ğŸšª í¼ì¦ 5: ìµœì¢… íƒˆì¶œ',
        story: `ë¬¸ ì˜†ì„ ì‚´í´ë³´ë‹ˆ, ë²½ì§€ ë’¤ì— ìˆ¨ê²¨ì§„ ë””ì§€í„¸ íŒ¨ë„ì´ ìˆë‹¤.

íŒ¨ë„ì—ëŠ” ì´ìƒí•œ í™”ë©´ì´ ë– ìˆë‹¤. êµìˆ˜ê°€ ë§Œë“  ê²ƒ ê°™ì€ í”„ë¡œê·¸ë¨ì´ë‹¤. í™”ë©´ì— ë„¤ ëª…ì˜ ìºë¦­í„°ê°€ í‘œì‹œë˜ì–´ ìˆë‹¤.

<b>ğŸ‘¤ A: "Bê°€ ë²”ì¸ì´ë‹¤"
ğŸ‘¤ B: "ë‚˜ëŠ” ê²°ë°±í•˜ë‹¤"
ğŸ‘¤ C: "DëŠ” ê±°ì§“ë§ì„ í•˜ê³  ìˆë‹¤"
ğŸ‘¤ D: "Aê°€ ë²”ì¸ì´ë‹¤"</b>

ì•„ë˜ì— ê·œì¹™ì´ ì í˜€ìˆë‹¤:
<b>"ë²”ì¸ì€ ì •í™•íˆ í•œ ëª…. ë²”ì¸ë§Œ ê±°ì§“ë§ì„ í•œë‹¤. ë‚˜ë¨¸ì§€ëŠ” ëª¨ë‘ ì§„ì‹¤ì„ ë§í•œë‹¤."</b>

íŒ¨ë„ì— ë²”ì¸ì˜ ì•ŒíŒŒë²³ì„ ì…ë ¥í•˜ë©´ ë¬¸ì´ ì—´ë¦°ë‹¤.`,
        question: `ë…¼ë¦¬ í¼ì¦ì„ í’€ì–´ë¼.

ë²”ì¸ì€ í•œ ëª…ì´ê³ , ë²”ì¸ë§Œ ê±°ì§“ë§ì„ í•œë‹¤.

ğŸ‘¤ A: "Bê°€ ë²”ì¸ì´ë‹¤"
ğŸ‘¤ B: "ë‚˜ëŠ” ê²°ë°±í•˜ë‹¤"
ğŸ‘¤ C: "DëŠ” ê±°ì§“ë§ì„ í•˜ê³  ìˆë‹¤"
ğŸ‘¤ D: "Aê°€ ë²”ì¸ì´ë‹¤"

ë²”ì¸ì€ ëˆ„êµ¬ì¸ê°€? (A, B, C, D ì¤‘ í•˜ë‚˜)`,
        hint: 'Bê°€ ë²”ì¸ì´ë¼ê³  ê°€ì •í•˜ë©´? Bì˜ "ë‚˜ëŠ” ê²°ë°±í•˜ë‹¤"ëŠ” ê±°ì§“(OK). Aì˜ "Bê°€ ë²”ì¸"ì€ ì§„ì‹¤(OK). Dì˜ "Aê°€ ë²”ì¸"ì€ ê±°ì§“ì´ ë˜ëŠ”ë°... DëŠ” ë²”ì¸ì´ ì•„ë‹ˆë‹ˆ ì§„ì‹¤ë§Œ ë§í•´ì•¼ í•œë‹¤. ëª¨ìˆœ! ë‹¤ë¥¸ ê²½ìš°ë¥¼ ì‹œë„í•´ë³´ì.',
        validate: i => i.toUpperCase().replace(/\s/g,'') === 'A' }
    ]
  },
  {
    id: 'ship', emoji: 'ğŸš¢', name: 'í‘œë¥˜ëœ í™”ë¬¼ì„ ',
    desc: 'ë™í•´ì•ˆì— í‘œë¥˜í•œ ë¬´ì¸ í™”ë¬¼ì„ . 12ëª…ì˜ ì„ ì›ì€ í”ì ë„ ì—†ì´ ì‚¬ë¼ì¡Œë‹¤. ì§„ì‹¤ì„ ë°íˆê³  íƒˆì¶œí•˜ë¼.',
    difficulty: 2, time: '15ë¶„',
    intro: `ë™í•´ì•ˆì— ë– ë°€ë ¤ì˜¨ í™”ë¬¼ì„  "ë™í•´í˜¸". 12ëª…ì˜ ì„ ì›ì€ í”ì ë„ ì—†ì´ ì‚¬ë¼ì¡Œë‹¤. êµ¬ëª…ë³´íŠ¸ë„, ê°œì¸ ë¬¼í’ˆë„ ê·¸ëŒ€ë¡œ. í•´ì–‘ê²½ì°°ì¸ ë‹¹ì‹ ì´ ì¡°ì‚¬ë¥¼ ìœ„í•´ ë°°ì— ì˜¬ëì§€ë§Œ, ê°‘íŒ í•´ì¹˜ê°€ ë‹«íˆë©° ê°‡í˜”ë‹¤. ë¹„ìƒë“±ë§Œ ê¹œë¹¡ì´ëŠ” ë°° ì•ˆì—ì„œ ë¬´ì „ê¸°ì˜ ì˜ë¯¸ ë¶ˆëª… ì‹ í˜¸ìŒë§Œ ë°˜ë³µëœë‹¤. ì„ ì›ë“¤ì—ê²Œ ë¬´ìŠ¨ ì¼ì´ ì¼ì–´ë‚¬ëŠ”ì§€ ë°íˆê³ , í•´ì¹˜ë¥¼ ì—´ì–´ íƒˆì¶œí•˜ë¼.`,
    puzzles: [
      { type:'general', title:'ğŸ§­ í¼ì¦ 1: í•­í•´ ì¼ì§€ì˜ ë§ˆì§€ë§‰ ê¸°ë¡',
        story: `ì„ ì¥ì‹¤ì— ë“¤ì–´ì„°ë‹¤. í…Œì´ë¸” ìœ„ì— í•­í•´ ì¼ì§€ê°€ í¼ì³ì ¸ ìˆë‹¤. ë§ˆì§€ë§‰ ê¸°ë¡ ë‚ ì§œëŠ” ì‚¬í˜ ì „.

ì¼ì§€ì˜ ëŒ€ë¶€ë¶„ì€ í‰ë²”í•œ í•­í•´ ê¸°ë¡ì´ë‹¤. ë§ˆì§€ë§‰ ê¸°ë¡:

"2ì›” 11ì¼ 23:47 â€” ë ˆì´ë”ì— ì´ìƒ ë°˜ì‘. ì„ ì›ë“¤ì´ ê°‘íŒì—ì„œ ì†Œë¦¬ë¥¼ ë“¤ì—ˆë‹¤ê³  ë³´ê³ . í™•ì¸í•˜ëŸ¬ ê°„ë‹¤. ê¸ˆê³ ì— ì£¼íŒŒìˆ˜ ê¸°ë¡ì„ ë„£ì–´ë’€ë‹¤."

ì„ ì¥ì‹¤ ê¸ˆê³ ì— ë­”ê°€ ìˆì„ ê²ƒì´ë‹¤. ê¸ˆê³  ìœ„ì— ì„¸ ê¶Œì˜ ì±…ì´ ì˜ë„ì ìœ¼ë¡œ ë°°ì¹˜ë˜ì–´ ìˆê³ , ê° ì±…ì— í¬ìŠ¤íŠ¸ì‡ì´ ê½‚í˜€ìˆë‹¤. í‘œì‹œëœ í˜ì´ì§€ë¥¼ ì—´ë©´ í˜•ê´‘íœìœ¼ë¡œ ì¹ í•´ì§„ ë‹¨ì–´ê°€ ë³´ì¸ë‹¤.`,
        question: `ì„ ì¥ì‹¤ ê¸ˆê³  ìœ„ì— ì±… ì„¸ ê¶Œì´ ë†“ì—¬ìˆê³  ê°ê° í¬ìŠ¤íŠ¸ì‡ì´ ê½‚í˜€ìˆë‹¤.

<b>ğŸ“• "í•´ì–‘ë²• ê°œë¡ " â†’ í‘œì‹œëœ ë‹¨ì–´: "ëŒ€í•œë¯¼êµ­"
ğŸ“— "í•­í•´ìˆ ì˜ ì—­ì‚¬" â†’ í‘œì‹œëœ ë‹¨ì–´: "ë‚˜ì¹¨ë°˜"
ğŸ“˜ "ì„ ë°• êµ¬ì¡°í•™" â†’ í‘œì‹œëœ ë‹¨ì–´: "ìš©ê³¨"</b>

ê¸ˆê³  ë©”ëª¨: "ê° ë‹¨ì–´ì˜ ê¸€ì ìˆ˜ê°€ ë¹„ë°€ë²ˆí˜¸ë‹¤."

ì„¸ ìˆ«ìë¥¼ ìˆœì„œëŒ€ë¡œ ì´ì–´ì„œ ì…ë ¥í•˜ì‹œì˜¤.`,
        hint: 'ëŒ€í•œë¯¼êµ­ = 4ê¸€ì, ë‚˜ì¹¨ë°˜ = 3ê¸€ì, ìš©ê³¨ = 2ê¸€ì',
        validate: i => i.replace(/\s/g,'') === '432' },
      { type:'cpq', cpqIndex:0,
        story: `"HELP." ì„ ì¥ì˜ ë§ˆì§€ë§‰ ë©”ì‹œì§€ì˜€ë‹¤.

í•­í•´ ì¼ì§€ë¥¼ ë” ë„˜ê²¨ë³´ë‹ˆ, ì ‘í˜€ìˆë˜ í˜ì´ì§€ ì‚¬ì´ì—ì„œ ì¢…ì´ í•œ ì¥ì´ ë–¨ì–´ì§„ë‹¤. í™”ë¬¼ ì í•˜ ëª©ë¡ì´ë‹¤. ëŒ€ë¶€ë¶„ì˜ í™”ë¬¼ì€ ì¼ë°˜ ê³µì‚°í’ˆì´ì§€ë§Œ, í•œ í•­ëª©ì— ë¹¨ê°„ ì¤„ì´ ê·¸ì–´ì ¸ ìˆë‹¤.

"íŠ¹ìˆ˜ í™”ë¬¼ #7 â€” ë°œì†¡ì§€ í™•ì¸ ìš”ë§"

ì„ ì¥ì€ ì´ í™”ë¬¼ì˜ ì¶œì²˜ë¥¼ ì¶”ì í•˜ê³  ìˆì—ˆë‹¤. ì í•˜ ëª©ë¡ì— ì íŒ ë°œì†¡ì§€ ì£¼ì†Œ ì˜†ì— ë„¤ì´ë²„ ê²€ìƒ‰ ê¸°ë¡ ë©”ëª¨ê°€ ìˆë‹¤.

"ì´ ì¥ì†Œë¥¼ ì§ì ‘ í™•ì¸í•´ì•¼ í•œë‹¤. ë„ë³´ ê±°ë¦¬ ì¸¡ì •í•  ê²ƒ."

ì„ ì› ì‹¤ì¢…ê³¼ ì´ í™”ë¬¼ ì‚¬ì´ì— ë¬´ìŠ¨ ê´€ê³„ê°€ ìˆëŠ” ê±¸ê¹Œ?`,
        storyAfter: `ê±¸ìŒ ìˆ˜ë¥¼ í™•ì¸í–ˆë‹¤. ì í•˜ ëª©ë¡ ë’·ë©´ì— ì„ ì¥ì˜ ì¶”ê°€ ë©”ëª¨ê°€ ìˆë‹¤.

"í™”ë¬¼ #7ì˜ ì¶œì²˜ë¥¼ í™•ì¸í–ˆë‹¤. ë‘ ë²ˆì§¸ ì¥ì†Œë„ ì—°ê²°ë˜ì–´ ìˆë‹¤. ê¸°ê´€ì‹¤ì— ë” ë§ì€ ê¸°ë¡ì´ ìˆë‹¤."

ê¸°ê´€ì‹¤ë¡œ ì´ë™í•˜ì.` },
      { type:'general', title:'âš“ í¼ì¦ 3: ê¸°ê´€ì‹¤ì˜ ëª¨ìŠ¤ ë¶€í˜¸',
        story: `ì¢ì€ í†µë¡œë¥¼ ì§€ë‚˜ ê¸°ê´€ì‹¤ì— ë„ì°©í–ˆë‹¤. ê±°ëŒ€í•œ ì—”ì§„ì€ ì™„ì „íˆ ë©ˆì¶°ìˆë‹¤. ì—°ë£ŒëŠ” ì¶©ë¶„íˆ ë‚¨ì•„ìˆëŠ”ë°, ëˆ„êµ°ê°€ ì˜ë„ì ìœ¼ë¡œ ì—”ì§„ì„ ì •ì§€ì‹œí‚¨ ê²ƒ ê°™ë‹¤.

ê¸°ê´€ì‹¤ ë²½ì— ë°°ì „ë°˜ì´ ìˆë‹¤. 12ê°œì˜ ìŠ¤ìœ„ì¹˜ê°€ ë‘ ì¤„ë¡œ ë°°ì—´ë˜ì–´ ìˆë‹¤. ì¼ë¶€ëŠ” ìœ„(ON), ì¼ë¶€ëŠ” ì•„ë˜(OFF) ìƒíƒœë‹¤.

<b>ìœ„ ì•„ë˜ ì•„ë˜ ìœ„ | ì•„ë˜ ìœ„ ì•„ë˜ ì•„ë˜ | ì•„ë˜ ì•„ë˜ ìœ„ ìœ„</b>

ë°°ì „ë°˜ ì˜†ì— ê¸°ê´€ì¥ì˜ ë©”ëª¨:
"ì´ì§„ë²•ì´ë‹¤. ìœ„=1, ì•„ë˜=0. 4ìë¦¬ì”© ëŠì–´ì„œ ì‹­ì§„ìˆ˜ë¡œ ë³€í™˜í•˜ë©´ ë‚´ ì‚¬ë¬¼í•¨ ë²ˆí˜¸ê°€ ë‚˜ì˜¨ë‹¤."`,
        question: `ë°°ì „ë°˜ì˜ ì´ì§„ë²•ì„ í•´ë…í•˜ë¼.

<b>1001 | 0100 | 0011</b>
(ìœ„ì•„ë˜ì•„ë˜ìœ„ | ì•„ë˜ìœ„ì•„ë˜ì•„ë˜ | ì•„ë˜ì•„ë˜ìœ„ìœ„)

ê° 4ìë¦¬ ì´ì§„ìˆ˜ë¥¼ ì‹­ì§„ìˆ˜ë¡œ ë³€í™˜í•˜ë©´?
(ì„¸ ìˆ«ìë¥¼ ì´ì–´ì„œ ì…ë ¥. ì˜ˆ: "123")`,
        hint: '1001(2ì§„) = 8+0+0+1 = 9, 0100(2ì§„) = 0+4+0+0 = 4, 0011(2ì§„) = 0+0+2+1 = 3',
        validate: i => i.replace(/\s/g,'') === '943' },
      { type:'cpq', cpqIndex:1,
        story: `SOS. ì´ ë°°ëŠ” ì¡°ë‚œ ìƒíƒœë‹¤. í•˜ì§€ë§Œ ëˆ„ê°€ ì´ ì‹ í˜¸ë¥¼ ì„¤ì •í–ˆì„ê¹Œ?

ë¬´ì „ê¸° ì•„ë˜ ì„œëì„ ì—´ì, ê¸°ê´€ì¥ì˜ ê°œì¸ ë…¸íŠ¸ê°€ ë‚˜ì™”ë‹¤. ê¸°ê´€ì¥ ë°•ì² ìˆ˜, 53ì„¸. ë…¸íŠ¸ì—ëŠ” ì¼ìƒì ì¸ ì •ë¹„ ê¸°ë¡ ì‚¬ì´ì— ìˆ˜ìƒí•œ ë©”ëª¨ê°€ ë¼ì›Œì ¸ ìˆë‹¤.

"ì„ ì¥ì´ í™”ë¬¼ #7ì„ ì¡°ì‚¬í•˜ê³  ìˆë‹¤. ë‚˜ë„ ë…ìì ìœ¼ë¡œ ì¶œì²˜ë¥¼ ì¶”ì  ì¤‘. ì•„ë˜ ì¥ì†Œì™€ ì—°ê²°ê³ ë¦¬ê°€ ìˆëŠ” ê²ƒ ê°™ë‹¤."

ê¸°ê´€ì¥ë„ ê°™ì€ ê²ƒì„ ì¶”ì í•˜ê³  ìˆì—ˆë‹¤. ê·¸ì˜ ë©”ëª¨ì— ì íŒ ë˜ ë‹¤ë¥¸ ì¥ì†Œë¥¼ í™•ì¸í•´ì•¼ í•œë‹¤.`,
        storyAfter: `ë‘ ë²ˆì§¸ ì¥ì†Œì˜ ì •ë³´ê¹Œì§€ í™•ì¸í–ˆë‹¤. ê¸°ê´€ì¥ì˜ ë…¸íŠ¸ ë§ˆì§€ë§‰ í˜ì´ì§€ì— ê¸‰í•˜ê²Œ ì ì€ ë©”ì‹œì§€ê°€ ìˆë‹¤.

"2ì›” 11ì¼ 23:50 â€” ê°‘íŒì—ì„œ ì´ìƒí•œ ë¹›. ì„ ì›ë“¤ì´ í•˜ë‚˜ë‘˜ ì˜¬ë¼ê°€ê³  ìˆë‹¤. ë‚˜ë„ í™•ì¸í•˜ëŸ¬... í•´ì¹˜ ë¹„ìƒ ì ê¸ˆ ì½”ë“œë¥¼ ë‚¨ê¸´ë‹¤. ëˆ„êµ°ê°€ ì´ê²ƒì„ ì°¾ëŠ”ë‹¤ë©´..."

ì—¬ê¸°ì„œ ê¸°ë¡ì´ ëŠê¸´ë‹¤. í•˜ì§€ë§Œ í•´ì¹˜ ì ê¸ˆ ì½”ë“œì— ëŒ€í•œ ë‹¨ì„œë¥¼ ë‚¨ê²¼ë‹¤. ë‹¤ì‹œ ê°‘íŒìœ¼ë¡œ ëŒì•„ê°€ì.` },
      { type:'general', title:'ğŸšª í¼ì¦ 5: í•´ì¹˜ í•´ì œ',
        story: `ê°‘íŒìœ¼ë¡œ ëŒì•„ì™”ë‹¤. í•´ì¹˜ ì ê¸ˆ ì¥ì¹˜ ì˜†ì— ê¸°ê´€ì¥ì´ í…Œì´í”„ë¡œ ë¶™ì—¬ë‘” ìª½ì§€ê°€ ìˆë‹¤. ëë¶€ë¶„ì´ ì°¢ì–´ì ¸ ìˆì§€ë§Œ, ì½ì„ ìˆ˜ ìˆë‹¤.

"ì½”ë“œëŠ” ìˆ˜ìˆ˜ê»˜ë¼ë¡œ ë‚¨ê¸´ë‹¤. í˜¹ì‹œ ê·¸ë“¤ì´... ì•„ë‹ˆ, ëˆ„êµ¬ë“  ì´ê±¸ ì½ëŠ” ì‚¬ëŒì´ ì¸ê°„ì¸ì§€ í™•ì¸í•˜ê¸° ìœ„í•´."

ê·¸ ì•„ë˜ì— ìˆ˜ìˆ˜ê»˜ë¼ê°€ ì í˜€ìˆë‹¤.

ê¸°ê´€ì¥ì€ ë§ˆì§€ë§‰ ìˆœê°„ê¹Œì§€ ì´ì„±ì ì´ì—ˆë‹¤. í•´ì¹˜ë¥¼ ì ê·¸ê³ , ì½”ë“œë¥¼ ë‚¨ê¸°ê³ , ìì‹ ì€... ë‹¤ë¥¸ ì„ ì›ë“¤ê³¼ í•¨ê»˜ ì‚¬ë¼ì¡Œë‹¤.`,
        question: `ê¸°ê´€ì¥ì˜ ë§ˆì§€ë§‰ í¼ì¦:

<b>ì„¸ ëª…ì˜ ì„ ì›ì´ ë‹¹ì§ ìˆœì„œë¥¼ ì •í–ˆë‹¤.
- ê¹€ ì¼ë“±í•­í•´ì‚¬ëŠ” ë°• ê¸°ê´€ì¥ë³´ë‹¤ ë¨¼ì € ê·¼ë¬´í•œë‹¤.
- ì´ ê°‘íŒì¥ì€ ì²« ë²ˆì§¸ë¡œ ê·¼ë¬´í•˜ì§€ ì•ŠëŠ”ë‹¤.
- ë°• ê¸°ê´€ì¥ì€ ë§ˆì§€ë§‰ìœ¼ë¡œ ê·¼ë¬´í•˜ì§€ ì•ŠëŠ”ë‹¤.</b>

í•´ì¹˜ ì½”ë“œ = ê° ì„ ì›ì˜ ê·¼ë¬´ ìˆœì„œ
(ì˜ˆ: ê¹€=1, ì´=2, ë°•=3ì´ë©´ "ê¹€ì´ë°•")

<b>ê·¼ë¬´ ìˆœì„œë¥¼ "ì„±"ë§Œ ì¨ì„œ ìˆœì„œëŒ€ë¡œ ì…ë ¥í•˜ì‹œì˜¤.</b>`,
        hint: 'ë°•ì´ ë§ˆì§€ë§‰ì´ ì•„ë‹ˆê³ , ê¹€ì´ ë°•ë³´ë‹¤ ë¨¼ì €. ê¹€=1ì´ë©´ ë°•=2(ë§ˆì§€ë§‰ ì•„ë‹˜ OK). ì´=3. ì´ ê°‘íŒì¥ì´ ì²« ë²ˆì§¸ ì•„ë‹Œ ê²ƒë„ OK.',
        validate: i => i.replace(/\s/g,'') === 'ê¹€ë°•ì´' }
    ]
  },
  {
    id: 'hotel', emoji: 'ğŸ¨', name: 'í˜¸í…” ë¯¸ìŠ¤í„°ë¦¬',
    desc: '5ì„±ê¸‰ í˜¸í…”ì˜ VIPê°€ ì²´í¬ì¸ ì§í›„ ì‚¬ë¼ì¡Œë‹¤. 1408í˜¸ì— ë‚¨ì€ í”ì ì„ ì¶”ì í•˜ë¼.',
    difficulty: 3, time: '15ë¶„',
    intro: `5ì„±ê¸‰ ê·¸ëœë“œ íŒŒí¬ í˜¸í…”. IT ê¸°ì—… ëŒ€í‘œ ë°•ì¤€í˜¸ê°€ ì²´í¬ì¸ 47ë¶„ í›„ ì‚¬ë¼ì¡Œë‹¤. CCTVì—ëŠ” 1408í˜¸ì— ë“¤ì–´ê°„ ê²ƒì´ ë§ˆì§€ë§‰, ì´í›„ ì–´ë””ì—ë„ ê·¸ì˜ ëª¨ìŠµì´ ì—†ë‹¤. ì§ë„ ì—¬ê¶Œë„ ê·¸ëŒ€ë¡œ. ë³´ì•ˆíŒ€ì¥ì¸ ë‹¹ì‹ ì´ ë°©ì— ë“¤ì–´ì„°ì§€ë§Œ, ì „ì ì ê¸ˆì¥ì¹˜ ì—ëŸ¬ë¡œ ë¬¸ì´ ì ê²¼ë‹¤. ìŠ¤ìœ„íŠ¸ë£¸ ê³³ê³³ì— ë­”ê°€ ì´ìƒí•œ í”ì ë“¤ì´ ë³´ì¸ë‹¤. ë°•ì¤€í˜¸ì˜ ë¹„ë°€ì„ í’€ê³  íƒˆì¶œí•˜ë¼.`,
    puzzles: [
      { type:'general', title:'ğŸ”‘ í¼ì¦ 1: íˆ¬ìˆ™ê°ì˜ ë…¸íŠ¸ë¶',
        story: `ì—…ë¬´ìš© ì±…ìƒìœ¼ë¡œ ë‹¤ê°€ê°„ë‹¤. ë…¸íŠ¸ë¶ì´ ì—´ë ¤ìˆê³ , í™”ë©´ì´ ì ê¸ˆ ìƒíƒœë‹¤. ë¹„ë°€ë²ˆí˜¸ íŒíŠ¸ê°€ í™”ë©´ì— í‘œì‹œë˜ì–´ ìˆë‹¤.

ë…¸íŠ¸ë¶ ì˜†ì— í˜¸í…” ë©”ëª¨ì§€ê°€ ìˆë‹¤. ë°•ì¤€í˜¸ì˜ ê¸€ì”¨ë¡œ ëª‡ ê°€ì§€ ìˆ«ìê°€ ì í˜€ìˆë‹¤.

"1408 â€” ì´ ìˆ«ìê°€ ë¶ˆê¸¸í•˜ë‹¤. ìŠ¤í‹°ë¸ í‚¹ì˜ ì†Œì„¤ ì œëª©ì´ê¸°ë„ í•˜ì§€. í•˜ì§€ë§Œ ìˆ«ì ìì²´ì— ë‹µì´ ìˆë‹¤."

ë¹„ë°€ë²ˆí˜¸ íŒíŠ¸:
"ë°© ë²ˆí˜¸ 1408ì—ì„œ, ê°€ì¥ í° ìˆ«ìì™€ ê°€ì¥ ì‘ì€ ìˆ«ìì˜ ì°¨ì´"

ë°•ì¤€í˜¸ëŠ” ë³´ì•ˆì— ë¯¼ê°í•œ ì‚¬ëŒì´ì—ˆë‹¤. ë‹¨ìˆœí•˜ì§€ë§Œ ì¦‰ì„ì—ì„œ ë§Œë“  ë¹„ë°€ë²ˆí˜¸ì¸ ê²ƒ ê°™ë‹¤.`,
        question: `ë…¸íŠ¸ë¶ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ë¼.

í™”ë©´ì— ì´ëª¨ì§€ ìˆ˜ì‹ì´ í‘œì‹œë˜ì–´ ìˆë‹¤:

<b>ğŸ¨ + ğŸ¨ = 28
ğŸ”‘ Ã— ğŸ”‘ = 16
ğŸ¨ - ğŸ”‘ = ?</b>

? ì— ë“¤ì–´ê°ˆ ìˆ«ìëŠ”?`,
        hint: 'ğŸ¨+ğŸ¨=28ì´ë©´ ğŸ¨=14. ğŸ”‘Ã—ğŸ”‘=16ì´ë©´ ğŸ”‘=4. 14-4=?',
        validate: i => i.trim()==='10' },
      { type:'cpq', cpqIndex:0,
        story: `ë…¸íŠ¸ë¶ì´ ì—´ë ¸ë‹¤. ë¸Œë¼ìš°ì €ì— ìµœê·¼ ê²€ìƒ‰ ê¸°ë¡ì´ ë‚¨ì•„ìˆë‹¤. ëŒ€ë¶€ë¶„ M&A ê´€ë ¨ ìë£Œì§€ë§Œ, ë§ˆì§€ë§‰ ê²€ìƒ‰ì´ ì´ìƒí•˜ë‹¤. ë¹„ì¦ˆë‹ˆìŠ¤ì™€ ì „í˜€ ê´€ë ¨ ì—†ëŠ” ì¥ì†Œë¥¼ ê²€ìƒ‰í–ˆë‹¤.

ê²€ìƒ‰ ì‹œê°„ì€ ì²´í¬ì¸ í›„ ì•½ 30ë¶„ ë’¤. ì‚¬ë¼ì§€ê¸° 17ë¶„ ì „ì´ë‹¤.

ê²€ìƒ‰ ê¸°ë¡ ì˜†ì— ë©”ëª¨ ì•±ì´ ì—´ë ¤ìˆë‹¤.
"ì˜¤ëŠ˜ ë°¤ ì´ê³³ì„ í™•ì¸í•´ì•¼ í•œë‹¤. ë„ë³´ë¡œ ê°ˆ ìˆ˜ ìˆëŠ” ê±°ë¦¬ì¸ì§€ ì²´í¬."

ë°•ì¤€í˜¸ëŠ” í˜¸í…”ì— ë„ì°©í•˜ìë§ˆì ì´ ì¥ì†Œë¥¼ ê²€ìƒ‰í–ˆë‹¤. ì™œ? M&Aì™€ ê´€ë ¨ì´ ìˆëŠ” ê±¸ê¹Œ, ì•„ë‹ˆë©´ ì™„ì „íˆ ë‹¤ë¥¸ ì´ìœ ì¼ê¹Œ?`,
        storyAfter: `ê±¸ìŒ ìˆ˜ë¥¼ í™•ì¸í–ˆë‹¤. ë…¸íŠ¸ë¶ì˜ ë©”ëª¨ ì•±ì— ì¶”ê°€ ë‚´ìš©ì´ ìˆë‹¤.

"ê±°ë¦¬ í™•ì¸ ì™„ë£Œ. ìš•ì‹¤ì„ í™•ì¸í•˜ë¼. ê±°ìš¸ ë’¤ì— ì§„ì‹¤ì´ ìˆë‹¤."

ì´ê²ƒì€ ë°•ì¤€í˜¸ ìì‹ ì´ ì ì€ ê²ƒì´ ì•„ë‹ˆë‹¤. ê¸€ì”¨ì²´ê°€ ë‹¤ë¥´ë‹¤. ëˆ„êµ°ê°€ ê·¸ì˜ ë…¸íŠ¸ë¶ì— ë©”ì‹œì§€ë¥¼ ë‚¨ê²¼ë‹¤... ìš•ì‹¤ë¡œ ì´ë™í•˜ì.` },
      { type:'general', title:'ğŸª í¼ì¦ 3: ìš•ì‹¤ ê±°ìš¸ì˜ ë©”ì‹œì§€',
        story: `ìš•ì‹¤ì— ë“¤ì–´ì„°ë‹¤. ëŒ€ë¦¬ì„ ë°”ë‹¥, ë…ë¦½í˜• ìš•ì¡°, ëŒ€í˜• ê±°ìš¸. ëŸ­ì…”ë¦¬í•œ ê³µê°„ì´ë‹¤.

ì„¸ë©´ëŒ€ì˜ ì˜¨ìˆ˜ë¥¼ í‹€ì—ˆë‹¤. ëœ¨ê±°ìš´ ì¦ê¸°ê°€ ì˜¬ë¼ì˜¤ë©´ì„œ, ê±°ìš¸ì— ìˆ¨ê²¨ì§„ ê¸€ìê°€ ì„œì„œíˆ ë“œëŸ¬ë‚œë‹¤. ëˆ„êµ°ê°€ ê±°ìš¸ì— ì†ê°€ë½ìœ¼ë¡œ ë©”ì‹œì§€ë¥¼ ì ì–´ë‘” ê²ƒì´ë‹¤. í‰ì†Œì—ëŠ” ë³´ì´ì§€ ì•Šì§€ë§Œ, ê¹€ì´ ì„œë¦¬ë©´ ë‚˜íƒ€ë‚˜ëŠ” íŠ¸ë¦­.

ê±°ìš¸ì— ë‚˜íƒ€ë‚œ ë©”ì‹œì§€:
"ë„ì›€ì„ ì²­í•˜ë¼"

í•˜ì§€ë§Œ ê±°ìš¸ì— ë¹„ì¹œ ê²ƒì´ë¯€ë¡œ, ì‹¤ì œë¡œëŠ” ì¢Œìš°ê°€ ë°˜ì „ë˜ì–´ ìˆë‹¤. ì›ë˜ ì íŒ ë¬¸ìì—´ì´ ë¬´ì—‡ì¸ì§€ íŒŒì•…í•´ì•¼ í•œë‹¤. ê±°ìš¸ì— ì ëŠ” ì‚¬ëŒ ì…ì¥ì—ì„œ, ë³´ëŠ” ì‚¬ëŒì´ ì½ì„ ë•Œ "ë„ì›€ì„ ì²­í•˜ë¼"ê°€ ë˜ë ¤ë©´, ì‹¤ì œë¡œ ì íŒ ê¸€ì ìˆœì„œëŠ” ë’¤ì§‘í˜€ìˆì„ ê²ƒì´ë‹¤.`,
        question: `ê±°ìš¸ì— ìˆ«ìê°€ ë‚˜íƒ€ë‚¬ë‹¤. ê±°ìš¸ì´ë¯€ë¡œ ì¢Œìš°ê°€ ë°˜ì „ë˜ì–´ ë³´ì¸ë‹¤.

ê±°ìš¸ì— ë¹„ì¹œ ìˆ«ì: <b>5765</b>

ì´ ìˆ«ìë“¤ì„ ê±°ìš¸ì— ë¹„ì¶”ë©´ ì¢Œìš°ë°˜ì „ëœë‹¤.
ì‹¤ì œ ìˆ«ì(ê±°ìš¸ ë°”ê¹¥ì—ì„œ ë³¸ ì›ë˜ ìˆ«ì)ë¥¼ ì…ë ¥í•˜ë¼.

(íŒíŠ¸: ìˆ«ì ìˆœì„œê°€ ë’¤ì§‘íŒë‹¤)`,
        hint: 'ê±°ìš¸ì€ ì¢Œìš°ë¥¼ ë°˜ì „ì‹œí‚¨ë‹¤. 5765ë¥¼ ê±°ìš¸ì— ë¹„ì¶”ë©´ ìˆœì„œê°€ ë’¤ì§‘í˜€ì„œ 5675ê°€ ëœë‹¤.',
        validate: i => i.trim()==='5675' },
      { type:'cpq', cpqIndex:1,
        story: `ê±°ìš¸ ë©”ì‹œì§€ë¥¼ í•´ë…í–ˆë‹¤. ê±°ìš¸ ì•„ë˜ íƒ€ì¼ í•˜ë‚˜ê°€ ì‚´ì§ ë“¤ë– ìˆëŠ” ê²ƒì„ ë°œê²¬í–ˆë‹¤. íƒ€ì¼ì„ ë“¤ì–´ì˜¬ë¦¬ì, ì•ˆì— ì‘ì€ ê¸ˆê³ ê°€ ìˆ¨ê²¨ì ¸ ìˆë‹¤. í˜¸í…”ì—ì„œ ì œê³µí•˜ëŠ” ê°ì‹¤ ê¸ˆê³ ê°€ ì•„ë‹ˆë¼, ëˆ„êµ°ê°€ ë³„ë„ë¡œ ì„¤ì¹˜í•œ ê²ƒì´ë‹¤.

ê¸ˆê³ ëŠ” ì´ë¯¸ ì—´ë ¤ìˆë‹¤. ì•ˆì—ëŠ” ë°•ì¤€í˜¸ì˜ ì¼ì •í‘œì™€ ë©”ëª¨ê°€ ìˆë‹¤. ì¼ì •í‘œì—ëŠ” ì„œìš¸ì—ì„œì˜ ë¯¸íŒ… ìŠ¤ì¼€ì¤„ì´ ì í˜€ìˆì§€ë§Œ, ë§ˆì§€ë§‰ í•­ëª©ì´ ì´ìƒí•˜ë‹¤.

"2ì›” 14ì¼ 22:00 â€” [ì¥ì†Œ í™•ì¸ í•„ìš”]. ë°˜ë“œì‹œ ë„ë³´ë¡œ ê±°ë¦¬ ì¸¡ì •í•  ê²ƒ."

ë˜ ë‹¤ë¥¸ ì¥ì†Œë‹¤. ë°•ì¤€í˜¸ëŠ” ì´ í˜¸í…”ì„ ê±°ì ìœ¼ë¡œ ì—¬ëŸ¬ ì¥ì†Œë¥¼ ì¡°ì‚¬í•˜ê³  ìˆì—ˆë‹¤.`,
        storyAfter: `ë‘ ì¥ì†Œì˜ ì •ë³´ë¥¼ ëª¨ë‘ í™•ì¸í–ˆë‹¤. ê¸ˆê³  ì•ˆì— ì ‘íŒ í¸ì§€ê°€ í•˜ë‚˜ ë” ìˆë‹¤. ë°•ì¤€í˜¸ê°€ ìì‹ ì—ê²Œ ì“´ ê²ƒ ê°™ì€ ë©”ëª¨ë‹¤.

"ì—¬ê¸°ê¹Œì§€ ì¶”ì í–ˆë‹¤ë©´, ë§ˆì§€ë§‰ ë‹¨ì„œëŠ” ì¹¨ëŒ€ í—¤ë“œë³´ë“œ ë’¤ì— ìˆë‹¤. ë¹„ë°€ í†µë¡œë¥¼ ì°¾ì•„ë¼. ì½”ë“œê°€ í•„ìš”í•˜ë‹¤."

ë°•ì¤€í˜¸ëŠ” ì‹¤ì¢…ëœ ê²ƒì´ ì•„ë‹ˆë¼... ìŠ¤ìŠ¤ë¡œ ì‚¬ë¼ì§„ ê²ƒì¼ê¹Œ? ì¹¨ëŒ€ë¡œ ì´ë™í•˜ì.` },
      { type:'general', title:'ğŸšª í¼ì¦ 5: ë¹„ë°€ í†µë¡œ',
        story: `ì¹¨ëŒ€ í—¤ë“œë³´ë“œë¥¼ ë°€ì–´ë³´ë‹ˆ, ë²½ë©´ì— ìˆ¨ê²¨ì§„ íŒ¨ë„ì´ ìˆë‹¤. ì˜¤ë˜ëœ í˜¸í…”ì˜ ë¹„ë°€ í†µë¡œë‹¤. ì•„ë§ˆ ê±´ì¶• ë‹¹ì‹œë¶€í„° ìˆì—ˆë˜ ê²ƒ ê°™ë‹¤. ë°•ì¤€í˜¸ëŠ” ì´ í†µë¡œì˜ ì¡´ì¬ë¥¼ ì•Œê³  ì´ ë°©ì„ ì§€ì •í•œ ê²ƒì´ë‹¤.

íŒ¨ë„ì˜ ì ê¸ˆì¥ì¹˜ì— ìˆ«ì í‚¤íŒ¨ë“œê°€ ìˆë‹¤. ì½”ë“œë¥¼ ì…ë ¥í•´ì•¼ í•œë‹¤.

íŒ¨ë„ ì˜†ì— ë§ˆì§€ë§‰ ë©”ëª¨ê°€ í…Œì´í”„ë¡œ ë¶™ì–´ìˆë‹¤.

"ì½”ë“œ = ì´ ë°©ì—ì„œ ë°œê²¬í•œ ëª¨ë“  ìˆ«ìì˜ í•©.
ì²´í¬ì¸ ì‹œê°„, ì²´í¬ì•„ì›ƒ ì‹œê°„, ë°© ë²ˆí˜¸, ì¸µ ìˆ˜."

ì•„ë˜ì— ì‘ì€ ê¸€ì”¨ë¡œ ì í˜€ìˆë‹¤.
"ì²´í¬ì¸: 14ì‹œ, ì²´í¬ì•„ì›ƒ: 08ì‹œ, ë°©: 1408í˜¸, ì¸µ: 14ì¸µ"`,
        question: `ë°•ì¤€í˜¸ì˜ íƒ€ì„ë¼ì¸ì„ ë¶„ì„í•˜ë¼.

<b>ì²´í¬ì¸ ì‹œê°: 21:00
ë§ˆì§€ë§‰ CCTV: 21:03 (ë°© ì…ì¥)
ë…¸íŠ¸ë¶ ê²€ìƒ‰ ì‹œê°: 21:30
ì‹¤ì¢… ì¶”ì • ì‹œê°: 21:47</b>

"ë¹„ë°€ë²ˆí˜¸ = ì²´í¬ì¸ë¶€í„° ì‹¤ì¢…ê¹Œì§€ ê±¸ë¦° ì‹œê°„(ë¶„)"

ëª‡ ë¶„ì¸ê°€?`,
        hint: '21:00ì— ì²´í¬ì¸, 21:47ì— ì‹¤ì¢…. 47 - 0 = ?',
        validate: i => i.trim()==='47' }
    ]
  }
];

// â”€â”€â”€ ê²Œì„ ìƒíƒœ â”€â”€â”€
let state = { currentRoom:null, currentPuzzle:0, cpqCampaigns:[], startTime:null, attempts:0 };

function loadProgress() { try{return JSON.parse(localStorage.getItem('qube_progress')||'{}')}catch{return{}} }
function saveProgress(p) { localStorage.setItem('qube_progress',JSON.stringify(p)) }
function getGrade(c) { return c>=10?'ğŸ•µï¸ ì…œë¡':c>=7?'ğŸ” ëª…íƒì •':c>=4?'ğŸ§ íƒì •':c>=2?'ğŸ“‹ ìˆ˜ìŠµíƒì •':'ğŸ”° ì´ˆë³´íƒì •' }
function formatTime(s) { return Math.floor(s/60)+':'+String(s%60).padStart(2,'0') }

// â”€â”€â”€ íŒŒí‹°í´ â”€â”€â”€
function createParticles() {
  const c = document.getElementById('particles');
  for(let i=0;i<50;i++){
    const p = document.createElement('div');
    p.className='particle';
    p.style.left=Math.random()*100+'%';
    p.style.animationDuration=(8+Math.random()*12)+'s';
    p.style.animationDelay=Math.random()*10+'s';
    const sz=(2+Math.random()*3)+'px';
    p.style.width=p.style.height=sz;
    p.style.background=Math.random()>.5?'#b44aff':'#00e5ff';
    p.style.boxShadow=`0 0 6px ${p.style.background}`;
    c.appendChild(p);
  }
}

function scrollToRooms() { document.getElementById('rooms-section').scrollIntoView({behavior:'smooth'}) }

// â”€â”€â”€ í™”ë©´ ì „í™˜ â”€â”€â”€
function showScreen(id) {
  document.getElementById('home').classList.toggle('hidden', id!=='home');
  document.getElementById('game').classList.toggle('hidden', id!=='game');
  document.getElementById('result').classList.toggle('hidden', id!=='result');
  document.getElementById('loadingScreen').classList.remove('active');
  if(id!=='home') window.scrollTo(0,0);
}

function goHome() {
  state.currentRoom=null;
  showScreen('home');
  renderHome();
}

function confirmExit() { if(confirm('ì •ë§ ë‚˜ê°€ì‹œê² ìŠµë‹ˆê¹Œ? ì§„í–‰ ìƒí™©ì´ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.')) goHome() }

// â”€â”€â”€ í™ˆ ë Œë”ë§ â”€â”€â”€
function renderHome() {
  const progress = loadProgress();
  const cleared = Object.keys(progress).filter(k=>progress[k]?.cleared).length;

  document.getElementById('statCleared').textContent = cleared;
  document.getElementById('statGrade').textContent = getGrade(cleared).split(' ')[0];
  document.getElementById('rooms-progress').textContent = `ğŸ”“ ${ROOMS.length}/${ROOMS.length} í•´ê¸ˆ Â· âœ… ${cleared} íƒˆì¶œ`;

  const grid = document.getElementById('roomGrid');
  grid.innerHTML = ROOMS.map(room => {
    const p = progress[room.id];
    const isClear = p?.cleared;
    const stars = Array.from({length:3},(_,i)=>`<span class="star ${i<room.difficulty?'':'empty'}">${i<room.difficulty?'â˜…':'â˜†'}</span>`).join('');
    const badge = isClear ? '<span class="room-badge badge-cleared">âœ“ í´ë¦¬ì–´</span>' : '<span class="room-badge badge-new">NEW</span>';

    return `<div class="room-card ${isClear?'cleared':''}" onclick="startRoom('${room.id}')">
      ${badge}
      <div class="room-emoji">${room.emoji}</div>
      <div class="room-title">${room.name}</div>
      <div class="room-desc">${room.desc}</div>
      <div class="room-meta">
        <span class="room-diff">${stars}</span>
        <span>â± ${room.time}</span>
        ${isClear?`<span>ğŸ† ${formatTime(p.bestTime)}</span>`:''}
      </div>
      <button class="room-start">${isClear?'ë‹¤ì‹œ ë„ì „ ğŸ”„':'ì…ì¥í•˜ê¸° ğŸ”‘'}</button>
    </div>`;
  }).join('');
}

// â”€â”€â”€ ê²Œì„ ì‹œì‘ â”€â”€â”€
async function startRoom(roomId) {
  const room = ROOMS.find(r=>r.id===roomId);
  if(!room) return;

  state.currentRoom=room; state.currentPuzzle=0; state.startTime=Date.now(); state.attempts=0;

  document.getElementById('loadingScreen').classList.add('active');

  try {
    const cpqCount = room.puzzles.filter(p=>p.type==='cpq').length;
    const res = await fetch(`${API}/api/random?count=${cpqCount}`);
    const data = await res.json();
    state.cpqCampaigns = data.campaigns || [];
  } catch(e) { state.cpqCampaigns = []; }

  showScreen('game');
  document.getElementById('gameTitle').textContent = room.emoji + ' ' + room.name;
  renderIntro();
}

function renderIntro() {
  renderProgress();
  document.getElementById('gameContent').innerHTML = `
    <div class="story-box">
      <div class="label">ğŸ“– í”„ë¡¤ë¡œê·¸</div>
      <p>${state.currentRoom.intro.replace(/\n/g,'<br>')}</p>
    </div>
    <button class="btn-next" onclick="renderPuzzle(0)">ì¡°ì‚¬ ì‹œì‘ â†’</button>`;
}

function renderProgress() {
  const room = state.currentRoom;
  const total = room.puzzles.length;
  document.getElementById('gameProgressText').textContent = `${state.currentPuzzle+1} / ${total}`;
  document.getElementById('progressBar').innerHTML =
    Array.from({length:total},(_,i)=>{
      const cls = i<state.currentPuzzle?'done':i===state.currentPuzzle?'active':'';
      return `<div class="prog-dot ${cls}"></div>`;
    }).join('');
}

// â”€â”€â”€ í¼ì¦ ë Œë”ë§ â”€â”€â”€
function renderPuzzle(idx) {
  state.currentPuzzle = idx;
  renderProgress();
  const puzzle = state.currentRoom.puzzles[idx];
  puzzle.type==='cpq' ? renderCpqPuzzle(idx,puzzle) : renderGeneralPuzzle(idx,puzzle);
}

function renderGeneralPuzzle(idx, puzzle) {
  document.getElementById('gameContent').innerHTML = `
    <div class="story-box">
      <div class="label">ğŸ“– ìƒí™©</div>
      <p>${puzzle.story.replace(/\n/g,'<br>')}</p>
    </div>
    <div class="puzzle-box">
      <div class="puzzle-label">${puzzle.title}</div>
      <div class="puzzle-question">${puzzle.question.replace(/\n/g,'<br>')}</div>
      <div class="hint-box hidden" id="hintBox">ğŸ’¡ ${puzzle.hint}</div>
      <button class="hint-btn" onclick="document.getElementById('hintBox').classList.remove('hidden');this.remove()">ğŸ’¡ íŒíŠ¸ ë³´ê¸°</button>
      <div class="answer-area">
        <input type="text" id="answerInput" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”" onkeydown="handleEnter(event,${idx})">
        <button class="btn-submit" onclick="checkGeneral(${idx})">í™•ì¸</button>
      </div>
      <div id="feedback"></div>
    </div>`;
  document.getElementById('answerInput').focus();
}

function renderCpqPuzzle(idx, puzzle) {
  const camp = state.cpqCampaigns[puzzle.cpqIndex];
  if(!camp) { nextPuzzle(idx); return; }

  const desc = camp.join_desc || '';
  const keyword = camp.search_keyword || '';
  const placeMatch = desc.match(/\[([^\]]*X[^\]]*)\]/);
  const placeHint = placeMatch ? placeMatch[1] : 'í•´ë‹¹ ì¥ì†Œ';
  const startMatch = desc.match(/ì¶œë°œì§€ë¥¼\s*\[([^\]]+)\]/);
  const startPlace = startMatch ? startMatch[1] : 'ì§€ì •ëœ ì¶œë°œì§€';

  document.getElementById('gameContent').innerHTML = `
    <div class="story-box">
      <div class="label">ğŸ“– ë‹¨ì„œ ë°œê²¬</div>
      <p>${puzzle.story.replace(/\n/g,'<br>')}</p>
    </div>
    <div class="puzzle-box">
      <div class="puzzle-label">ğŸ” í¼ì¦ ${idx+1}: ì¥ì†Œ ì¶”ì  ë¯¸ì…˜</div>
      <div class="puzzle-question">ë‹¨ì„œì— ì íŒ ì¥ì†Œë¥¼ ì°¾ì•„ì•¼ í•œë‹¤. ë„¤ì´ë²„ì—ì„œ ê²€ìƒ‰í•˜ì—¬ ê±¸ìŒ ìˆ˜ë¥¼ í™•ì¸í•˜ë¼.</div>
      <div class="cpq-mission">
        <div class="mission-title">ğŸ“‹ ë¯¸ì…˜ ìˆœì„œ</div>
        <ol class="cpq-steps">
          <li>ì•„ë˜ í‚¤ì›Œë“œë¥¼ ë³µì‚¬í•˜ì—¬ <b>ë„¤ì´ë²„</b>ì—ì„œ ê²€ìƒ‰</li>
          <li>ê²€ìƒ‰ ê²°ê³¼ì—ì„œ <b>${placeHint}</b> í´ë¦­</li>
          <li>í”Œë ˆì´ìŠ¤ì—ì„œ <b>ì§€ë„</b> íƒ­ â†’ <b>ì§€ë„ì•±ìœ¼ë¡œ ë³´ê¸°</b></li>
          <li><b>ë„ì°©</b> ë²„íŠ¼ í´ë¦­</li>
          <li>ì¶œë°œì§€ë¥¼ <b>${startPlace}</b>(ìœ¼)ë¡œ ì„¤ì •</li>
          <li><b>ë„ë³´</b> â†’ <b>ê°€ì¥ ë¹ ë¥¸</b> ê²½ë¡œì˜ ê±¸ìŒ ìˆ˜ í™•ì¸</li>
        </ol>
        <div class="cpq-keyword-box">
          <span class="cpq-keyword" onclick="copyKeyword(this)" title="í´ë¦­í•˜ì—¬ ë³µì‚¬">ğŸ” ${keyword}</span>
        </div>
      </div>
      <div class="answer-area" style="margin-top:16px">
        <input type="number" id="answerInput" placeholder="ê±¸ìŒ ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”" onkeydown="handleEnter(event,${idx},'cpq')">
        <button class="btn-submit" onclick="checkCpq(${idx})">í™•ì¸</button>
      </div>
      <div id="feedback"></div>
    </div>`;
  document.getElementById('answerInput').focus();
}

// â”€â”€â”€ ì…ë ¥ í•¸ë“¤ëŸ¬ â”€â”€â”€
let isComposing = false;
document.addEventListener('compositionstart', ()=>{isComposing=true});
document.addEventListener('compositionend', ()=>{isComposing=false});

function handleEnter(e, idx, type) {
  if(e.key==='Enter' && !isComposing) {
    e.preventDefault();
    type==='cpq' ? checkCpq(idx) : checkGeneral(idx);
  }
}

// â”€â”€â”€ ê²€ì¦ â”€â”€â”€
function checkGeneral(idx) {
  const input = document.getElementById('answerInput').value.trim();
  if(!input) return;
  state.attempts++;
  showFeedback(state.currentRoom.puzzles[idx].validate(input), idx);
}

async function checkCpq(idx) {
  const input = document.getElementById('answerInput').value.trim();
  if(!input) return;
  state.attempts++;
  const camp = state.cpqCampaigns[state.currentRoom.puzzles[idx].cpqIndex];
  try {
    const res = await fetch(`${API}/api/verify`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({campaign_id:camp.id,user_answer:input})});
    const data = await res.json();
    showFeedback(data.correct, idx);
  } catch { showFeedback(false, idx); }
}

function showFeedback(correct, idx) {
  const fb = document.getElementById('feedback');
  const puzzle = state.currentRoom.puzzles[idx];
  if(correct) {
    const after = puzzle.storyAfter||'';
    fb.innerHTML = `<div class="feedback correct">âœ… ì •ë‹µ!${after?' '+after:''}</div>
      <button class="btn-next" onclick="nextPuzzle(${idx})">${idx<state.currentRoom.puzzles.length-1?'ë‹¤ìŒ í¼ì¦ â†’':'ğŸšª íƒˆì¶œ!'}</button>`;
  } else {
    fb.innerHTML = '<div class="feedback wrong">âŒ ì˜¤ë‹µ. ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.</div>';
    document.getElementById('answerInput').value='';
    document.getElementById('answerInput').focus();
  }
}

function nextPuzzle(cur) { cur+1>=state.currentRoom.puzzles.length ? showResult() : renderPuzzle(cur+1) }

// â”€â”€â”€ ê²°ê³¼ â”€â”€â”€
function showResult() {
  const elapsed = Math.floor((Date.now()-state.startTime)/1000);
  const room = state.currentRoom;
  const progress = loadProgress();
  const prev = progress[room.id];
  const bestTime = prev?.bestTime ? Math.min(prev.bestTime,elapsed) : elapsed;
  progress[room.id] = {cleared:true, bestTime, lastPlayed:Date.now()};
  saveProgress(progress);

  const cleared = Object.keys(progress).filter(k=>progress[k]?.cleared).length;
  const grade = getGrade(cleared);
  let gameGrade = 'S';
  if(elapsed>600) gameGrade='C'; else if(elapsed>300) gameGrade='B'; else if(elapsed>180) gameGrade='A';

  showScreen('result');
  document.getElementById('resultContent').innerHTML = `
    <div class="result-emoji">ğŸ‰</div>
    <div class="result-title">íƒˆì¶œ ì„±ê³µ!</div>
    <div class="result-sub">${room.name}ì—ì„œ ë¬´ì‚¬íˆ íƒˆì¶œí–ˆìŠµë‹ˆë‹¤</div>
    <div class="result-grade">${gameGrade} RANK</div>
    <div class="result-stats">
      <div class="result-stat"><div class="result-stat-val">${formatTime(elapsed)}</div><div class="result-stat-label">ì†Œìš”ì‹œê°„</div></div>
      <div class="result-stat"><div class="result-stat-val">${state.attempts}</div><div class="result-stat-label">ì‹œë„íšŸìˆ˜</div></div>
      <div class="result-stat"><div class="result-stat-val">${grade.split(' ')[0]}</div><div class="result-stat-label">${grade.split(' ')[1]||''}</div></div>
    </div>
    <div class="result-btns">
      <button class="btn-home" onclick="goHome()">ğŸšª ë¡œë¹„ë¡œ ëŒì•„ê°€ê¸°</button>
      <button class="btn-share" onclick="shareResult()">ğŸ“¤ ê²°ê³¼ ê³µìœ í•˜ê¸°</button>
    </div>`;
}

function shareResult() {
  const room = state.currentRoom;
  const elapsed = Math.floor((Date.now()-state.startTime)/1000);
  const text = `ğŸ” QUBE - ${room.name}\n${room.emoji} íƒˆì¶œ ì„±ê³µ! | â± ${formatTime(elapsed)}\n\në‚˜ëŠ” íƒˆì¶œí–ˆë‹¤. ë‹¹ì‹ ì€?\nğŸ‘‰ https://qube.salmonholic.com`;
  navigator.share ? navigator.share({text}) : (navigator.clipboard?.writeText(text), alert('í´ë¦½ë³´ë“œì— ë³µì‚¬ëìŠµë‹ˆë‹¤!'));
}

function copyKeyword(el) {
  const text = el.textContent.replace('ğŸ” ','').trim();
  navigator.clipboard?.writeText(text);
  const orig = el.textContent;
  el.textContent = 'âœ“ ë³µì‚¬ë¨!';
  setTimeout(()=>el.textContent=orig, 1500);
}

// â”€â”€â”€ ì´ˆê¸°í™” â”€â”€â”€
createParticles();
renderHome();
</script>
</body>
</html>
