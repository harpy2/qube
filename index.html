<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QUBE — 풀어라. 탈출하라.</title>
<meta name="description" content="방탈출 추리 퍼즐 게임. 단서를 찾고, 퍼즐을 풀고, 탈출하라.">
<meta property="og:title" content="QUBE — 방탈출 추리 퍼즐 게임">
<meta property="og:description" content="풀어라. 탈출하라.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://qube.salmonholic.com">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🔒</text></svg>">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#0a0a0a;--bg2:#111;--bg3:#1a1a1a;
  --text:#e0e0e0;--text2:#888;--text3:#555;
  --accent:#b44aff;--accent2:#9333ea;--accent-glow:rgba(180,74,255,.15);
  --cyan:#00e5ff;--danger:#ff4444;--success:#00ff88;
  --card:rgba(255,255,255,.03);--card-border:rgba(255,255,255,.06);
}
html{scroll-behavior:smooth}
body{background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Noto Sans KR',sans-serif;line-height:1.6;overflow-x:hidden}
.hidden{display:none!important}

/* Hero */
.hero{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;position:relative;overflow:hidden;padding:2rem}
.hero::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at 50% 40%,rgba(180,74,255,.06) 0%,transparent 70%);pointer-events:none}
.hero h1{font-size:clamp(3rem,10vw,6rem);font-weight:900;letter-spacing:0.1em;margin-bottom:1rem;background:linear-gradient(135deg,#fff 0%,#b44aff 50%,#00e5ff 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hero p{font-size:clamp(1rem,3vw,1.3rem);color:var(--text2);max-width:450px;margin-bottom:2.5rem}
.hero-cta{padding:16px 48px;background:linear-gradient(135deg,var(--accent),var(--cyan));color:#000;font-size:1.1rem;font-weight:700;border:none;border-radius:50px;cursor:pointer;transition:all .3s;letter-spacing:.05em}
.hero-cta:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(180,74,255,.4)}
.scroll-hint{position:absolute;bottom:2rem;animation:bounce 2s infinite;color:var(--text3);font-size:1.5rem}
@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(10px)}}

/* Particles */
.particles{position:absolute;inset:0;pointer-events:none;overflow:hidden}
.particle{position:absolute;width:3px;height:3px;border-radius:50%;opacity:.4;animation:float linear infinite}
@keyframes float{0%{transform:translateY(100vh) scale(0);opacity:0}10%{opacity:.4}90%{opacity:.4}100%{transform:translateY(-10vh) scale(1);opacity:0}}

/* Stats Bar */
.stats-bar{display:flex;justify-content:center;gap:40px;padding:24px 0;margin-bottom:1rem}
.stat{text-align:center}
.stat-val{font-size:2rem;font-weight:900;background:linear-gradient(135deg,var(--accent),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.stat-label{font-size:.8rem;color:var(--text2);margin-top:4px}

/* Rooms Section */
.rooms-section{max-width:900px;margin:0 auto;padding:0 1.5rem 4rem}
.rooms-section h2{font-size:1.5rem;margin-bottom:.5rem;display:flex;align-items:center;gap:8px}
.rooms-progress{color:var(--text2);font-size:.85rem;margin-bottom:1.5rem}
.room-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:1.2rem}

/* Room Card */
.room-card{background:var(--card);border:1px solid var(--card-border);border-radius:16px;padding:1.5rem;backdrop-filter:blur(10px);transition:all .3s;cursor:pointer;position:relative;overflow:hidden}
.room-card:hover{border-color:rgba(180,74,255,.3);background:rgba(255,255,255,.05);transform:translateY(-3px);box-shadow:0 8px 30px rgba(180,74,255,.1)}
.room-card.cleared{border-color:rgba(0,255,136,.2)}
.room-card.cleared .room-start{background:var(--bg3);color:var(--text2)}
.room-badge{position:absolute;top:12px;right:12px;padding:4px 12px;border-radius:20px;font-size:.7rem;font-weight:700}
.badge-new{background:var(--accent);color:#fff}
.badge-cleared{background:var(--success);color:#000}
.room-emoji{font-size:2.5rem;margin-bottom:.8rem}
.room-title{font-size:1.15rem;font-weight:700;margin-bottom:.4rem}
.room-desc{font-size:.85rem;color:var(--text2);margin-bottom:.8rem;line-height:1.5}
.room-meta{display:flex;gap:12px;color:var(--text2);font-size:.85rem;margin-bottom:1rem}
.room-diff .star{color:var(--accent)}
.room-diff .star.empty{color:var(--text3)}
.room-start{width:100%;padding:10px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;border:none;border-radius:50px;cursor:pointer;font-size:.9rem;font-weight:600;transition:all .3s}
.room-start:hover{box-shadow:0 4px 15px rgba(180,74,255,.4)}

/* Game Screen */
#game{max-width:700px;margin:0 auto;min-height:100vh;padding:1rem}
.game-header{display:flex;align-items:center;padding:1rem 0;border-bottom:1px solid var(--card-border);margin-bottom:1.5rem;gap:12px}
.game-back{background:none;border:none;color:var(--text2);font-size:1.3rem;cursor:pointer;padding:4px 8px}
.game-back:hover{color:var(--text)}
.game-title{font-size:1.1rem;font-weight:700;flex:1}
.game-progress-text{color:var(--text2);font-size:.85rem}

.progress-bar{display:flex;gap:6px;margin-bottom:1.5rem}
.prog-dot{flex:1;height:4px;border-radius:2px;background:var(--bg3);transition:all .3s}
.prog-dot.active{background:var(--accent);box-shadow:0 0 8px rgba(180,74,255,.4)}
.prog-dot.done{background:var(--success)}

.story-box{background:var(--bg3);border:1px solid var(--card-border);border-radius:16px;padding:1.5rem;margin-bottom:1.5rem;animation:fadeIn .5s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(15px)}to{opacity:1;transform:translateY(0)}}
.story-box .label{color:var(--accent);font-size:.75rem;font-weight:700;margin-bottom:8px;text-transform:uppercase;letter-spacing:.15em}
.story-box p{color:var(--text2);line-height:1.8}

.puzzle-box{background:rgba(180,74,255,.05);border:1px solid rgba(180,74,255,.15);border-radius:16px;padding:1.5rem;margin-bottom:1.5rem;animation:fadeIn .5s ease}
.puzzle-label{color:var(--cyan);font-size:.8rem;font-weight:700;margin-bottom:12px;letter-spacing:.05em}
.puzzle-question{font-size:1rem;line-height:1.8;margin-bottom:1.2rem}

.cpq-mission{background:rgba(0,229,255,.05);border:1px solid rgba(0,229,255,.15);border-radius:12px;padding:1.2rem;margin:1rem 0}
.cpq-mission .mission-title{color:var(--cyan);font-size:.8rem;font-weight:700;margin-bottom:10px}
.cpq-steps{font-size:.9rem;color:var(--text2);line-height:2;padding-left:1.2rem}
.cpq-steps b{color:var(--text)}
.cpq-keyword-box{margin-top:12px;display:flex;align-items:center;gap:10px}
.cpq-keyword{display:inline-block;background:linear-gradient(135deg,var(--accent),var(--cyan));color:#000;padding:8px 20px;border-radius:50px;font-size:.9rem;font-weight:700;cursor:pointer;transition:all .2s}
.cpq-keyword:hover{transform:scale(1.03);box-shadow:0 4px 15px rgba(180,74,255,.3)}

.hint-btn{background:none;border:1px solid var(--text3);color:var(--text2);padding:8px 16px;border-radius:50px;font-size:.8rem;cursor:pointer;transition:all .2s;margin-bottom:1rem}
.hint-btn:hover{border-color:var(--accent);color:var(--accent)}
.hint-box{background:rgba(255,165,0,.08);border:1px solid rgba(255,165,0,.2);border-radius:10px;padding:12px 16px;font-size:.9rem;color:#f59e0b;margin-bottom:1rem}

.answer-area{display:flex;flex-direction:column;gap:10px}
.answer-area input{width:100%;padding:14px 18px;background:var(--bg3);border:1px solid var(--card-border);border-radius:12px;color:var(--text);font-size:1rem;font-family:inherit;outline:none;transition:border-color .3s}
.answer-area input:focus{border-color:var(--accent)}
.answer-area input::placeholder{color:var(--text3)}
.btn-submit{width:100%;padding:14px 28px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;border:none;border-radius:12px;font-weight:700;cursor:pointer;transition:all .2s;white-space:nowrap;font-family:inherit;font-size:.95rem}
.btn-submit:hover{box-shadow:0 4px 15px rgba(180,74,255,.4)}
.btn-next{width:100%;padding:14px;background:linear-gradient(135deg,var(--accent),var(--cyan));color:#000;border:none;border-radius:50px;font-weight:700;cursor:pointer;transition:all .3s;font-size:1rem;font-family:inherit;margin-top:1rem}
.btn-next:hover{box-shadow:0 4px 20px rgba(180,74,255,.4);transform:translateY(-1px)}

.feedback{padding:14px 18px;border-radius:12px;margin-top:1rem;font-size:.95rem;animation:fadeIn .3s}
.feedback.correct{background:rgba(0,255,136,.1);color:var(--success);border:1px solid rgba(0,255,136,.2)}
.feedback.wrong{background:rgba(255,68,68,.1);color:var(--danger);border:1px solid rgba(255,68,68,.2)}

/* Result */
#result{max-width:600px;margin:0 auto;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:2rem}
.result-card{text-align:center;width:100%}
.result-emoji{font-size:4rem;margin-bottom:1rem}
.result-title{font-size:2rem;font-weight:900;margin-bottom:.5rem;background:linear-gradient(135deg,#fff,var(--accent),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.result-sub{color:var(--text2);margin-bottom:2rem}
.result-grade{display:inline-block;font-size:1.5rem;font-weight:900;padding:10px 30px;border-radius:50px;background:linear-gradient(135deg,var(--accent),var(--cyan));color:#000;margin-bottom:2rem}
.result-stats{display:flex;justify-content:center;gap:20px;margin-bottom:2rem;flex-wrap:wrap}
.result-stat{background:var(--card);border:1px solid var(--card-border);border-radius:16px;padding:18px 24px;min-width:100px}
.result-stat-val{font-size:1.5rem;font-weight:900;color:var(--accent)}
.result-stat-label{font-size:.75rem;color:var(--text2);margin-top:4px}
.result-btns{display:flex;flex-direction:column;gap:10px;max-width:300px;margin:0 auto}
.btn-home{padding:14px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;border:none;border-radius:50px;font-weight:700;cursor:pointer;font-size:1rem;font-family:inherit;transition:all .3s}
.btn-home:hover{box-shadow:0 4px 15px rgba(180,74,255,.4)}
.btn-share{padding:14px;background:transparent;border:1px solid var(--card-border);color:var(--text2);border-radius:50px;cursor:pointer;font-size:.9rem;font-family:inherit;transition:all .2s}
.btn-share:hover{border-color:var(--accent);color:var(--text)}

/* Loading */
.loading-screen{display:none;position:fixed;inset:0;background:var(--bg);z-index:1000;flex-direction:column;align-items:center;justify-content:center;gap:16px}
.loading-screen.active{display:flex}
.spinner{width:40px;height:40px;border:3px solid var(--bg3);border-top-color:var(--accent);border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-text{color:var(--text2);font-size:.9rem}

@media(max-width:600px){
  .hero h1{letter-spacing:.05em}
  .room-grid{grid-template-columns:1fr}
  .stats-bar{gap:24px}
  .result-stats{gap:12px}
}
</style>
</head>
<body>

<!-- ─── 홈 ─── -->
<div id="home">
  <div class="hero">
    <div class="particles" id="particles"></div>
    <h1>QUBE</h1>
    <p>풀어라. 탈출하라.</p>
    <button class="hero-cta" onclick="scrollToRooms()">방 선택하기</button>
    <div class="scroll-hint">↓</div>
  </div>
  <div class="stats-bar">
    <div class="stat"><div class="stat-val" id="statCleared">0</div><div class="stat-label">클리어</div></div>
    <div class="stat"><div class="stat-val" id="statGrade">🔰</div><div class="stat-label">등급</div></div>
    <div class="stat"><div class="stat-val" id="statStreak">0</div><div class="stat-label">연속</div></div>
  </div>
  <div class="rooms-section" id="rooms-section">
    <h2>🚪 미스터리 목록</h2>
    <div class="rooms-progress" id="rooms-progress"></div>
    <div class="room-grid" id="roomGrid"></div>
  </div>
</div>

<!-- ─── 로딩 ─── -->
<div class="loading-screen" id="loadingScreen">
  <div class="spinner"></div>
  <div class="loading-text">방에 진입하는 중...</div>
</div>

<!-- ─── 게임 ─── -->
<div id="game" class="hidden">
  <div class="game-header">
    <button class="game-back" onclick="confirmExit()">←</button>
    <div class="game-title" id="gameTitle"></div>
    <div class="game-progress-text" id="gameProgressText"></div>
  </div>
  <div class="progress-bar" id="progressBar"></div>
  <div id="gameContent"></div>
</div>

<!-- ─── 결과 ─── -->
<div id="result" class="hidden">
  <div class="result-card" id="resultContent"></div>
</div>

<script>
const API = 'https://qube-api.harpy922.workers.dev';

// ─── 방 템플릿 ───
const ROOMS = [
  {
    id: 'professor', emoji: '🏚️', name: '사라진 교수의 서재',
    desc: '고고학 교수 김동현이 3일째 연락이 없다. 그의 서재에는 실종의 단서가 숨겨져 있다. 진실을 밝혀라.',
    difficulty: 1, time: '12분',
    intro: `고고학 교수 김동현이 3일째 연락이 없다. 대학원 조교인 당신은 마스터키로 그의 서재에 잠입했지만, 문이 자동으로 잠겼다. 어두운 서재 안, 책상 위 스탠드만 희미하게 빛나고 있다. 어지럽게 널린 서류, 벽면의 책장, 고대 유물 복제품들... 교수는 무언가를 급히 정리하다 사라진 것 같다. 서재의 비밀을 풀고 탈출하라.`,
    puzzles: [
      { type:'general', title:'📋 퍼즐 1: 책상 위의 암호 메모',
        story: `책상 위를 살펴본다. 논문 초안, 발굴 보고서, 커피 자국이 묻은 머그컵... 그 사이에 포스트잇 하나가 눈에 띈다. 교수의 필체로 뭔가 적혀있다.

포스트잇에는 이상한 표가 그려져 있다. 교수가 즐겨 쓰던 "좌표 암호"다. 격자에 글자를 배치하고, 좌표로 메시지를 전달하는 방식.

<b>┌──┬──┬──┬──┐
│ 서 │ 랍 │ 을 │ 금 │
├──┼──┼──┼──┤
│ 열 │ 어 │ 고 │ 라 │
├──┼──┼──┼──┤
│ 벽 │ 확 │ 인 │ 해 │
└──┴──┴──┴──┘</b>

그 아래 좌표가 적혀있다: <b>(1,1) (1,2) (2,1) (2,2) (2,3)</b>
(행,열 순서)`,
        question: `격자에서 좌표를 읽어 메시지를 완성하라.

(1,1)=서, (1,2)=랍, (2,1)=열, (2,2)=어, (2,3)=?

다섯 글자를 이어서 입력하시오. (공백 없이)`,
        hint: '(1,1)=서, (1,2)=랍, (2,1)=열, (2,2)=어, (2,3)=고 → "서랍열어고"? 아니, 다시 읽어보자.',
        validate: i => i.replace(/\s/g,'') === '서랍열어고' || i.replace(/\s/g,'') === '서랍을열어' },
      { type:'cpq', cpqIndex:0,
        story: `정답이다. 포스트잇 뒷면에 숨겨진 글자가 드러난다. "서랍을 열어라."

책상 서랍을 당기자, 안에는 의외의 물건이 들어있다. 택배 영수증 한 장. 배송 날짜는 교수가 실종되기 이틀 전이다. 영수증에는 수신인이 교수 본인으로 되어있지만, 배송지 주소가 자택이 아니라 낯선 곳이다.

영수증 옆에 교수가 빨간 펜으로 적어놓은 메모가 있다.
"이곳까지의 거리를 확인할 것. 도보 기준."

교수가 이 장소를 직접 방문하려 했던 것 같다. 영수증에 적힌 정보를 추적해야 한다.`,
        storyAfter: `걸음 수를 확인했다. 영수증 뒷면을 뒤집으니 교수가 연필로 흐릿하게 적어둔 메모가 보인다.

"두 번째 단서는 벽에 있다."

교수는 체계적으로 단서를 남겨둔 것이다. 마치 누군가 자신을 뒤따라오길 원했던 것처럼... 벽면을 살펴보자.` },
      { type:'general', title:'🔢 퍼즐 3: 벽 속의 금고',
        story: `벽면의 책장을 하나씩 살펴본다. 세 번째 칸에서 이상한 점을 발견했다. 책들 사이에 빈 공간이 있고, 그 뒤에 작은 금고가 숨겨져 있다.

금고에는 4자리 숫자를 입력하는 다이얼이 달려있다. 금고 위에 네 권의 책이 나란히 꽂혀있다. 교수가 의도적으로 배치한 것 같다.

<b>📕 "로마의 일곱 언덕" — 263페이지
📗 "이집트 제5왕조" — 178페이지
📘 "그리스 12신" — 412페이지
📙 "한국의 삼국시대" — 95페이지</b>

금고 옆에 메모:
"각 책 제목에 숨겨진 숫자가 비밀번호다. 페이지 수에 속지 마라."`,
        question: `교수의 메모를 해석하라.

각 책 <b>제목</b> 속에 숨겨진 숫자를 순서대로 나열하면?

📕 로마의 <b>일곱</b> 언덕
📗 이집트 제<b>5</b>왕조
📘 그리스 <b>12</b>신
📙 한국의 <b>삼국</b>시대

(힌트: 숫자를 아라비아 숫자로 변환)`,
        hint: '일곱=7, 5=5, 12=12, 삼국=3 → 4자리 숫자로...',
        validate: i => i.replace(/\s/g,'') === '75123' || i.replace(/\s/g,'') === '7-5-12-3' || i.replace(/\s/g,'').includes('75123') },
      { type:'cpq', cpqIndex:1,
        story: `금고가 열렸다. 안에는 교수의 비밀 수첩이 있다. 가죽 표지에 "PRIVATE"이라고 각인되어 있다.

수첩을 넘기자, 최근 몇 페이지에 집중적으로 메모가 적혀있다. 날짜별로 정리된 기록인데, 교수가 어떤 장소들을 체계적으로 조사하고 있었다는 것을 알 수 있다.

마지막 페이지에 또 다른 장소가 적혀있다. 빨간 동그라미가 쳐져 있고, 옆에 "여기가 핵심"이라고 적혀있다.

"이 장소의 도보 거리도 확인해야 한다."

교수의 동선을 완전히 파악하려면 이곳도 추적해야 한다.`,
        storyAfter: `두 번째 장소의 걸음 수까지 확인했다. 수첩 마지막 장에 교수가 남긴 결론이 보인다.

"모든 단서를 모았다면, 문 옆 패널을 확인하라. 코드는 내가 이 방에서 가장 소중히 여긴 것들 속에 있다."

교수는 이 서재 자체를 하나의 퍼즐로 설계해둔 것이다. 탈출의 실마리가 보이기 시작한다.` },
      { type:'general', title:'🚪 퍼즐 5: 최종 탈출',
        story: `문 옆을 살펴보니, 벽지 뒤에 숨겨진 디지털 패널이 있다.

패널에는 이상한 화면이 떠있다. 교수가 만든 것 같은 프로그램이다. 화면에 네 명의 캐릭터가 표시되어 있다.

<b>👤 A: "B가 범인이다"
👤 B: "나는 결백하다"
👤 C: "D는 거짓말을 하고 있다"
👤 D: "A가 범인이다"</b>

아래에 규칙이 적혀있다:
<b>"범인은 정확히 한 명. 범인만 거짓말을 한다. 나머지는 모두 진실을 말한다."</b>

패널에 범인의 알파벳을 입력하면 문이 열린다.`,
        question: `논리 퍼즐을 풀어라.

범인은 한 명이고, 범인만 거짓말을 한다.

👤 A: "B가 범인이다"
👤 B: "나는 결백하다"
👤 C: "D는 거짓말을 하고 있다"
👤 D: "A가 범인이다"

범인은 누구인가? (A, B, C, D 중 하나)`,
        hint: 'B가 범인이라고 가정하면? B의 "나는 결백하다"는 거짓(OK). A의 "B가 범인"은 진실(OK). D의 "A가 범인"은 거짓이 되는데... D는 범인이 아니니 진실만 말해야 한다. 모순! 다른 경우를 시도해보자.',
        validate: i => i.toUpperCase().replace(/\s/g,'') === 'A' }
    ]
  },
  {
    id: 'ship', emoji: '🚢', name: '표류된 화물선',
    desc: '동해안에 표류한 무인 화물선. 12명의 선원은 흔적도 없이 사라졌다. 진실을 밝히고 탈출하라.',
    difficulty: 2, time: '15분',
    intro: `동해안에 떠밀려온 화물선 "동해호". 12명의 선원은 흔적도 없이 사라졌다. 구명보트도, 개인 물품도 그대로. 해양경찰인 당신이 조사를 위해 배에 올랐지만, 갑판 해치가 닫히며 갇혔다. 비상등만 깜빡이는 배 안에서 무전기의 의미 불명 신호음만 반복된다. 선원들에게 무슨 일이 일어났는지 밝히고, 해치를 열어 탈출하라.`,
    puzzles: [
      { type:'general', title:'🧭 퍼즐 1: 항해 일지의 마지막 기록',
        story: `선장실에 들어섰다. 테이블 위에 항해 일지가 펼쳐져 있다. 마지막 기록 날짜는 사흘 전.

일지의 대부분은 평범한 항해 기록이다. 마지막 기록:

"2월 11일 23:47 — 레이더에 이상 반응. 선원들이 갑판에서 소리를 들었다고 보고. 확인하러 간다. 금고에 주파수 기록을 넣어뒀다."

선장실 금고에 뭔가 있을 것이다. 금고 위에 세 권의 책이 의도적으로 배치되어 있고, 각 책에 포스트잇이 꽂혀있다. 표시된 페이지를 열면 형광펜으로 칠해진 단어가 보인다.`,
        question: `선장실 금고 위에 책 세 권이 놓여있고 각각 포스트잇이 꽂혀있다.

<b>📕 "해양법 개론" → 표시된 단어: "대한민국"
📗 "항해술의 역사" → 표시된 단어: "나침반"
📘 "선박 구조학" → 표시된 단어: "용골"</b>

금고 메모: "각 단어의 글자 수가 비밀번호다."

세 숫자를 순서대로 이어서 입력하시오.`,
        hint: '대한민국 = 4글자, 나침반 = 3글자, 용골 = 2글자',
        validate: i => i.replace(/\s/g,'') === '432' },
      { type:'cpq', cpqIndex:0,
        story: `"HELP." 선장의 마지막 메시지였다.

항해 일지를 더 넘겨보니, 접혀있던 페이지 사이에서 종이 한 장이 떨어진다. 화물 적하 목록이다. 대부분의 화물은 일반 공산품이지만, 한 항목에 빨간 줄이 그어져 있다.

"특수 화물 #7 — 발송지 확인 요망"

선장은 이 화물의 출처를 추적하고 있었다. 적하 목록에 적힌 발송지 주소 옆에 네이버 검색 기록 메모가 있다.

"이 장소를 직접 확인해야 한다. 도보 거리 측정할 것."

선원 실종과 이 화물 사이에 무슨 관계가 있는 걸까?`,
        storyAfter: `걸음 수를 확인했다. 적하 목록 뒷면에 선장의 추가 메모가 있다.

"화물 #7의 출처를 확인했다. 두 번째 장소도 연결되어 있다. 기관실에 더 많은 기록이 있다."

기관실로 이동하자.` },
      { type:'general', title:'⚓ 퍼즐 3: 기관실의 모스 부호',
        story: `좁은 통로를 지나 기관실에 도착했다. 거대한 엔진은 완전히 멈춰있다. 연료는 충분히 남아있는데, 누군가 의도적으로 엔진을 정지시킨 것 같다.

기관실 벽에 배전반이 있다. 12개의 스위치가 두 줄로 배열되어 있다. 일부는 위(ON), 일부는 아래(OFF) 상태다.

<b>위 아래 아래 위 | 아래 위 아래 아래 | 아래 아래 위 위</b>

배전반 옆에 기관장의 메모:
"이진법이다. 위=1, 아래=0. 4자리씩 끊어서 십진수로 변환하면 내 사물함 번호가 나온다."`,
        question: `배전반의 이진법을 해독하라.

<b>1001 | 0100 | 0011</b>
(위아래아래위 | 아래위아래아래 | 아래아래위위)

각 4자리 이진수를 십진수로 변환하면?
(세 숫자를 이어서 입력. 예: "123")`,
        hint: '1001(2진) = 8+0+0+1 = 9, 0100(2진) = 0+4+0+0 = 4, 0011(2진) = 0+0+2+1 = 3',
        validate: i => i.replace(/\s/g,'') === '943' },
      { type:'cpq', cpqIndex:1,
        story: `SOS. 이 배는 조난 상태다. 하지만 누가 이 신호를 설정했을까?

무전기 아래 서랍을 열자, 기관장의 개인 노트가 나왔다. 기관장 박철수, 53세. 노트에는 일상적인 정비 기록 사이에 수상한 메모가 끼워져 있다.

"선장이 화물 #7을 조사하고 있다. 나도 독자적으로 출처를 추적 중. 아래 장소와 연결고리가 있는 것 같다."

기관장도 같은 것을 추적하고 있었다. 그의 메모에 적힌 또 다른 장소를 확인해야 한다.`,
        storyAfter: `두 번째 장소의 정보까지 확인했다. 기관장의 노트 마지막 페이지에 급하게 적은 메시지가 있다.

"2월 11일 23:50 — 갑판에서 이상한 빛. 선원들이 하나둘 올라가고 있다. 나도 확인하러... 해치 비상 잠금 코드를 남긴다. 누군가 이것을 찾는다면..."

여기서 기록이 끊긴다. 하지만 해치 잠금 코드에 대한 단서를 남겼다. 다시 갑판으로 돌아가자.` },
      { type:'general', title:'🚪 퍼즐 5: 해치 해제',
        story: `갑판으로 돌아왔다. 해치 잠금 장치 옆에 기관장이 테이프로 붙여둔 쪽지가 있다. 끝부분이 찢어져 있지만, 읽을 수 있다.

"코드는 수수께끼로 남긴다. 혹시 그들이... 아니, 누구든 이걸 읽는 사람이 인간인지 확인하기 위해."

그 아래에 수수께끼가 적혀있다.

기관장은 마지막 순간까지 이성적이었다. 해치를 잠그고, 코드를 남기고, 자신은... 다른 선원들과 함께 사라졌다.`,
        question: `기관장의 마지막 퍼즐:

<b>세 명의 선원이 당직 순서를 정했다.
- 김 일등항해사는 박 기관장보다 먼저 근무한다.
- 이 갑판장은 첫 번째로 근무하지 않는다.
- 박 기관장은 마지막으로 근무하지 않는다.</b>

해치 코드 = 각 선원의 근무 순서
(예: 김=1, 이=2, 박=3이면 "김이박")

<b>근무 순서를 "성"만 써서 순서대로 입력하시오.</b>`,
        hint: '박이 마지막이 아니고, 김이 박보다 먼저. 김=1이면 박=2(마지막 아님 OK). 이=3. 이 갑판장이 첫 번째 아닌 것도 OK.',
        validate: i => i.replace(/\s/g,'') === '김박이' }
    ]
  },
  {
    id: 'hotel', emoji: '🏨', name: '호텔 미스터리',
    desc: '5성급 호텔의 VIP가 체크인 직후 사라졌다. 1408호에 남은 흔적을 추적하라.',
    difficulty: 3, time: '15분',
    intro: `5성급 그랜드 파크 호텔. IT 기업 대표 박준호가 체크인 47분 후 사라졌다. CCTV에는 1408호에 들어간 것이 마지막, 이후 어디에도 그의 모습이 없다. 짐도 여권도 그대로. 보안팀장인 당신이 방에 들어섰지만, 전자 잠금장치 에러로 문이 잠겼다. 스위트룸 곳곳에 뭔가 이상한 흔적들이 보인다. 박준호의 비밀을 풀고 탈출하라.`,
    puzzles: [
      { type:'general', title:'🔑 퍼즐 1: 투숙객의 노트북',
        story: `업무용 책상으로 다가간다. 노트북이 열려있고, 화면이 잠금 상태다. 비밀번호 힌트가 화면에 표시되어 있다.

노트북 옆에 호텔 메모지가 있다. 박준호의 글씨로 몇 가지 숫자가 적혀있다.

"1408 — 이 숫자가 불길하다. 스티븐 킹의 소설 제목이기도 하지. 하지만 숫자 자체에 답이 있다."

비밀번호 힌트:
"방 번호 1408에서, 가장 큰 숫자와 가장 작은 숫자의 차이"

박준호는 보안에 민감한 사람이었다. 단순하지만 즉석에서 만든 비밀번호인 것 같다.`,
        question: `노트북 비밀번호를 입력하라.

화면에 이모지 수식이 표시되어 있다:

<b>🏨 + 🏨 = 28
🔑 × 🔑 = 16
🏨 - 🔑 = ?</b>

? 에 들어갈 숫자는?`,
        hint: '🏨+🏨=28이면 🏨=14. 🔑×🔑=16이면 🔑=4. 14-4=?',
        validate: i => i.trim()==='10' },
      { type:'cpq', cpqIndex:0,
        story: `노트북이 열렸다. 브라우저에 최근 검색 기록이 남아있다. 대부분 M&A 관련 자료지만, 마지막 검색이 이상하다. 비즈니스와 전혀 관련 없는 장소를 검색했다.

검색 시간은 체크인 후 약 30분 뒤. 사라지기 17분 전이다.

검색 기록 옆에 메모 앱이 열려있다.
"오늘 밤 이곳을 확인해야 한다. 도보로 갈 수 있는 거리인지 체크."

박준호는 호텔에 도착하자마자 이 장소를 검색했다. 왜? M&A와 관련이 있는 걸까, 아니면 완전히 다른 이유일까?`,
        storyAfter: `걸음 수를 확인했다. 노트북의 메모 앱에 추가 내용이 있다.

"거리 확인 완료. 욕실을 확인하라. 거울 뒤에 진실이 있다."

이것은 박준호 자신이 적은 것이 아니다. 글씨체가 다르다. 누군가 그의 노트북에 메시지를 남겼다... 욕실로 이동하자.` },
      { type:'general', title:'🪞 퍼즐 3: 욕실 거울의 메시지',
        story: `욕실에 들어섰다. 대리석 바닥, 독립형 욕조, 대형 거울. 럭셔리한 공간이다.

세면대의 온수를 틀었다. 뜨거운 증기가 올라오면서, 거울에 숨겨진 글자가 서서히 드러난다. 누군가 거울에 손가락으로 메시지를 적어둔 것이다. 평소에는 보이지 않지만, 김이 서리면 나타나는 트릭.

거울에 나타난 메시지:
"도움을 청하라"

하지만 거울에 비친 것이므로, 실제로는 좌우가 반전되어 있다. 원래 적힌 문자열이 무엇인지 파악해야 한다. 거울에 적는 사람 입장에서, 보는 사람이 읽을 때 "도움을 청하라"가 되려면, 실제로 적힌 글자 순서는 뒤집혀있을 것이다.`,
        question: `거울에 숫자가 나타났다. 거울이므로 좌우가 반전되어 보인다.

거울에 비친 숫자: <b>5765</b>

이 숫자들을 거울에 비추면 좌우반전된다.
실제 숫자(거울 바깥에서 본 원래 숫자)를 입력하라.

(힌트: 숫자 순서가 뒤집힌다)`,
        hint: '거울은 좌우를 반전시킨다. 5765를 거울에 비추면 순서가 뒤집혀서 5675가 된다.',
        validate: i => i.trim()==='5675' },
      { type:'cpq', cpqIndex:1,
        story: `거울 메시지를 해독했다. 거울 아래 타일 하나가 살짝 들떠있는 것을 발견했다. 타일을 들어올리자, 안에 작은 금고가 숨겨져 있다. 호텔에서 제공하는 객실 금고가 아니라, 누군가 별도로 설치한 것이다.

금고는 이미 열려있다. 안에는 박준호의 일정표와 메모가 있다. 일정표에는 서울에서의 미팅 스케줄이 적혀있지만, 마지막 항목이 이상하다.

"2월 14일 22:00 — [장소 확인 필요]. 반드시 도보로 거리 측정할 것."

또 다른 장소다. 박준호는 이 호텔을 거점으로 여러 장소를 조사하고 있었다.`,
        storyAfter: `두 장소의 정보를 모두 확인했다. 금고 안에 접힌 편지가 하나 더 있다. 박준호가 자신에게 쓴 것 같은 메모다.

"여기까지 추적했다면, 마지막 단서는 침대 헤드보드 뒤에 있다. 비밀 통로를 찾아라. 코드가 필요하다."

박준호는 실종된 것이 아니라... 스스로 사라진 것일까? 침대로 이동하자.` },
      { type:'general', title:'🚪 퍼즐 5: 비밀 통로',
        story: `침대 헤드보드를 밀어보니, 벽면에 숨겨진 패널이 있다. 오래된 호텔의 비밀 통로다. 아마 건축 당시부터 있었던 것 같다. 박준호는 이 통로의 존재를 알고 이 방을 지정한 것이다.

패널의 잠금장치에 숫자 키패드가 있다. 코드를 입력해야 한다.

패널 옆에 마지막 메모가 테이프로 붙어있다.

"코드 = 이 방에서 발견한 모든 숫자의 합.
체크인 시간, 체크아웃 시간, 방 번호, 층 수."

아래에 작은 글씨로 적혀있다.
"체크인: 14시, 체크아웃: 08시, 방: 1408호, 층: 14층"`,
        question: `박준호의 타임라인을 분석하라.

<b>체크인 시각: 21:00
마지막 CCTV: 21:03 (방 입장)
노트북 검색 시각: 21:30
실종 추정 시각: 21:47</b>

"비밀번호 = 체크인부터 실종까지 걸린 시간(분)"

몇 분인가?`,
        hint: '21:00에 체크인, 21:47에 실종. 47 - 0 = ?',
        validate: i => i.trim()==='47' }
    ]
  },
  {
    id: 'hospital', emoji: '🏥', name: '폐병원 304호',
    desc: '10년 전 폐쇄된 병원. 304호에서 밤마다 불빛이 목격된다.',
    difficulty: 2, time: '15분',
    intro: `10년 전 의료사고로 폐쇄된 성모병원. 304호 병실에서 밤마다 의문의 불빛이 목격되고 있다. 병원 경비로 일하는 당신은 진상을 파악하기 위해 304호에 잠입했지만, 문이 자동으로 잠겼다. 썩은 냄새와 삐걱거리는 소리, 복도 끝에서 들려오는 의문의 신음소리. 이곳에 숨겨진 진실을 밝히고 탈출하라.`,
    puzzles: [
      { type:'general', title:'💊 퍼즐 1: 환자 차트의 암호',
        story: `304호 침대 옆 테이블에 낡은 환자 차트가 놓여있다. 페이지가 찢어져 있지만, 마지막 기록이 흥미롭다.

"환자 박민수 (남, 45세) - 처방전: 매일 3회 복용, 아침 2정, 점심 1정, 저녁 3정"

차트 뒤편에 간호사가 연필로 적어둔 메모가 있다.
"환자가 하루에 복용하는 총 알약 수가 중요하다. 그 숫자가 열쇠다."

침대 아래에서 작은 금고를 발견했다. 숫자 3자리를 입력하는 다이얼 락이 달려있다.`,
        question: `환자 차트를 분석하라.

<b>처방전 내용:</b>
- 매일 3회 복용
- 아침: 2정
- 점심: 1정  
- 저녁: 3정

환자가 하루에 복용하는 <b>총 알약 수</b>를 계산하여 입력하시오.`,
        hint: '아침 2정 + 점심 1정 + 저녁 3정 = ?',
        validate: i => i.trim() === '6' },
      { type:'cpq', cpqIndex:0,
        story: `금고가 열렸다. 안에는 의사 김영호의 개인 수첩이 들어있다. 수첩에는 병원 폐쇄 직전의 기록들이 적혀있다.

"환자들의 증상이 갑자기 악화되기 시작했다. 원인을 찾기 위해 이 장소를 조사해야 한다."

수첩에 적힌 의심스러운 장소의 주소가 있다. 김 의사는 병원 폐쇄의 진짜 원인을 추적하고 있었다.

"이곳까지의 거리를 반드시 확인할 것. 도보로 얼마나 걸리는지..."`,
        storyAfter: `김 의사가 조사했던 거리를 확인했다. 수첩의 다음 페이지에 충격적인 기록이 적혀있다.

"진실을 발견했다. 하지만 그들이 나를 찾고 있다. 창문으로 탈출해야 한다."

창가로 이동하자.` },
      { type:'general', title:'🔬 퍼즐 3: 창가의 화학 공식',
        story: `창가에 작은 실험대가 있다. 김 의사가 마지막까지 분석을 시도했던 흔적이다. 시약병 몇 개와 화학 공식이 적힌 메모가 남아있다.

<b>H₂O + NaCl = ?
2H₂ + O₂ = 2H₂O
C₆H₁₂O₆ + 6O₂ = 6CO₂ + 6H₂O</b>

창문에 김 의사가 손가락으로 쓴 메시지가 있다. 먼지가 쌓여 희미하게 보인다.

"원소 기호의 첫 글자를 모아라. 순서대로 읽으면 탈출 코드다."

실험대 위의 화학식에서 모든 원소 기호를 찾아야 한다.`,
        question: `화학 공식에서 나타나는 모든 원소를 찾아라.

<b>H₂O + NaCl = ?
2H₂ + O₂ = 2H₂O  
C₆H₁₂O₆ + 6O₂ = 6CO₂ + 6H₂O</b>

등장하는 원소: H(수소), O(산소), Na(나트륨), Cl(염소), C(탄소)

<b>각 원소의 첫 글자</b>를 순서대로 나열하면?
(H, O, N, C, C 순서로)`,
        hint: 'H=수소=H, O=산소=O, Na=나트륨=N, Cl=염소=C, C=탄소=C',
        validate: i => i.toUpperCase().replace(/\s/g,'') === 'HONCC' },
      { type:'cpq', cpqIndex:1,
        story: `화학 공식을 해독했다. 창문 손잡이가 돌아가면서 비밀 서랍이 나타났다. 김 의사의 최종 조사 보고서가 숨겨져 있다.

"병원 폐쇄의 진짜 원인을 찾았다. 이 장소가 모든 것의 시발점이었다."

보고서에는 또 다른 의심스러운 장소가 적혀있다. 김 의사가 마지막으로 추적했던 핵심 장소다.

"여기까지의 도보 거리를 측정해야 한다. 모든 퍼즐이 완성될 것이다."`,
        storyAfter: `모든 조사를 완료했다. 김 의사의 보고서 마지막 장에 충격적인 진실이 기록되어 있다.

"304호의 비밀은 침대 아래에 있다. 바닥 타일을 확인하라. 최종 탈출 코드가 숨겨져 있다."

침대 아래로 돌아가자.` },
      { type:'general', title:'🚪 퍼즐 5: 304호의 비밀',
        story: `침대 아래 바닥을 자세히 살펴보니, 한 장의 타일이 미묘하게 들떠있다. 타일을 들어올리자 디지털 패널이 나타난다.

패널에는 병원의 마지막 환자 명단이 표시되어 있다. 304호에 입원했던 환자들의 기록이다.

<b>🏥 304호 환자 명단 (폐쇄 전 마지막 주)
월: 김철수(37세), 박영희(42세)
화: 이민호(28세), 정수진(35세), 최영수(51세)  
수: 홍길동(45세)
목: (공실)
금: 장민정(33세), 윤서연(29세)
토: 오태식(48세)
일: (공실)</b>

패널 아래 메시지: "가장 많은 환자가 입원했던 요일의 환자 수가 탈출 코드다."`,
        question: `304호 환자 명단을 분석하라.

각 요일별 환자 수:
- 월요일: 2명 (김철수, 박영희)
- 화요일: 3명 (이민호, 정수진, 최영수)
- 수요일: 1명 (홍길동)
- 목요일: 0명 (공실)
- 금요일: 2명 (장민정, 윤서연)
- 토요일: 1명 (오태식)
- 일요일: 0명 (공실)

<b>가장 많은 환자가 입원했던 요일의 환자 수</b>는?`,
        hint: '각 요일의 환자 수를 세어보자. 월(2), 화(3), 수(1), 목(0), 금(2), 토(1), 일(0). 가장 많은 것은?',
        validate: i => i.trim() === '3' }
    ]
  },
  {
    id: 'magician', emoji: '🎪', name: '마술사의 비밀 방',
    desc: '유명 마술사 최현우가 공연 중 무대에서 사라졌다. 그의 비밀 방에 단서가 있다.',
    difficulty: 1, time: '12분',
    intro: `유명 마술사 최현우가 "대탈출" 공연 중 무대에서 사라진 지 일주일. 경찰은 수사를 포기했지만, 마술사 매니저인 당신은 포기할 수 없다. 극장 뒷편 숨겨진 비밀 방에 잠입했지만, 마술 장치가 작동하며 문이 봉쇄됐다. 거울, 카드, 실크 스카프... 마술사의 모든 비밀이 이곳에 있다. 그의 마지막 트릭을 해결하고 진실을 밝혀라.`,
    puzzles: [
      { type:'general', title:'🃏 퍼즐 1: 마술사의 카드 트릭',
        story: `방 중앙에 벨벳 테이블이 있고, 그 위에 카드 한 벌이 펼쳐져 있다. 최현우가 즐겨 사용하던 특별한 카드들이다.

테이블 위에 메모가 놓여있다.
"내 가장 좋아하는 마술: 수학의 마법"

카드들이 특별한 패턴으로 배열되어 있다.

<b>♠A ♠2 ♠3 ♠4 ♠5
♥2 ♥4 ♥6 ♥8 ♥?
♦1 ♦3 ♦5 ♦7 ♦?
♣3 ♣6 ♣9 ♣12 ♣?</b>

테이블 모서리에 작은 금고가 있다. "물음표에 들어갈 세 숫자"를 입력하라는 메모가 붙어있다.`,
        question: `카드 패턴을 분석하라.

<b>♠A(1) ♠2 ♠3 ♠4 ♠5</b> ← +1씩
<b>♥2 ♥4 ♥6 ♥8 ♥?</b> ← +2씩  
<b>♦1 ♦3 ♦5 ♦7 ♦?</b> ← +2씩
<b>♣3 ♣6 ♣9 ♣12 ♣?</b> ← +3씩

각 줄의 물음표에 들어갈 숫자는?
♥=?, ♦=?, ♣=?

세 숫자를 순서대로 입력하시오. (예: "10911")`,
        hint: '♥: 2,4,6,8,? → 10, ♦: 1,3,5,7,? → 9, ♣: 3,6,9,12,? → 15',
        validate: i => i.replace(/\s/g,'') === '10915' },
      { type:'cpq', cpqIndex:0,
        story: `카드 트릭을 해결했다. 금고 안에서 최현우의 개인 다이어리를 발견했다. 마지막 페이지가 접혀있다.

"그들이 내 뒤를 쫓고 있다. 내가 발견한 비밀 때문이다. 이 장소에서 모든 것이 시작됐다."

다이어리에는 최현우가 조사하고 있던 의문의 장소가 적혀있다. 그의 실종과 관련된 핵심 단서인 것 같다.

"이곳까지 걸어서 얼마나 걸리는지 반드시 확인해야 한다."

최현우의 발자취를 따라가야 한다.`,
        storyAfter: `거리를 확인했다. 다이어리 접힌 페이지를 펼치니 놀라운 내용이 드러난다.

"진실을 알게 됐다. 하지만 이제 안전하지 않다. 마지막 단서는 거울 속에 숨겨뒀다."

방 곳곳에 설치된 마술용 거울들 중 하나에 비밀이 있을 것이다.` },
      { type:'general', title:'🪞 퍼즐 3: 마법의 거울',
        story: `방의 한쪽 벽면에 커다란 마술용 거울이 걸려있다. 겉보기에는 평범하지만, 자세히 보니 거울 표면에 이상한 점들이 있다.

거울에 손을 대자, LED가 켜지면서 숨겨진 패턴이 나타난다. 거울 표면에 점들이 5x5 격자로 배열되어 있다.

<b>● ○ ● ○ ●
○ ● ○ ● ○  
● ○ ○ ○ ●
○ ● ○ ● ○
● ○ ● ○ ○</b>

거울 하단에 메모: "검은 점(●)의 개수를 세어라. 그것이 다음 열쇠다."

패턴을 정확히 세어야 한다.`,
        question: `거울의 LED 패턴을 분석하라.

<b>● ○ ● ○ ●</b> ← 3개
<b>○ ● ○ ● ○</b> ← 2개
<b>● ○ ○ ○ ●</b> ← 2개
<b>○ ● ○ ● ○</b> ← 2개
<b>● ○ ● ○ ○</b> ← 2개

검은 점(●)의 총 개수는?`,
        hint: '각 줄을 차례대로 세어보자. 1줄(3) + 2줄(2) + 3줄(2) + 4줄(2) + 5줄(2) = ?',
        validate: i => i.trim() === '11' },
      { type:'cpq', cpqIndex:1,
        story: `거울의 비밀을 풀었다. 거울이 회전하면서 뒤편에 숨겨진 서랍이 나타난다. 최현우의 마지막 조사 자료가 들어있다.

"모든 퍼즐이 이 장소로 연결된다. 내가 사라지기 전에 반드시 확인해야 할 마지막 장소다."

서랍 안에는 또 다른 주소가 적힌 메모가 있다. 최현우가 실종되기 직전에 방문하려 했던 곳인 것 같다.

"여기까지의 도보 시간을 정확히 측정하라. 그것이 마지막 열쇠가 될 것이다."`,
        storyAfter: `최종 목적지까지의 거리를 확인했다. 서랍 안에서 최현우가 남긴 마지막 메시지를 발견했다.

"진실을 알아버렸다. 하지만 이제 더 이상 안전하지 않다. 실크 스카프 아래 마지막 장치를 만들어뒀다."

방 한쪽에 걸린 화려한 실크 스카프를 확인해보자.` },
      { type:'general', title:'🚪 퍼즐 5: 대탈출의 비밀',
        story: `벽에 걸린 실크 스카프를 들어올리자, 그 뒤에 최현우의 마지막 마술 장치가 숨겨져 있다.

디지털 패널에 이상한 문제가 표시되어 있다.

<b>"마술사의 마지막 트릭"</b>

<b>🎩 + 🎩 + 🎩 = 24
🎪 + 🎪 + 🎩 = 20  
🎪 + 🃏 + 🃏 = 18
🃏 + 🎩 × 🎪 = ?</b>

패널 아래 메시지: "이것이 내 마지막 마술이다. 답을 맞히면 진실로 이어지는 문이 열린다."

최현우가 준비한 최종 수학 퍼즐이다.`,
        question: `마술사의 수식 퍼즐을 풀어라.

<b>🎩 + 🎩 + 🎩 = 24</b> → 🎩 = 8
<b>🎪 + 🎪 + 🎩 = 20</b> → 🎪 + 🎪 + 8 = 20 → 🎪 = 6  
<b>🎪 + 🃏 + 🃏 = 18</b> → 6 + 🃏 + 🃏 = 18 → 🃏 = 6
<b>🃏 + 🎩 × 🎪 = ?</b>

마지막 계산의 답은? (곱셈 먼저 계산)`,
        hint: '🃏=6, 🎩=8, 🎪=6. 🃏 + 🎩 × 🎪 = 6 + (8 × 6) = 6 + 48 = ?',
        validate: i => i.trim() === '54' }
    ]
  },
  {
    id: 'school', emoji: '🏫', name: '야간 학교의 비밀',
    desc: '명문 사립학교에서 야간 자율학습 중 3명의 학생이 실종됐다. 교실에 남은 단서를 찾아라.',
    difficulty: 2, time: '14분',
    intro: `명문 사립 세종고등학교. 야간 자율학습 중 3학년 2반 학생 3명이 동시에 사라졌다. 교실에는 책상과 의자만 어지럽게 널려있고, 칠판에는 의문의 숫자들이 적혀있다. 담임교사인 당신이 진상을 파악하기 위해 밤늦게 교실에 왔지만, 갑자기 문이 잠기며 전등이 꺼졌다. 비상등만 깜빡이는 교실에서 학생들의 마지막 흔적을 따라 진실을 밝혀라.`,
    puzzles: [
      { type:'general', title:'📚 퍼즐 1: 사물함의 조합',
        story: `교실 뒤편에 학생들의 개인 사물함이 있다. 실종된 학생 중 한 명인 김민수의 사물함이 반쯤 열려있다.

사물함 문에 민수가 연필로 적어둔 메모가 있다.

<b>"조합번호를 까먹을까 봐 힌트를 남겨둔다.
첫 번째 숫자: 우리 반 번호 × 2
두 번째 숫자: 내 생일 월 + 일 (12월 8일)
세 번째 숫자: 우리가 앉은 줄 수 (교실 창가부터)"</b>

교실 문에 "3-2" 표시가 있고, 창가부터 5번째 줄에 민수 자리가 있다.

사물함의 디지털 자물쇠에 3자리 숫자를 입력해야 한다.`,
        question: `민수의 사물함 조합을 계산하라.

<b>힌트 해석:</b>
- 첫 번째: 반 번호(2) × 2 = ?
- 두 번째: 생일 월(12) + 일(8) = ?  
- 세 번째: 창가부터 줄 수 = 5

세 숫자를 이어서 입력하시오. (예: "4205")`,
        hint: '2×2=4, 12+8=20, 줄 수=5 → "4205"',
        validate: i => i.replace(/\s/g,'') === '4205' },
      { type:'cpq', cpqIndex:0,
        story: `민수의 사물함이 열렸다. 안에는 교과서와 함께 이상한 쪽지가 들어있다. 민수가 급하게 적은 것 같다.

"오늘 밤 우리가 발견한 비밀을 확인하러 간다. 선생님이 숨기고 있는 진실이 이 장소에 있다."

쪽지에는 학교 근처의 한 장소 주소가 적혀있다. 민수와 친구들이 그날 밤 향했던 곳인 것 같다.

"이곳까지 학교에서 걸어서 얼마나 걸리는지 확인해야 한다."

학생들의 마지막 행적을 추적해보자.`,
        storyAfter: `학생들이 향했던 장소까지의 거리를 확인했다. 사물함 안쪽에 또 다른 메모가 붙어있다.

"진짜 비밀은 칠판 뒤에 있다. 선생님도 모르는 학교의 숨겨진 역사."

교실 앞 칠판을 확인해보자.` },
      { type:'general', title:'📐 퍼즐 3: 칠판의 수학 문제',
        story: `칠판에 학생들이 풀다가 만 수학 문제가 적혀있다. 복잡한 기하학 문제인데, 중간에 이상한 숫자들이 끼워져 있다.

<b>정육각형의 내각의 합은?
- 삼각형의 내각의 합: 180°
- 사각형의 내각의 합: 360°  
- 오각형의 내각의 합: 540°
- 육각형의 내각의 합: ?</b>

칠판 귀퉁이에 작은 글씨로 적힌 메모:
"패턴을 찾아라. (n-2) × 180"

학생들이 이 문제를 풀다가 뭔가를 깨달았던 것 같다.`,
        question: `다각형 내각의 합 공식을 적용하라.

<b>패턴 분석:</b>
- 삼각형(3): (3-2) × 180 = 180°
- 사각형(4): (4-2) × 180 = 360°
- 오각형(5): (5-2) × 180 = 540°
- 육각형(6): (6-2) × 180 = ?

정육각형의 내각의 합은 몇 도인가?`,
        hint: '육각형은 6각형이니까 (6-2) × 180 = 4 × 180 = ?',
        validate: i => i.trim() === '720' },
      { type:'cpq', cpqIndex:1,
        story: `수학 문제를 풀자 칠판이 살짝 움직인다. 뒤편에 숨겨진 공간이 있다. 학교의 오래된 비밀 자료실인 것 같다.

벽에 붙은 오래된 신문 스크랩들이 있다. "세종고 화재 사고", "학생 실종 사건", "은폐된 진실"... 학교 역사상 가장 어두운 사건들의 기록이다.

스크랩 사이에서 최근 인쇄된 문서 하나를 발견했다. 실종된 학생들이 조사하고 있던 또 다른 장소의 정보다.

"이 장소가 모든 사건의 연결고리다. 도보 거리를 확인하라."`,
        storyAfter: `두 번째 장소까지의 정보를 확인했다. 자료실 깊숙한 곳에서 학생들이 남긴 마지막 메시지를 발견했다.

"진실을 알았다. 하지만 이제 우리는 안전하지 않다. 마지막 단서는 선생님 책상 서랍에 있다."

교무실로 향해야 할 것 같다. 하지만 교실 앞 선생님 책상도 확인해보자.` },
      { type:'general', title:'🚪 퍼즐 5: 선생님의 비밀',
        story: `교실 앞 선생님 책상의 잠긴 서랍을 발견했다. 서랍에는 전자 잠금장치가 달려있고, 화면에 논리 퍼즐이 표시되어 있다.

<b>세종고 3학년 학생회 선거 후보</b>

<b>- 민지는 "수호가 회장이 될 것"이라고 말했다.
- 수호는 "민지가 거짓말을 하고 있다"고 말했다.  
- 현우는 "내가 회장이 될 것"이라고 말했다.
- 지원이는 "현우가 거짓말을 하고 있다"고 말했다.</b>

화면 하단 메시지: "한 명만 회장이 되고, 한 명만 진실을 말한다. 회장이 된 학생의 이름 첫 글자를 입력하라."

학생들이 이 문제를 풀고 있었다.`,
        question: `논리 퍼즐을 풀어라.

4명의 후보 중 한 명만 회장, 한 명만 진실을 말한다고 가정:

- 민지: "수호가 회장"
- 수호: "민지가 거짓말"  
- 현우: "내가 회장"
- 지원: "현우가 거짓말"

<b>누가 회장이 되었는가?</b>
회장의 이름 첫 글자를 입력하시오. (ㅁ, ㅅ, ㅎ, ㅈ)`,
        hint: '현우가 회장이라고 가정해보자. 현우의 "내가 회장"=진실(OK). 지원의 "현우가 거짓말"=거짓(OK). 민지의 "수호가 회장"=거짓(OK). 수호의 "민지가 거짓말"=진실(OK). 그런데 진실을 말하는 사람이 현우와 수호 두 명?',
        validate: i => i === 'ㅅ' || i.toLowerCase() === 's' || i === '수호' }
    ]
  },
  {
    id: 'detective', emoji: '🕵️', name: '탐정 사무소의 수수께끼',
    desc: '베테랑 사립탐정 장혜린이 중요한 사건을 조사하던 중 사라졌다. 사무소에 남은 단서를 추적하라.',
    difficulty: 1, time: '11분',
    intro: `20년 경력의 베테랑 사립탐정 장혜린이 3일째 연락이 없다. 그녀가 마지막으로 조사하던 '황금 상속 사건'의 결정적 단서를 찾았다는 전화를 남기고 사라졌다. 조수인 당신이 사무소에 와보니 책상 위는 어수선하고, 금고는 열려있다. 갑자기 사무소 문이 잠기며 "진짜 탐정이라면 이것을 풀어보라"는 음성이 들려온다. 장혜린이 남긴 마지막 퍼즐을 해결하고 진실에 다가가라.`,
    puzzles: [
      { type:'general', title:'🔍 퍼즐 1: 탐정의 알리바이 시간표',
        story: `장혜린의 책상 위에 사건 수첩이 펼쳐져 있다. '황금 상속 사건' 용의자 4명의 알리바이를 정리한 시간표다.

<b>2월 14일 오후 8시 ~ 10시 (사건 발생 시간)</b>

<b>🤵 김대표: 8시 레스토랑 → 9시 집 도착 → 10시 잠자리</b>
<b>👩 박차장: 8시 영화관 → 9시30분 영화 종료 → 10시 귀가</b>  
<b>👨 최부장: 8시 회사 야근 → 9시 편의점 → 10시 집</b>
<b>👧 이비서: 8시 헬스장 → 9시 사우나 → 10시30분 집 도착</b>

시간표 옆에 장혜린의 메모:
"범인은 9시부터 9시30분 사이에 자유시간이 있었던 사람이다."

각 용의자의 9시 ~ 9시30분 상황을 분석해야 한다.`,
        question: `용의자들의 알리바이를 분석하라.

<b>9시 ~ 9시30분 동안:</b>
- 김대표: 집에 있음 (9시 집 도착)
- 박차장: 영화 관람 중 (9시30분 종료)
- 최부장: 편의점에서 집으로 이동 중  
- 이비서: 사우나에 있음

"9시부터 9시30분 사이에 <b>자유시간</b>이 있었던 사람"은 누구인가?

해당 용의자의 성씨를 입력하시오. (김, 박, 최, 이)`,
        hint: '김대표는 집에 있고, 박차장은 영화 중, 이비서는 사우나 중. 최부장만 편의점에서 집까지 이동하는 동안 자유시간이...',
        validate: i => i.trim() === '최' },
      { type:'cpq', cpqIndex:0,
        story: `장혜린의 추리가 맞았다. 수첩 다음 페이지에는 최부장을 추적한 기록이 있다.

"최부장이 회사에서 나온 후 실제로 향한 곳을 확인했다. 편의점이 아니라 이곳을 갔다 왔다."

장혜린이 적어둔 주소가 있다. 최부장의 진짜 알리바이를 확인하기 위해 장혜린이 직접 조사했던 장소다.

"이곳까지 회사에서 도보로 얼마나 걸리는지 측정이 필요하다. 시간이 맞아떨어지는지 확인해야 한다."

장혜린의 수사 방식을 따라가보자.`,
        storyAfter: `장혜린이 조사했던 거리를 확인했다. 수첩에 계속 이어지는 기록이 있다.

"최부장의 거짓 알리바이를 확인했다. 하지만 진짜 문제는 따로 있었다. 금고 안의 서류를 확인하라."

사무소 한쪽 금고가 열려있다. 장혜린이 의도적으로 열어둔 것 같다.` },
      { type:'general', title:'💰 퍼즐 3: 상속 재산의 암호',
        story: `금고 안에는 '황금 상속 사건'의 핵심 서류들이 정리되어 있다. 피상속인 故 황금남 회장의 유언장과 재산 목록이다.

유언장에 이상한 암호가 적혀있다.

<b>📜 "나의 재산을 다음과 같이 나눈다"

아들 = 전체의 1/2
딸 = 전체의 1/3  
손자 = 전체의 1/6
자선단체 = 나머지</b>

유언장 하단에 황 회장이 직접 적은 메모:
"암호가 맞지 않으면 유언장은 무효다. 분수의 합이 1이 되는지 확인하라."

장혜린이 빨간 펜으로 표시한 부분: "이 계산이 핵심이다!"`,
        question: `상속 비율을 계산하라.

<b>재산 분배:</b>
- 아들: 1/2 = 3/6
- 딸: 1/3 = 2/6  
- 손자: 1/6 = 1/6
- 자선단체: 나머지

분수의 합: 3/6 + 2/6 + 1/6 = ?/6

자선단체가 받을 몫은 전체 중 몇 분의 몇인가?
(분수 형태로 입력. 예: 1/6)`,
        hint: '3/6 + 2/6 + 1/6 = 6/6 = 1. 전체가 1이므로 자선단체 몫은 0이다. 즉, 0/6 = 0',
        validate: i => i.trim() === '0' || i.trim() === '0/6' || i.includes('0') },
      { type:'cpq', cpqIndex:1,
        story: `상속 계산을 완료했다. 유언장이 완벽하다는 것을 확인한 순간, 금고 뒤편에서 또 다른 서류를 발견했다.

장혜린이 남긴 조사 노트다. "진짜 범인은 최부장이 아니다. 상속 서류를 조작하려던 진짜 배후가 따로 있다."

노트에는 장혜린이 마지막으로 조사하려던 결정적 장소가 적혀있다. 진짜 흑막을 찾기 위해 향하려던 곳이다.

"이곳에서 모든 진실이 밝혀질 것이다. 도보 거리를 반드시 확인하라."`,
        storyAfter: `장혜린의 마지막 행선지까지 확인했다. 조사 노트 마지막 장에 충격적인 발견이 기록되어 있다.

"진범을 찾았다. 하지만 그들이 나를 감시하고 있다. 혹시 누군가 이 사무소에 온다면... 책장 뒤의 비밀 금고를 확인하라."

책장을 확인해보자.` },
      { type:'general', title:'🚪 퍼즐 5: 탐정의 마지막 메시지',
        story: `사무소 한쪽 책장을 밀어보니, 뒤편에 작은 디지털 금고가 숨겨져 있다. 장혜린이 마지막 순간에 설치한 것 같다.

금고 화면에 메시지가 떠있다.

<b>"진짜 탐정이라면 이 문제를 풀 수 있을 것이다."</b>

<b>🔍 탐정 사무소에 의뢰인 4명이 왔다:
- A씨: "B씨가 범인입니다"
- B씨: "C씨가 범인입니다"  
- C씨: "A씨가 거짓말하고 있습니다"
- D씨: "B씨는 무고합니다"

범인은 한 명이고, 범인만 거짓말을 한다.</b>

하단 메시지: "범인을 찾아 알파벳을 입력하라."`,
        question: `탐정의 논리 퍼즐을 풀어라.

범인은 한 명, 범인만 거짓말을 한다:

- A: "B가 범인"
- B: "C가 범인"
- C: "A가 거짓말"  
- D: "B는 무고"

<b>누가 범인인가?</b> (A, B, C, D)`,
        hint: 'C가 범인이라고 가정해보자. C의 "A가 거짓말"=거짓(범인이니까). 그러면 A의 "B가 범인"=진실이어야 하는데, C가 범인이니 A는 거짓말하고 있어야... 모순! 다른 경우를 시도해보자.',
        validate: i => i.toUpperCase().trim() === 'D' }
    ]
  },
  {
    id: 'orphanage', emoji: '🏚️', name: '버려진 고아원의 저주',
    desc: '30년 전 폐쇄된 구세주 고아원. 밤마다 아이들의 울음소리가 들린다는 소문이 있다.',
    difficulty: 3, time: '18분',
    intro: `30년 전 의문의 화재로 폐쇄된 구세주 고아원. 지역 주민들은 밤마다 아이들의 울음소리가 들린다고 말한다. 심령 조사관인 당신이 진상을 파악하기 위해 들어섰지만, 현관문이 저절로 닫히며 잠겼다. 썩은 나무 냄새와 곰팡이 냄새가 진동하고, 복도 끝에서 작은 발자국 소리가 들려온다. 30년 전 그날 밤 무슨 일이 일어났는지 밝히고, 이곳에 갇힌 영혼들을 해방시켜라.`,
    puzzles: [
      { type:'general', title:'👶 퍼즐 1: 아이들의 이름 암호',
        story: `고아원 현관 옆 사무실에 들어섰다. 30년 전 그대로 방치된 공간이다. 책상 위에 '재원생 명단'이라고 적힌 낡은 장부가 펼쳐져 있다.

화재 당시 고아원에 있던 아이들의 이름이 적혀있다.

<b>📖 재원생 명단 (1994년 2월)
김민수, 박영희, 이철호, 정수진, 최영수
장미나, 오태식, 윤서연, 홍길동, 강혜진</b>

장부 옆에 원장 수녀가 남긴 메모가 있다.
"아이들을 기억하는 방법: 각 이름의 첫 글자를 가나다 순으로 정렬했을 때, 다섯 번째 글자가 비밀번호다."

사무실 구석에 작은 금고가 있고, 한 글자만 입력하면 되는 자물쇠가 달려있다.`,
        question: `아이들 이름의 첫 글자를 분석하라.

<b>이름들:</b> 김민수, 박영희, 이철호, 정수진, 최영수, 장미나, 오태식, 윤서연, 홍길동, 강혜진

<b>첫 글자들:</b> 김, 박, 이, 정, 최, 장, 오, 윤, 홍, 강

이를 가나다 순으로 정렬하면?
강, 김, 박, 오, 윤, 이, 장, 정, 최, 홍

<b>다섯 번째 글자</b>는?`,
        hint: '가나다 순: ㄱ(강), ㄱ(김), ㄱ(박)... 아니다. 강(ㄱ), 김(ㄱ), 오(ㅇ), 박(ㅂ), 윤(ㅇ), 이(ㅇ), 장(ㅈ), 정(ㅈ), 최(ㅊ), 홍(ㅎ)',
        validate: i => i.trim() === '윤' || i.trim() === 'ㅇ' },
      { type:'cpq', cpqIndex:0,
        story: `금고가 열렸다. 안에는 원장 수녀의 일기장이 들어있다. 화재 직전의 기록들이 적혀있다.

"아이들이 이상한 행동을 보이기 시작했다. 밤마다 어딘가로 나가려 한다. 그들이 말하는 '그 장소'가 무엇인지 확인해야 한다."

일기장에는 수녀가 아이들을 따라가 본 장소의 주소가 적혀있다. 화재 사건과 관련된 결정적 장소인 것 같다.

"이곳까지 고아원에서 아이들이 걸어갔다. 얼마나 걸리는지 확인해야 한다."

30년 전 그날 밤 아이들의 마지막 행적을 따라가야 한다.`,
        storyAfter: `아이들이 마지막으로 향했던 장소까지의 거리를 확인했다. 일기장 접힌 페이지를 펼치니 수녀의 마지막 기록이 나타난다.

"진실을 알게 됐다. 하지만 이제 너무 늦었다. 아이들을 지키기 위해... 놀이방에 마지막 단서를 남겨둔다."

2층 놀이방으로 이동해야 할 것 같다.` },
      { type:'general', title:'🧸 퍼즐 3: 놀이방의 이진법',
        story: `삐걱거리는 계단을 올라 2층 놀이방에 도착했다. 30년 전 아이들이 마지막으로 놀았던 공간이다.

벽면에 걸린 칠판에 이상한 그림이 그려져 있다. 아이들이 그린 것이 아니라, 수녀가 남긴 암호인 것 같다.

<b>🌟 ⚫ 🌟 ⚫ 🌟 ⚫ ⚫ 🌟</b>

칠판 아래에 수녀의 메모:
"별은 1, 검은 동그라미는 0이다. 이진법을 십진법으로 바꾸면 답이 나온다."

놀이방 구석에 장난감 상자가 있고, 3자리 숫자를 입력하는 자물쇠가 달려있다.`,
        question: `칠판의 이진법을 해독하라.

<b>🌟 ⚫ 🌟 ⚫ 🌟 ⚫ ⚫ 🌟</b>
= 1 0 1 0 1 0 0 1

8자리 이진법 10101001을 십진법으로 변환하면?

계산: 1×128 + 0×64 + 1×32 + 0×16 + 1×8 + 0×4 + 0×2 + 1×1 = ?`,
        hint: '128 + 32 + 8 + 1 = ?',
        validate: i => i.trim() === '169' },
      { type:'cpq', cpqIndex:1,
        story: `장난감 상자가 열렸다. 안에는 아이들의 그림일기와 함께 충격적인 진실이 담긴 편지가 들어있다.

편지는 당시 고아원 이사장이 쓴 것이다. "고아원을 팔기 위해 계획적으로 화재를 일으켰다"는 고백이 적혀있다.

"아이들이 이 비밀을 알게 됐다. 그들이 증거를 찾아 이 장소로 향했다."

편지에는 이사장이 증거를 숨겨둔 또 다른 장소의 주소가 적혀있다. 아이들이 그날 밤 찾으려 했던 결정적 증거의 위치다.

"이곳까지의 거리를 확인하라. 30년 전 진실이 그곳에 있다."`,
        storyAfter: `증거가 숨겨진 장소까지의 정보를 확인했다. 편지 뒷면에 이사장의 마지막 고백이 적혀있다.

"아이들이 진실을 폭로하려 했지만... 나는 그들을 막기 위해... 원장 수녀만이 진짜 비밀을 안다. 지하실을 확인하라."

고아원 지하실로 내려가야 한다.` },
      { type:'general', title:'🚪 퍼즐 5: 지하실의 마지막 진실',
        story: `지하실로 내려가는 계단은 더욱 삐걱거린다. 지하실은 완전히 어둡지만, 한쪽 벽에 수녀가 설치한 것 같은 양초들이 타고 있다.

벽면에 수녀가 새긴 마지막 메시지가 있다.

<b>"진실을 아는 자는 고통받는다. 하지만 침묵하는 자는 더 큰 죄를 짓는다."</b>

그 아래 복잡한 시간 계산 문제가 새겨져 있다.

<b>🕰️ 화재 발생: 1994년 2월 15일 오후 11시 30분
📅 오늘 날짜: 2024년 2월 15일
⏰ 지금 시각: 오후 11시 30분

정확히 몇 년이 지났는가?</b>

지하실 깊숙한 곳에서 마지막 문이 보인다. 연도를 입력하는 자물쇠가 달려있다.`,
        question: `30년 전 화재에서 현재까지의 정확한 시간을 계산하라.

<b>화재 발생:</b> 1994년 2월 15일 오후 11시 30분
<b>현재:</b> 2024년 2월 15일 오후 11시 30분

2024 - 1994 = 몇 년?

정확히 지난 연수를 입력하시오.`,
        hint: '2024 - 1994 = ?',
        validate: i => i.trim() === '30' }
    ]
  },
  {
    id: 'subway', emoji: '🚇', name: '지하철 마지막 열차의 공포',
    desc: '자정을 넘긴 2호선 마지막 열차. 승객들이 하나둘 사라지고 있다.',
    difficulty: 2, time: '16분',
    intro: `새벽 1시 30분, 2호선 마지막 열차. 집으로 돌아가던 당신은 이상한 점을 발견했다. 승객들이 역마다 내리지만, 새로운 승객은 전혀 타지 않는다. 그리고 몇몇 승객들이... 갑자기 사라진다. 아무도 내리지 않았는데 자리가 비어있다. 지하철이 터널에서 멈췄을 때, 모든 문이 잠기고 조명이 깜빡이기 시작했다. 차내 안내방송도 끊겼다. 이 열차에 무슨 일이 일어나고 있는지 알아내고, 다음 역에서 탈출하라.`,
    puzzles: [
      { type:'general', title:'🗺️ 퍼즐 1: 지하철 노선도의 암호',
        story: `열차가 터널 중간에서 완전히 멈췄다. 차내가 고요해지자, 벽에 붙은 노선도에서 이상한 점을 발견했다.

누군가 노선도에 빨간 펜으로 특정 역들에 표시해뒀다. 표시된 역들을 연결하면 이상한 패턴이 나타난다.

<b>📍 표시된 역들:
홍대입구(2,6호선) → 신촌(2호선) → 이대(2호선) → 충정로(2,5호선)</b>

노선도 옆에 작은 메모가 붙어있다.
"환승 횟수를 세어라. 2호선에서 다른 노선으로 바뀌는 횟수가 답이다."

좌석 아래에서 작은 상자를 발견했다. 한 자리 숫자를 입력하는 자물쇠가 달려있다.`,
        question: `지하철 노선도를 분석하라.

표시된 역들의 환승 정보:
- 홍대입구: 2호선 ↔ 6호선 (환승 가능)
- 신촌: 2호선만
- 이대: 2호선만  
- 충정로: 2호선 ↔ 5호선 (환승 가능)

<b>2호선에서 다른 노선으로 환승 가능한 역은 몇 개인가?</b>

환승역 개수를 입력하시오.`,
        hint: '홍대입구(2↔6), 충정로(2↔5). 신촌과 이대는 2호선만.',
        validate: i => i.trim() === '2' },
      { type:'cpq', cpqIndex:0,
        story: `상자가 열렸다. 안에는 지하철 기관사의 비상 일지가 들어있다. 마지막 기록이 오늘 밤이다.

"승객들이 이상하다. 몇몇이 이상한 장소 얘기를 계속 한다. 그 장소에 뭔가 있는 것 같다."

일지에는 승객들이 계속 언급했던 장소의 주소가 적혀있다. 기관사도 궁금해서 메모해뒀던 것 같다.

"이 장소가 무엇인지 확인해야 한다. 지하철역에서 도보로 얼마나 걸리는지 측정하라."

사라진 승객들과 이 장소 사이에 무슨 연관이 있을까?`,
        storyAfter: `기관사가 메모한 장소까지의 거리를 확인했다. 일지 다음 페이지에 기관사의 추가 발견이 기록되어 있다.

"승객들이 말한 장소를 조사해봤더니... 끔찍한 진실을 발견했다. 운전석 서랍에 더 자세한 기록을 남겨둔다."

열차 맨 앞 운전석으로 이동해야 한다.` },
      { type:'general', title:'⏰ 퍼즐 3: 시간표의 비밀',
        story: `운전석에 도착했다. 기관사 자리 옆 서랍에서 2호선 시간표를 발견했다. 하지만 일반 시간표와 다르다.

특별한 메모가 적혀있는 '비밀 시간표'다.

<b>🕐 특별 운행 기록
23:45 - 홍대입구역 출발
00:15 - 신촌역 (승객 3명 탑승)
00:30 - 이대역 (승객 1명 하차)
00:45 - 충정로역 (승객 2명 하차)
01:15 - 시청역 도착</b>

시간표 아래 기관사의 계산:
"총 운행시간 = 도착시간 - 출발시간 (분 단위)"

운전석 계기판에 숫자를 입력하는 패널이 있다.`,
        question: `지하철 운행 시간을 계산하라.

<b>출발:</b> 23:45 (23시 45분)
<b>도착:</b> 01:15 (1시 15분, 다음날)

23:45 → 00:00 → 01:15

23:45에서 01:15까지 총 몇 분인가?

(힌트: 23:45 → 00:00은 15분, 00:00 → 01:15는 75분)`,
        hint: '23:45 → 24:00(00:00) = 15분, 00:00 → 01:15 = 75분. 총 15 + 75 = ?',
        validate: i => i.trim() === '90' },
      { type:'cpq', cpqIndex:1,
        story: `운전석 계기판이 활성화됐다. 숨겨진 서랍이 나타나면서 기관사의 최종 조사 보고서가 드러난다.

"진실을 알았다. 이 열차의 승객들은... 그들이 모두 그 장소와 연결되어 있다."

보고서에는 기관사가 마지막으로 확인하려던 결정적 장소가 적혀있다. 모든 미스터리의 핵심이 되는 곳이다.

"이곳까지의 거리를 반드시 측정해야 한다. 모든 퍼즐이 완성될 것이다."`,
        storyAfter: `최종 목적지까지의 정보를 확인했다. 보고서 마지막 장에 기관사의 충격적인 발견이 기록되어 있다.

"이 열차의 진짜 목적지를 알았다. 승객들이 사라지는 이유도... 비상 탈출 코드는 차내 비상벨 옆에 있다."

차량 중앙의 비상벨을 찾아가자.` },
      { type:'general', title:'🚪 퍼즐 5: 마지막 역으로의 탈출',
        story: `차량 중앙 비상벨 옆에서 숨겨진 패널을 발견했다. 기관사가 비상시를 위해 설치한 탈출 시스템인 것 같다.

패널에는 마지막 논리 퍼즐이 표시되어 있다.

<b>🚇 지하철 2호선 승객 4명의 증언

A승객: "B승객이 거짓말하고 있다"
B승객: "우리 중 한 명만 진실을 말한다"  
C승객: "A승객의 말이 맞다"
D승객: "B승객의 말이 틀렸다"</b>

패널 하단 메시지: "진실을 말하는 승객은 몇 명인가? 그 숫자가 탈출 코드다."

이것이 마지막 퍼즐이다.`,
        question: `승객들의 증언을 분석하라.

- A: "B가 거짓말"
- B: "우리 중 한 명만 진실"
- C: "A의 말이 맞다"  
- D: "B의 말이 틀렸다"

B의 말이 참이라면 (한 명만 진실), A,C,D는 모두 거짓말쟁이여야 한다.
그런데 A는 "B가 거짓말"이라고 했으니 A가 거짓말쟁이면 B는 진실해야...

B의 말이 거짓이라면, B를 제외하고 누가 진실을 말하는가?

<b>진실을 말하는 승객은 총 몇 명인가?</b>`,
        hint: 'B가 거짓말이라고 가정하자. 그러면 A("B가 거짓말")=참, C("A가 맞다")=참, D("B가 틀렸다")=참. B만 거짓말하고 나머지는 진실.',
        validate: i => i.trim() === '3' }
    ]
  },
  {
    id: 'museum', emoji: '🏛️', name: '박물관의 저주',
    desc: '국립 고고학 박물관에서 야간 경비원이 실종됐다. 전시관에 숨겨진 비밀을 찾아라.',
    difficulty: 2, time: '15분',
    intro: `국립 고고학 박물관. 베테랑 야간 경비원 김태현이 3일째 자취를 감췄다. 마지막 CCTV 기록은 이집트관에서 끊어져 있다. 박물관 관리소장인 당신이 직접 조사하기 위해 야간에 들어왔지만, 갑자기 모든 문이 자동 잠금되었다. 고대 유물들이 어둠 속에서 불길하게 빛나고, 복도 끝에서 이상한 속삭임이 들려온다. 김 경비원의 마지막 흔적을 따라 박물관에 숨겨진 저주의 비밀을 밝혀라.`,
    puzzles: [
      { type:'general', title:'🏺 퍼즐 1: 고대 유물의 연도 암호',
        story: `이집트관에 들어섰다. 파라오의 황금 마스크, 미라 관, 파피루스 두루마리... 수많은 유물이 전시되어 있다.

중앙 진열장에서 이상한 점을 발견했다. 4개의 주요 유물 앞에 김 경비원이 남긴 작은 메모들이 붙어있다.

<b>📜 투탕카멘 황금 마스크 (기원전 1323년) - "3"
🏺 카노푸스 항아리 (기원전 1550년) - "5"  
📊 로제타 스톤 (기원전 196년) - "6"
🐍 클레오파트라 목걸이 (기원전 69년) - "9"</b>

메모 뒤편에 김 경비원의 글씨: "각 유물 연도의 마지막 숫자가 금고 비밀번호다."

전시관 구석에 작은 금고가 숨겨져 있다.`,
        question: `유물 연도의 패턴을 분석하라.

<b>유물별 제작 연도:</b>
- 투탕카멘 마스크: 기원전 1323년 → 마지막 자리: 3
- 카노푸스 항아리: 기원전 1550년 → 마지막 자리: 0
- 로제타 스톤: 기원전 196년 → 마지막 자리: 6  
- 클레오파트라 목걸이: 기원전 69년 → 마지막 자리: 9

네 숫자를 순서대로 이어서 입력하시오.`,
        hint: '1323의 마지막 숫자는 3, 1550은 0, 196은 6, 69는 9',
        validate: i => i.replace(/\s/g,'') === '3069' },
      { type:'cpq', cpqIndex:0,
        story: `금고가 열렸다. 안에는 김 경비원의 순찰 일지가 들어있다. 실종 직전까지의 기록이 상세히 적혀있다.

"며칠 전부터 전시관에서 이상한 일들이 일어나고 있다. 유물들이 제자리에 없을 때가 있다. 누군가 몰래 들어와 뭔가를 찾고 있는 것 같다."

일지 마지막 기록: "오늘 밤 그들을 따라가 보기로 했다. 이 장소에서 뭔가 중요한 발견을 할 것 같다."

김 경비원이 적어둔 의심스러운 장소의 주소가 있다. 그의 마지막 행적을 추적해야 한다.

"이곳까지 박물관에서 도보로 얼마나 걸리는지 확인하라."`,
        storyAfter: `김 경비원이 향했던 장소까지의 거리를 확인했다. 일지 접힌 페이지를 펼치니 놀라운 발견이 기록되어 있다.

"그들이 찾는 것을 알아냈다. 박물관에 전시되지 않은 '진짜' 보물이 따로 있다. 그리스관에 단서가 있다."

그리스관으로 이동하자.` },
      { type:'general', title:'🏛️ 퍼즐 3: 그리스 신화의 음악 암호',
        story: `그리스관은 하얀 대리석 조각상들로 가득하다. 제우스, 아테나, 아폴로... 올림포스의 12신이 위엄있게 서있다.

아폴로 조각상 앞에서 김 경비원이 남긴 또 다른 단서를 발견했다. 조각상 대좌에 음표가 그려져 있다.

<b>🎵 도(1) 레(2) 미(3) 파(4) 솔(5) 라(6) 시(7) 도(8)</b>

그 아래 그려진 악보:
<b>♪ 솔 도 레 미 ♪</b>

김 경비원의 메모: "아폴로는 음악의 신이다. 이 멜로디를 숫자로 바꾸면 다음 단서의 위치를 알 수 있다."

그리스관 벽면에 8개의 작은 문이 있고, 각각 1-8번이 적혀있다.`,
        question: `그리스 음악 암호를 해독하라.

<b>음계 대응표:</b>
도(1), 레(2), 미(3), 파(4), 솔(5), 라(6), 시(7), 도(8)

<b>악보의 멜로디:</b> 솔 도 레 미

각 음을 숫자로 변환하면?
솔(5) 도(1) 레(2) 미(3)

네 숫자를 순서대로 입력하시오.`,
        hint: '솔=5, 도=1, 레=2, 미=3',
        validate: i => i.replace(/\s/g,'') === '5123' },
      { type:'cpq', cpqIndex:1,
        story: `5번 문이 열렸다. 안에는 박물관의 비밀 수장고가 있다. 일반에게 공개되지 않은 진짜 보물들이 보관된 곳이다.

수장고 중앙에 김 경비원의 마지막 조사 보고서가 놓여있다. 그가 발견한 충격적인 진실이 기록되어 있다.

"박물관 내부자가 유물을 빼돌리고 있다. 진짜 보물들이 이 장소로 유출되고 있다."

보고서에는 유물 밀매상들의 거래 장소가 적혀있다. 김 경비원이 마지막으로 확인하려던 결정적 증거가 있는 곳이다.

"이곳까지의 도보 거리를 반드시 확인해야 한다."`,
        storyAfter: `밀매 장소까지의 정보를 확인했다. 수장고 깊숙한 곳에서 김 경비원이 남긴 마지막 메시지를 발견했다.

"진범을 찾았다. 하지만 그들이 나를 의심하고 있다. 혹시 누군가 이 메시지를 본다면... 로마관의 시계를 확인하라."

로마관으로 향하자.` },
      { type:'general', title:'🚪 퍼즐 5: 로마 황제의 시간',
        story: `로마관에 도착했다. 황제들의 흉상과 로마 군단의 갑옷이 전시되어 있다. 중앙에 거대한 로마식 해시계가 설치되어 있다.

해시계 주변에 4명의 로마 황제 흉상이 배치되어 있고, 각각 재위 기간이 표시되어 있다.

<b>🏛️ 로마 황제들
아우구스투스: 재위 45년 (기원전 27년 ~ 후 14년)
트라야누스: 재위 19년 (98년 ~ 117년)  
하드리아누스: 재위 21년 (117년 ~ 138년)
마르쿠스: 재위 19년 (161년 ~ 180년)</b>

해시계 중앙에 김 경비원의 마지막 퍼즐이 새겨져 있다.
"가장 오래 통치한 황제의 재위 기간이 탈출 코드다."`,
        question: `로마 황제들의 재위 기간을 비교하라.

<b>각 황제의 재위 기간:</b>
- 아우구스투스: 45년
- 트라야누스: 19년
- 하드리아누스: 21년  
- 마르쿠스: 19년

<b>가장 오래 통치한 황제의 재위 기간</b>은 몇 년인가?`,
        hint: '45년, 19년, 21년, 19년 중에서 가장 큰 수는?',
        validate: i => i.trim() === '45' }
    ]
  },
  {
    id: 'opera', emoji: '🎭', name: '오페라 극장의 유령',
    desc: '100년 된 오페라 하우스에서 프리마돈나가 공연 중 무대에서 사라졌다. 극장의 비밀을 밝혀라.',
    difficulty: 3, time: '17분',
    intro: `100년의 역사를 자랑하는 그란데 오페라 하우스. 프리마돈나 이소프라노가 <라 트라비아타> 공연 중 2막에서 갑자기 사라졌다. 1천여 관객이 지켜보는 가운데 무대 중앙에서 연기처럼 사라진 것이다. 극장 프로듀서인 당신이 무대 뒤를 조사하러 왔지만, 극장의 오래된 기계장치가 작동하며 모든 출입구가 봉쇄됐다. 무대 위에서 오르골 소리가 들려오고, 관객석에서는 박수 소리가 메아리친다. 100년 전부터 전해내려오는 극장 유령의 비밀을 풀고 진실을 밝혀라.`,
    puzzles: [
      { type:'general', title:'🎼 퍼즐 1: 악보의 숫자 암호',
        story: `무대 뒤 분장실에 들어섰다. 이소프라노의 화장대 위에 <라 트라비아타> 악보가 펼쳐져 있다. 2막 마지막 아리아 "Addio del passato"다.

악보에 빨간 펜으로 특정 음표들에 동그라미가 쳐져 있다. 이소프라노가 직접 표시한 것 같다.

<b>🎵 표시된 음표들:
도(C) - 레(D) - 미(E) - 도(C) - 솔(G)</b>

악보 옆에 메모: "각 음표를 알파벳 순서로 바꾸면 답이 나온다. C=3, D=4, E=5..."

분장실 구석에 작은 금고가 있고, 5자리 숫자를 입력하는 자물쇠가 달려있다.`,
        question: `음표를 알파벳 순서 번호로 변환하라.

<b>알파벳 순서:</b> A=1, B=2, C=3, D=4, E=5, F=6, G=7...

<b>표시된 음표들:</b>
- 도(C) = 3번째 알파벳 = 3
- 레(D) = 4번째 알파벳 = 4  
- 미(E) = 5번째 알파벳 = 5
- 도(C) = 3번째 알파벳 = 3
- 솔(G) = 7번째 알파벳 = 7

다섯 숫자를 순서대로 입력하시오.`,
        hint: 'C=3, D=4, E=5, C=3, G=7',
        validate: i => i.replace(/\s/g,'') === '34537' },
      { type:'cpq', cpqIndex:0,
        story: `금고가 열렸다. 안에는 이소프라노의 개인 일기가 들어있다. 최근 며칠간의 기록이 불안감으로 가득하다.

"누군가 나를 지켜보고 있다. 연습실에서, 무대에서, 심지어 집에서도. 그들이 원하는 것이 이 장소와 관련이 있는 것 같다."

일기에는 이소프라노가 최근 자주 방문했던 의문의 장소가 적혀있다. 그녀가 위협을 느끼면서도 계속 찾아갔던 곳이다.

"이곳에서 답을 찾을 수 있을 것이다. 극장에서 도보로 얼마나 걸리는지 확인해야 한다."

이소프라노의 마지막 행적을 추적해야 한다.`,
        storyAfter: `이소프라노가 자주 찾았던 장소까지의 거리를 확인했다. 일기 마지막 장에 그녀의 두려움이 적나라하게 드러나 있다.

"진실을 알게 됐다. 하지만 이제 더 이상 안전하지 않다. 오케스트라 보관소에 증거를 숨겨뒀다."

극장 지하의 오케스트라 보관소로 향해야 한다.` },
      { type:'general', title:'🎻 퍼즐 3: 오케스트라의 수학적 하모니',
        story: `지하 오케스트라 보관소는 각종 악기들로 가득하다. 바이올린, 첼로, 플루트, 트럼펫... 수십 년간 사용된 악기들이 정렬되어 있다.

중앙 연단에서 이상한 배치를 발견했다. 악기들이 수학적 패턴으로 배열되어 있다.

<b>🎻 1열: 바이올린 8대
🎺 2열: 트럼펫 6대  
🎼 3열: 플루트 4대
🥁 4열: 팀파니 2대
🎹 5열: ? 대</b>

연단 위에 지휘자가 남긴 메모: "각 열의 악기 수가 2씩 줄어든다. 5열에 몇 대가 있어야 하는지가 다음 단서다."

보관소 벽면에 숫자판이 있다.`,
        question: `악기 배치의 패턴을 분석하라.

<b>각 열별 악기 수:</b>
- 1열: 8대
- 2열: 6대 (8-2)
- 3열: 4대 (6-2)  
- 4열: 2대 (4-2)
- 5열: ? (2-2)

패턴: 매번 2씩 감소

<b>5열에는 몇 대의 악기가 있어야 하는가?</b>`,
        hint: '8 → 6 → 4 → 2 → ?',
        validate: i => i.trim() === '0' },
      { type:'cpq', cpqIndex:1,
        story: `패턴을 맞혔다. 연단 뒤편에 숨겨진 공간이 열렸다. 극장의 100년 역사가 담긴 비밀 기록보관소다.

오래된 문서들 사이에서 이소프라노가 남긴 최종 조사 보고서를 발견했다. 그녀가 사라지기 직전에 작성한 것이다.

"극장 유령의 정체를 알아냈다. 하지만 그들이 나를 막으려 한다. 마지막 증거는 이 장소에 있다."

보고서에는 극장 유령 전설의 진실이 숨겨진 장소가 적혀있다. 100년 전부터 이어져온 비밀의 핵심이다.

"이곳까지의 도보 거리를 반드시 확인하라. 모든 것이 연결될 것이다."`,
        storyAfter: `극장 유령의 비밀이 숨겨진 장소까지의 정보를 확인했다. 기록보관소 깊숙한 곳에서 100년 전 초대 극장장이 남긴 진실이 드러났다.

"유령은 실제로 존재한다. 하지만 그것은 초자연적인 존재가 아니다... 무대 아래 기계실을 확인하라."

극장 무대 아래로 내려가야 한다.` },
      { type:'general', title:'🚪 퍼즐 5: 무대 기계실의 마지막 비밀',
        story: `무대 아래 기계실은 100년 된 극장의 심장부다. 무대를 움직이는 거대한 기계장치들과 도르래, 그리고 복잡한 조작 패널이 있다.

중앙 조작 패널에 마지막 퍼즐이 표시되어 있다. 100년 전 극장이 건설될 때부터 있었던 장치인 것 같다.

<b>🎭 오페라 하우스 건립: 1924년
🎪 첫 번째 공연: 1925년  
👻 첫 번째 유령 목격: 1927년
🔥 화재 사고: 1943년
🎨 리모델링 완공: 1967년
⭐ 황금기 시작: 1985년</b>

패널 하단 메시지: "극장 역사에서 가장 중요한 해는? 건립 연도와 현재(2024)의 차이가 탈출 코드다."

이것이 극장 유령이 남긴 마지막 시험이다.`,
        question: `극장의 역사를 계산하라.

<b>오페라 하우스 건립:</b> 1924년
<b>현재:</b> 2024년

극장이 건립된 지 몇 년이 지났는가?

2024 - 1924 = ?

계산한 연수를 입력하시오.`,
        hint: '2024 - 1924 = ?',
        validate: i => i.trim() === '100' }
    ]
  },
  {
    id: 'clocktower', emoji: '⛪', name: '시계탑의 비밀',
    desc: '도시 중심가 고딕 시계탑에서 종지기가 실종됐다. 시계바늘이 멈춘 그 시간에 무슨 일이?',
    difficulty: 2, time: '14분',
    intro: `도시의 랜드마크인 고딕 시계탑. 50년간 종을 관리해온 베테랑 종지기 박시계가 사라졌다. 시계탑의 시계는 오후 3시 33분에 멈춰있고, 그 이후로 종소리도 들리지 않는다. 시계탑 관리사인 당신이 조사차 올라왔지만, 나선형 계단이 무너지며 갇혔다. 시계탑 곳곳에서 기어 돌아가는 소리와 함께 이상한 암호들이 새겨져 있다. 박시계가 남긴 단서를 따라 시간의 비밀을 풀고 탈출하라.`,
    puzzles: [
      { type:'general', title:'⏰ 퍼즐 1: 시계바늘의 각도 계산',
        story: `시계탑 중앙에 거대한 시계 기계장치가 있다. 시곗바늘이 3시 33분에 멈춰있는 상태다.

시계 옆에 박시계가 남긴 메모가 있다.

<b>"시간의 비밀은 각도에 있다.
시침과 분침 사이의 각도를 계산하라.
- 시침: 1시간당 30도 이동 (360도 ÷ 12시간)  
- 분침: 1분당 6도 이동 (360도 ÷ 60분)
- 3시 33분에서 두 바늘 사이의 각도는?"</b>

시계 기계 아래에 숫자를 입력하는 패널이 있다. 각도를 입력하면 다음 단서가 나타날 것 같다.`,
        question: `3시 33분에서 시침과 분침 사이의 각도를 계산하라.

<b>분침 위치:</b> 33분 → 33 × 6도 = 198도
<b>시침 위치:</b> 3시 33분 → 3 × 30도 + (33 × 0.5도) = 90도 + 16.5도 = 106.5도

<b>두 바늘 사이 각도:</b> |198도 - 106.5도| = 91.5도

시침과 분침 사이의 각도는? (소수점 첫째 자리까지)`,
        hint: '분침은 198도 위치, 시침은 106.5도 위치. 두 각도의 차이는 91.5도',
        validate: i => i.trim() === '91.5' || i.trim() === '91' },
      { type:'cpq', cpqIndex:0,
        story: `각도 계산이 정확했다. 시계 기계 뒤편에서 박시계의 작업 일지를 발견했다. 최근 몇 주간의 기록이 상세히 적혀있다.

"시계탑 시계가 자꾸 느려진다. 누군가 기계를 조작하고 있는 것 같다. 그들이 원하는 것이 이 장소와 관련이 있다."

일지에는 박시계가 의심을 품고 조사했던 장소의 주소가 적혀있다. 시계탑에서 보이는 곳이라고 메모되어 있다.

"이곳까지 시계탑에서 도보로 얼마나 걸리는지 확인해야 한다. 그들의 정체를 밝힐 수 있을 것이다."`,
        storyAfter: `박시계가 조사했던 장소까지의 거리를 확인했다. 작업 일지 뒷면에 그의 추가 발견이 기록되어 있다.

"진실을 알게 됐다. 시계탑에 숨겨진 비밀 방이 있다. 종루 위쪽을 확인하라."

시계탑의 가장 높은 곳, 종루로 올라가야 한다.` },
      { type:'general', title:'🔔 퍼즐 3: 종의 진동 주파수',
        story: `종루에 도착했다. 거대한 청동 종이 조용히 매달려 있다. 50년간 도시에 시간을 알려준 종이다.

종 옆에 박시계가 남긴 기술 자료가 있다. 종의 진동 주파수를 계산하는 공식이 적혀있다.

<b>🔔 시계탑 종의 특성
직경: 2미터
무게: 1,500kg  
재질: 청동 (구리 80% + 주석 20%)
진동 주파수 공식: f = 무게 ÷ 직경²</b>

박시계의 메모: "종의 진동 주파수가 다음 단서의 위치를 알려준다. f = 1500 ÷ (2)² = ?"

종루 바닥에 여러 개의 돌판이 있고, 각각 다른 숫자가 새겨져 있다.`,
        question: `종의 진동 주파수를 계산하라.

<b>공식:</b> f = 무게 ÷ 직경²

<b>주어진 값:</b>
- 무게: 1,500kg
- 직경: 2미터

f = 1,500 ÷ (2)²
f = 1,500 ÷ 4
f = ?

계산 결과를 입력하시오.`,
        hint: '1,500 ÷ 4 = ?',
        validate: i => i.trim() === '375' },
      { type:'cpq', cpqIndex:1,
        story: `375번 돌판을 눌렀다. 종루 바닥에서 숨겨진 계단이 나타났다. 시계탑 건설 당시부터 있었던 비밀 공간인 것 같다.

비밀 방에는 박시계의 최종 조사 자료가 정리되어 있다. 시계탑에 숨겨진 진짜 비밀이 기록되어 있다.

"이 시계탑은 단순한 시계가 아니다. 도시 전체의 특별한 장소들과 연결되어 있다. 마지막 핵심 장소를 확인해야 한다."

자료에는 박시계가 마지막으로 조사하려던 결정적 장소가 적혀있다. 시계탑 비밀의 완전한 해답이 있는 곳이다.

"이곳까지의 도보 거리를 반드시 측정하라."`,
        storyAfter: `시계탑 비밀의 핵심이 되는 장소까지의 정보를 확인했다. 비밀 방 깊숙한 곳에서 박시계가 남긴 마지막 메시지를 발견했다.

"모든 퍼즐을 풀었다면, 시계 기계 내부의 최종 장치를 확인하라. 탈출 코드는 시간 속에 숨어있다."

다시 시계 기계로 돌아가자.` },
      { type:'general', title:'🚪 퍼즐 5: 시간의 마지막 비밀',
        story: `시계 기계 내부에 들어갔다. 복잡한 기어와 태엽들이 정교하게 맞물려 있다. 박시계가 50년간 관리해온 정밀한 장치다.

기계 중심부에서 마지막 퍼즐을 발견했다. 시계탑 건설자가 남긴 최종 시험인 것 같다.

<b>⏰ 시간 계산 문제

시계탑 건설: 1974년 6월 15일 오후 3시 33분
현재: 2024년 6월 15일 오후 3시 33분

정확히 몇 년이 지났는가?</b>

기계 중앙에 연도를 입력하는 최종 패널이 있다. 박시계가 3시 33분에 시계를 멈춘 이유가 이것 때문인 것 같다.`,
        question: `시계탑의 정확한 연수를 계산하라.

<b>건설 일시:</b> 1974년 6월 15일 오후 3시 33분
<b>현재 일시:</b> 2024년 6월 15일 오후 3시 33분

두 시점 사이에 지난 정확한 연수는?

2024 - 1974 = ?

계산한 연수를 입력하시오.`,
        hint: '2024 - 1974 = ?',
        validate: i => i.trim() === '50' }
    ]
  },
  {
    id: 'laboratory', emoji: '🌊', name: '해저 연구소의 공포',
    desc: '심해 1000m 해저 연구소에서 과학자 5명이 동시에 사라졔다. 밀폐된 연구소에서 무슨 일이?',
    difficulty: 3, time: '20분',
    intro: `태평양 심해 1000미터 아래 해저 연구소 '딥 블루'. 해양 생태계를 연구하던 과학자 5명이 어젯밤 동시에 사라졔다. 연구소는 외부와 완전히 차단된 밀폐 공간이고, 탈출구는 하나뿐이다. 긴급 구조대장인 당신이 잠수정으로 내려왔지만, 연구소 시스템이 오작동하며 모든 구획이 봉쇄됐다. 산소 공급장치는 3시간 후 정지된다. 바깥은 거대한 수압이 기다리고 있고, 연구소 내부에서는 이상한 생명체의 흔적이 발견된다. 과학자들에게 무슨 일이 일어났는지 밝히고 수면으로 탈출하라.`,
    puzzles: [
      { type:'general', title:'🧬 퍼즐 1: 해저 기압 계산',
        story: `연구소 중앙 제어실에 들어섰다. 거대한 모니터에 연구소 현황이 표시되어 있다. 수심 1000미터에서의 모든 데이터가 실시간으로 나타난다.

메인 컴퓨터에 마지막 로그인이 기록되어 있다. 책임연구원 김해양 박사의 계정이다.

화면에 표시된 마지막 계산:

<b>💧 해저 기압 계산 공식
수면 기압: 1기압
수심 10m마다: +1기압 추가
현재 수심: 1000m
총 기압 = 1 + (수심 ÷ 10) = ?</b>

제어판에 기압 값을 입력하는 패널이 있다. 정확한 값을 입력해야 다음 구역으로 이동할 수 있을 것 같다.`,
        question: `해저 1000m에서의 기압을 계산하라.

<b>기압 계산 공식:</b>
- 수면 기압: 1기압  
- 수심 10m마다: +1기압

<b>수심 1000m에서:</b>
총 기압 = 1 + (1000 ÷ 10)
총 기압 = 1 + 100
총 기압 = ?

계산 결과를 입력하시오.`,
        hint: '1 + (1000 ÷ 10) = 1 + 100 = ?',
        validate: i => i.trim() === '101' },
      { type:'cpq', cpqIndex:0,
        story: `제어실이 활성화됐다. 김해양 박사의 연구 일지에 접근할 수 있게 됐다. 마지막 며칠간의 기록이 불안감으로 가득하다.

"연구소 주변에서 미지의 생명체가 발견됐다. 지금까지 과학이 알지 못했던 존재다. 그런데 그들이 우리를 관찰하고 있는 것 같다."

일지 마지막 기록: "오늘 밤 그 생명체들의 서식지를 직접 확인하러 간다. 이 장소에서 결정적 단서를 찾을 수 있을 것이다."

김 박사가 적어둔 해저 탐사 지점이 있다. 연구소에서 그리 멀지 않은 곳이다.

"이곳까지 잠수정으로 얼마나 걸리는지 확인해야 한다."

과학자들의 마지막 행적을 추적해보자.`,
        storyAfter: `김 박사가 탐사했던 해저 지점까지의 정보를 확인했다. 연구 일지에 계속 이어지는 기록이 있다.

"그 생명체들의 정체를 알게 됐다. 하지만 이제 우리는 안전하지 않다. 연구 샘플은 실험실에 보관해뒀다."

연구소 실험실로 이동해야 한다.` },
      { type:'general', title:'🔬 퍼즐 3: DNA 서열 암호',
        story: `실험실에 도착했다. 현미경, 원심분리기, DNA 서열분석기 등 첨단 장비들이 늘어서 있다.

중앙 실험대에 미지의 생명체 샘플이 보관되어 있다. 투명한 용기 속에 푸른 빛을 내는 신비한 물질이다.

DNA 서열분석기 화면에 분석 결과가 표시되어 있다.

<b>🧬 미지 생명체 DNA 서열
ATCG-TACG-GCTA-ATGC</b>

화면 옆에 김 박사의 메모:
"DNA 염기서열을 숫자로 변환하라. A=1, T=2, C=3, G=4"

실험실 금고에 DNA 코드를 입력하는 장치가 있다.`,
        question: `DNA 서열을 숫자 코드로 변환하라.

<b>염기 대응표:</b> A=1, T=2, C=3, G=4

<b>DNA 서열:</b> ATCG-TACG-GCTA-ATGC

각 염기를 숫자로 변환:
- A(1) T(2) C(3) G(4)
- T(2) A(1) C(3) G(4)  
- G(4) C(3) T(2) A(1)
- A(1) T(2) G(4) C(3)

16자리 숫자를 순서대로 입력하시오.`,
        hint: 'ATCG = 1234, TACG = 2134, GCTA = 4321, ATGC = 1243',
        validate: i => i.replace(/\s/g,'').replace(/-/g,'') === '1234213443211243' },
      { type:'cpq', cpqIndex:1,
        story: `DNA 코드가 정확했다. 실험실 금고가 열리면서 김 박사의 최종 연구 보고서가 나타났다.

"이 생명체들은 지구 생명체가 아니다. 그들의 목적을 파악하기 위해 이 장소를 조사해야 한다."

보고서에는 미지 생명체들이 집중적으로 활동하는 해저 지역이 표시되어 있다. 과학자들이 마지막으로 향했던 곳이다.

"이곳까지의 거리와 시간을 정확히 측정하라. 그들과의 마지막 접촉 지점이다."

과학자들에게 무슨 일이 일어났는지 알 수 있을 것이다.`,
        storyAfter: `미지 생명체들의 활동 지역까지의 정보를 확인했다. 보고서 마지막 장에 김 박사의 충격적인 발견이 기록되어 있다.

"그들이 우리를 데려간 이유를 알았다. 하지만 이미 늦었다. 비상 탈출 프로토콜은 중앙 컴퓨터에 있다."

연구소 중앙 컴퓨터 시스템을 해킹해야 한다.` },
      { type:'general', title:'🚪 퍼즐 5: 비상 탈출 시퀀스',
        story: `중앙 컴퓨터 시스템에 접근했다. 화면에 비상 탈출 프로토콜이 표시되어 있지만, 마지막 인증 코드가 필요하다.

김 박사가 설정해둔 최종 보안 시스템이다.

<b>🌊 해저 연구소 비상 탈출 프로토콜

단계 1: 밸러스트 탱크 배수 ✓
단계 2: 비상 부력 활성화 ✓  
단계 3: 잠수정 도킹 해제 ✓
단계 4: 최종 인증 코드 입력 [?]

인증 문제: "해저 생명체의 발견 연도 + 연구소 건설 연도"
- 미지 생명체 최초 발견: 2019년
- 딥 블루 연구소 건설: 2015년</b>

모든 시스템이 대기 상태다. 인증 코드를 입력하면 수면으로 긴급 부상할 수 있다.`,
        question: `비상 탈출 인증 코드를 계산하라.

<b>필요한 정보:</b>
- 미지 생명체 최초 발견: 2019년
- 딥 블루 연구소 건설: 2015년

<b>인증 코드:</b> 발견 연도 + 건설 연도

2019 + 2015 = ?

계산 결과를 입력하시오.`,
        hint: '2019 + 2015 = ?',
        validate: i => i.trim() === '4034' }
    ]
  }
];

// ─── 게임 상태 ───
let state = { currentRoom:null, currentPuzzle:0, cpqCampaigns:[], startTime:null, attempts:0 };

function loadProgress() { try{return JSON.parse(localStorage.getItem('qube_progress')||'{}')}catch{return{}} }
function saveProgress(p) { localStorage.setItem('qube_progress',JSON.stringify(p)) }
function getGrade(c) { return c>=10?'🕵️ 셜록':c>=7?'🔍 명탐정':c>=4?'🧐 탐정':c>=2?'📋 수습탐정':'🔰 초보탐정' }
function formatTime(s) { return Math.floor(s/60)+':'+String(s%60).padStart(2,'0') }

// ─── 파티클 ───
function createParticles() {
  const c = document.getElementById('particles');
  for(let i=0;i<50;i++){
    const p = document.createElement('div');
    p.className='particle';
    p.style.left=Math.random()*100+'%';
    p.style.animationDuration=(8+Math.random()*12)+'s';
    p.style.animationDelay=Math.random()*10+'s';
    const sz=(2+Math.random()*3)+'px';
    p.style.width=p.style.height=sz;
    p.style.background=Math.random()>.5?'#b44aff':'#00e5ff';
    p.style.boxShadow=`0 0 6px ${p.style.background}`;
    c.appendChild(p);
  }
}

function scrollToRooms() { document.getElementById('rooms-section').scrollIntoView({behavior:'smooth'}) }

// ─── 화면 전환 ───
function showScreen(id) {
  document.getElementById('home').classList.toggle('hidden', id!=='home');
  document.getElementById('game').classList.toggle('hidden', id!=='game');
  document.getElementById('result').classList.toggle('hidden', id!=='result');
  document.getElementById('loadingScreen').classList.remove('active');
  if(id!=='home') window.scrollTo(0,0);
}

function goHome() {
  state.currentRoom=null;
  showScreen('home');
  renderHome();
}

function confirmExit() { if(confirm('정말 나가시겠습니까? 진행 상황이 초기화됩니다.')) goHome() }

// ─── 홈 렌더링 ───
function renderHome() {
  const progress = loadProgress();
  const cleared = Object.keys(progress).filter(k=>progress[k]?.cleared).length;

  document.getElementById('statCleared').textContent = cleared;
  document.getElementById('statGrade').textContent = getGrade(cleared).split(' ')[0];
  document.getElementById('rooms-progress').textContent = `🔓 ${ROOMS.length}/${ROOMS.length} 해금 · ✅ ${cleared} 탈출`;

  const grid = document.getElementById('roomGrid');
  grid.innerHTML = ROOMS.map(room => {
    const p = progress[room.id];
    const isClear = p?.cleared;
    const stars = Array.from({length:3},(_,i)=>`<span class="star ${i<room.difficulty?'':'empty'}">${i<room.difficulty?'★':'☆'}</span>`).join('');
    const badge = isClear ? '<span class="room-badge badge-cleared">✓ 클리어</span>' : '<span class="room-badge badge-new">NEW</span>';

    return `<div class="room-card ${isClear?'cleared':''}" onclick="startRoom('${room.id}')">
      ${badge}
      <div class="room-emoji">${room.emoji}</div>
      <div class="room-title">${room.name}</div>
      <div class="room-desc">${room.desc}</div>
      <div class="room-meta">
        <span class="room-diff">${stars}</span>
        <span>⏱ ${room.time}</span>
        ${isClear?`<span>🏆 ${formatTime(p.bestTime)}</span>`:''}
      </div>
      <button class="room-start">${isClear?'다시 도전 🔄':'입장하기 🔑'}</button>
    </div>`;
  }).join('');
}

// ─── 게임 시작 ───
async function startRoom(roomId) {
  const room = ROOMS.find(r=>r.id===roomId);
  if(!room) return;

  state.currentRoom=room; state.currentPuzzle=0; state.startTime=Date.now(); state.attempts=0;

  document.getElementById('loadingScreen').classList.add('active');

  try {
    const cpqCount = room.puzzles.filter(p=>p.type==='cpq').length;
    const res = await fetch(`${API}/api/random?count=${cpqCount}`);
    const data = await res.json();
    state.cpqCampaigns = data.campaigns || [];
  } catch(e) { state.cpqCampaigns = []; }

  showScreen('game');
  document.getElementById('gameTitle').textContent = room.emoji + ' ' + room.name;
  renderIntro();
}

function renderIntro() {
  renderProgress();
  document.getElementById('gameContent').innerHTML = `
    <div class="story-box">
      <div class="label">📖 프롤로그</div>
      <p>${state.currentRoom.intro.replace(/\n/g,'<br>')}</p>
    </div>
    <button class="btn-next" onclick="renderPuzzle(0)">조사 시작 →</button>`;
}

function renderProgress() {
  const room = state.currentRoom;
  const total = room.puzzles.length;
  document.getElementById('gameProgressText').textContent = `${state.currentPuzzle+1} / ${total}`;
  document.getElementById('progressBar').innerHTML =
    Array.from({length:total},(_,i)=>{
      const cls = i<state.currentPuzzle?'done':i===state.currentPuzzle?'active':'';
      return `<div class="prog-dot ${cls}"></div>`;
    }).join('');
}

// ─── 퍼즐 렌더링 ───
function renderPuzzle(idx) {
  state.currentPuzzle = idx;
  renderProgress();
  const puzzle = state.currentRoom.puzzles[idx];
  puzzle.type==='cpq' ? renderCpqPuzzle(idx,puzzle) : renderGeneralPuzzle(idx,puzzle);
}

function renderGeneralPuzzle(idx, puzzle) {
  document.getElementById('gameContent').innerHTML = `
    <div class="story-box">
      <div class="label">📖 상황</div>
      <p>${puzzle.story.replace(/\n/g,'<br>')}</p>
    </div>
    <div class="puzzle-box">
      <div class="puzzle-label">${puzzle.title}</div>
      <div class="puzzle-question">${puzzle.question.replace(/\n/g,'<br>')}</div>
      <div class="hint-box hidden" id="hintBox">💡 ${puzzle.hint}</div>
      <button class="hint-btn" onclick="document.getElementById('hintBox').classList.remove('hidden');this.remove()">💡 힌트 보기</button>
      <div class="answer-area">
        <input type="text" id="answerInput" placeholder="정답을 입력하세요" onkeydown="handleEnter(event,${idx})">
        <button class="btn-submit" onclick="checkGeneral(${idx})">확인</button>
      </div>
      <div id="feedback"></div>
    </div>`;
  setTimeout(() => document.getElementById('gameContent').scrollIntoView({behavior:'smooth'}), 100);
}

function renderCpqPuzzle(idx, puzzle) {
  const camp = state.cpqCampaigns[puzzle.cpqIndex];
  if(!camp) { nextPuzzle(idx); return; }

  const desc = camp.join_desc || '';
  const keyword = camp.search_keyword || '';
  const placeMatch = desc.match(/\[([^\]]*X[^\]]*)\]/);
  const placeHint = placeMatch ? placeMatch[1] : '해당 장소';
  const startMatch = desc.match(/출발지를\s*\[([^\]]+)\]/);
  const startPlace = startMatch ? startMatch[1] : '지정된 출발지';

  document.getElementById('gameContent').innerHTML = `
    <div class="story-box">
      <div class="label">📖 단서 발견</div>
      <p>${puzzle.story.replace(/\n/g,'<br>')}</p>
    </div>
    <div class="puzzle-box">
      <div class="puzzle-label">🔍 퍼즐 ${idx+1}: 장소 추적 미션</div>
      <div class="puzzle-question">단서에 적힌 장소를 찾아야 한다. 네이버에서 검색하여 걸음 수를 확인하라.</div>
      <div class="cpq-mission">
        <div class="mission-title">📋 미션 순서</div>
        <ol class="cpq-steps">
          <li>아래 키워드를 복사하여 <b>네이버</b>에서 검색</li>
          <li>검색 결과에서 <b>${placeHint}</b> 클릭</li>
          <li>플레이스에서 <b>지도</b> 탭 → <b>지도앱으로 보기</b></li>
          <li><b>도착</b> 버튼 클릭</li>
          <li>출발지를 <b>${startPlace}</b>(으)로 설정</li>
          <li><b>도보</b> → <b>가장 빠른</b> 경로의 걸음 수 확인</li>
        </ol>
        <div class="cpq-keyword-box">
          <span class="cpq-keyword" onclick="copyKeyword(this)" title="클릭하여 복사">🔎 ${keyword}</span>
        </div>
      </div>
      <div class="answer-area" style="margin-top:16px">
        <input type="number" id="answerInput" placeholder="걸음 수를 입력하세요" onkeydown="handleEnter(event,${idx},'cpq')">
        <button class="btn-submit" onclick="checkCpq(${idx})">확인</button>
      </div>
      <div id="feedback"></div>
    </div>`;
  setTimeout(() => document.getElementById('gameContent').scrollIntoView({behavior:'smooth'}), 100);
}

// ─── 입력 핸들러 ───
let isComposing = false;
document.addEventListener('compositionstart', ()=>{isComposing=true});
document.addEventListener('compositionend', ()=>{isComposing=false});

function handleEnter(e, idx, type) {
  if(e.key==='Enter' && !isComposing) {
    e.preventDefault();
    type==='cpq' ? checkCpq(idx) : checkGeneral(idx);
  }
}

// ─── 검증 ───
function checkGeneral(idx) {
  const input = document.getElementById('answerInput').value.trim();
  if(!input) return;
  state.attempts++;
  showFeedback(state.currentRoom.puzzles[idx].validate(input), idx);
}

async function checkCpq(idx) {
  const input = document.getElementById('answerInput').value.trim();
  if(!input) return;
  state.attempts++;
  const camp = state.cpqCampaigns[state.currentRoom.puzzles[idx].cpqIndex];
  try {
    const res = await fetch(`${API}/api/verify`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({campaign_id:camp.id,user_answer:input})});
    const data = await res.json();
    showFeedback(data.correct, idx);
  } catch { showFeedback(false, idx); }
}

function showFeedback(correct, idx) {
  const fb = document.getElementById('feedback');
  const puzzle = state.currentRoom.puzzles[idx];
  if(correct) {
    const after = puzzle.storyAfter||'';
    fb.innerHTML = `<div class="feedback correct">✅ 정답!${after?' '+after:''}</div>
      <button class="btn-next" onclick="nextPuzzle(${idx})">${idx<state.currentRoom.puzzles.length-1?'다음 퍼즐 →':'🚪 탈출!'}</button>`;
  } else {
    fb.innerHTML = '<div class="feedback wrong">❌ 오답. 다시 시도해보세요.</div>';
    document.getElementById('answerInput').value='';
    document.getElementById('feedback').scrollIntoView({behavior:'smooth', block:'center'});
  }
}

function nextPuzzle(cur) { cur+1>=state.currentRoom.puzzles.length ? showResult() : renderPuzzle(cur+1) }

// ─── 결과 ───
function showResult() {
  const elapsed = Math.floor((Date.now()-state.startTime)/1000);
  const room = state.currentRoom;
  const progress = loadProgress();
  const prev = progress[room.id];
  const bestTime = prev?.bestTime ? Math.min(prev.bestTime,elapsed) : elapsed;
  progress[room.id] = {cleared:true, bestTime, lastPlayed:Date.now()};
  saveProgress(progress);

  const cleared = Object.keys(progress).filter(k=>progress[k]?.cleared).length;
  const grade = getGrade(cleared);
  let gameGrade = 'S';
  if(elapsed>600) gameGrade='C'; else if(elapsed>300) gameGrade='B'; else if(elapsed>180) gameGrade='A';

  showScreen('result');
  document.getElementById('resultContent').innerHTML = `
    <div class="result-emoji">🎉</div>
    <div class="result-title">탈출 성공!</div>
    <div class="result-sub">${room.name}에서 무사히 탈출했습니다</div>
    <div class="result-grade">${gameGrade} RANK</div>
    <div class="result-stats">
      <div class="result-stat"><div class="result-stat-val">${formatTime(elapsed)}</div><div class="result-stat-label">소요시간</div></div>
      <div class="result-stat"><div class="result-stat-val">${state.attempts}</div><div class="result-stat-label">시도횟수</div></div>
      <div class="result-stat"><div class="result-stat-val">${grade.split(' ')[0]}</div><div class="result-stat-label">${grade.split(' ')[1]||''}</div></div>
    </div>
    <div class="result-btns">
      <button class="btn-home" onclick="goHome()">🚪 로비로 돌아가기</button>
      <button class="btn-share" onclick="shareResult()">📤 결과 공유하기</button>
    </div>`;
}

function shareResult() {
  const room = state.currentRoom;
  const elapsed = Math.floor((Date.now()-state.startTime)/1000);
  const text = `🔐 QUBE - ${room.name}\n${room.emoji} 탈출 성공! | ⏱ ${formatTime(elapsed)}\n\n나는 탈출했다. 당신은?\n👉 https://qube.salmonholic.com`;
  navigator.share ? navigator.share({text}) : (navigator.clipboard?.writeText(text), alert('클립보드에 복사됐습니다!'));
}

function copyKeyword(el) {
  const text = el.textContent.replace('🔎 ','').trim();
  navigator.clipboard?.writeText(text);
  const orig = el.textContent;
  el.textContent = '✓ 복사됨!';
  setTimeout(()=>el.textContent=orig, 1500);
}

// ─── 초기화 ───
createParticles();
renderHome();
</script>
</body>
</html>
